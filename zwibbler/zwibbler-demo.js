(function(){var aa="function"==typeof Object.defineProperties?Object.defineProperty:function(c,a,b){c!=Array.prototype&&c!=Object.prototype&&(c[a]=b.value)},ba="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function ca(c,a){if(a){for(var b=ba,d=c.split("."),e=0;e<d.length-1;e++){var f=d[e];f in b||(b[f]={});b=b[f]}d=d[d.length-1];e=b[d];f=a(e);f!=e&&null!=f&&aa(b,d,{configurable:!0,writable:!0,value:f})}}var da;
if("function"==typeof Object.setPrototypeOf)da=Object.setPrototypeOf;else{var ea;a:{var fa={Kp:!0},ha={};try{ha.__proto__=fa;ea=ha.Kp;break a}catch(c){}ea=!1}da=ea?function(c,a){c.__proto__=a;if(c.__proto__!==a)throw new TypeError(c+" is not extensible");return c}:null}var ia=da;ca("Object.setPrototypeOf",function(c){return c||ia});function ja(){ja=function(){};ba.Symbol||(ba.Symbol=ka)}var ka=function(){var c=0;return function(a){return"jscomp_symbol_"+(a||"")+c++}}();
function la(){ja();var c=ba.Symbol.iterator;c||(c=ba.Symbol.iterator=ba.Symbol("iterator"));"function"!=typeof Array.prototype[c]&&aa(Array.prototype,c,{configurable:!0,writable:!0,value:function(){return ma(this)}});la=function(){}}function ma(c){var a=0;return na(function(){return a<c.length?{done:!1,value:c[a++]}:{done:!0}})}function na(c){la();c={next:c};c[ba.Symbol.iterator]=function(){return this};return c}
function oa(c,a){la();c instanceof String&&(c+="");var b=0,d={next:function(){if(b<c.length){var e=b++;return{value:a(e,c[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d}ca("Array.prototype.keys",function(c){return c?c:function(){return oa(this,function(a){return a})}});ca("Array.prototype.values",function(c){return c?c:function(){return oa(this,function(a,b){return b})}});
ca("Array.prototype.fill",function(c){return c?c:function(a,b,d){var e=this.length||0;0>b&&(b=Math.max(0,e+b));if(null==d||d>e)d=e;d=Number(d);0>d&&(d=Math.max(0,e+d));for(b=Number(b||0);b<d;b++)this[b]=a;return this}});ca("Array.prototype.find",function(c){return c?c:function(a,b){a:{var d=this;d instanceof String&&(d=String(d));for(var e=d.length,f=0;f<e;f++){var c=d[f];if(a.call(b,c,f,d)){d=c;break a}}d=void 0}return d}});
var p=function(){var c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d])};return function(a,b){function d(){this.constructor=a}c(a,b);a.prototype=null===b?Object.create(b):(d.prototype=b.prototype,new d)}}();function pa(c){return"object"===typeof c&&"[object Array]"===Object.prototype.toString.apply(c)}function qa(c){return"string"===typeof c}function r(c){return"number"===typeof c}function ra(c){return"object"===typeof c};var t=function(){function c(){this.keys={}}c.prototype.contains=function(a){return a in this.keys};c.prototype.add=function(a){if(a instanceof Array)for(var b=0;b<a.length;b++)this.keys[a[b]]=!0;else this.keys[a]=!0};c.prototype.remove=function(a){delete this.keys[a]};c.prototype.Pf=function(a){var b,d;void 0===d&&(d="");if(!(a instanceof c))throw d||"Assertion failed";d=new c;for(b in this.keys)a.contains(b)||d.add(b);return d};c.prototype.ec=function(){var a;var b=[];for(a in this.keys)this.keys.hasOwnProperty(a)&&
b.push(a);return b};c.prototype.ud=function(){var a;var b=[];for(a in this.keys)this.keys.hasOwnProperty(a)&&b.push(parseFloat(a));return b};c.prototype.clear=function(){this.keys={}};c.prototype.sb=function(a){for(var b in this.keys)if(this.keys.hasOwnProperty(b)&&a(b))break};c.prototype.empty=function(){for(var a in this.keys)if(this.keys.hasOwnProperty(a))return!1;return!0};return c}();var x=new (function(){function c(){this.kn={};this.Zm={}}c.prototype.add=function(a,b){x.kn[a]=b};c.prototype.Fj=function(a,b){x.Zm[a]=b};c.prototype.encode=function(a,b){for(var d=a.split(","),e=b,f=0;f<d.length;f++)e=x.kn[d[f]](e);return e};c.prototype.decode=function(a,b){for(var d=a.split(","),e=b,f=0;f<d.length;f++)e=x.Zm[d[f]](e);return e};return c}());
x.add("base64",function(c){for(var a="",b,d,e,f,g,h,k=0;k<c.length;)b=c.charCodeAt(k++),d=c.charCodeAt(k++),e=c.charCodeAt(k++),f=b>>2,b=(b&3)<<4|d>>4,g=(d&15)<<2|e>>6,h=e&63,isNaN(d)?g=h=64:isNaN(e)&&(h=64),a=a+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h);
return a});
x.Fj("base64",function(c){var a="",b=0,d={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,a:26,b:27,c:28,d:29,e:30,f:31,g:32,h:33,i:34,j:35,k:36,l:37,m:38,n:39,o:40,p:41,q:42,r:43,s:44,t:45,u:46,v:47,w:48,x:49,y:50,z:51,0:52,1:53,2:54,3:55,4:56,5:57,6:58,7:59,8:60,9:61,"+":62,"/":63,"=":64};for(c=c.replace(/[^A-Za-z0-9\-_=\+\/]/g,"");b<c.length;){var e=d[c.charAt(b++)];var f=d[c.charAt(b++)];var g=d[c.charAt(b++)];var h=d[c.charAt(b++)];
e=e<<2|f>>4;f=(f&15)<<4|g>>2;var k=(g&3)<<6|h;a+=String.fromCharCode(e);64!==g&&(a+=String.fromCharCode(f));64!==h&&(a+=String.fromCharCode(k))}return a});
x.add("ascii85",function(c){for(var a="",b,d,e,f,g,h,k,l,m=0;m<c.length;)b=c.charCodeAt(m++),d=c.charCodeAt(m++),e=c.charCodeAt(m++),f=c.charCodeAt(m++),g=(b<<24|d<<16|e<<8|f)>>>0,b=(g/52200625|0)%85+33,h=(g/614125|0)%85+33,k=(g/7225|0)%85+33,l=(g/85|0)%85+33,g=g%85+33,a+=String.fromCharCode(b)+String.fromCharCode(h),isNaN(d)||(a+=String.fromCharCode(k),isNaN(e)||(a+=String.fromCharCode(l),isNaN(f)||(a+=String.fromCharCode(g))));return a+"~>"});
x.add("utf8",function(c){for(var a="",b=0;b<c.length;b++){var d=c.charCodeAt(b);128>d?a+=String.fromCharCode(d):(127<d&&2048>d?a+=String.fromCharCode(d>>6|192):(a+=String.fromCharCode(d>>12|224),a+=String.fromCharCode(d>>6&63|128)),a+=String.fromCharCode(d&63|128))}return a});
x.Fj("utf8",function(c){for(var a="",b=0;b<c.length;b++){var d=c.charCodeAt(b);127>=d?a+=String.fromCharCode(d):2047>=d?(a+=String.fromCharCode(192|d>>6),a+=String.fromCharCode(128|d&63)):65535>=d?(a+=String.fromCharCode(224|d>>12),a+=String.fromCharCode(128|d>>6&63),a+=String.fromCharCode(128|d&63)):1114111>=d?(a+=String.fromCharCode(240|d>>18),a+=String.fromCharCode(128|d>>12&63),a+=String.fromCharCode(128|d>>6&63),a+=String.fromCharCode(128|d&63)):a+=String.fromCharCode(63)}return a});
x.Fj("utf8",function(c){for(var a="",b=0;b<c.length;b++){var d=c.charCodeAt(b);128>d?a+=String.fromCharCode(d):(127<d&&2048>d?a+=String.fromCharCode(d>>6|192):(a+=String.fromCharCode(d>>12|224),a+=String.fromCharCode(d>>6&63|128)),a+=String.fromCharCode(d&63|128))}return a});x.add("hex",function(c){for(var a=[],b=0;b<c.length;b++){var d=c.charCodeAt(b);16>d&&a.push("0");a.push(d.toString(16))}return a.join("")});
x.add("sha1",function(c){var a=[1518500249,1859775393,2400959708,3395469782];c+=String.fromCharCode(128);for(var b=Math.ceil((c.length/4+2)/16),d=Array(b),e=0;e<b;e++){d[e]=Array(16);for(var f=0;16>f;f++)d[e][f]=c.charCodeAt(64*e+4*f)<<24|c.charCodeAt(64*e+4*f+1)<<16|c.charCodeAt(64*e+4*f+2)<<8|c.charCodeAt(64*e+4*f+3)}d[b-1][14]=8*(c.length-1)/Math.pow(2,32);d[b-1][14]=Math.floor(d[b-1][14]);d[b-1][15]=8*(c.length-1)&4294967295;c=1732584193;f=4023233417;var g=2562383102,h=271733878,k=3285377520,
l=Array(80);for(e=0;e<b;e++){for(var m=0;16>m;m++)l[m]=d[e][m];for(m=16;80>m;m++){var n=l[m-3]^l[m-8]^l[m-14]^l[m-16];l[m]=n<<1|n>>>31}n=c;var q=f;var u=g;var v=h;var z=k;for(m=0;80>m;m++){var w=Math.floor(m/20);a:switch(w){case 0:var y=q&u^~q&v;break a;case 1:y=q^u^v;break a;case 2:y=q&u^q&v^u&v;break a;default:y=q^u^v}w=(n<<5|n>>>27)+y+z+a[w]+l[m]&4294967295;z=v;v=u;u=q<<30|q>>>2;q=n;n=w}c=c+n&4294967295;f=f+q&4294967295;g=g+u&4294967295;h=h+v&4294967295;k=k+z&4294967295}return String.fromCharCode(c>>
24&255)+String.fromCharCode(c>>16&255)+String.fromCharCode(c>>8&255)+String.fromCharCode(c>>0&255)+String.fromCharCode(f>>24&255)+String.fromCharCode(f>>16&255)+String.fromCharCode(f>>8&255)+String.fromCharCode(f>>0&255)+String.fromCharCode(g>>24&255)+String.fromCharCode(g>>16&255)+String.fromCharCode(g>>8&255)+String.fromCharCode(g>>0&255)+String.fromCharCode(h>>24&255)+String.fromCharCode(h>>16&255)+String.fromCharCode(h>>8&255)+String.fromCharCode(h>>0&255)+String.fromCharCode(k>>24&255)+String.fromCharCode(k>>
16&255)+String.fromCharCode(k>>8&255)+String.fromCharCode(k>>0&255)});var sa=function(){function c(a,b,d){void 0===d&&(d="");this.name=a;this.attributes=b;this.text=d;this.children=[]}c.prototype.toString=function(){var a=[];this.Gm(a,"");return x.encode("utf8",a.join(""))};c.prototype.Gm=function(a,b){var d;if(this.hasAttributes()||0!==this.children.length){a.push(b);a.push("<");a.push(this.name);for(d in this.attributes)this.attributes.hasOwnProperty(d)&&(a.push(" "),a.push(d),void 0!==this.attributes[d]&&null!==this.attributes[d]&&(a.push('="'),a.push(this.vm(""+
this.attributes[d])),a.push('"')));if(this.children.length||void 0!==this.text){a.push(">\n");for(d=0;d<this.children.length;d++)this.children[d].Gm(a,b+"  ");void 0!==this.text&&a.push(b+"  "+this.vm(this.text));a.push(b+"</"+this.name+">")}else a.push("/>");a.push("\n")}};c.prototype.hasAttributes=function(){for(var a in this.attributes)if(this.attributes.hasOwnProperty(a))return!0;return!1};c.prototype.Mo=function(a){for(var b in a)a.hasOwnProperty(b)&&(this.attributes[b]=a[b])};c.prototype.Le=
function(a){this.children.push(a)};c.prototype.vm=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")};return c}();var A=function(){function c(a,b){this.type=a;this.values=b}c.lk=function(a){a.toLowerCase()in c.bm&&(a=c.bm[a.toLowerCase()]);var b=/#([0-9a-f])([0-9a-f])([0-9a-f])/i,d=/rgb\( *([0-9]+) *, *([0-9]+) *, *([0-9]+) *\)/,e=/rgba\( *([0-9]+) *, *([0-9]+) *, *([0-9]+) *, *([0-9\.]+) *\)/;var f=/#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/i.exec(a);if(null!==f)a=parseInt(f[1],16)/255,b=parseInt(f[2],16)/255,d=parseInt(f[3],16)/255,f=1;else if(f=e.exec(a),null!==f)a=parseFloat(f[1])/255,b=parseFloat(f[2])/
255,d=parseFloat(f[3])/255,f=parseFloat(f[4]);else if(f=d.exec(a),null!==f)a=parseFloat(f[1])/255,b=parseFloat(f[2])/255,d=parseFloat(f[3])/255,f=1;else if(f=b.exec(a),null!==f)a=parseInt(f[1],16),a=(16*a+a)/255,b=parseInt(f[2],16),b=(16*b+b)/255,d=parseInt(f[2],16),d=(16*d+d)/255,f=1;else return null;return new c(c.RGBA,[a,b,d,f])};c.Xb=function(a){return c.lk(a)||new c(c.RGBA,[1,0,1,1])};c.Us=function(a){var b=/#[0-9a-f]+|rgba?\([^\)]+\)|[a-z]+/gi,d=[],e;do(e=b.exec(a))&&d.push(e[0]);while(e);return d};
c.prototype.toString=function(){function a(b){b=Math.round(255*b);return 16>b?"0"+b.toString(16):b.toString(16)}var b=this.Ad(c.RGBA);return 1===b.values[3]?"#"+a(b.values[0])+a(b.values[1])+a(b.values[2]):"rgba("+Math.round(255*b.values[0])+","+Math.round(255*b.values[1])+","+Math.round(255*b.values[2])+","+b.values[3]+")"};c.prototype.Ad=function(a){return c.vq[this.type][a](this)};c.prototype.Oa=function(a){a.type!==this.type&&(a=a.Ad(this.type));if(this.type===c.Ac){var b=this.values[0],d=a.values[0];
b=b>d?Math.min(b-d,d-b+360):Math.min(d-b,b-d+360);b/=360;return Math.pow(b*b+(this.values[1]-a.values[1])*(this.values[1]-a.values[1])+(this.values[2]-a.values[2])*(this.values[2]-a.values[2]),.5)}return Math.pow((this.values[0]-a.values[0])*(this.values[0]-a.values[0])+(this.values[1]-a.values[1])*(this.values[1]-a.values[1])+(this.values[2]-a.values[2])*(this.values[2]-a.values[2]),.5)};c.RGBA=0;c.om=1;c.Ac=2;c.up=3;c.Qu=3;c.vq=[[ua,va,wa,xa],[ya,ua,za,Ba],[Ca,Da,ua,Ea],[Fa,Ga,Ha,ua]];c.bm={aliceblue:"#f0f8ff",
antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",
darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",
honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",
limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",
orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",
steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",transparent:"rgba(0,0,0,0.0)",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};return c}(),Ia=.9505,Ja=1,Ka=1.089;
function Ca(c){var a=c.values[0],b=c.values[1],d=c.values[2];0>a&&(a+=360);var e=a/60-Math.floor(a/60),f=d*(1-b),g=d*(1-e*b);b=d*(1-(1-e)*b);var h=e=0,k=0;switch(Math.floor(a/60)%6){case 0:e=d;h=b;k=f;break;case 1:e=g;h=d;k=f;break;case 2:e=f;h=d;k=b;break;case 3:e=f;h=g;k=d;break;case 4:e=b;h=f;k=d;break;case 5:e=d,h=f,k=g}return new A(A.RGBA,[e,h,k,c.values[3]])}
function wa(c){var a=c.values[0],b=c.values[1],d=c.values[2],e=Math.max(a,b,d),f=Math.min(a,b,d);return new A(A.Ac,[e===f?0:e===a?(60*(b-d)/(e-f)+360)%360:e===b?60*(d-a)/(e-f)+120:60*(a-b)/(e-f)+240,0===e?0:1-f/e,e,c.values[3]])}function Ba(c){function a(b){return b>6/29*(6/29)*(6/29)?Math.pow(b,1/3):1/3*(29/6)*(29/6)*b+4/29}var b=a(c.values[1]/Ja);return new A(A.up,[116*b-16,500*(a(c.values[0]/Ia)-b),200*(b-a(c.values[2]/Ka)),c.values[3]])}
function Ga(c){var a=(c.values[0]+16)/116,b=a+c.values[1]/500,d=a-c.values[2]/200,e=6/29;return new A(A.om,[b>e?Ia*b*b*b:3*(b-16/116)*e*e*Ia,a>e?Ja*a*a*a:3*(a-16/116)*e*e*Ja,d>e?Ka*d*d*d:3*(d-16/116)*e*e*Ka,c.values[3]])}function va(c){for(var a=[],b=0;3>b;b++)a[b]=.04045>=c.values[b]?c.values[b]/12.92:Math.pow((c.values[b]+.055)/1.055,2.4);return new A(A.om,[.4124*a[0]+.3576*a[1]+.1805*a[2],.2126*a[0]+.7152*a[1]+.0722*a[2],.0193*a[0]+.1192*a[1]+.9505*a[2],c.values[3]])}
function ya(c){var a=[],b=[0,0,0,0];a[0]=3.241*c.values[0]-1.5374*c.values[1]-.4986*c.values[2];a[1]=-.9692*c.values[0]+1.876*c.values[1]+.0416*c.values[2];a[2]=.0556*c.values[0]-.204*c.values[1]+1.057*c.values[2];for(var d=0;3>d;d++)b[d]=.0031308>=a[d]?12.92*a[d]:1.055*Math.pow(a[d],1/2.4)-.055;b[3]=c.values[3];return new A(A.RGBA,b)}function ua(c){return new A(c.type,c.values.concat())}function xa(c){return Ba(va(c))}function Fa(c){return ya(Ga(c))}function za(c){return wa(ya(c))}
function Da(c){return va(Ca(c))}function Ea(c){return xa(Ca(c))}function Ha(c){return za(Ga(c))};var B=new (function(){function c(){this.disabled={};this.ih=[];this.rq=!1}c.prototype.enable=function(a,b){void 0===b&&(b=!0);this.disabled[a]=!b};c.prototype.create=function(a,b){void 0===b&&(b=!0);!1===b&&(this.disabled[a]=!0);var d=this;return function(){for(var b=0;b<arguments.length;b++);d.ss(a,arguments)}};c.prototype.addListener=function(a){this.ih.push(a);return a};c.prototype.removeListener=function(a){for(var b=0;b<this.ih.length;b++)if(this.ih[b]===a){this.ih.splice(b,1);break}};c.prototype.Nq=
function(){this.rq||this.addListener(function(a,b){console.log(a+": "+b)})};c.prototype.ss=function(a,b){var d=[],e;if(!this.disabled[a]){var f=b[0].split("%s");d.push(f[0]);for(e=1;e<f.length;e++)e-1>=b.length-1?d.push("<too few args>"):"string"===typeof b[e]||"number"===typeof b[e]?d.push(b[e]):void 0===b[e]?d.push("(undefined)"):null===b[e]?d.push("(null)"):b[e]instanceof Object&&b[e].toString instanceof Function?d.push(b[e].toString()):d.push(JSON.stringify(b[e])),d.push(f[e]);d=d.join("");e=
0;for(f=this.ih;e<f.length;e++)(0,f[e])(a,d)}};return c}());(function(){function c(a){this.log=B.create("Layout");this.ie=a.itemSize||100;this.algorithm=a.algorithm||"wrap";this.Jn=a.gravity||"down";this.Mm=!1!==a.resize;"down"===this.Jn?(this.offsetWidth="offsetWidth",this.offsetHeight="offsetHeight",this.width="width",this.height="height",this.top="top",this.left="left",this.clientWidth="clientWidth",this.clientHeight="clientHeight"):"up"===this.Jn?(this.offsetWidth="offsetWidth",this.offsetHeight="offsetHeight",this.width="width",this.height="height",this.top=
"bottom",this.left="left",this.clientWidth="clientWidth",this.clientHeight="clientHeight"):(this.offsetWidth="offsetHeight",this.offsetHeight="offsetWidth",this.width="height",this.height="width",this.top="left",this.left="top",this.clientWidth="clientHeight",this.clientHeight="clientWidth")}c.prototype.$f=function(a){return a[this.offsetWidth]};c.prototype.gh=function(a){return a[this.offsetHeight]};c.prototype.ol=function(a,b){if(this.Mm){var d=this.$f(a),e=this.gh(a);a.style[this.width]=""+b+"px";
a.style[this.height]=""+b/d*e+"px"}};c.prototype.To=function(a,b){if(this.Mm){var d=this.$f(a),e=this.gh(a);a.style[this.height]=""+b+"px";a.style[this.width]=""+b/e*d+"px"}};c.prototype.hf=function(a,b,d){a.style[this.top]=d+"px";a.style[this.left]=b+"px"};c.prototype.js=function(a){"absolute"!==window.getComputedStyle(a).getPropertyValue("position")&&(a.style.position="relative");for(var b=0;b<a.children.length;b++)a.children[b].style.position="absolute";"wrap"===this.algorithm?this.ms(a):"mason"===
this.algorithm?this.ks(a):"perfect"===this.algorithm&&this.ls(a)};c.prototype.ms=function(a){for(var b=a[this.clientWidth],d=0,e=0,f=0,c=0;c<a.children.length;c++){var h=a.children[c];this.ol(h,this.ie);var k=this.$f(h),l=this.gh(h);d+k>b?0===d?(this.hf(h,d,e),e+=l):(e+=f,d=0,this.hf(h,d,e),f=l):(this.hf(h,d,e),d+=k,f=Math.max(f,l))}};c.prototype.ks=function(a){var b=a[this.clientWidth],d;if(0>=b)this.log("Skipping layout; width is <= 0");else{this.log("Laying out to width %s",b);var e=Math.round(b/
this.ie);this.ie=b/e;b=[];for(var f=0;f<e;f++)b.push(0);for(f=0;f<a.children.length;f++){var c=a.children[f];this.ol(c,this.ie);var h=this.gh(c),k=0;for(d=1;d<e;d++)b[d]<b[k]&&(k=d);d=k*this.ie;var l=b[k];this.hf(c,d,l);b[k]+=h}}};c.prototype.ls=function(a){var b=a[this.clientWidth],d=0,e=[];var f=0;for(var c,h=0;h<a.children.length;h++){var k=a.children[h];this.To(k,this.ie);var l=this.$f(k);if(f+l>b)if(0===e.length){this.hf(k,0,d);this.ol(k,b);d+=this.gh(k);continue}else{for(var m=b/f,n=f=0;n<e.length;n++)c=
e[n],this.To(c,this.ie*m),this.hf(c,f,d),f+=this.$f(c);d+=this.ie*m;f=0;e.length=0}e.push(k);f+=l}for(h=f=0;h<e.length;h++)c=e[h],this.hf(c,f,d),f+=this.$f(c)};return c})();function Ma(){this.length=0}var Na=B.create("JQUERY"),Oa,Pa=/\s+/,Qa=/^[\s\xA0]+/,Ra=/[\s\xA0]+$/,Sa=/[\n\t]/g,Ta,Ua={B:1,BIG:1,I:1,SMALL:1,TT:1,ABBR:1,ACRONYM:1,CITE:1,CODE:1,DFN:1,EM:1,KBD:1,STRONG:1,SAMP:1,VAR:1,A:1,BDO:1,BR:1,IMG:1,MAP:1,OBJECT:1,Q:1,SCRIPT:1,SPAN:1,SUB:1,SUP:1,BUTTON:1,INPUT:1,LABEL:1,SELECT:1,TEXTAREA:1},Va=[],Wa=!1;function Xa(){!Wa&&window.attachEvent&&(window.attachEvent("onresize",function(c){for(var a=0;a<Va.length;a++)Va[a](c)}),Wa=!0)}
function Ya(c,a,b,d){this.name=c;this.Mq=a;this.vi=b;this.Gu=d}
function Za(c,a){var b=/#(.*)$/,d=/\.(.*)$/,e=/^<\s*([a-zA-Z0-9]+).*>$/,f=/^([A-Za-z]+)$/;a=a||document;var g=new Ma,h;try{var k=("object"===typeof HTMLElement?c instanceof HTMLElement:"object"===typeof c&&1===c.nodeType&&"string"===typeof c.nodeName||3===c.nodeType)||c===window||c===document||c===document.body||c instanceof Element}catch(q){k=!1}if(k)return g[g.length++]=c,g;if(c instanceof Ma)return c;k=c.split(",");for(var l=0;l<k.length;l++){var m=k[l];if(null!==(h=b.exec(m)))h=document.getElementById(h[1]),
null!==h&&(g[g.length++]=h);else if(null!==(h=e.exec(m)))h=h[1],g[g.length++]=document.createElement(h);else if(null!==(h=d.exec(m))){m=g;h=Ta(a,h[1]);for(var n=0;n<h.length;n++)m[m.length++]=h[n]}else if(null!==(h=f.exec(m)))for(m=g,h=a.getElementsByTagName(h[1]),n=0;n<h.length;n++)m[m.length++]=h[n];else throw console.log(m),"Error: can't parse selector: "+m+" ("+m.nodeType;}return g}
Ma.prototype={first:function(){var c=new Ma;this.length&&(c[c.length++]=this[0]);return c},children:function(){for(var c=new Ma,a=0;a<this.length;a++)for(var b=this[a].firstChild;b;)c[c.length++]=b,b=b.nextSibling;return c},Xa:function(){for(var c=0;c<this.length;c++){var a=C(this[c]).ea("display");"none"!==a&&(this[c].mo=a);this[c].style.display="none"}return this},show:function(){for(var c=0;c<this.length;c++)this[c].mo?this[c].style.display=this[c].mo:"none"===C(this[c]).ea("display")&&(this[c].style.display=
this[c].tagName in Ua?"inline":"block");return this},toggle:function(c){void 0===c&&this.length&&(c="none"===this.ea("display"));c?this.show():this.Xa()},append:function(c){c=Za(c);if(0<this.length)for(var a=0;a<c.length;a++)this[0].appendChild(c[a]);return this},Ij:function(c){c=Za(c);if(0<c.length)for(var a=0;a<this.length;a++)c[0].appendChild(this[a]);return this},remove:function(){for(var c=0;c<this.length;c++)this[c].parentNode&&this[c].parentNode.removeChild(this[c]);return this},empty:function(){for(var c=
0;c<this.length;c++)for(;null!==this[c].firstChild;)this[c].removeChild(this[c].firstChild);return this},text:function(c){if(0===arguments.length){var a="";$a(this,function(b){3===b.nodeType&&(a+=b.nodeValue)});return a}for(var b=0;b<this.length;b++){for(;null!==this[b].firstChild;)this[b].removeChild(this[b].firstChild);this[b].appendChild(document.createTextNode(c))}return this},xg:function(c){this.sb(function(a,b){Na("Trigger "+c);if(document.createEventObject){var d=document.createEventObject();
if("resize"===c){Na("Calling stored window resize functions");for(var e=0;e<Va.length;e++)Va[e](d)}else b.fireEvent("on"+c,d)}else d=document.createEvent("HTMLEvents"),d.initEvent(c,!0,!0),b.dispatchEvent(d)})},width:function(c){if(0<this.length){if(1===arguments.length){for(var a=Math.max(0,arguments[0]),b=0;b<this.length;b++)this[b].style.width=""+a+"px";return this}return this[0]===window?this[0].innerWidth||document.documentElement.clientWidth:this[0].clientWidth}return 0},height:function(){if(0<
this.length){if(1===arguments.length){for(var c=0;c<this.length;c++)this[c].style.height=""+arguments[0]+"px";return this}return this[0]===window?this[0].innerHeight||document.documentElement.clientHeight:this[0].clientHeight}return 0},outerWidth:function(){return 0<this.length?this[0].offsetWidth:0},outerHeight:function(){return 0<this.length?this[0].offsetHeight:0},offset:function(c){if(c){if(0<this.length){var a=this.offsetParent().offset();this[0].style.left=c.left-a.left+"px";this[0].style.top=
c.top-a.top+"px"}return this}if(0<this.length){c=this[0].getBoundingClientRect();if("pageYOffset"in window){a=window.pageXOffset;var b=window.pageYOffset}else a=document.body.scrollLeft,b=document.body.scrollTop;if(this[0]!==document.body)for(var d=this[0].parentNode;d&&d!==document.body&&"scrollTop"in d;)a+=d.scrollLeft,b+=d.scrollTop,d=d.parentNode;return{top:c.top+b,left:c.left+a}}return{left:0,top:0}},offsetParent:function(){if(0===this.length)return null;if("fixed"===this.ea("position"))return C(document.body);
for(var c=this[0].parentNode;c&&"static"===C(c).ea("position")&&"BODY"!==c.tagName;)c=c.parentNode;return C(c)},clone:function(){return this.length?Za(this[0].cloneNode(!0)):new Ma},find:function(c){return this.length?Za(c,this[0]):new Ma},Jb:function(c,a){if(2===arguments.length){for(var b=0;b<this.length;b++)this[b].setAttribute(c,a);return this}return 0<this.length?this[0].getAttribute(c):""},replaceWith:function(c){this.length&&this[0].parentNode.replaceChild(c[0],this[0]);return this},sb:function(c){for(var a=
0;a<this.length;a++)c(a,this[a])},focus:function(){0<this.length&&this[0].focus();return this},blur:function(){0<this.length&&this[0].blur();return this},submit:function(){for(var c=0;c<this.length;c++)this[c].submit();return this},select:function(){for(var c=0;c<this.length;c++)this[c].select();return this},ea:function(c,a){var b=c.split("-");c=b[0];for(var d=1;d<b.length;d++)c="ms"!==b[d]?c+(b[d].substr(0,1).toUpperCase()+b[d].substr(1)):c+b[d];if(2===arguments.length){for(d=0;d<this.length;d++)this[d].style[c]=
""+a;return this}return this[0].currentStyle?this[0].currentStyle[c]:window.getComputedStyle?window.getComputedStyle(this[0],null)[c]:this[0].style[c]},xa:function(c,a){function b(b){d[0]===window&&"resize"===b&&window.attachEvent?(Va.push(a),Xa()):window.addEventListener?d.sb(function(d,e){function f(b){b.uo=b;"which"in b||(b.which=b.button);return a.call(e,b)}e.__JqlListeners||(e.__JqlListeners=[]);f.Ap=c;a.Ap=c;e.addEventListener(b,f,!1);e.__JqlListeners.push(new Ya(b,e,a,f))}):d.sb(function(d,
e){e.attachEvent("on"+b,function(b){b.uo=b;b.which=b.button;b.pageX=b.clientX;b.pageY=b.clientY;b.preventDefault=function(){b.returnValue=!1};b.stopPropagation=function(){b.cancelBubble=!0};b.target=b.target||b.srcElement;return a.call(e,b)})})}var d=this;c=c.split(" ");for(var e=0;e<c.length;e++)b(c[e]);return this},bind:function(c,a){return this.xa(c,a)},yg:function(c,a){window.addEventListener&&this.sb(function(b,d){if(d.__JqlListeners)for(var e=d.__JqlListeners,f=0;f<e.length;f++){var g=e[f];
if(c===g.name&&d===g.Mq&&a===g.vi){d.removeEventListener(c,g.Gu,!1);e.splice(f,1);break}}});return this},click:function(c){return c?this.xa("click",c):this.xg("click")},load:function(c){return this.xa("load",c)},gd:function(c){return this.xa("change",c)},resize:function(c){c?this.xa("resize",c):this.xg("resize");return this},scrollLeft:function(c){if(1===arguments.length){for(var a=0;a<this.length;a++)this[a].scrollLeft=c;return this}return this[0].scrollLeft},scrollTop:function(c){if(1===arguments.length){for(var a=
0;a<this.length;a++)this[a].scrollTop=c;return this}return this[0].scrollTop}};function ab(c){for(var a=0;a<c.length;a++)c[a].style.display="block"}function eb(c,a){c.xa("mouseout",a)}function fb(c,a){c.xa("mouseover",a)}function gb(c,a){c.xa("dblclick",a)}function hb(c,a){c.xa("mousemove",a)}function ib(c,a){c.xa("mousedown",a)}function jb(c,a){c.xa("keydown",a)}function kb(){var c=C("<input>").Jb("type","button");c[0].value="OK";return c}
function lb(c,a){if(a&&"string"===typeof a)for(var b=(a||"").split(Pa),d=0,e=c.length;d<e;d++){var f=c[d];if(1===f.nodeType)if(f.className){for(var g=" "+f.className+" ",h=f.className,k=0,l=b.length;k<l;k++)0>g.indexOf(" "+b[k]+" ")&&(h+=" "+b[k]);f.className=Oa.trim(h)}else f.className=a}return c}function mb(c,a){for(var b=0;b<c.length;b++)c[b].innerHTML=a}function nb(c,a){a=Za(a);0<c.length&&0<a.length&&a[0].parentNode.insertBefore(c[0],a[0])}
function ob(c,a){a=Za(a);0<c.length&&0<a.length&&a[0].parentNode.insertBefore(c[0],a[0].nextSibling)}function $a(c,a){for(var b=[],d=c.length-1;0<=d;d--)b.push(c[d]);for(;b.length;)for(d=b.pop(),a(d),d=d.lastChild;d;)b.push(d),d=d.previousSibling}Oa=function(c){return Za(c)};Oa.trim=function(c){return null===c?"":c.toString().replace(Qa,"").replace(Ra,"")};
Oa.Sp=function(c){var a=c.url||"",b=c.type||"GET",d=c.cu||function(){},e=c.error||function(){},f=c.data||"";c=c.$p||function(){};var g="";try{var h=new XMLHttpRequest}catch(l){try{h=new ActiveXObject("Msxml2.XMLHTTP")}catch(m){try{h=new ActiveXObject("Microsoft.XMLHTTP")}catch(n){e(null,"",null)}}}if("object"===typeof f)for(var k in f)Object.hasOwnProperty.call(f,k)&&(g.length&&(g+="&"),g+=encodeURIComponent(k),g+="=",g+=encodeURIComponent(f[k]));"GET"===b&&(a+="?"+g,g="");c(h,h);h.open(b,a,!0);h.onreadystatechange=
function(){if(4===h.readyState)if(200===h.status){var b=h.responseText,a=h.getResponseHeader("content-type");if(a&&0===a.indexOf("application/json"))try{b=Oa.Xs(b)}catch(n){}d(b,"",h)}else e(h,"",null)};"POST"===b&&h.setRequestHeader("Content-Type","application/x-www-form-urlencoded");h.send(g)};
Ta=function(c,a){var b=[],d;var e=a.split(/\s+/);for(d=0;d<e.length;d++){var f=e[d].replace(/([\/\\\^$*+?.()|\[\]{}])/g,"\\$1");b.push(new RegExp("(^|\\s)"+f+"(\\s|$)"))}var g=c.getElementsByTagName("*"),h=[];d=0;for(f=g.length;d<f;d++){var k=g[d],l=!0;for(e=0;e<b.length;e++)if(!b[e].test(k.className)){l=!1;break}l&&h.push(k)}return h};Oa.Xs=function(c){return window.JSON.parse(c)};
Oa.extend=function(c){for(var a=arguments[0],b=1;b<arguments.length;b++){var d=arguments[b],e;for(e in d)d.hasOwnProperty(e)&&(a[e]=d[e])}return a};Oa.fn=Ma.prototype;var C=Oa;var pb=function(){function c(a,b){this.Ss=a;this.name=b;this.ia=C("<div>").ea("border-top","1px solid #888").ea("padding","5px").ea("cursor","default");this.Ss.append(this.ia);this.update(0)}c.prototype.update=function(a){this.ia.text(this.name+"... "+Math.round(100*a)+"%")};c.prototype.error=function(a){var b=this,d=kb();d.click(function(){b.done()});mb(this.ia,this.name+"... "+a+" ");this.ia.append(d)};c.prototype.done=function(){this.ia.remove()};c.all=[];return c}();var qb=function(){function c(a,b,d,e,f){void 0===a&&(a="transparent");void 0===b&&(b=0);void 0===d&&(d=0);void 0===e&&(e=0);void 0===f&&(f=0);this.Me=a;this.left=b;this.top=d;this.right=e;this.bottom=f;this.zIndex=1;this.insertBefore=null;this.ia=C("<div>")}c.prototype.Xa=function(){this.ia&&this.ia.remove()};c.prototype.show=function(a){this.ia.ea("position","fixed");this.ia.ea("background",this.Me);this.ia.ea("opacity","0.25");this.ia.ea("left",""+this.left+"px");this.ia.ea("top",""+this.top+"px");
this.ia.ea("right",""+this.right+"px");this.ia.ea("bottom",""+this.bottom+"px");this.ia.ea("display","none");this.ia.click(function(b){a(b)});this.insertBefore?(this.ia.ea("z-index",""+this.zIndex),nb(C(this.ia),this.insertBefore)):(this.ia.ea("z-index",""+this.zIndex),C("body").append(this.ia));ab(this.ia)};return c}();var rb=function(){function c(a){this.Sc=this.Rd=0;this.ia=a;this.ia.ea("position","absolute");this.ia.ea("margin","0px");this.ia.ea("padding","0px")}c.prototype.width=function(a){function b(b){b=parseInt(d.ia.ea(b),10);return isNaN(b)?0:b}var d=this;if(void 0===a)return this.ia.outerWidth();a-=b("border-left-width");a-=b("border-right-width");a-=b("padding-right");a-=b("padding-left");a-=b("margin-left");a-=b("margin-right");this.Rd=a=Math.max(0,a);this.ia.ea("width",""+a+"px");return a};c.prototype.height=
function(a){function b(b){b=parseInt(d.ia.ea(b),10);return isNaN(b)?0:b}var d=this;if(void 0===a)return this.ia.outerHeight();a-=b("border-top-width");a-=b("border-bottom-width");a-=b("padding-top");a-=b("padding-bottom");a-=b("margin-top");a-=b("margin-bottom");this.Sc=a=Math.max(0,a);this.ia.ea("height",""+this.Sc+"px");return a};c.prototype.moveTo=function(a,b){null!==a&&this.ia.ea("left",""+a+"px");null!==b&&this.ia.ea("top",""+b+"px")};c.prototype.show=function(){this.ia.show()};c.prototype.Xa=
function(){this.ia.Xa()};c.prototype.Of=function(){this.ia.remove()};return c}();var sb=function(){function c(){this.Pg=[];this.log=B.create("DESTRUCTOR")}c.prototype.add=function(a){this.Pg.push(a)};c.prototype.bind=function(a,b,d){a.bind(b,d);this.add(function(){a.yg(b,d)})};c.prototype.Of=function(){this.log("Running %s destructors",this.Pg.length);for(var a=this.Pg.length-1;0<=a;a--)this.Pg[a]();this.Pg.length=0};return c}();var tb=function(c){function a(b,a){var d=c.call(this,b)||this;d.Ok=0;d.Gk={};d.xb=!1;d.timeout=null;d.lines=[];d.Lb="#ffffff #008800 #008888 #880000 #880088 #884400 #888888 #444444 #0000ff #00ff00 #00ffff #ff0000 #ff00ff #ffff00".split(" ");d.ia.ea("background","black");d.ia.ea("font-family",'"Lucida Console","Dejavu Sans Mono",Monospace,"Courier New"');d.ia.ea("font-size","11px");d.ia.ea("line-height","12px");d.ia.ea("overflow","scroll");d.ia.ea("cursor","default");d.os=B.addListener(function(b,
a){return d.Jm(b,a)});a.add(function(){B.removeListener(d.os)});d.Jm("DEBUG","Debug window starting");d.$u=d.Lb[0];return d}p(a,c);a.prototype.show=function(){rb.prototype.show.call(this);this.xb=!0;this.pm();this.ia[0].scrollTop=this.ia[0].scrollHeight};a.prototype.Xa=function(){this.xb=!1;rb.prototype.Xa.call(this)};a.prototype.mr=function(b){b in this.Gk||(this.Gk[b]=this.Lb[this.Ok],this.Ok=(this.Ok+1)%this.Lb.length);return this.Gk[b]};a.prototype.Jm=function(b,a){var d,f=this;var c=a.split("\n");
var h=0;for(d=c.length;h<d;h++){var k=c[h];this.lines.push({key:b,line:k})}this.xb&&null===this.timeout&&(this.timeout=setTimeout(function(){return f.pm()},100))};a.prototype.pm=function(){var b;var a=this.ia[0].scrollTop>this.ia[0].scrollHeight-this.ia[0].clientHeight-100;var e=this.lines;var f=0;for(b=e.length;f<b;f++){var c=e[f];var h=c.key;c=c.line;var k=this.mr(h);k=C("<div>").ea("color",k);k.ea("border-bottom","1px solid #222");k.text(""+h+": "+c);this.ia.append(k)}a&&(this.ia[0].scrollTop=
this.ia[0].scrollHeight);this.timeout=null;this.lines.length=0};return a}(rb);function ub(c,a){function b(b){for(var a=b.changedTouches,d=0;d<a.length;d++){var e;a:{var f=a[d],c=-1;if("identifier"in f)for(e=0;e<k.length;e++){if(f.identifier===k[e].identifier)break a}else{var l=0;for(e=0;e<k.length;e++){var n=k[e].Qf(f);if(-1===c||n<l)c=e,l=n}}e=c}-1===e?"touchend"!==b.type&&(k.push(new h(a[d])),g("New touch %s",a[d].identifier)):"touchend"!==b.type?(k[e].pageX=a[d].pageX,k[e].pageY=a[d].pageY):(g("Remove touch %s",a[d].identifier),k.splice(e,1))}}function d(){for(var b=0,a=
0,d=0;d<k.length;d++)g("Active touch: %s,%s",k[d].pageX,k[d].pageY),b+=k[d].pageX,a+=k[d].pageY;return{x:b/k.length,y:a/k.length}}function e(b,a){for(var d=0,e=0;e<k.length;e++){var f=k[e];d+=Math.sqrt((f.pageX-b)*(f.pageX-b)+(f.pageY-a)*(f.pageY-a))}return d/k.length}function f(b,a){b.preventDefault=function(){a.preventDefault()};b.stopPropagation=function(){a.stopPropagation()};return b}var g=B.create("GESTURES");if(c.iv)c.addEventListener("gesture",a,!1),g("No emulation needed");else{var h=function(){function b(b){this.Bh=
b.pageX;this.Ch=b.pageY;this.pageX=b.pageX;this.pageY=b.pageY;this.identifier=b.identifier}b.prototype.Qf=function(b){return Math.sqrt((this.pageX-b.pageX)*(this.pageX-b.pageX)+(this.pageY-b.pageY)*(this.pageY-b.pageY))};return b}(),k=[],l=!1,m=1,n=0,q,u;c.addEventListener("touchstart",function(c){b(c);g("touchend; inGesture=%s active.length=%s",l,k.length);2<=k.length&&!l&&(l=!0,u=d(),q=e(u.x,u.y),m=1,n=0,a(f({type:"gesturestart",pageX:u.x,pageY:u.y,scale:m,rotation:n},c)))});c.addEventListener("touchmove",
function(c){b(c);if(2<=k.length){u=d();m=e(u.x,u.y)/q;for(var g=u.x,h=u.y,l=0,v=0;v<k.length;v++)l+=Math.atan2(k[v].pageY-h,k[v].pageX-g)-Math.atan2(k[v].Ch-h,k[v].Bh-g);n=l/k.length/Math.PI*180;a(f({type:"gesturechange",pageX:u.x,pageY:u.y,scale:m,rotation:n},c))}});c.addEventListener("touchend",function(d){b(d);g("touchend; inGesture=%s active.length=%s",l,k.length);l&&2>k.length&&(l=!1,a(f({type:"gestureend",pageX:u.x,pageY:u.y,scale:m,rotation:n},d)))})}};var vb=function(){function c(a,b){this.ia=a;this.size=b;this.canvas=document.createElement("canvas");this.lb=0;this.Xh=!1;this.cg="";this.strokeStyle="#000000";this.Id={x:0,y:0};this.Ye={x:0,y:0};this.gg={x:0,y:0};this.mid={x:0,y:0};this.log=B.create("ColourWheel");this.height=this.width=b;this.canvas.width=this.width;this.canvas.height=this.height;this.canvas.style.cursor="crosshair";this.ia.appendChild(this.canvas);"G_vmlCanvasManager"in window&&window.G_vmlCanvasManager.initElement(this.canvas);
this.ka=this.canvas.getContext("2d");var d=document.createElement("input");d.setAttribute("type","range");this.wg=document.createElement("input");this.wg.setAttribute("type","checkbox");"range"===d.type?(this.ia.appendChild(document.createElement("br")),this.ia.appendChild(d),d.min="0",d.max="255",d.value="255",this.yd=d):(this.yd=null,d="colourcheckbox"+this.lb,this.wg.setAttribute("id",d),this.ia.appendChild(document.createElement("br")),this.ia.appendChild(this.wg),this.lb+=1,d=C("<label>").Jb("for",
d).text("Transparent"),this.ia.appendChild(d[0]));this.cb=this.height;this.he=.8*this.height;if(c.Cache[b])this.data=c.Cache[b];else{d=this.ka.getImageData(0,0,this.cb,this.cb);for(var e=this.cb/2,f=this.he/2,g,h=0;h<this.cb;h++){var k=Math.sqrt(e*e-(h-e)*(h-e)),l=Math.floor(-k+e),m=Math.floor(k+e),n=f*f-(h-e)*(h-e);if(0<=n){k=Math.sqrt(n);n=Math.floor(-k+e);var q=Math.floor(k+e);for(k=h*this.cb*4+4*l;l<=n;l++)g=Math.atan2(h-e,l-e),g=new A(A.Ac,[g/Math.PI*180,1,1,1]),g=g.Ad(A.RGBA),d.data[k++]=255*
g.values[0],d.data[k++]=255*g.values[1],d.data[k++]=255*g.values[2],d.data[k++]=255;k=h*this.cb*4+4*q;l=q}else k=h*this.cb*4+4*l;for(;l<=m;l++)g=Math.atan2(h-e,l-e),g=new A(A.Ac,[g/Math.PI*180,1,1,1]),g=g.Ad(A.RGBA),d.data[k++]=255*g.values[0],d.data[k++]=255*g.values[1],d.data[k++]=255*g.values[2],d.data[k++]=255}this.data=d;c.Cache[b]=d}this.kb=new A(A.Ac,[20,1,1,1]);this.update();this.ja();var u=this;u.Xh=!1;u.cg="";ib(C(this.canvas),function(b){if("mousedown"===b.type){var a=C(u.canvas).offset(),
d=b.pageX-a.left;a=b.pageY-a.top;u.Xh=!0;u.Um(d,a);b.stopPropagation();b.preventDefault()}});hb(C(this.canvas),function(b){if(u.Xh&&"mousemove"===b.type){var a=C(u.canvas).offset();u.Um(b.pageX-a.left,b.pageY-a.top)}b.stopPropagation();b.preventDefault()});C(window).xa("mouseup",function(){u.Xh=!1;u.cg=""});null!==this.yd&&C(this.yd).gd(function(){u.yd&&(u.kb.values[3]=parseFloat(u.yd.value)/255,u.update(),u.ja())});C(this.wg).gd(function(){u.kb.values[3]=u.wg.checked?0:1;u.update();u.ja()})}c.prototype.Ro=
function(a){this.kb=A.Xb(a).Ad(A.Ac);null!==this.yd&&(this.yd.value=""+Math.round(255*this.kb.values[3]));this.wg.checked=0===this.kb.values[3]?!0:!1;this.ja();this.update()};c.prototype.update=function(){this.Yk&&this.Yk(this.kb.toString())};c.prototype.ja=function(){this.ka.save();this.ka.lineWidth=1;this.ka.fillStyle="rgb(128, 128, 128)";this.ka.fillRect(0,0,this.width,this.height);this.ka.putImageData(this.data,0,0);var a=this.kb.values[0]/180*Math.PI;this.ka.beginPath();var b={x:Math.cos(a)*
this.he/2+this.cb/2,y:Math.sin(a)*this.he/2+this.cb/2},d={x:Math.cos(a+2*Math.PI/3)*this.he/2+this.cb/2,y:Math.sin(a+2*Math.PI/3)*this.he/2+this.cb/2},e={x:Math.cos(a+4*Math.PI/3)*this.he/2+this.cb/2,y:Math.sin(a+4*Math.PI/3)*this.he/2+this.cb/2},f=Math.cos(a)*this.cb/2+this.cb/2,c=Math.sin(a)*this.cb/2+this.cb/2;a={x:d.x+(e.x-d.x)/2,y:d.y+(e.y-d.y)/2};this.ka.moveTo(b.x,b.y);this.ka.lineTo(d.x,d.y);this.ka.lineTo(e.x,e.y);this.ka.lineTo(b.x,b.y);var h=this.ka.createLinearGradient(d.x,d.y,e.x,e.y);
h.addColorStop(0,"#ffffff");h.addColorStop(1,"#000000");this.ka.fillStyle=h;this.ka.fill();h=this.ka.createLinearGradient(b.x,b.y,a.x,a.y);var k=this.kb.Ad(A.Ac);k.values[1]=1;k.values[2]=1;k=k.Ad(A.RGBA);k.values[3]=1;h.addColorStop(0,k.toString());k.values[3]=0;h.addColorStop(1,k.toString());this.ka.fillStyle=h;this.ka.fill();this.strokeStyle="#000000";this.ka.beginPath();this.ka.moveTo(b.x,b.y);this.ka.lineTo(f,c);this.ka.stroke();c=1-this.kb.values[2];f=this.kb.values[1]*b.x+c*e.x+(1-this.kb.values[1]-
c)*d.x;c=this.kb.values[1]*b.y+c*e.y+(1-this.kb.values[1]-c)*d.y;this.ka.beginPath();this.ka.arc(f,c,4,0,2*Math.PI,!1);this.ka.stroke();this.ka.restore();this.Id=b;this.Ye=d;this.gg=e;this.mid=a};c.prototype.Um=function(a,b){var d=Math.sqrt((a-this.cb/2)*(a-this.cb/2)+(b-this.cb/2)*(b-this.cb/2));if("ring"===this.cg||"triangle"!==this.cg&&d>=this.he/2&&d<=this.cb/2)this.kb.values[0]=Math.atan2(this.cb/2-b,this.cb/2-a)/Math.PI*180+180,0===this.kb.values[1]&&(this.kb.values[1]=1,this.kb.values[2]=1),
this.cg="ring";else{var e=this.Id;d=this.Ye;var f=this.gg;var c=(e.x-f.x)*(d.y-f.y)-(d.x-f.x)*(e.y-f.y);d=((d.y-f.y)*(a-f.x)-(d.x-f.x)*(b-f.y))/c;c=1-Math.max(0,d)-Math.max(0,(-(e.y-f.y)*(a-f.x)+(e.x-f.x)*(b-f.y))/c);this.kb.values[1]=Math.min(Math.max(d,0),1);this.kb.values[2]=1-Math.min(Math.max(c,0),1);this.cg="triangle"}0===this.kb.values[3]&&(this.kb.values[3]=1,null!==this.yd&&(this.yd.value="255"));this.ja();this.update()};c.isSupported=function(){var a=document.createElement("canvas");"G_vmlCanvasManager"in
window&&window.G_vmlCanvasManager.initElement(a);return a.getContext&&a.getContext("2d").getImageData};c.Cache=[];return c}();var wb=function(){function c(a){this.code="en";this.data={};this.log=B.create("LANGUAGE");this.data=this.wo(a,{})}c.prototype.Uo=function(a){a=a.split(",");this.log("Choice of languages: %s",a);for(var b=0;b<a.length;b++){var d=a[b].split("-")[0];if(d in this.data){this.log("Using language code %s",d);this.code=d;break}else this.log("No language for code %s",d)}};c.prototype.Hj=function(a){this.wo(a,this.data)};c.prototype.wo=function(a,b){for(var d=a.split("\n"),e=/^([ \t]*)([^:]+):([^:]+):(.*)/,
f=0;f<d.length;f++){var c=e.exec(d[f]);if(c){var h=c[2],k=c[3];c=c[4];h in b||(b[h]={});k in b[h]&&this.log("Warning: Replacing %s:%s",h,k);b[h][k]=c}}return b};c.prototype.fn=function(){var a=this;return function(b){for(var d=[],e=1;e<arguments.length;e++)d[e-1]=arguments[e];return a.xm(b,d)}};c.prototype.get=function(a){for(var b=[],d=1;d<arguments.length;d++)b[d-1]=arguments[d];return this.xm(a,b)};c.prototype.xm=function(a,b){var d="<not translated:"+a+">";this.code in this.data&&a in this.data[this.code]&&
(d=this.data[this.code][a]);for(var e=0;e<b.length;e++)d=d.replace("^"+e,b[e]);return d};return c}();var xb=B.create("SharedTree");
(function(){function c(){this.ra={};this.log=B.create("DebugTree");this.root={vb:"0",parent:null,children:[],aa:{name:"root"}};this.ra["0"]=this.root}c.prototype.createNode=function(a,b,d,e){this.log("create node "+a+" child of "+b);b=this.ra[b];e={vb:a,parent:b,children:[],aa:e};b.children.splice(d,0,e);this.ra[a]=e};c.prototype.sc=function(a){this.log("delete node "+a);if(a in this.ra){var b=this.ra[a].parent;if(b)for(var d=0;d<b.children.length;d++)if(b.children[d].vb===a){b.children.splice(d,
1);break}delete this.ra[a]}};c.prototype.le=function(a,b,d){this.log("move "+a+" to "+b+":"+d);if(a in this.ra){var e=this.ra[a];this.sc(a);this.createNode(a,b,d,e.aa)}};c.prototype.Cb=function(a,b){if(a in this.ra)for(var d in b)b.hasOwnProperty(d)&&(this.ra[a].aa[d]=b[d])};c.prototype.uc=function(a){return a in this.ra?this.ra[a].aa:{}};c.prototype.ta=function(){};c.prototype.toString=function(){return this.encode(this.root)};c.prototype.encode=function(a){for(var b="("+a.aa.name,d=0;d<a.children.length;d++)b+=
" "+this.encode(a.children[d]);return b+")"};return c})();function yb(c){c=c.split("-");return c[0]+"-"+(parseInt(c[1])+1)}
var zb=function(){function c(a,b){this.Jc=a;this.index=b}c.prototype.encode=function(){return this.Jc+";"+this.index};return c}(),Ab=function(){function c(a,b,d){this.rc=a;this.jg=b;this.type=d}c.prototype.encode=function(){return""};return c}(),Bb=function(c){function a(b,a,e,f,g,h){b=c.call(this,b,a,"c")||this;b.vb=e;b.Zu=f;b.aa=h;b.type="c";b.bb=new zb(f,g);return b}p(a,c);a.prototype.encode=function(){var b=JSON.stringify(this.aa);return"C"+this.vb+";"+this.bb.encode()+";"+b.length+";"+b+";"};
a.Ce=function(b,d,e,f){var c=/C([^;]+);([^;]+);(\d+);(\d+);/g;c.lastIndex=d;var h=c.exec(b);return h&&h.index===d?(d=parseInt(h[4],10),b=JSON.parse(b.substr(c.lastIndex,d)),{gd:new a(e,f,h[1],h[2],parseInt(h[3],10),b),position:c.lastIndex+d+1}):null};return a}(Ab),Cb=function(c){function a(b,a,e,f,g){b=c.call(this,b,a,"d")||this;b.vb=e;b.Jc=f;b.index=g;b.aa={};b.type="d";b.bb=new zb(f,g);return b}p(a,c);a.prototype.encode=function(){return"D"+this.vb+";"+this.bb.encode()+";"};a.Ce=function(b,d,e,
f){var c=/D([^;]+);([^;]+);(\d+);/g;c.lastIndex=d;return(b=c.exec(b))&&b.index===d?{gd:new a(e,f,b[1],b[2],parseInt(b[3],10)),position:c.lastIndex}:null};return a}(Ab),Db=function(c){function a(b,a,e,f){b=c.call(this,b,a,"s")||this;b.vb=e;b.aa=f;b.Uk={};b.type="s";return b}p(a,c);a.prototype.encode=function(){var b=JSON.stringify(this.aa);return"S"+this.vb+";"+b.length+";"+b+";"};a.Ce=function(b,d,e,f){var c=/S([^;]+);(\d+);/g;c.lastIndex=d;var h=c.exec(b);return h&&h.index===d?(d=parseInt(h[2],10),
b=JSON.parse(b.substr(c.lastIndex,d)),{gd:new a(e,f,h[1],b),position:c.lastIndex+d+1}):null};return a}(Ab),Eb=function(c){function a(b,a,e,f,g,h,k){b=c.call(this,b,a,"m")||this;b.vb=e;b.type="m";b.src=new zb(f,g);b.bb=new zb(h,k);return b}p(a,c);a.prototype.encode=function(){return"M"+this.vb+";"+this.src.encode()+";"+this.bb.encode()+";"};a.Ce=function(b,d,e,f){var c=/M([^;]+);([^;]+);(\d+);([^;]+);(\d+);/g;c.lastIndex=d;return(b=c.exec(b))&&b.index===d?{gd:new a(e,f,b[1],b[2],parseInt(b[3],10),
b[4],parseInt(b[5],10)),position:c.lastIndex}:null};return a}(Ab);(function(){function c(a){this.ha=a}c.prototype.toString=function(){return""};return c})();
function Fb(c){for(var a=[],b=0,d="0-0",e="0-0",f=/B([^;]+);([^;]+);([^;]+);\d+;/g;b<c.length;){switch(c[b]){case "B":f.lastIndex=b;if((d=f.exec(c))&&d.index===b)e=d[2],d=d[3],b=f.lastIndex;else return null;continue;case "C":e=Bb.Ce(c,b,d,e);break;case "D":e=Cb.Ce(c,b,d,e);break;case "S":e=Db.Ce(c,b,d,e);break;case "M":e=Eb.Ce(c,b,d,e);break;default:return null}if(null===e)return null;b=e.position;a.push(e.gd);e=d;d=yb(d)}return a}
var Gb=function(){function c(a){this.Oc=a;this.local=[];this.Pc={};this.rd=[];this.clientId=Math.floor(1E7*Math.random()).toString(36);this.Bs=1;this.mc=this.Wp=!1;this.log=B.create("SharedTree")}c.prototype.Sh=function(){return 0===this.rd.length?"0-0":this.rd[this.rd.length-1].rc};c.prototype.Qh=function(){return this.clientId+"-"+this.Bs++};c.prototype.vs=function(a){return"N"+this.clientId+"-"+a};c.prototype.createNode=function(a,b,d,e){this.mc||(b=new Bb(this.Qh(),this.Sh(),a,b,d,e),this.Mh(b));
return a};c.prototype.sc=function(a,b,d){this.mc||(b=new Cb(this.Qh(),this.Sh(),a,b,d),b.aa=this.Oc.uc(a),this.Mh(b))};c.prototype.le=function(a,b,d,e,c){this.mc||(a=new Eb(this.Qh(),this.Sh(),a,e,c,b,d),this.Mh(a))};c.prototype.Cb=function(a,b){if(!this.mc){var d=new Db(this.Qh(),this.Sh(),a,b);this.Mh(d)}};c.prototype.Mh=function(a){this.Pc[a.rc]=a;this.rd.push(a);this.local.push(a);xb("Add change "+a.rc+" parent "+a.jg);this.Wp&&this.xj(a,!1)};c.prototype.lr=function(){var a;void 0===a&&(a=!0);
for(var b=this.local,d="",e=[[]],c=e[0],g=0;g<b.length;g++)0<g&&yb(b[g-1].rc)===b[g].rc&&(c=[],e.push(c)),c.push(b[g]);for(b=0;b<e.length;b++)for(c=e[b],g=0;g<c.length;g++){var h=c[g];0===g&&(d+="B"+Math.round((new Date).getTime()/1E3).toString(36)+";"+h.jg+";"+h.rc+";"+c.length+";");d+=h.encode()}a&&(this.local.length=0);return d};c.prototype.Mp=function(a){function b(a,d,e){for(var c="",f=0;f<e;f++)c+="..";xb(c+("["+d+"]"));c=0;for(d=a[d];c<d.length;c++)b(a,d[c],e+1)}var d=Fb(a);if(null!==d){for(a=
0;a<d.length;a++){var e=d[a];e.rc in this.Pc||(this.Pc[e.rc]=e)}d={"0-0":[]};for(var c in this.Pc)this.Pc.hasOwnProperty(c)&&(d[c]=[]);for(c in this.Pc)this.Pc.hasOwnProperty(c)&&(e=this.Pc[c],a=e.jg,a in d&&d[a].push(c));for(c in d)d.hasOwnProperty(c)&&d[c].sort();b(d,"0-0",0);e=d["0-0"];c="0-0";for(a=0;a<this.rd.length&&1===e.length&&e[0]===this.rd[a].rc;a++)c=e[0],e=d[e[0]];for(e=this.rd.length-1;e>=a;e--)this.xj(this.rd[e],!0);this.rd.length=a;e=[];this.uk(d,c,e);for(a=1;a<e.length;a++)this.rd.push(this.Pc[e[a]]),
this.xj(this.Pc[e[a]],!1);this.mc=!0;2<=e.length&&this.Oc.ta();this.mc=!1}};c.prototype.uk=function(a,b,d){d.push(b);for(b=a[b];1===b.length;)d.push(b[0]),b=a[b[0]];if(0!==b.length){var e=d.length;this.uk(a,b[0],d);for(var c=1;c<b.length;c++){var g=d.length;this.uk(a,b[c],d);for(var h=g;h<d.length;h++)for(var k=this.Pc[d[h]],l=e;l<g;l++)this.ju(this.Pc[d[l]],k)}}};c.prototype.ju=function(a,b){function d(b,d,c){b="c"===a.type?1:-1;switch(c.type){case "c":e(d,c.bb,b,"c");break;case "d":e(d,c.bb,b,"d");
break;case "m":e(d,c.src,b,"d"),e(d,c.bb,b,"c")}}function e(a,d,e,c){a.Jc===d.Jc&&0<=d.index&&(a.index<d.index||a.index==d.index&&0<e?(d.index+=e,xb("Shift "+b.type+" by "+e)):a.index===d.index&&0>e&&"d"===c&&(d.index=-1,xb("NULLIFY")))}xb("xform "+a.rc+":"+a.type+"/"+b.rc+":"+b.type);a.jg===b.jg&&(b.jg=a.rc);"c"===a.type?d(a.type,a.bb,b):"d"===a.type?d(a.type,a.bb,b):"m"===a.type&&(d("d",a.src,b),d("c",a.bb,b))};c.prototype.xj=function(a,b){xb((b?"Undo":"Execute")+" "+a.rc+": "+a.type);this.mc=!0;
if("c"===a.type){var d=a;b?this.Oc.sc(d.vb,d.bb.Jc,d.bb.index):this.Oc.createNode(d.vb,d.bb.Jc,d.bb.index,d.aa)}else if("d"===a.type){d=a;if(-1===d.bb.index){xb("Change was nullified.");this.mc=!1;return}b?this.Oc.createNode(d.vb,d.bb.Jc,d.bb.index,d.aa):(d.aa=this.Oc.uc(d.vb),this.Oc.sc(d.vb,d.bb.Jc,d.bb.index))}else if("s"===a.type)if(d=a,b)this.Oc.Cb(d.vb,d.Uk);else{d.Uk={};var e=this.Oc.uc(d.vb),c;for(c in d.aa)d.Uk[c]=e[c];this.Oc.Cb(d.vb,d.aa)}else if("m"===a.type){d=a;if(-1===d.src.index){this.mc=
!1;return}b?this.Oc.le(d.vb,d.src.Jc,d.src.index,d.bb.Jc,d.bb.index):this.Oc.le(d.vb,d.bb.Jc,d.bb.index,d.src.Jc,d.src.index)}this.mc=!1};return c}();var Hb=function(){function c(){this.Fi=!1;this.Ra={};this.log=B.create("EventEmitter")}c.prototype.ua=function(a){for(var b=this,d=1;d<arguments.length;d++);var e=Array.prototype.slice.apply(arguments);setTimeout(function(){b.Pe.apply(b,e)},0)};c.prototype.Pe=function(a){for(var b=1;b<arguments.length;b++);this.Ra||(this.Ra={});b=Array.prototype.slice.call(arguments,1);var d,e=!1;if(a in this.Ra){var c=this.Ra[a];var g=0;for(d=c.length;g<d;g++){var h=c[g];this.Fi||e||(this.log("Emit %s",a),e=!0);
h.apply(null,b)}}};c.prototype.xa=function(a,b){this.Ra||(this.Ra={});this.bind(a,b)};c.prototype.once=function(a,b){function d(){e.yg(a,d);b.apply(null,arguments)}var e=this;e.bind(a,d)};c.prototype.bind=function(a,b){a in this.Ra?this.Ra[a].push(b):this.Ra[a]=[b];return b};c.prototype.yg=function(a,b){var d,e;if(a in this.Ra){var c=this.Ra[a];var g=d=0;for(e=c.length-1;d<=e;g=d+=1)if(c[g]===b){c.splice(g,1);break}}};return c}();var Ib=function(c){function a(b){var a=c.call(this)||this;a.Sd=b;a.cv=(new Date).getTime();a.ej=1;a.We={};a.buttons=[];a.ce=0;a.log=B.create("TOOLBAR");a.ia=document.createElement("div");a.ia.style.width=b+"px";a.ia.style.height="320px";a.ia.style.border="none";a.ia.style.backgroundColor="#ffffff";a.ia.style.MozUserSelect="none";a.ia.style.WebkitUserSelect="none";a.ia.style.Su="none";a.ia.style.Cu="none";a.ce=0;return a}p(a,c);a.prototype.width=function(){return parseInt(this.ia.style.width,10)};
a.prototype.focus=function(b){0<this.buttons.length&&(0<arguments.length&&(this.Eg(!1),this.ce=b||0),this.Eg(!0))};a.prototype.blur=function(){0<this.buttons.length&&this.Eg(!1)};a.prototype.Eg=function(b){this.buttons[this.ce].ia.style.outline=b?"1px dotted gray":"none"};a.prototype.Zb=function(b,a){if(0!==this.buttons.length){var d="next"===b||"previous"===b;d&&this.Eg(!1);switch(b){case "next":this.ce=Math.min(this.ce+1,this.buttons.length-1);break;case "previous":this.ce=Math.max(this.ce-1,0);
break;case "enter":this.buttons[this.ce].mq(a)}d&&(this.Eg(!0),a.stopPropagation(),a.preventDefault())}};a.prototype.moveTo=function(b,a){C(this.ia).ea("left",""+b+"px");C(this.ia).ea("top",""+a+"px")};a.prototype.show=function(b){void 0===b&&(b=!1);this.ia.style.display=b?"block":"none"};a.prototype.Fe=function(b,a,e,c){this.We[b]=this.hc(e,a,c)};a.prototype.iq=function(){for(var b in this.We)this.We.hasOwnProperty(b)&&(this.We[b].ia.style.background="#ffffff",this.We[b].qa.style.background="#ffffff")};
a.prototype.No=function(b){this.iq();b in this.We&&(b=this.We[b],b.ia.style.background="#9fb3e7",b.qa.style.background="#9fb3e7")};a.prototype.hc=function(b,a,e){function d(){var b=h.style.background;h.style.background="#e7d69f";k.style.background="#e7d69f";var a=h.style.background;setTimeout(function(){h.style.background===a&&(h.style.background=b,k.style.background=b)},200)}var c=this,h=document.createElement("div"),k=document.createElement("img"),l=this;h.style.display="inline";h.style.cssFloat=
"left";h.style.overflow="hidden";h.style.width=this.Sd+"px";h.style.height=this.Sd+"px";h.style.margin="1px";h.style.Cu="none";k.src=b;k.style.cursor="pointer";k.setAttribute("title",a);k.style.maxWidth=this.Sd+"px";k.style.maxHeight=this.Sd+"px";k.draggable=!1;k.style.nv="none";k.hv=function(b){b.preventDefault()};h.appendChild(k);C(k).bind("load",function(){var b=(c.Sd-k.height)/2;k.style.marginLeft=(c.Sd-k.width)/2+"px";k.style.marginTop=b+"px"});this.ia.appendChild(h);var m=this.buttons.length;
e&&(C(h).bind("touchstart",function(b){b.preventDefault();d();e(b);l.ua("click",b)}),C(h).click(function(b){d();e(b);l.focus(m);l.ua("click",b)}));this.ej+=this.Sd+1;b={ia:h,qa:k,mq:e};this.buttons.push(b);return b};a.prototype.cr=function(b){if(!(0>=b)){var a=(this.Sd+2)*Math.ceil(this.ej/b)+1;this.ia.style.width=""+a+"px";this.ia.style.height=""+b+"px";this.log("Toolbar width/height = %s,%s totalHeight=%s",a,b,this.ej)}};return a}(Hb);var Jb=function(c){function a(b){var d=c.call(this)||this;d.ia=b;d.Ej=!1;d.duration=200;d.right=!0;d.Vh=a.zp();d.prefix=a.lm;d.bh=null;d.left=!1;d.fg=null;d.log=B.create("SlidingPanel",!1);b.ea("display","none");d.Vh&&(b=d.ia.outerWidth(),d.ea("TransitionProperty","transform"),d.ea("Transform","translate("+b+"px,0)"));d.body=C(".body");return d}p(a,c);a.zp=function(){var b=(document.body||document.documentElement).style,d="transition",e=["Moz","Webkit","Khtml","O","ms"];d=d.charAt(0).toUpperCase()+
d.substr(1);for(var c=0;c<e.length;c++)if("string"===typeof b[e[c]+d])return a.lm=e[c],!0;return!1};a.prototype.show=function(b,a){void 0===a&&(a=!1);var d=this;this.bh&&(clearTimeout(this.bh),this.bh=null);!1!==a&&(a=!0);this.Ej=!0;this.ia.show();var c=this.ia.outerWidth();this.ia.Xa();"right"===b?(this.left=!1,this.ia.ea("left",""+(C(window).width()-c)+"px")):this.left=!0;a&&(d.fg=new qb,d.fg.zIndex=parseFloat(d.ia.ea("z-index"))||0,d.fg.insertBefore=d.ia,d.fg.show(function(){d.Os()}));d.Vh?(this.log("Performing transition"),
d.ia.ea("display","block"),d.left?d.ea("Transform","translate(-"+c+"px,0)"):d.ea("Transform","translate("+c+"px,0)"),d.ea("TransitionDuration",""+d.duration+"ms"),d.ea("TransitionDuration",""+d.duration+"ms",d.body),window.setTimeout(function(){d.ea("Transform","translate(0,0)");d.ea("Transform","translate("+(d.left?c:-c)+"px,0)",d.body);window.setTimeout(function(){d.to()},d.duration)},1)):(this.log("No transitions allowed"),d.ia.ea("display","block"),d.to())};a.prototype.Os=function(){this.Xa()};
a.prototype.ea=function(b,a,e){void 0===e&&(e=this.ia);0!==e.length&&(b=""!==this.prefix?this.prefix+b:b.charAt(0).toLowerCase()+b.substr(1),e[0].style[b]=a,this.log("%s=%s",b,a))};a.prototype.xb=function(){return this.Ej};a.prototype.Xa=function(){var b=this;if(!this.bh){this.Ej=!1;b.fg&&b.fg.Xa();var a=this.ia.outerWidth();b.Vh?this.left?b.ea("Transform","translate(-"+a+"px,0)"):b.ea("Transform","translate("+a+"px,0)"):b.ia.ea("display","none");b.ea("Transform","translate(0,0)",this.body);b.Vh?
this.bh=window.setTimeout(function(){b.ia.ea("display","none");b.ua("hide")},b.duration):b.ua("hide")}};a.prototype.to=function(){this.ia.find(".focus").focus();this.ua("show")};a.lm="";return a}(Hb);var Kb=function(c){function a(){var b=c.call(this)||this;b.keys={};b.Fi=!0;b.Yt=new RegExp("alt backspace cmd command control ctrl del delete down end enter esc escape f4 home ins insert left meta pagedown pageup right shift up \u2318".split(" ").sort(function(b,a){return a.length-b.length}).join("|"),"g");b.log=B.create("KEYMAP");b.vi=function(a){b.Xr(a)};return b}p(a,c);a.prototype.map=function(b,a){var d=b.toLowerCase().split(","),c;if("string"===typeof a){var g=a.split(",");for(c=0;c<d.length;c++)for(var h=
0;h<g.length;h++)this.qm(d[c],g[h])}else for(c=0;c<d.length;c++)this.qm(d[c],a)};a.prototype.qm=function(b,a){if(0!==b.length){var d=b.match(this.Yt)||[],c=!1,g=!1,h=!1,k=!1,l=[],m;for(m=0;m<d.length;m++)switch(d[m]){case "alt":h=!0;break;case "control":case "ctrl":g=!0;break;case "shift":c=!0;break;case "home":l.push(36);break;case "end":l.push(35);break;case "pageup":l.push(33);break;case "pagedown":l.push(34);break;case "delete":case "del":l.push(46);break;case "backspace":l.push(8);break;case "up":l.push(38);
break;case "right":l.push(39);break;case "down":l.push(40);break;case "left":l.push(37);break;case "escape":case "esc":l.push(27);break;case "enter":l.push(13);break;case "ins":case "insert":l.push(45);break;case "f4":l.push(115);break;case "meta":case "command":case "cmd":case "\u2318":k=!0;break;default:alert("key entry not found: "+d[m])}var n=this;d=function(b){c&&-1===b.indexOf("-shift")&&(b+="-shift");g&&-1===b.indexOf("-control")&&(b+="-control");h&&-1===b.indexOf("-alt")&&(b+="-alt");k&&-1===
b.indexOf("-meta")&&(b+="-meta");"string"===typeof a?n.log("Keyboard mapping: %s->%s",b,a):n.log("Keyboard mapping: %s->%s",b,"function()");if(b in n.keys){var d,e=n.keys[b];for(d=0;d<e.length&&e[d]!==a;d++);d===e.length&&n.keys[b].push(a)}else n.keys[b]=[a]};if(0===l.length)switch(m=b.toUpperCase().charAt(b.length-1),m){case "=":d("107-shift");d("187");d("61");break;case "+":d("107");d("61-shift");break;case "-":d("109");d("189");d("173");break;default:l.push(m.charCodeAt(0))}for(m=0;m<l.length;m++)d(""+
l[m])}};a.prototype.Cr=function(b){var a="";b.keyCode&&(a+=b.keyCode);b.shiftKey&&(a+="-shift");b.ctrlKey&&(a+="-control");b.altKey&&(a+="-alt");b.metaKey&&(a+="-meta");return a};a.prototype.translate=function(b){var a=[];b=this.Cr(b);b in this.keys&&(a=this.keys[b]);this.log("%s",b);return a};a.prototype.Xr=function(b){for(var a=0,e=this.translate(b);a<e.length;a++){var c=e[a];"string"===typeof c?(this.log("action: %s",c),this.Pe("*",c,b)):c(b)}};a.prototype.Vp=function(b){C(b).bind("keydown",this.vi)};
a.prototype.detach=function(b){C(b).yg("keydown",this.vi)};return a}(Hb);function Lb(c){var a=document.createElement("input");C(a).Jb("type","range");if("range"===a.type)return a.Jt=function(b,d){a.min=""+b;a.max=""+d},a.Hn=function(){return parseFloat(a.value)},a.vl=function(b){a.value=""+b},a;var b=C("<div>");b.ea("display","inline-block");b.ea("vertical-align","top");b.ea("height","1em");b.ea("width","10em");b.ea("padding","0.25em");b.ea("position","relative");var d=C("<div>");d.ea("top","50%");d.ea("height","0");d.ea("border-top","1px solid black");d.ea("border-bottom",
"1px solid #888888");d.ea("position","absolute");d.ea("left","0");d.ea("right","0");var e=C("<div>");e.ea("height","1em");e.ea("left","0px");e.ea("background","#888888");e.ea("border-top","1px solid #cccccc");e.ea("border-left","1px solid #cccccc");e.ea("border-bottom","1px solid #000000");e.ea("border-right","1px solid #000000");e.ea("width","0.5em");e.ea("position","absolute");e.ea("cursor","pointer");b.append(d);b.append(e);var f=b[0];f.type="range";f.min="0";f.max="100";f.value="0";f.onchange=
function(){};f.Jt=function(b,a){f.min=""+b;f.max=""+a};f.vl=function(a){f.value=""+a;var d=b.width()-e.width();a=a/parseFloat(f.max)*d;a=Math.round(a);a=Math.max(a,0);a=Math.min(a,b.width());e.ea("left",""+a+"px")};f.Hn=function(){return parseFloat(f.value)};var g,h,k,l=B.create("RANGE");ib(C(e),function(b){"mousedown"===b.type&&(k=!0,g=b.pageX,h=parseInt(e.ea("left"),10),l("Mousedown at %s, ox=%s",g,h),b.stopPropagation(),b.preventDefault())});ib(C(b),function(a){if("mousedown"===a.type){var d=b.width()-
e.width(),c=a.pageX-C(b).offset().left;c=Math.max(c,0);c=Math.min(c,d);e.ea("left",""+c+"px");g=a.pageX;h=c;c=c/d*(parseFloat(f.max)-parseFloat(f.min))+parseFloat(f.min);c=Math.round(c);f.value=""+c;f.onchange&&f.onchange.call(f,a);k=!0}});hb(C(b),function(a){if(k&&"mousemove"===a.type){var d=b.width()-e.width(),c=a.pageX-g+h;c=Math.max(c,0);c=Math.min(c,d);e.ea("left",""+c+"px");c=c/d*(parseFloat(f.max)-parseFloat(f.min))+parseFloat(f.min);c=Math.round(c);f.value=""+c;f.onchange&&f.onchange.call(f,
a)}});c.bind(C(document.body),"mouseup",function(){k=!1});return f};function Mb(c,a,b){this.qa=c;this.Zi=a;this.fn=b;this.dj=0}
var Nb=new (function(){function c(){this.Ab=[];this.Hl=!1;this.log=B.create("ImageLoader")}c.prototype.timeout=function(){var a=[];this.log("Timeout running... %s images remaining",this.Ab.length);for(var b=0;b<this.Ab.length;b++)this.Ab[b].qa.complete?this.Ab[b].fn(this.Ab[b].qa,this.Ab[b].Zi):5E3>this.Ab[b].dj?(this.Ab[b].dj+=250,a.push(this.Ab[b])):this.Ab[b].fn(this.Ab[b].qa,this.Ab[b].Zi);this.Ab=a;this.Ab.length?setTimeout(this.timeout,250):(this.log("Timeout Stopped"),this.Hl=!1)};c.prototype.load=
function(a,b){var d=this,e=document.createElement("img"),c=new Mb(e,a,b);this.Ab.push(c);var g=0<=a.indexOf("://"),h="://"+window.location.host;0!==a.indexOf("data:")&&g&&-1===a.indexOf(h)&&(this.log("Using cross origin request for img"),e.crossOrigin="");e.addEventListener("load",function(){d.log("LoadFn called. complete=%s",e.complete);if(e.complete)for(var a=0;a<d.Ab.length;a++){var f=d.Ab[a];if(f.qa===e){d.Ab.splice(a,1);b(e,f.Zi);break}}else d.Hl||(d.Hl=!0,setTimeout(d.timeout,250),c.dj=250)},
!1);e.addEventListener("error",function(){d.log("Error loading %s",a);b(null,c.Zi)},!1);e.src=a;return e};return c}());var Ob=function(c){function a(b){var a=c.call(this,C("<div>"))||this;a.parent=b;a.Ra={};a.maxWidth=128;a.maxHeight=0;a.Xt=2;a.js="grid";a.Pk=0;a.oi=1;a.cells=[];a.Il=null;a.log=B.create("ListView");b.append(a.ia);a.ia.ea("overflow-x","auto");a.ia.ea("overflow-y","auto");return a}p(a,c);a.prototype.xa=function(b,a){this.Ra[b]=a};a.prototype.Ui=function(b,a){this.maxWidth=b;this.maxHeight=a};a.prototype.Uh=function(b,a,e){var d=this,c=this.oi;var h={qa:null,index:this.Pk,Vn:!1};this.Pk+=1;Nb.load(b,
function(b){if(c===d.oi&&null!==b){var f=b.width;var g=b.height;d.maxWidth&&f>d.maxWidth&&(b.width=d.maxWidth,b.height=g/f*d.maxWidth);d.maxHeight&&g>d.maxHeight&&(b.width=d.maxHeight/(g/f),b.height=d.maxHeight);var k=C(b);k.ea("margin",""+d.Xt+"px");k.ea("border-width","3");k.ea("border-color","white");k.ea("border-style","solid");k.ea("image-rendering","optimizeQuality");fb(k,function(){d.log("Mouseenter");return k.ea("border-color","#888888")});eb(k,function(){return k.ea("border-color","white")});
k.click(function(){if("click"in d.Ra)return d.Ra.click(a)});e&&k.Jb("title",e);h.qa=k;d.cells.push(h);d.cells.sort(function(b,a){return b.index-a.index});d.Il||(d.Il=setTimeout(function(){d.Il=null;d.format()},500))}})};a.prototype.format=function(){var b;var a=null;var e=this.cells;var c=0;for(b=e.length;c<b;c++){var g=e[c];if(!g.Vn&&g.qa){if(null===a){a=this.ia;var h=g.qa;h=Za(h);0<a.length?a[0].insertBefore(h[0],a[0].firstChild):a[0].appendChild(h[0])}else a.qa&&ob(a.qa,g.qa);g.Vn=!0}a=g}};a.prototype.clear=
function(){this.ia.empty();this.cells.length=0;this.oi+=1};return a}(rb);Ob.prototype=C.extend({},rb.prototype,Ob.prototype);var Qb=function(){function c(){this.items=[];this.next=0;this.Xd=!1;this.log=B.create("UNDOSTACK")}c.prototype.ta=function(a,b,d){void 0===b&&(b=!1);a=a instanceof Pb?[a]:a;this.next<this.items.length&&(this.items.length=this.next);if(!b)for(b=0;b<a.length;b++)a[b].Ob(d);for(d=this.top();d;)if(d[d.length-1].ko(a[0])){if(a.shift(),0===a.length)break}else break;a.length&&this.items.push(a);this.Xd=!0;this.next=this.items.length};c.prototype.jb=function(a){this.log("Undo index %s of %s",this.next,this.items.length);
if(this.Ke()){for(var b=this.items[--this.next],d=b.length-1;0<=d;d--)b[d].jb(a);this.Xd=!0}};c.prototype.Kd=function(a){this.log("Redo index %s of %s",this.next,this.items.length);if(this.Je()){for(var b=this.items[this.next++],d=0;d<b.length;d++)b[d].Ob(a);this.Xd=!0}};c.prototype.Ke=function(){return 0<this.next};c.prototype.Je=function(){return this.next<this.items.length};c.prototype.clear=function(){this.next=this.items.length=0;this.Xd=!1};c.prototype.top=function(){return this.items.length?
this.items[this.items.length-1]:null};return c}(),Pb=function(){function c(){}c.prototype.Ob=function(){};c.prototype.jb=function(){};c.prototype.ko=function(){return!1};return c}();var Rb=function(){function c(a){this.next=a}c.prototype.Vl=function(a){for(var b=0;b<a.length;b++)this.Qa(a.charCodeAt(b))};c.prototype.Qa=function(a){this.next.Qa(a)};c.prototype.flush=function(){this.next.flush()};c.prototype.Tf=function(){return this.next.Tf()};return c}(),Sb=function(){function c(){this.data="";this.log=B.create("BYTESTREAM")}c.prototype.Vl=function(a){for(var b=0;b<a.length;b++)this.Qa(a.charCodeAt(b))};c.prototype.Tf=function(){return this};c.prototype.Qa=function(a){if(255<
a||0>a)throw"Bad data written to byte buffer";this.data+=String.fromCharCode(a)};c.prototype.flush=function(){};c.prototype.toString=function(){return this.data};c.prototype.ec=function(){for(var a=[],b=0;b<this.data.length;b++)a.push(this.data.charCodeAt(b));return a};c.tj=function(a,b){c.hm[a]=b};c.Ag=function(a){var b=new c;a=a.split(",");a.reverse();for(var d=0;d<a.length;d++){var e=a[d];e.length&&(b=c.hm[e](b))}return b};c.hm={};return c}();var Tb=function(c){function a(b){b=c.call(this,b)||this;b.Gg=0;b.total=0;b.size=0;b.keys="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return b}p(a,c);a.prototype.Qa=function(b){this.Gg=this.Gg<<8|b;this.size+=8;for(this.total+=1;6<=this.size;)this.next.Qa(this.keys.charCodeAt(this.Gg>>this.size-6&63)),this.size-=6};a.prototype.flush=function(){var b=(3-this.total%3)%3;this.size&&(this.next.Qa(this.keys.charCodeAt(this.Gg>>this.size-6&63)),this.Gg=this.size=0);for(;b--;)this.next.Qa(61);
this.next.flush()};return a}(Rb);Sb.tj("Base64Encoder",function(c){return new Tb(c)});var Ub=function(c){function a(b){b=c.call(this,b)||this;b.items=[];return b}p(a,c);a.prototype.Qa=function(b){4===this.items.length&&this.um();this.items.push(b)};a.prototype.um=function(){var b=this.items[0];var a=this.items[1];var e=this.items[2];var c=this.items[3];b=(b<<24|a<<16|e<<8|c)>>>0;var g=(b/614125|0)%85+33;var h=(b/7225|0)%85+33;var k=(b/85|0)%85+33;var l=b%85+33;this.next.Qa((b/52200625|0)%85+33);this.next.Qa(g);isNaN(a)||(this.next.Qa(h),isNaN(e)||(this.next.Qa(k),isNaN(c)||this.next.Qa(l)));
this.items.length=0};a.prototype.flush=function(){0<this.items.length&&this.um();this.next.Vl("~>");this.next.flush()};return a}(Rb);Sb.tj("Ascii85Encoder",function(c){return new Ub(c)});var Vb=function(){function c(a){this.next=a;this.pd=this.Ze=0;this.io=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8193];this.log=B.create("BITWRITER")}c.prototype.Qa=function(a){this.mp(a,8)};c.prototype.mp=function(a,b){this.Ze=this.Ze<<b|a&this.io[b];for(this.pd+=b;8<=this.pd;)this.next.Qa(this.Ze>>>this.pd-8&255),this.pd-=8,this.Ze&=this.io[this.pd]};c.prototype.flush=function(){this.pd&&(this.next.Qa(this.Ze<<8-this.pd),this.Ze=this.pd=0);this.next.flush()};return c}();var Wb=function(c){function a(b){var a=c.call(this,b)||this;a.dg=258;a.Yu=0;a.tf=0;a.first=!0;a.Jg=[];a.bl=[];a.Jj=[];a.fv=0;a.Oj=9;a.log=B.create("LZWEncoder");a.bq=new Vb(b);a.sm();return a}p(a,c);a.prototype.Qa=function(b){if(this.first)this.tf=b,this.first=!1;else{var a=this.Dp(this.tf,b);void 0!==this.Jg[a]?this.tf=this.Jg[a]:(this.Rh(this.tf),this.Jg[a]=this.dg,this.bl[a]=this.tf,this.tf=this.Jj[a]=b,4095>this.dg?(this.dg+=1,this.Oj=Math.ceil(Math.log(this.dg)/Math.log(2))):this.sm())}};a.prototype.Dp=
function(a,d){var b;var c=d<<4^a;for(b=0===c?1:18041-c;;){if(void 0===this.Jg[c]||this.bl[c]===a&&this.Jj[c]===d)return c;c-=b;0>c&&(c+=18041)}};a.prototype.sm=function(){this.Rh(a.op);this.dg=258;this.Oj=9;this.Jg.length=0;this.bl.length=0;this.Jj.length=0};a.prototype.flush=function(){this.first||(this.Rh(this.tf),this.Rh(a.tp))};a.prototype.Rh=function(a){this.bq.mp(a,this.Oj)};a.op=256;a.tp=257;return a}(Rb);Sb.tj("LZWEncoder",function(c){return new Wb(c)});var Xb=B.create("MISC");function Yb(c){"jQuery"in window&&c instanceof window.jQuery&&(c=c[0]);return C(c)}function Zb(c){var a=document.createElement("canvas");c&&c.appendChild(a);"G_vmlCanvasManager"in window&&(Xb("Emulating canvas in IE"),window.Ou.bv(a),C(a).bind("selectstart",function(a){Xb("Cancelled selectstart on canvas");a.stopPropagation();a.preventDefault()}));a.style.background="transparent";return a}function $b(){return(new Date).getTime()}
var ac=/MSIE ([0-9]{1,}[\.0-9]{0,})/,bc=0,cc=!1;function dc(){if(cc)var c=bc;else{c=-1;if("Microsoft Internet Explorer"===navigator.appName){var a=ac.exec(navigator.userAgent);null!==a&&(c=parseFloat(a[1]))}bc=c;cc=!0;Xb("IE version is %s",c)}return 0<=c&&9>c}function ec(){for(var c=document.getElementsByTagName("*"),a=0,b=0;b<c.length;b++){var d=parseInt(C(c[b]).ea("z-index"),10)||0;d>a&&(a=d)}return a}
function fc(){if(null===gc){var c=document.createElement("div");c.style.visibility="hidden";c.style.width="100px";document.body.appendChild(c);var a=c.offsetWidth;c.style.overflow="scroll";var b=document.createElement("div");b.style.width="100%";c.appendChild(b);b=b.offsetWidth;c.parentNode.removeChild(c);gc=a-b;Xb("ScrollbarWidth calculated as %spx",gc)}return gc}var gc=0;function hc(c,a){var b=A.Xb(c);b.values[3]=a;return b.toString()}
function ic(c){var a=atob(c.split(",")[1]);c=c.split(",")[0].split(":")[1].split(";")[0];for(var b=new ArrayBuffer(a.length),d=new Uint8Array(b),e=0;e<a.length;e++)d[e]=a.charCodeAt(e);return new Blob([b],{type:c})}function jc(c,a){var b="function"!==typeof a?function(b){return b===a}:a;for(var d=0,e=0;e<c.length;e++)b(c[e])?d+=1:d&&(c[e-d]=c[e]);c.length-=d}
function kc(){var c=document.documentElement,a=c.scrollHeight>C(c).height();c=c.scrollWidth>C(c).width();a=a?fc():0;c=c?fc():0;var b=document.documentElement.scrollTop||document.body.scrollTop,d=document.documentElement.scrollLeft||document.body.scrollLeft;return{width:C(window).width()-a,height:C(window).height()-c,x:d,y:b}}function lc(c){var a=kc(),b=c.offset();b.left=Math.min(b.left,a.x+a.width-c.outerWidth());b.top=Math.min(b.top,a.y+a.height-c.outerHeight());c.offset(b)}
function mc(c,a){function b(a,b){return{stopPropagation:function(){a.stopPropagation()},preventDefault:function(){a.preventDefault()},uo:a,type:b.type,target:b.target,pageX:b.pageX,pageY:b.pageY,scale:b.scale,rotation:b.rotation}}var d=1,e=0;c.addEventListener("mousedown",function(c){3===(c.buttons&3)&&(d=1,e=0,a(b(c,{type:"gesturestart",target:c.target,pageX:c.pageX,pageY:c.pageY,scale:d,rotation:e})))},!1);c.addEventListener("contextmenu",function(a){a.preventDefault()},!1);c.addEventListener("mousemove",
function(c){3===(c.buttons&3)&&a(b(c,{type:"gesturechange",target:c.target,pageX:c.pageX,pageY:c.pageY,scale:d,rotation:e}))},!1);c.addEventListener("mouseup",function(e){5!==(e.buttons&3)&&a(b(e,{type:"gestureend",target:e.target,pageX:e.pageX,pageY:e.pageY,scale:d,rotation:0}))},!1);c.addEventListener("wheel",function(c){3===(c.buttons&3)&&(d=0<c.deltaY?1.1*d:d/1.1,0<c.deltaX?e+=10:0>c.deltaY&&(e-=10),a(b(c,{type:"gesturechange",target:c.target,pageX:c.pageX,pageY:c.pageY,scale:d,rotation:e})))})}
function nc(c,a){"erase"===a?c.Df?(c.strokeStyle="#000000",c.globalCompositeOperation="destination-out",--c.lineWidth,c.stroke(),c.globalCompositeOperation="source-over",c.strokeStyle=c.Df,c.lineWidth+=2,c.stroke(),--c.lineWidth):(c.strokeStyle="#000000",c.globalCompositeOperation="destination-out",c.stroke(),c.globalCompositeOperation="source-over"):(c.strokeStyle=a,c.stroke())};var oc=function(c){function a(a,d,e,f,g){var b=c.call(this)||this;b.size=d;b.wd=e;b.Vu=f;b.Lb=[];b.width=0;b.Sc=0;b.Kg=0;b.lp=!1;b.log=B.create("COLOURPANEL");b.canvas=C(Zb(a[0]));b.ia=b.canvas;b.canvas.ea("position","absolute");b.canvas.ea("border","none");b.canvas.ea("border-top","1px solid black");b.canvas.ea("display","block");b.ka=b.canvas[0].getContext("2d");b.Lb="string"===typeof g?b.Ym():g;b.wl(100);b.canvas.bind("touchstart",function(a){if("touchstart"===a.type){var d=b.canvas.offset();b.nc(a.touches[0].pageX-
d.left,a.touches[0].pageY-d.top,!0);a.preventDefault();a.stopPropagation()}});ib(b.canvas,function(a){if("mousedown"===a.type){var d=b.canvas.offset();b.nc(a.pageX-d.left,a.pageY-d.top,0===a.button)||(a.preventDefault(),a.stopPropagation())}});b.canvas.bind("contextmenu",function(a){a.preventDefault();a.stopPropagation();return!1});return b}p(a,c);a.prototype.ve=function(a,d){this.size=a;this.wd=d;this.format();this.ja()};a.prototype.Ym=function(){function a(a){for(var b=30;100>b;b+=20)a.values[2]=
b/100,d.push(a.toString())}var d="rgba(0,0,0,0.0) rgba(0,0,0,0.5) #000000 #ffffff #000088 #008800 #008888 #880000 #880088 #884400 #888888 #444444 #0000ff #00ff00 #00ffff #ff0000 #ff00ff #ffff00".split(" ");a(new A(A.Ac,[0,0,0,1]));for(var e=0;720>e;e+=35){var c=new A(A.Ac,[e,.5,0,1]);a(c)}return d};a.prototype.vt=function(a){this.Lb="string"===typeof a?this.Ym():a.slice(0);this.log("Set colours to %s len=%s",this.Lb,this.Lb.length);this.format();this.ja()};a.prototype.wl=function(a){this.width=a;
this.canvas.Jb("width",""+this.width);this.format();this.ja()};a.prototype.So=function(a){this.Sc=a;this.canvas.Jb("height",""+(this.Sc-1))};a.prototype.height=function(){return this.Sc};a.prototype.moveTo=function(a,d){this.canvas.ea("left",""+a+"px");this.canvas.ea("top",""+d+"px")};a.prototype.format=function(){this.Kg=Math.floor(this.width/this.size);var a=Math.ceil(this.Lb.length/this.Kg);this.log("Format to width=%s; height=%s wrap=%s, cpr=%s",this.width,a*this.size,this.lp,this.Kg);this.lp?
this.So(a*this.size):this.So(this.size)};a.gm=function(a,d,e,c){a.fillStyle="#ffffff";a.fillRect(d,e,c,c);a.beginPath();a.strokeStyle="#000000";a.moveTo(d,e);a.lineTo(d+c,e+c);a.moveTo(d+c,e);a.lineTo(d,e+c);a.stroke()};a.fm=function(a,d,e,c){for(var b,f=0;f<c;f+=5){b=0===f/5%2;for(var k=0;k<c;k+=5)a.fillStyle=b?"#000000":"#ffffff",b=!b,a.fillRect(d+k,e+f,5,5)}b=a.createLinearGradient(d+c,e+c,d,e);b.addColorStop(0,"rgba(255, 255, 255, 1.0)");b.addColorStop(1,"rgba(255, 255, 255, 0.0)");a.fillStyle=
b;a.fillRect(d,e,c,c)};a.prototype.ja=function(){for(var b=0,d=0,e=0;e<this.Lb.length;e++){var c=A.Xb(this.Lb[e]);this.ka.fillStyle=this.Lb[e];this.ka.fillRect(b,d,this.size,this.size);0===c.values[3]?a.gm(this.ka,b,d,this.size):.5===c.values[3]&&a.fm(this.ka,b,d,this.size);b+=this.size;b>=this.width&&(d+=this.size,b=0)}};a.prototype.Xa=function(){this.canvas.Xa()};a.prototype.show=function(){this.canvas.show()};a.prototype.nc=function(a,d,e){a=Math.floor(a/this.size);d=Math.floor(d/this.size);var b=
d*this.Kg+a;this.log("row=%s col=%s index=%s coloursPerRow=%s",d,a,b,this.Kg);return b<this.Lb.length?("rgba(0,0,0,0.0)"===this.Lb[b]?this.ua("opacity",0,e):"rgba(0,0,0,0.5)"===this.Lb[b]?this.ua("opacity",.5,e):this.ua("colour",this.Lb[b],e),!0):!1};return a}(Hb);var pc=function(c){function a(a,d,e,f){var b=c.call(this)||this;b.wa=a;b.zo=e;b.log=B.create("PageSelector");b.current=0;b.fd=[];b.enabled=!1;b.page=0;b.ia=C(d);lb(b.ia,"zwibbler-page-selector");b.zo||(b.ia.ea("overflow-y","scroll"),b.ia.ea("text-align","center"));e||f||(a=C("<input>").Jb("type","button").Jb("value","Add Page"),b.ia.append(a),a.click(function(){b.wa.pf(b.wa.fh(b.wa.de()+1))}),a=C("<input>").Jb("type","button").Jb("value","Delete Page"),b.ia.append(a),a.click(function(){b.wa.an(b.wa.de())}),
b.enabled=!1);return b}p(a,c);a.prototype.Ti=function(a){this.enabled=a;var b=this;this.enabled&&this.wa&&setTimeout(function(){b.el()},10)};a.prototype.ml=function(a){function b(){null===c&&e.enabled&&(c=setTimeout(function(){e.el();e.Bb(e.wa.de());c=null},100))}var e=this,c=null;this.wa=a;a.xa("document-changed",function(){b()});a.xa("resource-loaded",function(){b()});a.xa("set-page",function(a){e.Bb(a)})};a.prototype.el=function(){this.log("Regenerate page views.");var a=this.ia.width()-6-10-fc(),
d=this.ia.height()-6,e=this.wa.Ec(),c=this.wa.Xg();d>a?d=a/c.width*c.height:a=d/c.height*c.width;for(var g=0;g<e;g++){var h=g===this.fd.length?this.ts(g):this.fd[g];h.width=a;h.height=d;if(h=h.getContext("2d"))h.save(),h.fillStyle="#ffffff",h.fillRect(0,0,a,d),h.scale(a/c.width,a/c.width),h.translate(-c.x,-c.y),this.wa.ja(h,{page:g}),h.restore()}for(;g<this.fd.length;g++)C(this.fd[g]).remove();this.fd.length=e};a.prototype.ts=function(a){var b=Zb(this.ia[0]);this.zo||(C(b).ea("margin-left","10px"),
C(b).ea("margin-right","10px"),C(b).ea("margin-top","5px"),C(b).ea("margin-bottom","5px"));C(b).ea("border-width","3px");this.log("Make canvas for page %s, currentPage is %s",a,this.page);a===this.page?C(b).ea("border-color","#9fb3e7"):C(b).ea("border-color","transparent");C(b).ea("border-style","solid");this.fd.push(b);b.page=a;var e=this;C(b).click(function(){e.wa.pf(a);e.wa.ua("page-preview-clicked",a)});return b};a.prototype.Bb=function(a){a!==this.page&&this.log("Set page %s",a);this.page<this.fd.length&&
C(this.fd[this.page]).ea("border-color","transparent");this.page=a;this.page<this.fd.length&&C(this.fd[this.page]).ea("border-color","#9fb3e7")};return a}(Hb);function D(c){var a;void 0===a&&(a="Assertion failed.");if(!c)throw Error(a);}
var qc=function(){function c(a){var b=this;this.Lc=0;this.log=B.create("BinaryReader");if("string"===typeof a)this.length=a.length,this.getUint8=function(){D(b.Lc<a.length);return a.charCodeAt(b.Lc++)&255};else{var d=new Uint8Array(a);this.length=d.length;this.getUint8=function(){D(b.Lc<d.length);return d[b.Lc++]}}}c.prototype.seek=function(a){D(0<=a&&a<=this.length);var b=this.Lc;this.Lc=a;return b};c.prototype.getUint16=function(){return(this.getUint8()<<8|this.getUint8())>>>0};c.prototype.getUint32=
function(){return this.getInt32()>>>0};c.prototype.getInt16=function(){var a=this.getUint16();a&32768&&(a-=65536);return a};c.prototype.getInt32=function(){return this.getUint8()<<24|this.getUint8()<<16|this.getUint8()<<8|this.getUint8()};c.prototype.Fb=function(){return this.getInt16()};c.prototype.Sr=function(){this.getUint16()};c.prototype.Se=function(){return this.getInt16()/16384};c.prototype.sk=function(){return this.getInt32()/65536};c.prototype.Gn=function(a){for(var b="",d=0;d<a;d++)b+=String.fromCharCode(this.getUint8());
return b};c.prototype.Tr=function(a){for(var b="",d=0;d<a;d+=2)b+=String.fromCharCode(this.getUint16());return b};c.prototype.getDate=function(){var a=1E3*(4294967296*this.getUint32()+this.getUint32())+Date.UTC(1904,1,1);return new Date(a)};return c}(),rc=function(){function c(a){this.format=0;this.Nm=[];this.log=B.create("CMAP0");for(var b=0;256>b;b++){var d=a.getUint8();this.log("   Glyph[%s] = %s",b,d);this.Nm.push(d)}}c.prototype.map=function(a){return 0<=a&&255>=a?this.Nm[a]:0};return c}(),tc=
function(){function c(a){this.file=a;this.format=4;this.cache={};this.log=B.create("CMAP4");var b,d=[],e=a.getUint16()/2;a.getUint16();a.getUint16();a.getUint16();for(b=0;b<e;b++)d.push({zi:0,$i:0,ln:a.getUint16(),Sn:0});a.getUint16();for(b=0;b<e;b++)d[b].$i=a.getUint16();for(b=0;b<e;b++)d[b].Sn=a.getUint16();for(b=0;b<e;b++){var c=a.getUint16();d[b].zi=c?a.Lc-2+c:0}this.va=d}c.prototype.map=function(a){if(!(a in this.cache)){for(var b=0;b<this.va.length;b++){var d=this.va[b];if(d.$i<=a&&d.ln>=a){if(d.zi){var e=
d.zi+2*(a-d.$i);this.file.seek(e);var c=this.file.getUint16()}else c=d.Sn+a&65535;this.log("Charcode %s is between %s and %s; maps to %s (%s) roffset=%s",a,d.$i,d.ln,e,c,d.zi);this.cache[a]=c;break}}b===this.va.length&&(this.cache[a]=0)}return this.cache[a]};return c}(),uc=function(){function c(a,b,d){this.file=a;this.map={};this.Xe=-1;this.log=B.create("KERN0");this.du=b&&!d||!b&&d;this.file=a;this.offset=a.Lc;this.zs=a.getUint16();a.getUint16();a.getUint16();a.getUint16();for(b=0;b<this.zs;b++){d=
a.getUint16();var e=a.getUint16(),c=a.Fb();this.map[d<<16|e]=c}this.reset()}c.prototype.reset=function(){this.Xe=-1};c.prototype.get=function(a){var b=0;if(0<=this.Xe){var d=this.Xe<<16|a;d in this.map&&(b=this.map[d])}this.Xe=a;return this.du?{x:0,y:b}:{x:b,y:0}};return c}(),vc=function(){function c(a){this.Nj=[];this.hh=[];this.Nl=this.flags=this.fo=this.version=0;this.Wd=new Date;this.Un=this.Yl=this.Wl=this.Zl=this.Xl=0;this.fontFamily=this.Sf="";this.lh=0;this.log=B.create("TrueType");this.file=
new qc(a);this.hb=this.gt(this.file);this.ct(this.file);this.ft(this.file);this.at(this.file);this.dt(this.file);this.et(this.file);this.length=this.Vr()}c.prototype.gt=function(a){var b={};a.getUint32();var d=a.getUint16();a.getUint16();a.getUint16();a.getUint16();for(var e=0;e<d;e++){var c=a.Gn(4);b[c]={hq:a.getUint32(),offset:a.getUint32(),length:a.getUint32()};"head"!==c&&this.log("Table %s has checksum 0x%s",c,b[c].hq.toString(16))}return b};c.prototype.ct=function(a){D("head"in this.hb);a.seek(this.hb.head.offset);
this.version=a.sk();a.sk();a.getUint32();this.fo=a.getUint32();D(1594834165===this.fo);this.flags=a.getUint16();this.Nl=a.getUint16();this.Wd=a.getDate();a.getDate();this.Xl=a.Fb();this.Zl=a.Fb();this.Wl=a.Fb();this.Yl=a.Fb();a.getUint16();a.getUint16();a.getInt16();this.Un=a.getInt16();a.getInt16()};c.prototype.at=function(a){D("cmap"in this.hb);var b=this.hb.cmap.offset;a.seek(b);a.getUint16();for(var d=a.getUint16(),e=0;e<d;e++){var c=a.getUint16(),g=a.getUint16(),h=a.getUint32();this.log("CMap platformid=%s specificid=%s offset=%s",
c,g,h);3===c&&1>=g&&this.$s(a,b+h)}};c.prototype.$s=function(a,b){var d=a.seek(b),e=a.getUint16(),c=a.getUint16();a.getUint16();var g;this.log("    Cmap format %s length %s",e,c);0===e?g=new rc(a,c):4===e&&(g=new tc(a,c));g&&this.Nj.push(g);a.seek(d)};c.prototype.et=function(a){if("kern"in this.hb){a.seek(this.hb.kern.offset);var b=a.getUint16(),d=a.getUint16();this.log("Kern Table version: %s",b);this.log("Kern nTables: %s",d);for(var e=0;e<d;e++){b=a.getUint16();var c=a.getUint16(),g=a.getUint16(),
h=g>>8,k=g&4,l=0===(g&1);this.log("Kerning subtable version %s format %s length %s coverage: %s",b,h,c,g);b=null;0===h?b=new uc(a,l,0!=k):(this.log("Unknown format -- skip"),a.seek(a.Lc+c));b&&this.hh.push(b)}}};c.prototype.ft=function(a){D("name"in this.hb);var b=this.hb.name.offset;a.seek(b);a.getUint16();for(var d=a.getUint16(),e=a.getUint16(),c=0;c<d;c++){var g=a.getUint16(),h=a.getUint16(),k=a.getUint16(),l=a.getUint16(),m=a.getUint16(),n=a.getUint16();n=a.seek(b+e+n);m=0===g||3===g?a.Tr(m):
a.Gn(m);this.log("Name %s/%s id %s language %s: %s",g,h,l,k,m);a.seek(n);switch(l){case 1:this.fontFamily=m;break;case 4:this.Sf=m}}};c.prototype.dt=function(a){D("hhea"in this.hb);a.seek(this.hb.hhea.offset);a.sk();a.Fb();a.Fb();a.Fb();a.Sr();a.Fb();a.Fb();a.Fb();a.getInt16();a.getInt16();a.Fb();a.getInt16();a.getInt16();a.getInt16();a.getInt16();a.getInt16();this.lh=a.getUint16()};c.prototype.zr=function(a){D("hmtx"in this.hb);var b=this.file;b.seek(this.hb.hmtx.offset+4);var d=this.hb.hmtx.offset;
if(a<this.lh){var e=this.file.seek(d+4*a);var c=b.getUint16();a=b.getInt16()}else e=b.seek(d+4*(this.lh-1)),c=b.getUint16(),b.seek(d+4*this.lh+2*(a-this.lh)),a=b.Fb();this.file.seek(e);return{Lm:c,ns:a}};c.prototype.Vr=function(){D("maxp"in this.hb);var a=this.file.seek(this.hb.maxp.offset+4),b=this.file.getUint16();this.file.seek(a);return b};c.prototype.xr=function(a){D("loca"in this.hb);var b=this.hb.loca,d=this.file;if(1===this.Un){b=d.seek(b.offset+4*a);a=d.getUint32();var e=d.getUint32()}else b=
d.seek(b.offset+2*a),a=2*d.getUint16(),e=2*d.getUint16();d.seek(b);return a===e?0:a+this.hb.glyf.offset};c.prototype.Do=function(a){var b=this.xr(a);a=this.file;if(0===b||b>=this.hb.glyf.offset+this.hb.glyf.length)return null;D(b>=this.hb.glyf.offset);D(b<this.hb.glyf.offset+this.hb.glyf.length);a.seek(b);b={zd:[],nh:a.getInt16(),ma:[],Xl:a.Fb(),Zl:a.Fb(),Wl:a.Fb(),Yl:a.Fb()};D(-1<=b.nh);-1===b.nh?this.bt(a,b):this.ht(a,b);return b};c.prototype.ht=function(a,b){function d(b,d,c){for(var f=0,k=0;k<
g;k++){var l=h[k];l&d?f=l&c?f+a.getUint8():f-a.getUint8():~l&c&&(f+=a.getInt16());e[k][b]=f}}b.zd=[];for(var e=b.ma=[],c=0;c<b.nh;c++)b.zd.push(a.getUint16());a.seek(a.getUint16()+a.Lc);if(0!==b.nh){var g=Math.max.apply(null,b.zd)+1,h=[];for(c=0;c<g;c++){var k=a.getUint8();h.push(k);e.push({x:0,y:0,eg:0<(k&1)});if(k&8){var l=a.getUint8();D(0<l);for(c+=l;l--;)h.push(k),e.push({x:0,y:0,eg:0<(k&1)})}}d("x",2,16,b.Xl,b.Wl);d("y",4,32,b.Zl,b.Yl)}};c.prototype.bt=function(a,b){var d,e,c=32;b.zd=[];for(b.ma=
[];c&32;){c=a.getUint16();var g=a.getUint16();var h=1;var k=d=0;var l=1;var m=e=0;if(c&1){var n=a.getInt16();var q=a.getInt16()}else n=a.getUint8(),q=a.getUint8();c&2&&(e=n,m=q);c&8?l=h=a.Se():c&64?(h=a.Se(),l=a.Se()):c&128&&(h=a.Se(),d=a.Se(),k=a.Se(),l=a.Se());this.log("Read component glyph index %s",g);this.log("Transform: [%s %s %s %s %s %s]",h,d,k,l,e,m);n=a.Lc;if(g=this.Do(g)){var u=b.ma.length;for(q=0;q<g.zd.length;q++)b.zd.push(g.zd[q]+u);for(q=0;q<g.ma.length;q++){u=g.ma[q].x;var v=g.ma[q].y;
u=h*u+d*v+e;v=k*u+l*v+m;b.ma.push({x:u,y:v,eg:g.ma[q].eg})}}a.seek(n)}b.nh=b.zd.length;c&256&&a.seek(a.getUint16()+a.Lc)};c.prototype.Eq=function(a,b,d,e){b=this.Do(b);if(null!==b)for(var c=0,g=0,h=0,k=0,l;g<b.ma.length;g++){var m=b.ma[g];0===c?(a.moveTo(m.x+d,m.y+e),c=1):1===c?m.eg?a.lineTo(m.x+d,m.y+e):c=2:(l=b.ma[g-1],m.eg?(a.quadraticCurveTo(l.x+d,l.y+e,m.x+d,m.y+e),c=1):a.quadraticCurveTo(l.x+d,l.y+e,(l.x+m.x)/2+d,(l.y+m.y)/2+e));g===b.zd[h]&&(2===c&&(l=m,m=b.ma[k],m.eg?a.quadraticCurveTo(l.x+
d,l.y+e,m.x+d,m.y+e):a.quadraticCurveTo(l.x+d,l.y+e,(l.x+m.x)/2+d,(l.y+m.y)/2+e)),k=g+1,h+=1,c=0)}};c.prototype.transform=function(a,b){a.scale(b/this.Nl,-b/this.Nl)};c.prototype.Kq=function(a,b,d,e,c){a.save();a.translate(d,e);this.transform(a,c);e=d=0;this.nt();for(c=0;c<b.length;c++){var f=this.ws(b.charCodeAt(c)),h=this.zr(f),k=this.Cs(f);this.log("Metrics for %s code %s index %s: %s %s kern: %s,%s",b.charAt(c),b.charCodeAt(c),f,h.Lm,h.ns,k.x,k.y);this.Eq(a,f,d+k.x,e+k.y);d+=h.Lm}a.restore()};
c.prototype.ws=function(a){for(var b=0,d=0;d<this.Nj.length&&!(b=this.Nj[d].map(a));d++);return b};c.prototype.nt=function(){for(var a=0;a<this.hh.length;a++)this.hh[a].reset()};c.prototype.Cs=function(a){for(var b,d=0,e=0,c=0;c<this.hh.length;c++)b=this.hh[c].get(a),d+=b.x,e+=b.y;return{x:d,y:e}};return c}(),wc=function(c){function a(){var a=c.call(this)||this;a.fonts={};a.mh=0;a.bk=[];a.log=B.create("FontCollection");return a}p(a,c);a.prototype.add=function(a,d){this.mh+=1;var b=this;C.Sp({url:a,
cu:function(e){b.Gp(a,d,e)},error:function(){b.Ia(a)},$p:function(a,b){b.overrideMimeType("text/plain; charset=x-user-defined")}})};a.prototype.Ia=function(a){this.log("Error fetching "+a);--this.mh;this.rm()};a.prototype.Gp=function(a,d,e){this.log("Got font %s; result is %s bytes",a,e.length);for(var b="",c=0;c<e.length;c++)b+=String.fromCharCode(e.charCodeAt(c)&255);e=new vc(b);this.log("Loaded '%s'",e.Sf);for(c=0;c<e.Sf.length;c++)this.log("   %s, %s",e.Sf.charAt(c),e.Sf.charCodeAt(c));d=d||e.fontFamily;
this.fonts[d]={name:e.Sf,url:a,data:b,font:e};--this.mh;this.rm()};a.prototype.rm=function(){if(0===this.mh){this.ua("done");for(var a=0;a<this.bk.length;a++)this.bk[a]();this.bk.length=0}};a.prototype.get=function(a){this.log("Lookup font %s",a);for(var b=0;b<a.length;b++)this.log("   %s, %s",a.charAt(b),a.charCodeAt(b));if(a in this.fonts)return this.fonts[a].font;this.log("Lookup font %s; not found",a);for(var e in this.fonts)this.log("Searched: '%s'",e)};return a}(Hb);B.create("Graphics",!0);
var E=function(){function c(a,b){this.x=a;this.y=b}c.prototype.Oa=function(a){return Math.sqrt((a.x-this.x)*(a.x-this.x)+(a.y-this.y)*(a.y-this.y))};c.prototype.toString=function(){return"("+this.x+", "+this.y+")"};c.prototype.be=function(a){return this.x===a.x&&this.y===a.y};c.prototype.clone=function(){return new c(this.x,this.y)};c.prototype.gi=function(a,b){var d=a.x,e=a.y,c=this.x,g=this.y,h=b.x-d,k=b.y-e,l=h*h+k*k;if(0===l)return this.Oa(a);l=((c-d)*h+(g-e)*k)/l;1<l?l=1:0>l&&(l=0);d=d+l*h-c;
e=e+l*k-g;return Math.sqrt(d*d+e*e)};return c}();function xc(c,a){this.width=c;this.height=a}function G(c,a,b,d){return Math.sqrt((c-b)*(c-b)+(a-d)*(a-d))}function I(c,a,b,d){var e=G(c,a,b,d);return 0===e?{x:1,y:0}:{x:(b-c)/e,y:(d-a)/e}}function yc(c){c.x*=-1;c.y*=-1;return c}
var K=function(){function c(a,b,d,e){this.x=a;this.y=b;this.width=d;this.height=e;this.Eo()}c.load=function(a){return new c(a.x,a.y,a.width,a.height)};c.Be=function(a){if(0===a.length)return new c(0,0,0,0);for(var b=a[0].x,d=a[0].x,e=a[0].y,f=a[0].y,g=1;g<a.length;g++)a[g].x<b&&(b=a[g].x),a[g].x>d&&(d=a[g].x),a[g].y<e&&(e=a[g].y),a[g].y>f&&(f=a[g].y);return new c(b,e,d-b,f-e)};c.prototype.save=function(){return{x:this.x,y:this.y,width:this.width,height:this.height}};c.prototype.clone=function(){return new c(this.x,
this.y,this.width,this.height)};c.prototype.be=function(a){return this.x===a.x&&this.y===a.y&&this.width===a.width&&this.height===a.height};c.prototype.Hh=function(a){a.x<this.x&&(this.width+=this.x-a.x,this.x=a.x);a.y<this.y&&(this.height+=this.y-a.y,this.y=a.y);a.x+a.width>this.x+this.width&&(this.width+=a.x+a.width-this.x-this.width);a.y+a.height>this.y+this.height&&(this.height+=a.y+a.height-this.y-this.height)};c.prototype.Ml=function(a,b){a<this.x?(this.width+=this.x-a,this.x=a):a>this.x+this.width&&
(this.width=a-this.x);b<this.y?(this.height+=this.y-b,this.y=b):b>this.y+this.height&&(this.height=b-this.y)};c.prototype.contains=function(a){return this.x<=a.x&&this.x+this.width>a.x+a.width&&this.y<=a.y&&this.y+this.height>a.y+a.height};c.prototype.Ps=function(a){return this.x>a.x+a.width||a.x>this.x+this.width||this.y>a.y+a.height||a.y>this.y+this.height?!1:!0};c.prototype.Vc=function(a,b,d){void 0===d&&(d=0);return this.x-d<=a&&this.x+this.width+d>a&&this.y-d<=b&&this.y+this.height+d>b};c.prototype.Eo=
function(){0>this.width&&(this.x+=this.width,this.width=-this.width);0>this.height&&(this.y+=this.height,this.height=-this.height)};c.prototype.Hc=function(a,b){void 0===b&&(b=a);this.x-=a/2;this.y-=b/2;this.width+=a;this.height+=b};c.prototype.transform=function(a){var b=a.apply(this.x,this.y);var d=a.apply(this.x+this.width,this.y);var e=a.apply(this.x+this.width,this.y+this.height);a=a.apply(this.x,this.y+this.height);this.x=Math.min(b.x,d.x,e.x,a.x);this.y=Math.min(b.y,d.y,e.y,a.y);this.width=
Math.max(b.x,d.x,e.x,a.x)-this.x;this.height=Math.max(b.y,d.y,e.y,a.y)-this.y};c.prototype.right=function(){return this.x+this.width};c.prototype.bottom=function(){return this.y+this.height};c.prototype.Lf=function(){return new E(this.x+this.width/2,this.y+this.height/2)};c.prototype.toString=function(){return"Rectangle("+this.x+", "+this.y+", "+this.width+", "+this.height+")"};return c}(),M=function(){function c(){this.log=B.create("MATRIX");this.Tb="Matrix";if(0===arguments.length)this.m11=1,this.m21=
this.m12=0,this.m22=1,this.Da=this.Ca=0;else if(1===arguments.length){if(6!==arguments[0].length)throw"Bad array initializer for Matrix.";this.m11=arguments[0][0];this.m12=arguments[0][1];this.m21=arguments[0][2];this.m22=arguments[0][3];this.Ca=arguments[0][4];this.Da=arguments[0][5]}else this.m11=arguments[0],this.m12=arguments[1],this.m21=arguments[2],this.m22=arguments[3],this.Ca=arguments[4],this.Da=arguments[5]}c.prototype.toString=function(){return"[ "+this.m11+" "+this.m12+" "+this.Ca+"    "+
this.m21+" "+this.m22+" "+this.Da+"    0 0 1 ]"};c.prototype.ec=function(){return[this.m11,this.m12,this.m21,this.m22,this.Ca,this.Da]};c.prototype.Dk=function(){return 1===this.m11&&0===this.m12&&0===this.m21&&1===this.m22&&0===this.Ca&&0===this.Da};c.prototype.be=function(a){return this.m11===a.m11&&this.m12===a.m12&&this.m21===a.m21&&this.m22===a.m22&&this.Ca===a.Ca&&this.Da===a.Da};c.prototype.multiply=function(a){var b=new c;b.m11=this.m11*a.m11+this.m12*a.m21;b.m21=this.m21*a.m11+this.m22*a.m21;
b.m12=this.m11*a.m12+this.m12*a.m22;b.m22=this.m21*a.m12+this.m22*a.m22;b.Ca=this.m11*a.Ca+this.m12*a.Da+this.Ca;b.Da=this.m21*a.Ca+this.m22*a.Da+this.Da;return b};c.prototype.apply=function(a,b){return new E(this.m11*a+this.m12*b+this.Ca,this.m21*a+this.m22*b+this.Da)};c.prototype.fj=function(a){var b;void 0===b&&(b=!1);b?a.setTransform(this.m11,this.m21,this.m12,this.m22,this.Ca,this.Da):a.transform(this.m11,this.m21,this.m12,this.m22,this.Ca,this.Da)};c.prototype.clone=function(){return new c(this.m11,
this.m12,this.m21,this.m22,this.Ca,this.Da)};c.prototype.inverse=function(){var a=this.m11*this.m22-this.m12*this.m21;return new c(this.m22/a,-this.m12/a,-this.m21/a,this.m11/a,(this.m12*this.Da-this.Ca*this.m22)/a,(this.Ca*this.m21-this.m11*this.Da)/a)};c.prototype.ip=function(){var a=this.m11,b=this.m21,d=this.m12,e=this.m22,f=Math.sqrt(a*a+b*b),g=Math.sqrt(d*d+e*e);return new c(a/f,d/g,b/f,e/g,this.Ca,this.Da)};c.prototype.Zg=function(){return new E(Math.sqrt(this.m11*this.m11+this.m21*this.m21),
Math.sqrt(this.m12*this.m12+this.m22*this.m22))};c.prototype.Zn=function(){return 1===this.m11&&1===this.m22&&0===this.m12&&0===this.m21};c.prototype.translate=function(a,b){return this.multiply(new L(a,b))};c.prototype.rotate=function(a,b,d){return this.multiply(new zc(a,b,d))};return c}(),zc=function(c){function a(a,d,e){var b=Math.cos(a);a=Math.sin(a);return c.call(this,b,a,-a,b,-d*b-e*a+d,d*a-e*b+e)||this}p(a,c);return a}(M),L=function(c){function a(a,d){return c.call(this,1,0,0,1,a,d)||this}
p(a,c);return a}(M),O=function(c){function a(a,d,e,f){return void 0===e||void 0===f?c.call(this,a,0,0,d,0,0)||this:c.call(this,a,0,0,d,e-a*e,f-d*f)||this}p(a,c);return a}(M),Ac=function(c){function a(a,d,e){var b=Math.cos(2*a);a=Math.sin(2*a);return c.call(this,b,a,a,-b,-d*b-e*a+d,-d*a+e*b+e)||this}p(a,c);return a}(M);
function Bc(c,a,b,d,e,f,g,h,k,l){if(!(8<++Bc.depth)){var m=(a+d)/2,n=(b+e)/2,q=(d+f)/2,u=(e+g)/2,v=(f+h)/2,z=(g+k)/2,w=(m+q)/2,y=(n+u)/2;q=(q+v)/2;u=(u+z)/2;var F=(w+q)/2,J=(y+u)/2,H=h-a,T=k-b;d=Math.abs((d-h)*T-(e-k)*H);f=Math.abs((f-h)*T-(g-k)*H);(d+f)*(d+f)<l*(H*H+T*T)?c.push(new E(F,J)):(Bc(c,a,b,m,n,w,y,F,J,l),Bc(c,F,J,q,u,v,z,h,k,l))}--Bc.depth}(Bc||(Bc={})).depth=0;
function Cc(c,a,b,d,e,f,g,h){if(!(8<++Bc.depth)){var k=(a+d)/2,l=(b+e)/2,m=(d+f)/2,n=(e+g)/2,q=(k+m)/2,u=(l+n)/2,v=f-a,z=g-b;d=Math.abs((d-f)*z-(e-g)*v);d*d<=h*(v*v+z*z)?c.push(new E(q,u)):(Cc(c,a,b,k,l,q,u,h),Cc(c,q,u,m,n,f,g,h))}--Bc.depth}
function Dc(c,a,b){var d,e=!1,f=c.length;1<f&&c[f-1].x===c[0].x&&c[f-1].y===c[0].y&&--f;if(3>f)return!1;var g=c[f-1].x;var h=c[f-1].y;for(d=0;d<f;d++){var k=c[d].x;var l=c[d].y;if(k>g){var m=g;var n=k;var q=h;h=l}else m=k,n=g,q=l;k<a===a<=g&&(b-q)*(n-m)<(h-q)*(a-m)&&(e=!e);g=k;h=l}return e}function Ec(c,a,b,d,e,f,g,h){b-=c;d-=a;g-=e;var k=h-f;var l=-g*d+b*k;if(0===l)return null;h=(-d*(c-e)+b*(a-f))/l;e=(g*(a-f)-k*(c-e))/l;return 0<=h&&1>=h&&0<=e&&1>=e?new E(c+e*b,a+e*d):null}
function Fc(c,a,b,d,e){for(var f=[],g=new E(c,a),h=1;h<=e.length;h++){var k=e[h-1],l=e[h%e.length];(k=Ec(c,a,b,d,k.x,k.y,l.x,l.y))&&f.push(k)}f.sort(function(a,b){return a.Oa(g)-b.Oa(g)});return f}function Gc(c,a,b,d){d*=d;for(var e=1;e<c.length;e++){var f=c[e-1].x,g=c[e-1].y,h=c[e].x-f,k=c[e].y-g,l=((a-f)*h+(b-g)*k)/(h*h+k*k);1<l?l=1:0>l&&(l=0);f=f+l*h-a;g=g+l*k-b;if(f*f+g*g<=d)return!0}return!1}
(function(){function c(a){this.Qb=a}c.prototype.clear=function(){for(var a=0;a<this.Qb.width*this.Qb.height*4;a++)this.Qb.data[a]=0};c.prototype.getImageData=function(){return this.Qb};c.prototype.width=function(){return this.Qb.width};c.prototype.height=function(){return this.Qb.height};c.prototype.get=function(a,b){var d=this.Qb.width*b*4+4*a;return this.Qb.data[d]|this.Qb.data[d+1]<<8|this.Qb.data[d+2]<<16|this.Qb.data[d+3]<<24};c.prototype.set=function(a,b,d){a=this.Qb.width*b*4+4*a;this.Qb.data[a]=
d&255;this.Qb.data[a+1]=d>>8&255;this.Qb.data[a+2]=d>>16&255;this.Qb.data[a+3]=d>>24&255};return c})();
(function(){function c(a,b){this.data=[];this.Rd=a;this.Sc=b;this.data=[]}c.prototype.width=function(){return this.Rd};c.prototype.height=function(){return this.Sc};c.prototype.getImageData=function(){var a=document.createElement("canvas");a.width=this.Rd;a.height=this.Sc;a=a.getContext("2d").getImageData(0,0,this.Rd,this.Sc);for(var b=this.Rd*this.Sc,d=0;d<b;d++){var e=!0===this.data[d]?255:0;a.data[4*d]=e;a.data[4*d+1]=e;a.data[4*d+2]=e;a.data[4*d+3]=255}return a};c.prototype.get=function(a,b){return!0===
this.data[this.Rd*b+a]};c.prototype.set=function(a,b,d){this.data[this.Rd*b+a]=d};return c})();
var P=function(){function c(a){this.closed=!1;this.ba=[];a instanceof K&&(this.moveTo(a.x,a.y),this.lineTo(a.x+a.width,a.y),this.lineTo(a.x+a.width,a.y+a.height),this.lineTo(a.x,a.y+a.height),this.lineTo(a.x,a.y),this.closePath())}c.prototype.clear=function(){this.closed=!1;this.ba=[]};c.prototype.beginPath=function(){};c.prototype.rect=function(){};c.prototype.moveTo=function(a,b){this.ba.push(c.qc,a,b)};c.prototype.lineTo=function(a,b){this.ba.push(c.pc,a,b)};c.prototype.bezierCurveTo=function(a,
b,d,e,f,g){this.ba.push(c.yf,a,b,d,e,f,g)};c.prototype.quadraticCurveTo=function(a,b,d,e){this.ba.push(c.Af,a,b,d,e)};c.prototype.arc=function(){};c.prototype.arcTo=function(){};c.prototype.closePath=function(){this.ba.push(c.zc)};c.prototype.ja=function(a){for(var b=0;b<this.ba.length;){switch(this.ba[b]){case c.qc:a.moveTo&&a.moveTo(this.ba[b+1],this.ba[b+2]);break;case c.pc:a.lineTo&&a.lineTo(this.ba[b+1],this.ba[b+2]);break;case c.yf:a.bezierCurveTo&&a.bezierCurveTo(this.ba[b+1],this.ba[b+2],
this.ba[b+3],this.ba[b+4],this.ba[b+5],this.ba[b+6]);break;case c.Af:a.quadraticCurveTo&&a.quadraticCurveTo(this.ba[b+1],this.ba[b+2],this.ba[b+3],this.ba[b+4]);break;case c.zc:a.closePath&&a.closePath();break;default:alert("Error!")}b+=c.gc[this.ba[b]]}};c.prototype.Nd=function(){for(var a=0,b,d=[];a<this.ba.length;){var e=c.km[this.ba[a]];for(b=0;b<e;b++)d.push(new E(this.ba[a+1+2*b],this.ba[a+1+2*b+1]));a+=c.gc[this.ba[a]]}return d};c.prototype.transform=function(a){for(var b=0,d,e;b<this.ba.length;){e=
c.km[this.ba[b]];for(d=0;d<e;d++){var f=a.apply(this.ba[b+1+2*d],this.ba[b+1+2*d+1]);this.ba[b+1+2*d]=f.x;this.ba[b+1+2*d+1]=f.y}b+=c.gc[this.ba[b]]}};c.prototype.clone=function(){var a=new c;a.ba=this.ba.concat();return a};c.prototype.Tm=function(a){for(var b=0,d,e=d=0,f=new K(this.ba[1],this.ba[2],0,0),g;b<this.ba.length;){switch(this.ba[b]){case c.qc:case c.pc:d=this.ba[b+1];e=this.ba[b+2];f.Ml(d,e);break;case c.yf:var h=g=[],k=this.ba[b+5],l=this.ba[b+6];Bc(h,d,e,this.ba[b+1],this.ba[b+2],this.ba[b+
3],this.ba[b+4],k,l,a*a);h.push(new E(k,l));for(d=0;d<g.length;d++)f.Ml(g[d].x,g[d].y);d=this.ba[b+5];e=this.ba[b+6];break;case c.Af:h=g=[];k=this.ba[b+3];l=this.ba[b+4];Cc(h,d,e,this.ba[b+1],this.ba[b+2],k,l,a*a);h.push(new E(k,l));for(d=0;d<g.length;d++)f.Ml(g[d].x,g[d].y);d=this.ba[b+3];e=this.ba[b+4]}b+=c.gc[this.ba[b]]}return f};c.prototype.append=function(a){this.ba=this.ba.concat(a.ba)};c.prototype.Jl=function(a){for(var b=0,d=0,e=0,f=new c,g;b<this.ba.length;){switch(this.ba[b]){case c.qc:d=
this.ba[b+1];e=this.ba[b+2];f.moveTo(d,e);break;case c.pc:d=this.ba[b+1];e=this.ba[b+2];f.lineTo(d,e);break;case c.yf:var h=g=[],k=this.ba[b+5],l=this.ba[b+6];Bc(h,d,e,this.ba[b+1],this.ba[b+2],this.ba[b+3],this.ba[b+4],k,l,a*a);h.push(new E(k,l));2===g.length&&1E-4>d*(g[0].y-g[1].y)+g[0].x*(g[1].y-e)+g[1].x*(e-g[0].y)&&(g[0]=g[1],g.length=1);for(d=0;d<g.length;d++)f.lineTo(g[d].x,g[d].y);d=this.ba[b+5];e=this.ba[b+6];break;case c.Af:h=g=[];k=this.ba[b+3];l=this.ba[b+4];Cc(h,d,e,this.ba[b+1],this.ba[b+
2],k,l,a*a);h.push(new E(k,l));for(d=0;d<g.length;d++)f.lineTo(g[d].x,g[d].y);d=this.ba[b+3];e=this.ba[b+4];break;case c.zc:f.closePath()}b+=c.gc[this.ba[b]]}return f};c.prototype.Ao=function(a,b,d){void 0===d&&(d=0);return Dc(this.Nd(),a,b)||0<d&&this.al(a,b,d)};c.prototype.al=function(a,b,d){var e=0,f=0,g=0;for(d*=d;g<this.ba.length;){switch(this.ba[g]){case c.qc:e=this.ba[g+1];f=this.ba[g+2];break;case c.pc:var h=this.ba[g+1];var k=this.ba[g+2];var l=h-e;var m=k-f;var n=l*l+m*m;n=((a-e)*l+(b-f)*
m)/n;1<n?n=1:0>n&&(n=0);e+=n*l;m=f+n*m;f=e-a;m-=b;f=f*f+m*m;if(f<=d)return!0;e=h;f=k}g+=c.gc[this.ba[g]]}return!1};c.prototype.nq=function(a){a=a.Nd();for(var b=0,d=new E(0,0),e=new E(0,0),f=new c,g=!1,h;b<this.ba.length;){switch(this.ba[b]){case c.qc:d.x=this.ba[b+1];d.y=this.ba[b+2];(g=Dc(a,d.x,d.y))||f.moveTo(d.x,d.y);break;case c.pc:e.x=this.ba[b+1];e.y=this.ba[b+2];h=Fc(d.x,d.y,e.x,e.y,a);for(var k=0;k<h.length;k++)g?f.moveTo(h[k].x,h[k].y):f.lineTo(h[k].x,h[k].y),g=!g;g||f.lineTo(e.x,e.y);d.x=
e.x;d.y=e.y}b+=c.gc[this.ba[b]]}return f};c.prototype.ii=function(a,b){for(var d=0,e=0,f=b[0],g,h=new E(0,0),k;d<this.ba.length;){switch(this.ba[d]){case c.qc:k=this.ba[d+1];g=this.ba[d+2];a.moveTo(k,g);h=new E(k,g);break;case c.pc:k=this.ba[d+1];var l=g=this.ba[d+2],m=new E(k,l);g=h.Oa(m);if(!(0>=g)){for(;g>f;)h.x+=(m.x-h.x)*f/g,h.y+=(m.y-h.y)*f/g,e&1?a.moveTo(h.x,h.y):a.lineTo(h.x,h.y),g-=f,e=(e+1)%b.length,f=b[e];g<=f&&(h=new E(k,l),e&1?a.moveTo(h.x,h.y):a.lineTo(h.x,h.y),f-=g)}}d+=c.gc[this.ba[d]]}};
c.prototype.Tp=function(){function a(a,b){f-=(a-d)*(b+e);d=a;e=b}for(var b=0,d,e,f=0;b<this.ba.length;){switch(this.ba[b]){case c.qc:d=this.ba[b+1];e=this.ba[b+2];break;case c.pc:a(this.ba[b+1],this.ba[b+2]);break;case c.yf:a(this.ba[b+5],this.ba[b+6]);break;case c.Af:a(this.ba[b+3],this.ba[b+4])}b+=c.gc[this.ba[b]]}return f/2};c.prototype.jn=function(a){for(var b=0,d=0,e=0,f=!1;b<this.ba.length;){switch(this.ba[b]){case c.qc:d=this.ba[b+1];e=this.ba[b+2];f=!0;break;case c.pc:a(d,e,this.ba[b+1],this.ba[b+
2],f),d=this.ba[b+1],e=this.ba[b+2],f=!1}b+=c.gc[this.ba[b]]}};c.prototype.cq=function(){var a=0;this.jn(function(b,d,e,c){a+=G(b,d,e,c)});return a};c.prototype.eq=function(a){var b=new c,d=0;this.jn(function(e,c,g,h,k){if(d<=a){k&&b.moveTo(e,c);k=G(e,c,g,h);if(d+k>=a){var f=a-d;g=e+(g-e)*f/k;h=c+(h-c)*f/k}d+=k;b.lineTo(g,h)}});return b};c.qc=0;c.pc=1;c.yf=2;c.Af=3;c.zc=4;c.gc=[3,3,7,5,1];c.km=[1,1,3,2,0];return c}();
function Hc(c,a,b,d,e){var f;if(2>=d-b)e.push(c[b]);else{var g=c[b],h=c[d-1],k=0,l=0;for(f=b+1;f<d;f++){var m=c[f].gi(g,h);m>k&&(k=m,l=f)}0<l&&k>a?(Hc(c,a,b,l,e),Hc(c,a,l,d,e)):e.push(g)}}function Ic(c,a){var b=[];Hc(c,a,0,c.length,b);0<c.length&&0<b.length&&!c[c.length-1].be(b[b.length-1])&&b.push(c[c.length-1]);return b}
var Q=function(){function c(){this.ma=[];if(1===arguments.length){var a=arguments[0];if(a instanceof K)this.ma.push(new E(a.x,a.y)),this.ma.push(new E(a.right(),a.y)),this.ma.push(new E(a.right(),a.bottom())),this.ma.push(new E(a.x,a.bottom()));else if(a instanceof Array)this.ma=a;else throw alert("Bad parameter passed to Polygon() constructor."),"Error";}}c.prototype.transform=function(a){for(var b=0;b<this.ma.length;b++)this.ma[b]=a.apply(this.ma[b].x,this.ma[b].y)};c.prototype.add=function(a,b){this.ma.push(new E(a,
b))};c.prototype.Vc=function(a,b,d){void 0===d&&(d=0);return Dc(this.ma,a,b)||d&&Gc(this.ma,a,b,d)};c.prototype.Sm=function(){return K.Be(this.ma)};c.prototype.clone=function(){return new c(this.ma.slice(0))};c.prototype.be=function(a){if(this.ma.length!==a.ma.length)return!1;for(var b=0;b<this.ma.length;b++){var d=this.ma[b],e=a.ma[b];if(d.x!==e.x||d.y!==e.y)return!1}return!0};c.prototype.Hc=function(a){for(var b=[],d=0;d<this.ma.length;d++){var e=this.ma[0===d?this.ma.length-1:d-1],c=this.ma[d],
g=this.ma[d===this.ma.length-1?0:d+1],h=G(e.x,e.y,c.x,c.y),k=G(g.x,g.y,c.x,c.y);b.push({x:c.x+((c.x-e.x)/h+(c.x-g.x)/k)/Math.sqrt(2)*a,y:c.y+((c.y-e.y)/h+(c.y-g.y)/k)/Math.sqrt(2)*a})}this.ma=b};c.prototype.ja=function(a){if(!(1>this.ma.length)){a.moveTo(this.ma[0].x,this.ma[0].y);for(var b=1;b<this.ma.length;b++)a.lineTo(this.ma[b].x,this.ma[b].y);a.closePath()}};c.prototype.Nd=function(){return this.ma};c.Nu=function(a,b){for(var d=0,e=0,c=!1,g=[],h=[],k=0;k<b.length;k++)h.push(0);for(;;){var l=
0,m=-1;for(k=0;k<b.length;k++)if(h[k]<b[k].length){var n=b[k][h[k]];if(0===k||n<l){l=n;m=k;var q=1-h[k]%2}}if(-1===m)return g;h[m]+=1;"intersection"===a?q?(e+=1,e===b.length&&(d=l)):(e===b.length&&(g.push(d),g.push(l)),--e):q?(e+=1,0===m?(c=!0,1===e)&&(d=l):c&&2===e&&(g.push(d),g.push(l))):(c&&1===e&&(g.push(d),g.push(l)),--e,0===m&&(c=!1),c&&1===e&&(d=l))}};return c}();
function Jc(c,a,b,d,e,f,g,h){b-=c;d-=a;g-=e;h-=f;var k=-g*d+b*h;if(0===k)return null;e=(g*(a-f)-h*(c-e))/k;return new E(c+e*b,a+e*d)}
function Kc(c,a){function b(a){var b,e;var c=[];var k=b=0;for(e=a.length;k<e;k++){var l=a[k];a[b+1]&&(c[b]=d(l,a[b+1]));b+=1}return c}function d(a,b){return new E(a.x+(b.x-a.x)/2,a.y+(b.y-a.y)/2)}return a?Kc(b(b(function(a){var b,e;a=[a[0]].concat(a).concat(a[a.length-1]);var c=[];var k=b=0;for(e=a.length;k<e;k++){var l=a[k];c[2*b]=l;a[b+1]&&(c[2*b+1]=d(l,a[b+1]));b+=1}return c}(c))),a-1):c}
function Lc(c,a){var b;void 0===b&&(b=null);var d=a.match(/[A-Z]+|-?[0-9\.E]+/gi),e=0,f=0,g,h=[];if(d)for(g=0;g<d.length;g++){var k=d[g++];var l=d;for(h.length=0;g<l.length;g++){var m=parseFloat(l[g]);if(isNaN(m)){g--;break}else h.push(m)}if("M"===k){c.moveTo(h[0],h[1]);for(k=2;k<h.length;k+=2)c.lineTo(h[k],h[k+1]);e=h[h.length-2];f=h[h.length-1]}else if("m"===k)for(c.moveTo(h[0]+e,h[1]+f),e=h[0]+e,f=h[1]+f,k=2;k<h.length;k+=2)c.lineTo(h[k]+e,h[k+1]+f),e=h[k]+e,f=h[k+1]+f;else if("L"===k){for(k=0;k<
h.length;k+=2)c.lineTo(h[k],h[k+1]);e=h[h.length-2];f=h[h.length-1]}else if("l"===k)for(k=0;k<h.length;k+=2)c.lineTo(h[k]+e,h[k+1]+f),e=h[k]+e,f=h[k+1]+f;else if("C"===k)for(k=0;k<h.length;k+=6)c.bezierCurveTo(h[k],h[k+1],h[k+2],h[k+3],h[k+4],h[k+5]),e=h[k+4],f=h[k+5];else if("c"===k)for(k=0;k<h.length;k+=6)c.bezierCurveTo(h[k]+e,h[k+1]+f,h[k+2]+e,h[k+3]+f,h[k+4]+e,h[k+5]+f),e=h[k+4]+e,f=h[k+5]+f;else"z"===k||"Z"===k?c.closePath():b&&b(k,h)}}
var Mc=function(){function c(){this.items=[];this.sa=new M}c.prototype.toString=function(){return this.items.join(" ")};c.prototype.arc=function(){throw Error("SvgPathContext.arc is not implemented.");};c.prototype.arcTo=function(){throw Error("SvgPathContext.arcTo is not implemented.");};c.prototype.moveTo=function(a,b){var d=this.sa.apply(a,b);this.items.push("M",d.x,d.y)};c.prototype.lineTo=function(a,b){var d=this.sa.apply(a,b);this.items.push("L",d.x,d.y)};c.prototype.transform=function(a,b,
d,e,c,g){a=new M(a,d,b,e,c,g);this.sa=this.sa.multiply(a)};c.prototype.rect=function(){};c.prototype.bezierCurveTo=function(a,b,d,e,c,g){a=this.sa.apply(a,b);d=this.sa.apply(d,e);c=this.sa.apply(c,g);this.items.push("C",a.x,a.y,d.x,d.y,c.x,c.y)};c.prototype.quadraticCurveTo=function(){throw Error("SvgPathContext.quadraticCurveTo is not implemented.");};c.prototype.beginPath=function(){};c.prototype.closePath=function(){this.items.push("Z")};return c}();
function Nc(c,a,b,d,e,f){if(!(2>a.length)){void 0===e&&(e=!0);void 0===f&&(f=!0);var g=a[0].x===a[a.length-1].x&&a[0].y===a[a.length-1].y,h=[],k=[],l=new E(0,0),m=l,n=l,q=l,u=l,v=[],z=b/2,w;for(w=1;w<a.length;w++){n=a[w-1];u=a[w];q=I(n.x,n.y,u.x,u.y);l=new E(q.y,-q.x);"middle"===d?(m=new E(n.x-q.x*z-l.x*z,n.y-q.y*z-l.y*z),n=new E(n.x-q.x*z+l.x*z,n.y-q.y*z+l.y*z)):"outside"===d?m=new E(n.x-l.x*b,n.y-l.y*b):(m=n,n=new E(n.x+l.x*b,n.y+l.y*b));if(k.length){var y=k[k.length-1];var F=v[v.length-1];m=Jc(y.x,
y.y,y.x+F.x,y.y+F.y,m.x,m.y,m.x+q.x,m.y+q.y)||m;y=h[h.length-1];n=Jc(y.x,y.y,y.x+F.x,y.y+F.y,n.x,n.y,n.x+q.x,n.y+q.y)||n}k.push(m);h.push(n);v.push(q)}g?(y=k[0],F=v[0],m=Jc(y.x,y.y,y.x+F.x,y.y+F.y,m.x,m.y,m.x+q.x,m.y+q.y)||m,y=h[0],n=Jc(y.x,y.y,y.x+F.x,y.y+F.y,n.x,n.y,n.x+q.x,n.y+q.y)||n,k[0].x=m.x,k[0].y=m.y,h[0].x=n.x,h[0].y=n.y,k.push(m),h.push(n)):"middle"===d?(k.push(new E(u.x+q.x*z-l.x*z,u.y+q.y*z-l.y*z)),h.push(new E(u.x+q.x*z+l.x*z,u.y+q.y*z+l.y*z))):"outside"===d?(k.push(new E(u.x-l.x*b,
u.y-l.y*b)),h.push(u)):(k.push(u),h.push(new E(u.x+l.x*b,u.y+l.y*b)));if(f){c.moveTo(k[0].x,k[0].y);for(w=1;w<k.length;w++)c.lineTo(k[w].x,k[w].y);g&&(c.closePath(),c.moveTo(h[h.length-1].x,h[h.length-1].y))}else e&&c.moveTo(h[h.length-1].x,h[h.length-1].y);if(e){for(w=h.length-1;0<=w;w--)c.lineTo(h[w].x,h[w].y);!g&&f&&c.lineTo(k[0].x,k[0].y)}}};var Oc=function(){function c(a,b,d,e){this.view=a;this.jf=b;this.Da=this.Ca=0;this.Ma=!1;this.log=B.create("SELECT");this.ro(d,e)}c.prototype.wb=function(a){if("touchmove"===a.type){var b=this.view.yc(a.changedTouches[0]);this.Ta(b.x,b.y,a)}else"touchend"===a.type&&(b=this.view.yc(a.changedTouches[0]),this.Za(b.x,b.y,a));return!0};c.prototype.Ya=function(a){this.log("Gesture detected; aborting select box.");this.view.Pa(this.jf);return this.jf.Ya?this.jf.Ya(a):!1};c.prototype.Sa=function(a,b){return this.ro(a,
b)};c.prototype.ro=function(a,b){this.Ca=a;this.Da=b;return this.Ma=!0};c.prototype.Ta=function(a,b){if(this.Ma){var d=this;this.view.ja(function(e){e.save();e.strokeStyle="#0050B7";e.lineWidth=2/d.view.scale;e.fillStyle="rgba(0, 80, 183, 0.2)";var c=new K(d.Ca+.5,d.Da+.5,a-d.Ca,b-d.Da);e.fillRect(c.x,c.y,c.width,c.height);e.strokeRect(c.x,c.y,c.width,c.height);e.restore()});return!0}return!1};c.prototype.Za=function(a,b){this.Ma=!1;this.view.nb();this.view.qt(new K(this.Ca,this.Da,a-this.Ca,b-this.Da));
this.view.Nb();this.view.ja();this.view.Pa(this.jf);return!0};return c}();var Pc=B.create("FitCurve");
function Qc(c){function a(a,b){F.bezierCurveTo(b[1].x,b[1].y,b[2].x,b[2].y,b[3].x,b[3].y);Pc("Bezier: (%s,%s), (%s,%s), (%s,%s), (%s,%s)",b[0].x,b[0].y,b[1].x,b[1].y,b[2].x,b[2].y,b[3].x,b[3].y)}function b(a,b){return a.x*b.x+a.y*b.y}function d(a){var b=1-a;return 3*a*b*b}function e(a){return 3*a*a*(1-a)}function f(a,b){var d=a.x-b.x,e=a.y-b.y;return Math.sqrt(d*d+e*e)}function g(a){return a.x*a.x+a.y*a.y}function h(a,b){var d=Math.sqrt(g(a));0!==d&&(a.x*=b/d,a.y*=b/d);return a}function k(a,b,d){void 0===
d&&Pc("Undef!");d.x=a.x+b.x;d.y=a.y+b.y;return d}function l(a,b){return{x:a.x+b.x,y:a.y+b.y}}function m(a,b){return{x:a.x*b,y:a.y*b}}function n(a,b){return{x:a.x-b.x,y:a.y-b.y}}function q(a,c,g,z,q,u){var v,w=[],y=[[],[]],H=[];var J=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}];var F=g-c+1;for(v=0;v<F;v++){var T={x:q.x,y:q.y};var W={x:u.x,y:u.y};h(T,d(z[v]));h(W,e(z[v]));w[v]=[T,W]}y[0][0]=0;y[0][1]=0;y[1][0]=0;y[1][1]=0;H[0]=0;for(v=H[1]=0;v<F;v++)y[0][0]+=b(w[v][0],w[v][0]),y[0][1]+=b(w[v][0],w[v][1]),
y[1][0]=y[0][1],y[1][1]+=b(w[v][1],w[v][1]),T=1-z[v],W=z[v],T=n(a[c+v],l(m(a[c],T*T*T),l(m(a[c],d(z[v])),l(m(a[g],e(z[v])),m(a[g],W*W*W))))),H[0]+=b(w[v][0],T),H[1]+=b(w[v][1],T);z=y[0][0]*y[1][1]-y[1][0]*y[0][1];v=y[0][0]*H[1]-y[0][1]*H[0];H=H[0]*y[1][1]-H[1]*y[0][1];0===z&&(z=y[0][0]*y[1][1]*1E-11);y=H/z;H=v/z;if(0>y||0>H)return y=f(a[g],a[c])/3,J[0]=a[c],J[3]=a[g],k(J[0],h(q,y),J[1]),k(J[3],h(u,y),J[2]),J;J[0]=a[c];J[3]=a[g];k(J[0],h(q,y),J[1]);k(J[3],h(u,H),J[2]);return J}function u(a,b,d){var e;
var c=[];for(e=0;e<=a;e++)c[e]={x:b[e].x,y:b[e].y};for(e=1;e<=a;e++)for(b=0;b<=a-e;b++)c[b].x=(1-d)*c[b].x+d*c[b+1].x,c[b].y=(1-d)*c[b].y+d*c[b+1].y;return c[0]}function v(a){var b=Math.sqrt(Math.sqrt(g(a)));0!==b&&(a.x/=b,a.y/=b);return a}function z(a,b,d,e,c){var f,h=(d-b+1)/2;var k=0;for(f=b+1;f<d;f++){var l=u(3,e,c[f-b]);l=n(l,a[f]);l=g(l);l>=k&&(k=l,h=f)}return{jo:k,ap:h}}function w(b,d,e,c,g,l){var m;var F=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}];var J=l*l;if(2===e-d+1)l=f(b[e],b[d])/3,F[0]=
b[d],F[3]=b[e],k(F[0],h(c,l),F[1]),k(F[3],h(g,l),F[2]),a(3,F);else{var H=[0];for(m=d+1;m<=e;m++)H[m-d]=H[m-d-1]+f(b[m],b[m-1]);for(m=d+1;m<=e;m++)H[m-d]/=H[e-d];var T=H;F=q(b,d,e,T,c,g);m=z(b,d,e,F,T);H=m.jo;m=m.ap;if(H<l)a(3,F);else{if(H<J||y)for(J=0;4>J;J++){m=b;H=d;var W=e;var Xd=F;var sc=[];for(F=H;F<=W;F++){var Yd=sc,Zd=F-H,N,La=Xd,bb=m[F],cb=T[F-H],ta=[];var Aa=[];var db=u(3,La,cb);for(N=0;2>=N;N++)ta[N]={x:0,y:0},ta[N].x=3*(La[N+1].x-La[N].x),ta[N].y=3*(La[N+1].y-La[N].y);for(N=0;1>=N;N++)Aa[N]=
{x:0,y:0},Aa[N].x=2*(ta[N+1].x-ta[N].x),Aa[N].y=2*(ta[N+1].y-ta[N].y);N=u(2,ta,cb);Aa=u(1,Aa,cb);Yd[Zd]=cb-((db.x-bb.x)*N.x+(db.y-bb.y)*N.y)/(N.x*N.x+N.y*N.y+(db.x-bb.x)*Aa.x+(db.y-bb.y)*Aa.y)}W=sc;F=q(b,d,e,W,c,g);m=z(b,d,e,F,W);H=m.jo;m=m.ap;if(H<l||y){a(3,F);return}T=W}W={x:0,y:0};J=n(b[m-1],b[m]);H=n(b[m],b[m+1]);W.x=(J.x+H.x)/2;W.y=(J.y+H.y)/2;J=W=v(W);w(b,d,m,c,J,l);J.x=-J.x;J.y=-J.y;w(b,m,e,J,g,l)}}}var y=!0;void 0===y&&(y=!1);var F=new P;F.moveTo(c[0].x,c[0].y);(function(a,b,d){var e=n(a[1],
a[0]);e=v(e);var c=b-1;c=n(a[c-1],a[c]);c=v(c);w(a,0,b-1,e,c,d)})(c,c.length,25);return F};var Rc=function(){function c(a){this.view=a;this.start=new E(0,0);this.Cl=new E(0,0);this.active=!1;this.rect=null;this.log=B.create("PanZoomMixin")}c.prototype.Ya=function(a){this.log("onGesture(%s)",a.type);if(!this.view.da.get("allowZoom"))return!1;if("gesturestart"===a.type)this.start=new E(a.pageX,a.pageY),this.Cl=this.view.eb(a.pageX,a.pageY),this.rect=this.view.Wf(),this.active=!0;else if("gesturechange"===a.type&&this.rect){var b=a.pageX-this.start.x,d=a.pageY-this.start.y;a=this.view.da.hl(1/
a.scale);a=new O(a,a,this.Cl.x,this.Cl.y);a=(new L(-b/this.view.scale,-d/this.view.scale)).multiply(a);b=this.rect.clone();b.transform(a);this.view.xh(b)}else"gestureend"===a.type&&(this.active=!1);return!0};return c}();var Sc=function(){function c(a){this.view=a;this.state="none";this.start=new E(0,0);this.cp=this.bp=0;this.log=B.create("PanTool");this.ac=new Rc(a)}c.prototype.tc=function(){this.log("Entering PanToolBehaviour");this.view.canvas.style.cursor="all-scroll"};c.prototype.Ic=function(){this.log("Leaving PanToolBehaviour")};c.prototype.Ya=function(a){return this.ac.Ya(a)};c.prototype.wb=function(a){if("touchstart"===a.type){var b=a.changedTouches[0];b=this.view.eb(b.pageX,b.pageY);return this.Sa(b.x,b.y,
a)}return"touchmove"===a.type?(b=a.changedTouches[0],b=this.view.eb(b.pageX,b.pageY),this.Ta(b.x,b.y,a)):"touchend"===a.type?(b=a.changedTouches[0],b=this.view.eb(b.pageX,b.pageY),this.Za(b.x,b.y,a)):!0};c.prototype.En=function(a){switch(a.type){case "touchend":case "touchstart":case "touchmove":return new E(a.changedTouches[0].pageX,a.changedTouches[0].pageY);case "mousedown":case "mouseup":case "mousemove":case "pointerdown":case "pointermove":case "pointerup":return new E(a.pageX,a.pageY);default:return this.log("Can't handle event: %s",
a.type),new E(0,0)}};c.prototype.Sa=function(a,b,d){this.log("onMouseDown type %s",d.type);this.state="dragging";this.start=this.En(d);this.bp=this.view.yb;this.cp=this.view.ib;return!0};c.prototype.Ta=function(a,b,d){if("dragging"!==this.state)return!1;a=this.En(d);b=this.cp+a.y-this.start.y;this.view.yb=this.bp+a.x-this.start.x;this.view.ib=b;this.view.ic();this.view.ja();return!0};c.prototype.Za=function(){this.state="none";return!0};c.prototype.Wk=function(a,b,d,e){if(!this.view.da.get("allowZoom"))return this.log("Zooming is disabled."),
!1;this.log("onMouseWheel(%s, %s, %s)",a,b,d);d=0<d?1/1.1:1.1;a=new O(d,d,a,b);b=this.view.Wf();b.transform(a);this.view.xh(b);e.stopPropagation();e.preventDefault();return!0};c.prototype.Zb=function(a){"cancel"===a&&this.view.Wa()};return c}();var Tc=function(c){function a(a,d,e){var b=c.call(this)||this;b.id=a;b.Dd=d;b.Fi=!0;b.width=32;b.height=500;b.mv=0;b.Eb=new K(0,0,0,0);b.Ma=!1;b.Yp="#c0c0c0";b.Rm="#808080";b.borderWidth=1;b.Zd=0;b.Yd=100;b.Ul=10;b.position=5;b.offset=0;b.log=B.create("SCROLLBAR",!0);b.Fi=!0;b.canvas=Zb(document.body);b.canvas.style.position="absolute";b.canvas.style.border="none";b.ka=b.canvas.getContext("2d");C(b.canvas).bind("click",function(a){b.nc(a)});C(b.canvas).bind("mousedown",function(a){b.Sa(a)});e.bind(C(document.body),
"mousemove",function(a){b.Ta(a)});e.bind(C(document.body),"mouseup",function(a){b.Za(a)});C(b.canvas).bind("touchstart",function(a){b.wb(a)});e.bind(C(document.body),"touchmove",function(a){b.wb(a)});e.bind(C(document.body),"touchend",function(a){b.wb(a)});b.format();return b}p(a,c);a.prototype.Ij=function(a){a.appendChild(this.canvas)};a.prototype.moveTo=function(a,d){this.canvas.style.left=""+a+"px";this.canvas.style.top=""+d+"px"};a.prototype.ve=function(a,d){this.width=a;this.height=d;this.canvas.width=
this.width;this.canvas.height=d;this.format();this.ja()};a.prototype.Xa=function(){this.canvas.style.display="none"};a.prototype.show=function(){this.canvas.style.display="block"};a.prototype.fs=function(){return"block"===this.canvas.style.display};a.prototype.Wo=function(a,d,e,c){this.Zd=a;this.Yd=d-a;this.Ul=e;this.position=c;this.format();this.ja()};a.prototype.format=function(){var a=this.Dd?this.width:this.height;var d=this.Ul/this.Yd*a;a*=(this.position-this.Zd)/this.Yd;this.Eb=this.Dd?new K(a,
0,d-1,this.height-1):new K(0,a,this.width-1,d-1);this.Eb.x=Math.round(this.Eb.x)+.5;this.Eb.y=Math.round(this.Eb.y)+.5;this.Eb.width=Math.round(this.Eb.width);this.Eb.height=Math.round(this.Eb.height)};a.prototype.ja=function(){this.ka.beginPath();this.ka.fillStyle=this.Yp;this.ka.strokeStyle=this.Rm;this.ka.lineWidth=this.borderWidth;this.ka.rect(this.borderWidth/2,this.borderWidth/2,this.width-this.borderWidth,this.height-this.borderWidth);this.ka.fill();this.ka.stroke();this.ka.beginPath();this.ka.fillStyle=
this.Rm;this.ka.strokeStyle="#000000";this.ka.rect(this.Eb.x,this.Eb.y,this.Eb.width,this.Eb.height);this.ka.fill();this.ka.stroke()};a.prototype.pn=function(a){var b=C(this.canvas).offset(),e=0,c=0;if("touchstart"===a.type||"touchend"===a.type||"touchmove"===a.type)e=a.changedTouches[0].pageX,c=a.changedTouches[0].pageY;else if("mousedown"===a.type||"mouseup"===a.type||"mousemove"===a.type)e=a.pageX,c=a.pageY;return new E(e-b.left,c-b.top)};a.prototype.wb=function(a){switch(a.type){case "touchstart":this.Sa(a);
break;case "touchend":this.Za(a);break;case "touchmove":this.Ta(a)}};a.prototype.nc=function(){};a.prototype.Bo=function(a){a=this.Dd?a.x/this.width*this.Yd+this.Zd:a.y/this.height*this.Yd+this.Zd;a=Math.min(a,this.Yd-this.Ul+this.Zd);return a=Math.max(a,this.Zd)};a.prototype.Sa=function(a){a.preventDefault();a=this.pn(a);this.Eb.Vc(a.x,a.y)?this.Dd?(this.offset=a.x-this.Eb.x,a.x-=this.offset):(this.offset=a.y-this.Eb.y,a.y-=this.offset):(this.position=this.Bo(a),this.offset=0,this.Dd?this.Eb.x=(this.position-
this.Zd)/this.Yd*this.width:this.Eb.y=(this.position-this.Zd)/this.Yd*this.height,this.ua("scroll",this.position),this.ja());this.Ma=!0};a.prototype.Ta=function(a){this.Ma&&(this.Ma&&"mousemove"===a.type&&0===a.buttons?this.Ma=!1:(a.preventDefault(),a=this.pn(a),this.Dd?a.x-=this.offset:a.y-=this.offset,this.position=this.Bo(a),this.ua("scroll",this.position),this.format(),this.ja()))};a.prototype.Za=function(){this.Ma&&(this.Ma=!1)};a.prototype.ti=function(){return this.Dd?this.height:this.width};
a.Uu=0;a.Ru=1;a.Mu=2;a.Tu=3;return a}(Hb);var Uc=function(){function c(a,b){void 0===b&&(b=30);this.bc=a;this.xc=b;this.If=[];this.log=B.create("AngleAddon")}c.prototype.format=function(){var a=this.bc.Kc,b=0,d=[],e=[];this.If.length=0;for(var c=0>a.Tp();b<a.ba.length;){switch(a.ba[b]){case P.qc:d=[new E(a.ba[b+1],a.ba[b+2])];e=d.concat();break;case P.pc:3===d.length&&d.shift();d.push(new E(a.ba[b+1],a.ba[b+2]));e.push(d[d.length-1]);3===d.length&&this.Im(d[0],d[1],d[2],c);break;case P.zc:3<=e.length&&this.Im(e[e.length-2],e[0],e[1],c)}b+=
P.gc[a.ba[b]]}};c.prototype.Im=function(a,b,d,e){var c=I(b.x,b.y,a.x,a.y);var g=I(b.x,b.y,d.x,d.y);a=I(a.x,a.y,d.x,d.y);new E(c.x+a.x/2,c.y+a.y/2);c=Math.atan2(c.y,c.x);g=Math.atan2(g.y,g.x);e&&(e=c,c=g,g=e);this.If.push({x:b.x,y:b.y,ng:g,ki:c})};c.prototype.ja=function(a){a.beginPath();var b;for(b=0;b<this.If.length;b++){var d=this.If[b];a.moveTo(d.x+this.xc*Math.cos(d.ng),d.y+this.xc*Math.sin(d.ng));a.arc(d.x,d.y,this.xc,d.ng,d.ki,!1)}a.lineWidth=3;a.strokeStyle="red";a.stroke();a.fillStyle="red";
a.font="20px Arial";for(b=0;b<this.If.length;b++){d=this.If[b];var e=(d.ng+d.ki)/2+Math.PI;0<d.ng&&0>d.ki&&(e-=Math.PI);var c=d.ki-d.ng;0>c&&(c+=2*Math.PI);a.fillText(""+Math.round(c/Math.PI*180)+"\u00b0",d.x+this.xc*Math.cos(e),d.y+this.xc*Math.sin(e))}};return c}();var Vc=function(){function c(a){this.bc=a;this.Yh=[];this.gl=!0;this.log=B.create("cloudAddon");this.xc=a.la("cloudRadius")}c.prototype.format=function(){var a=this.bc.Kc.Nd();this.log("Format cloud; %s points",a.length);this.Yh=this.oq(a,this.xc)};c.prototype.oq=function(a,b){var d=[],e=5/6*b*2,c,g=a[a.length-1];for(c=0;c<a.length;c++){var h=a[c];var k=h.x-g.x,l=h.y-g.y,m=Math.sqrt(k*k+l*l);k/=m;l/=m;var n=m/e+.5|0;1>n&&(n=1);n=m/n;for(var q=0;q+.1*n<m;q+=n)d.push({x:g.x+q*k,y:g.y+q*l,Pm:0,end:0});
g=h}h=d[d.length-1];for(c=0;c<d.length;c++)e=d[c],k=e.x-h.x,l=e.y-h.y,g=.5*Math.sqrt(k*k+l*l)/b,-1>g&&(g=-1),1<g&&(g=1),k=Math.atan2(l,k),g=Math.acos(g),g=[k-g,Math.PI+k+g],h.end=g[0],e.Pm=g[1],h=e;return d};c.prototype.ja=function(a){this.log("Drawing cloud with %s circles",this.Yh.length);var b=15*Math.PI/180,d=this.xc;a.beginPath();for(var e=0;e<this.Yh.length;e++){var c=this.Yh[e];a.arc(c.x,c.y,d,c.Pm,c.end+b)}a.stroke()};return c}();var R=function(){function c(a,b){this.id=a;this.ha=b;this.parent=null;this.aa={};this.rect=new K(0,0,1,1);this.Oh=!1;this.fb=new K(0,0,1,1);this.order=0;this.page=null;this.cc=0;this.log=B.create("BaseNode");this.aa.matrix=new M;this.aa.layer="default";this.Kj(c.ya)}c.Tc=function(a,b){c.types[a]=b};c.create=function(a,b,d){return a in c.types?new c.types[a](b,d):null};c.prototype.Kj=function(a){for(var b in a)a.hasOwnProperty(b)&&(this.aa[b]=a[b])};c.prototype.clip=function(){};c.prototype.toString=
function(){return this.type()+":"+this.id};c.prototype.Yf=function(){return!1};c.prototype.md=function(){return null};c.prototype.ji=function(){};c.prototype.Wn=function(){return!1};c.prototype.xi=function(){return"text"in this.aa};c.prototype.rn=function(a,b){var d=typeof this.aa[a],e=typeof b;d!==e&&"string"===e&&"number"===d&&(this.log("Convert property %s to a number.",a),b=parseFloat(b));return b};c.prototype.clone=function(a){a=c.create(this.type(),a(),this.ha);a.Cb(this.uc());return a};c.prototype.uc=
function(){var a={},b;for(b in this.aa)this.aa.hasOwnProperty(b)&&(a[b]=this.la(b));return a};c.prototype.Cb=function(a){for(var b in a)a.hasOwnProperty(b)&&this.setProperty(b,a[b])};c.prototype.Bd=function(){var a=this.la("layer");return a?""+a:"default"};c.prototype.Yn=function(){return void 0!==this.children};c.prototype.Ck=function(){return null!==this.parent&&null!==this.parent.parent&&"PageNode"!==this.parent.type()};c.prototype.type=function(){return"BaseNode"};c.prototype.Ga=function(){return this.aa.matrix};
c.prototype.Ue=function(){return this.aa.matrix.inverse()};c.prototype.qg=function(a){this.aa.matrix=a};c.prototype.setProperty=function(a,b){b=this.rn(a,b);if(a in this.aa||"customData"===a||"tag"===a||"locked"===a||"lockSize"===a||"lockRotation"===a||"lockPosition"===a||"lockEditMode"===a||"rotationHandles"===a||"lockAspectRatio"===a||"zIndex"===a||"wallAffinity"===a||"snap"===a||"opacity"===a)pa(b)&&(b=b.slice(0)),"opacity"===a&&(b=parseFloat(b)),this.aa[a]=b};c.prototype.la=function(a){return this.aa[a]};
c.prototype.yk=function(){return[]};c.prototype.mk=function(){var a=new Q(this.fb);a.transform(this.Ga());return a};c.prototype.Xf=function(){return this.la("zIndex")||0};c.prototype.transform=function(a){this.qg(a.multiply(this.Ga()))};c.prototype.format=function(){};c.prototype.gb=function(a,b){var d=this.Ue().apply(a,b);return this.hidden()||this.la("locked")||!this.fb.Vc(d.x,d.y)?null:this};c.prototype.se=function(a){this.Oh=a};c.prototype.hidden=function(){return this.Oh};c.prototype.rg=function(){};
c.prototype.Vk=function(){};c.prototype.Xk=function(){};c.prototype.kg=function(a){if(a.kg){var b={"zwibbler:id":""+this.id};if("tag"in this.aa){var d=this.aa.tag;"string"!==typeof d&&(d=JSON.stringify(d));b["zwibbler:tag"]=d}a.kg(b)}};c.prototype.ig=function(a){a.ig&&a.ig()};c.prototype.ja=function(a){a.save();this.kg(a);var b=this.aa.matrix;a.transform(b.m11,b.m21,b.m12,b.m22,b.Ca,b.Da);"erase"===this.aa.strokeStyle?a.Df?a.strokeStyle=a.Df:(a.strokeStyle="#000000",a.globalCompositeOperation="destination-out"):
a.strokeStyle=this.aa.strokeStyle;a.fillStyle=this.aa.fillStyle;a.lineWidth=this.aa.lineWidth;this.aa.shadow&&(a.shadowOffsetX=3,a.shadowOffsetY=3,a.shadowBlur=5,a.shadowColor="rgba(0,0,0,0.5)");"opacity"in this.aa&&(a.globalAlpha=this.aa.opacity);this.Ee(a);this.ig(a);a.restore();c.dm&&(a.save(),a.beginPath(),a.lineWidth=1,a.strokeStyle="#ff8000",a.rect(this.rect.x,this.rect.y,this.rect.width,this.rect.height),a.stroke(),a.restore())};c.prototype.Ee=function(){};c.prototype.resolve=function(){return!1};
c.prototype.br=function(a,b,d){this.Sg||(this.Sg={});var e=this.Sg.insideFill;if(!e||e.kp!==d){e&&d===e.kp||(e={kp:d,value:d},this.Sg.insideFill=e);d=/url\(([^\)]+)\)/.exec(d);var c;d&&(c=d[1]);var g=this;c&&(e.value="rgba(0, 0, 0, 0.2)",b.add(this.id,"image",c,null,function(d){g.log("Got image response.");e.value=a.createPattern(d,"repeat");b.ua("reformat",g)}))}};c.prototype.wr=function(){if(this.Sg){var a=this.Sg.insideFill;if(a)return a.value}return"magenta"};c.prototype.Uf=function(){return""};
c.prototype.ke=function(){};c.prototype.Yg=function(){return null};c.prototype.fe=function(){return null};c.prototype.Te=function(){return this.parent?this.parent.jk(this):-1};c.ya={fillStyle:"#cccccc",strokeStyle:"#000000",lineWidth:2,shadow:!1};c.dm=!1;c.types={};return c}();var Wc=function(){function c(){this.text="";this.font="10px Arial";this.tn="Arial";this.fontSize=10;this.lines=[];this.Tl="left";this.ah="top";this.$n=this.bold=!1;this.textDecoration="";this.log=B.create("TextBox");this.rect=new K(0,0,0,this.fontSize)}c.prototype.Ct=function(a,b,d,e,c){this.tn=a;this.fontSize=b;this.bold=d;this.$n=e;this.textDecoration=c};c.prototype.Xo=function(a){this.text=a};c.prototype.Lo=function(a,b){switch(a){case "left":case "centre":case "right":this.ah=a;break;case null:break;
default:this.log("Unknnown alignment: %s",a)}switch(b){case "top":case "middle":case "bottom":this.Tl=b;break;case null:break;default:this.log("Unknnown alignment: %s",b)}};c.prototype.format=function(a,b,d){this.font=""+this.fontSize+'px "'+this.tn+'"';this.bold&&(this.font="bold "+this.font);this.$n&&(this.font="italic "+this.font);this.lines.length=0;var e;a.font=this.font;var c=0;this.rect.width=0;if(0===b){var g=this.text.split("\n");for(e=0;e<g.length;e++){var h=g[e];var k=a.measureText(h).width;
c+=this.fontSize;this.lines.push({x:0,y:c,width:k,text:h});this.rect.width=Math.max(this.rect.width,k)}}else{h=g=0;var l=!1;for(e=0;e<this.text.length;e++){var m=this.text.charAt(e);k=a.measureText(this.text.substr(g,e-g+1)).width;"\n"===m?l=!0:k>b?h?(e=h,l=!0):e>g&&(--e,l=!0):" "===m&&(h=e);l&&(k=" "===this.text.charAt(e)?a.measureText(this.text.substr(g,e-g)).width:a.measureText(this.text.substr(g,e-g+1)).width,c+=this.fontSize,this.lines.push({x:0,y:c,width:k,text:this.text.substr(g,e-g+1)}),g=
e+1,h=0,l=!1,this.rect.width=Math.max(this.rect.width,k))}k&&(c+=this.fontSize,this.lines.push({x:0,y:c,width:k,text:this.text.substr(g,e-g)}),this.rect.width=Math.max(this.rect.width,k))}this.rect.x=0;this.rect.y=0;this.rect.height=c;if("centre"===this.ah)for(e=0;e<this.lines.length;e++)a=this.lines[e],a.x=this.rect.width/2-a.width/2;else if("right"===this.ah)for(e=0;e<this.lines.length;e++)a=this.lines[e],a.x=this.rect.width-a.width;b&&"centre"===this.ah?this.rect.x=b/2-this.rect.width/2:b&&"right"===
this.ah&&(this.rect.x=b-this.rect.width);d&&"middle"===this.Tl?this.rect.y=d/2-this.rect.height/2:d&&"bottom"===this.Tl&&(this.rect.y=d-this.rect.height)};c.prototype.ja=function(a,b,d){this.fillText(a,b,d);this.gn(a,b,d)};c.prototype.gn=function(a,b,d){var e;if(0<=this.textDecoration.indexOf("underline")){a.save();a.beginPath();var c=1;for(e=0;e<this.lines.length;e++){var g=this.lines[e];a.moveTo(g.x+b,g.y+d+c);a.lineTo(g.x+b+g.width,g.y+d+c)}a.strokeStyle=a.fillStyle;a.lineWidth=1;a.stroke();a.beginPath();
a.restore()}if(0<=this.textDecoration.indexOf("line-through")){a.save();a.beginPath();c=.25*-this.fontSize;for(e=0;e<this.lines.length;e++)g=this.lines[e],a.moveTo(g.x+b,g.y+d+c),a.lineTo(g.x+b+g.width,g.y+d+c);a.strokeStyle=a.fillStyle;a.lineWidth=1;a.stroke();a.restore()}};c.prototype.fillText=function(a,b,d){a.textBaseline="alphabetic";a.font=this.font;for(var e=0;e<this.lines.length;e++){var c=this.lines[e];a.fillText(c.text,this.rect.x+c.x+b,this.rect.y+c.y+d)}};c.prototype.strokeText=function(a,
b,d){a.textBaseline="alphabetic";a.font=this.font;for(var e=0;e<this.lines.length;e++){var c=this.lines[e];a.strokeText(c.text,this.rect.x+c.x+b,this.rect.y+c.y+d)}};return c}();var Xc=function(c){function a(b,d){var e=c.call(this,b,d)||this;e.pb=new Wc;e.Pn=0;e.border={lineWidth:0,Me:"#000000"};e.log=B.create("TEXT",!0);e.Kj(a.Bp);e.aa.text="lorum ipsum dolor";return e}p(a,c);a.prototype.type=function(){return"TextNode"};a.prototype.setProperty=function(a,d){this.aa[a]=this.rn(a,d);"textFillStyle"===a?this.aa.fillStyle=d:"fillStyle"===a&&(this.aa.textFillStyle=d)};a.prototype.format=function(a){this.pb.Ct(this.aa.fontName,this.aa.fontSize,this.aa.bold,this.aa.italic,this.aa.textDecoration);
var b=this.aa.text;b.length&&10===b.charCodeAt(b.length-1)&&(b=b.substr(0,b.length-1));this.pb.Xo(b);var e=this.aa.matrix;b=e.apply(0,0);e=e.apply(1,0);b=b.Oa(e);e=this.la("wrap");var c=!1!==this.la("scaleFont");this.pb.Lo(this.aa.textAlign,"top");e?(e=this.aa.baseWidth,void 0===e&&(this.pb.format(a,0,0),e=Math.max(this.pb.rect.width,10),500<e&&(e=500),this.aa.baseWidth=e,this.log("Formatting text for first time; baseWidth=%s",e)),b=Math.ceil(b*e),this.pb.format(a,b,0),a=this.pb.rect.height,this.fb=
new K(0,0,e,a)):c?(this.pb.format(a,0,0),b=this.pb.rect.width,a=this.pb.rect.height,this.fb=new K(0,-(0+this.la("fontSize")),b,a)):(this.pb.format(a,0,0),b=this.pb.rect.width,a=this.pb.rect.height,this.fb=new K(0,0,b,a));a=new Q(this.fb);a.transform(this.Ga());this.rect=a.Sm();this.Pn=this.rect.height;this.rect.height+=1.3*this.aa.fontSize;a=this.la("lineWidth")+0;this.rect.Hc(a,a);this.border=this.aa.border?this.Vs(this.aa.border):{lineWidth:0,Me:"#000000"}};a.prototype.Vs=function(a){var b={lineWidth:0,
Me:"#000000"};a=a.split(" ");for(var e=0;e<a.length;e++){var c=parseFloat(a[e]);if(isNaN(c)){if(c=A.lk(a[e]))b.Me=c.toString()}else b.lineWidth=c}return b};a.prototype.Ga=function(){return!1===this.la("scaleFont")?c.prototype.Ga.call(this).ip():c.prototype.Ga.call(this)};a.prototype.ja=function(a){if(0!==this.aa.text.length){a.save();this.kg(a);this.la("wrap")?this.Ga().ip().fj(a):this.Ga().fj(a);"opacity"in this.aa&&(a.globalAlpha=this.aa.opacity);var b=this.aa.background;if(b||this.border.lineWidth)a.save(),
b&&(a.fillStyle=b,a.fillRect(this.fb.x,this.fb.y,this.fb.width,this.fb.height)),this.border.lineWidth&&(a.beginPath(),a.strokeStyle=this.border.Me,a.lineWidth=this.border.lineWidth,a.rect(this.fb.x,this.fb.y,this.fb.width,this.fb.height),a.stroke()),a.restore();a.strokeStyle=this.aa.strokeStyle;a.fillStyle=this.aa.fillStyle;a.lineWidth=this.aa.lineWidth;b=0;this.aa.wrap||!1===this.la("scaleFont")||(b=-(0+this.la("fontSize")));this.aa.shadow&&(a.shadowOffsetX=3,a.shadowOffsetY=3,a.shadowBlur=5,a.shadowColor=
"rgba(0,0,0,0.5)");0<this.aa.lineWidth&&this.pb.strokeText(a,0,b);this.pb.fillText(a,0,b);this.pb.gn(a,0,b);this.ig(a);a.restore();R.dm&&(a.save(),a.beginPath(),a.lineWidth=1,a.strokeStyle="#ff8000",a.rect(this.rect.x,this.rect.y,this.rect.width,this.rect.height),a.stroke(),a.restore())}};a.Bp={textFillStyle:"#000000",fontName:"Arial",fontSize:20,lineWidth:0,fillStyle:"#000000",wrap:!1,textAlign:"left",bold:!1,italic:!1,background:"rgba(0,0,0,0.0)",textDecoration:""};return a}(R);
R.Tc("TextNode",Xc);var Yc=function(){function c(a,b){this.pa=a;this.fa=b;this.Vt=!0;this.log=B.create("MoveSegment")}c.prototype.ja=function(a){a.moveTo(this.fa.x,this.fa.y)};c.prototype.ze=function(){return this.Dc()};c.prototype.Dc=function(){return{x:1,y:0}};return c}(),Zc=function(){function c(a,b,d,e,c){this.pa=a;this.fa=b;this.zl=e;this.Ld=c;this.log=B.create("LineSegment");this.mf=0;this.Aa=new E(0,0);this.Ja=new E(0,0);this.length=0;this.from=new E(0,0);this.fa=b;this.pa=a;this.Ld=c;this.zl=e;d.next();this.Li=
d.next();this.Mi=d.next();this.moveTo=this.nf=null;this.format()}c.prototype.format=function(){var a=G(this.pa.fa.x,this.pa.fa.y,this.fa.x,this.fa.y);this.mf=this.length=a;var b=this.pa.fa.clone();this.pa instanceof c&&this.Ld&&(this.Ld=Math.min(this.Ld,a/2,this.pa.length/2),a=I(this.pa.fa.x,this.pa.fa.y,this.fa.x,this.fa.y),b.x+=a.x*this.Ld,b.y+=a.y*this.Ld,this.pa.Nt(this.Ld),this.mf-=this.Ld);this.from=b;null===this.nf&&(this.nf=this.fa);a=this.mf/10*this.zl;10<a&&(a=10);var d=b.x,e=b.y,f=this.fa.x,
g=this.fa.y;d+=a;e+=a;this.Aa=new E(d+this.Li*(f+a-d),e+this.Li*(g+a-e));d=b.x-a;f=this.fa.x-a;e=b.y-a;g=this.fa.y-a;this.Ja=new E(d+this.Mi*(f-d),e+this.Mi*(g-e))};c.prototype.Nt=function(a){var b=I(this.from.x,this.from.y,this.fa.x,this.fa.y),d=this.fa.clone();d.x-=b.x*a;d.y-=b.y*a;this.nf=d;this.mf-=a;a=this.mf/10*this.zl;10<a&&(a=10);b=this.from.x;var e=this.from.y,c=d.x,g=d.y;b+=a;e+=a;this.Aa=new E(b+this.Li*(c+a-b),e+this.Li*(g+a-e));this.log("RECALC ctrl1=%s",this.Aa);b=this.from.x-a;c=d.x-
a;e=this.from.y-a;g=d.y-a;this.Ja=new E(b+this.Mi*(c-b),e+this.Mi*(g-e))};c.prototype.wh=function(a){this.pa=a;this.format();this.pa instanceof c&&(this.moveTo=this.pa.nf)};c.prototype.ja=function(a){null!==this.nf&&(this.Ld&&(this.moveTo&&a.moveTo(this.moveTo.x,this.moveTo.y),a.quadraticCurveTo(this.pa.fa.x,this.pa.fa.y,this.from.x,this.from.y)),a.bezierCurveTo(this.Aa.x,this.Aa.y,this.Ja.x,this.Ja.y,this.nf.x,this.nf.y))};c.prototype.ze=function(){return this.pa?I(this.pa.fa.x,this.pa.fa.y,this.Aa.x,
this.Aa.y):this.Dc()};c.prototype.Dc=function(){return I(this.Ja.x,this.Ja.y,this.fa.x,this.fa.y)};return c}(),$c=function(){function c(a,b,d){this.Al=d;this.fa=b;this.pa=a;this.Al=d;var e=G(a.fa.x,a.fa.y,b.x,b.y);e||(e=1);var c=(b.x-a.fa.x)/e,g=(b.y-a.fa.y)/e;this.Ja=new E(b.x-e*d*c,b.y-e*d*g);if((b=a.Ja)&&a.pa){var h=I(a.pa.fa.x,a.pa.fa.y,a.fa.x,a.fa.y),k=G(a.pa.fa.x,a.pa.fa.y,a.fa.x,a.fa.y);c=.5*(c+h.x);g=.5*(g+h.y);b.x=a.fa.x-k*d*c;b.y=a.fa.y-k*d*g}this.Aa=new E(a.fa.x+e*d*c,a.fa.y+e*d*g);this.length=
e}c.prototype.wh=function(a){this.pa=a;var b=a.Ja,d=(this.fa.x-a.fa.x)/this.length,e=(this.fa.y-a.fa.y)/this.length,c=this.Al;if(b&&a.pa){var g=I(a.pa.fa.x,a.pa.fa.y,a.fa.x,a.fa.y),h=G(a.pa.fa.x,a.pa.fa.y,a.fa.x,a.fa.y);d=.5*(d+g.x);e=.5*(e+g.y);b.x=a.fa.x-h*c*d;b.y=a.fa.y-h*c*e}this.Aa=new E(a.fa.x+this.length*c*d,a.fa.y+this.length*c*e)};c.prototype.ja=function(a){a.bezierCurveTo(this.Aa.x,this.Aa.y,this.Ja.x,this.Ja.y,this.fa.x,this.fa.y)};c.prototype.ze=function(){return this.pa?I(this.pa.fa.x,
this.pa.fa.y,this.Aa.x,this.Aa.y):{x:1,y:0}};c.prototype.Dc=function(){return 0<this.Al?I(this.Ja.x,this.Ja.y,this.fa.x,this.fa.y):I(this.pa.fa.x,this.pa.fa.y,this.fa.x,this.fa.y)};return c}(),ad=function(){function c(a,b,d){this.pa=a;this.control=b;this.fa=d}c.prototype.ja=function(a){a.quadraticCurveTo(this.control.x,this.control.y,this.fa.x,this.fa.y)};c.prototype.ze=function(){return this.pa?I(this.pa.fa.x,this.pa.fa.y,this.control.x,this.control.y):{x:1,y:0}};c.prototype.Dc=function(){return I(this.control.x,
this.control.y,this.fa.x,this.fa.y)};return c}(),bd=function(){function c(a,b,d,e){this.pa=a;this.control=b;this.fa=d;this.xc=e}c.prototype.ja=function(a){a.arcTo(this.control.x,this.control.y,this.fa.x,this.fa.y,this.xc)};c.prototype.ze=function(){return{x:1,y:0}};c.prototype.Dc=function(){return I(0,0,1,0)};return c}(),cd=function(){function c(a,b,d,e){this.Aa=b;this.Ja=d;this.Aa=b;this.Ja=d;this.fa=e;this.pa=a}c.prototype.ja=function(a){a.bezierCurveTo(this.Aa.x,this.Aa.y,this.Ja.x,this.Ja.y,this.fa.x,
this.fa.y)};c.prototype.ze=function(){return this.pa?I(this.pa.fa.x,this.pa.fa.y,this.Aa.x,this.Aa.y):{x:1,y:0}};c.prototype.Dc=function(){return I(this.Ja.x,this.Ja.y,this.fa.x,this.fa.y)};return c}(),dd=function(){function c(a,b,d,e){this.pa=a;this.Aa=b;this.Ja=d;this.fa=e}c.prototype.ja=function(a){if(this.pa){var b=[];this.pa.Ja&&b.push(this.pa.Ja);this.Aa&&b.push(this.Aa);2===b.length?a.bezierCurveTo(b[0].x,b[0].y,b[1].x,b[1].y,this.fa.x,this.fa.y):1===b.length&&a.quadraticCurveTo(b[0].x,b[0].y,
this.fa.x,this.fa.y)}};c.prototype.wh=function(a){this.pa=a};c.prototype.ze=function(){return this.pa&&this.pa.Ja?I(this.pa.fa.x,this.pa.fa.y,this.Aa.x,this.Aa.y):{x:1,y:0}};c.prototype.Dc=function(){return this.Aa?I(this.Aa.x,this.Aa.y,this.fa.x,this.fa.y):{x:1,y:0}};return c}(),ed=function(){function c(a,b,d,e,c){this.pa=a;this.Lg=b;this.fa=d;this.log=B.create("SEGMENT");this.pa=a;this.Lg=b;c*=2;var f=2*e.next()-1;e.next();e=this.pa.Dc();if(!this.pa.Vt&&e){var h=G(a.fa.x,a.fa.y,b.x,b.y);this.Aa=
new E(a.fa.x+.5522847498*e.x*h,a.fa.y+.5522847498*e.y*h)}else this.Aa=new E(a.fa.x+.5522847498*(b.x-a.fa.x),a.fa.y+.5522847498*(b.y-a.fa.y));this.Ja=new E(d.x-.5522847498*(d.x-b.x)*(1-f*c),d.y-.5522847498*(d.y-b.y)*(1-f*c));this.fa=d}c.prototype.wh=function(a){this.pa=a;var b=this.pa.Dc();if(b){var d=G(a.fa.x,a.fa.y,this.Lg.x,this.Lg.y);this.Aa=new E(a.fa.x+.5522847498*b.x*d,a.fa.y+.5522847498*b.y*d)}else this.Aa=new E(a.fa.x+.5522847498*(this.Lg.x-this.pa.fa.x),a.fa.y+.5522847498*(this.Lg.y-this.pa.fa.y))};
c.prototype.ja=function(a){a.bezierCurveTo(this.Aa.x,this.Aa.y,this.Ja.x,this.Ja.y,this.fa.x,this.fa.y)};c.prototype.ze=function(){return this.pa?I(this.pa.fa.x,this.pa.fa.y,this.Aa.x,this.Aa.y):{x:1,y:0}};c.prototype.Dc=function(){return I(this.Ja.x,this.Ja.y,this.fa.x,this.fa.y)};return c}();var fd=function(){function c(a){this.kh=this.jh=0;if("string"===typeof a){for(;8>a.length;)a+=a;for(var b=16777619,d=0;d<a.length;d++)b=(16777619*b^a.charCodeAt(d))&4294967295;a=b}this.Ko=a;this.reset()}c.prototype.reset=function(){this.kh=this.jh=this.Ko};c.prototype.next=function(){this.kh=36969*(this.kh&65535)+(this.kh>>16);this.jh=18E3*(this.jh&65535)+(this.jh>>16);return((this.kh<<16)+this.jh)/4294967295/2+.5};return c}();var gd=function(){function c(a){this.ma=a;this.n=0;this.ld=new E(0,0)}c.prototype.next=function(a){if(0===this.ma.length)return null;if(0===this.n)return this.ld=this.ma[0].clone(),this.n+=1,this.ld.clone();for(;this.n<this.ma.length;){var b=this.ld.Oa(this.ma[this.n]);if(0===b)this.n+=1;else if(b<=a)a-=b,this.n+=1;else return this.ld.x+=(this.ma[this.n].x-this.ld.x)*a/b,this.ld.y+=(this.ma[this.n].y-this.ld.y)*a/b,this.ld.clone()}return null};return c}(),hd=function(){function c(a){this.bc=a;this.gl=
!0;this.ma=[];this.log=B.create("WaveAddon");this.xc=a.la("waveRadius")}c.prototype.format=function(){var a=this.bc.Lj(!1).Jl(S.oj).Nd();this.log("Format cloud; %s points",a.length);this.ma=this.Du(a,this.xc)};c.prototype.Du=function(a,b){var d=new gd(a),e=1,c=[];if(2>a.length)return c;var g=0;for(var h=1;h<a.length;h++)g+=G(a[h-1].x,a[h-1].y,a[h].x,a[h].y);b=g/Math.round(g/(2*b)+.5)/2;for(g=[];;){h=d.next(2*b);if(!h)break;g.push(h)}g.push(a[a.length-1]);var k=g[0];c.push(k);for(d=1;d<g.length;d++){h=
g[d];var l=I(k.x,k.y,h.x,h.y);var m=b,n=new E(l.y*e,-1*l.x*e);k=new E(k.x+(l.x+n.x)*m,k.y+(l.y+n.y)*m);c.push(k);c.push(h);e*=-1;k=h}for(d=2;d<c.length-1;d+=2)e=c[d-1],g=c[d+1],c[d].x=e.x+(g.x-e.x)/2,c[d].y=e.y+(g.y-e.y)/2;return c};c.prototype.ja=function(a){a.beginPath();a.moveTo(this.ma[0].x,this.ma[0].y);for(var b=1;b<this.ma.length-1;b+=2)a.quadraticCurveTo(this.ma[b].x,this.ma[b].y,this.ma[b+1].x,this.ma[b+1].y)};return c}();var S=function(c){function a(b,d){var e=c.call(this,b,d)||this;e.va=[];e.Jf=0;e.Uc=[];e.Xi=[];e.fp=!1;e.inverse=new M;e.origin=new E(0,0);e.lc=[];e.Kc=new P;e.Ln=!1;e.log=B.create("PATHNODE");e.log("New PathNode Created");e.dc=new Xc(0,d);e.dc.setProperty("text",e.aa.text);e.Kj(a.ya);e.aa.closed=!1;e.aa.commands=[];e.aa.seed=0;return e}p(a,c);a.prototype.moveTo=function(b,d){var e=this.aa.commands;e.push(a.zf);e.push(b);e.push(d)};a.prototype.aq=function(b,d,e,c,g,h){var f=this.aa.commands;f.push(a.zg);
f.push(g);f.push(h);f.push(b);f.push(d);f.push(e);f.push(c)};a.prototype.type=function(){return"PathNode"};a.prototype.xi=function(){return!0};a.prototype.setProperty=function(a,d){c.prototype.setProperty.call(this,a,d);if("fontName"===a||"fontSize"===a||"text"===a||"wrap"===a)this.dc.setProperty(a,d);else if("textFillStyle"===a)this.dc.setProperty("fillStyle",d);else if("textBackground"===a)this.dc.setProperty("background",d);else if("spotHighlight"===a)this.aa.spotHighlight=d;else if("cloudRadius"===
a||"waveRadius"===a||"doubleLine"===a||"doubleLineDashSide"===a)this.aa[a]=d};a.prototype.Yg=function(b){for(var d=0,e=this.aa.commands,c=b/3|0,g=0;g<c;g++)d+=a.$a[e[d]]+1;g=b%3*2+1;c=e[d+g];d=e[d+g+1];this.log("getEditHandle(%s) = (%s, %s)",b,c,d);return this.Ga().apply(c,d)};a.prototype.ke=function(b,d,e){for(var c=0,g=this.aa.commands,h=b/3|0,k=0;k<h;k++)c+=a.$a[g[c]]+1;h=this.inverse.apply(d,e);k=b%3*2+1;g[c+k]=h.x;g[c+k+1]=h.y;if(0===b&&this.aa.closed){for(b=null;c<g.length;)h=a.$a[g[c]],2<=
h&&(b=c),c+=h+1;b&&(c=b,h=this.inverse.apply(d,e),g[c+1]=h.x,g[c+2]=h.y)}};a.prototype.Uf=function(){return"commands"};a.prototype.mt=function(b){for(var d=this.aa.commands,e=0,c=0;c<b/3;c++)e+=a.$a[d[e]]+1;d.splice(e,a.$a[d[e]]+1)};a.prototype.ir=function(){return this.la("arrowXOffset")||this.la("arrowSize")};a.prototype.format=function(b,d){var e=null;this.va.length=0;this.inverse=this.aa.matrix.inverse();new E(0,0);for(var c=this.aa.commands,g=null,h,k,l=this.aa.matrix,m=new fd(this.aa.seed),
n=this.Xi.length=0;n<c.length;){switch(c[n++]){case a.zf:var q=l.apply(c[n++],c[n++]);this.va.push(new Yc(g,q));null===e&&(e=q);this.Xi.push(q);break;case a.Qd:g&&(q=l.apply(c[n++],c[n++]),this.va.push(new Zc(g,q,m,this.aa.sloppiness,this.aa.roundRadius)),this.Xi.push(q));break;case a.Bf:g&&(q=l.apply(c[n++],c[n++]),h=l.apply(c[n++],c[n++]),this.va.push(new ad(g,h,q)));break;case a.nj:g&&(q=l.apply(c[n++],c[n++]),h=l.apply(c[n++],c[n++]),k=c[n++],this.va.push(new bd(g,h,q,k)));break;case a.zg:g&&
(q=l.apply(c[n++],c[n++]),h=l.apply(c[n++],c[n++]),k=l.apply(c[n++],c[n++]),this.va.push(new cd(g,h,k,q)));break;case a.nm:g&&(q=l.apply(c[n++],c[n++]),h=l.apply(c[n++],c[n++]),k=l.apply(c[n++],c[n++]),this.va.push(new dd(g,h,k,q)));break;case a.Kh:g&&(q=l.apply(c[n++],c[n++]),this.va.push(new $c(g,q,this.aa.smoothness)));break;case a.pj:g&&(q=l.apply(c[n++],c[n++]),h=l.apply(c[n++],c[n++]),this.va.push(new ed(g,h,q,m,this.aa.sloppiness)));break;case a.zc:this.aa.closed=!0;break;default:n++}g=this.va[this.va.length-
1]}this.origin=e||new E(0,0);n=this.va[1];this.aa.closed&&3<=this.va.length&&n.wh&&g&&(n.wh(g),g.fa=this.origin);this.Jf=this.va.length;this.$q(m);this.rect.x=this.origin.x;this.rect.y=this.origin.y;this.rect.width=0;this.rect.height=0;g=this.aa.dashes.split(",");this.lc=[];for(n=0;n<g.length;n++)m=parseFloat(g[n]),isNaN(m)||this.lc.push(m);g=this.lc.length?a.oj:a.np;this.Kc=this.Lj(!0).Jl(g);n=0+this.la("shapeWidth");0<n&&(this.Kc=this.uq(this.Kc,n));this.rect=this.Kc.Tm(g);n=this.rect.width-2*(this.aa.lineWidth/
2+1);m=this.aa.lineWidth;e=this.Kc.clone();e.transform(this.Ue());this.fb=e.Tm(g);g=this.Ga().Zg();this.fb.Hc(Math.ceil(m/g.x),Math.ceil(m/g.y));this.rect.Hc(m+1,m+1);8>this.rect.width&&(this.rect.x+=this.rect.width/2-4,this.rect.width=8);8>this.rect.height&&(this.rect.y+=this.rect.height/2-4,this.rect.height=8);""!==this.aa.text&&(g=this.rect.Lf(),this.dc.setProperty("textAlign","centre"),this.dc.setProperty("baseWidth",n),this.dc.format(b,d),this.dc.transform(new L(g.x-this.dc.rect.x-this.dc.rect.width/
2,g.y-this.dc.rect.y-this.dc.Pn/2)),this.dc.format(b,d));this.fp=0===A.Xb(this.aa.fillStyle).values[3];this.Uc.length=0;0<this.aa.angleArcs?this.Uc.push(new Uc(this,this.aa.angleArcs)):0<this.aa.cloudRadius?this.Uc.push(new Vc(this)):0<this.aa.waveRadius?this.Uc.push(new hd(this)):this.aa.doubleLine&&this.Uc.push(new id(this));for(n=0;n<this.Uc.length;n++)this.Uc[n].format(b)};a.prototype.yk=function(){return this.Xi};a.prototype.si=function(){return this.Kc};a.prototype.$q=function(a){function b(b,
d){b=b.clone();k&&(b.x+=d.x*g*.5,b.y+=d.y*g*.5);var f=b.x-d.x*g;var l=b.y-d.y*g;var m=f+d.y*c/2;var n=l-d.x*c/2;f+=-d.y*c/2;l+=d.x*c/2;e.va.push(new Yc(e.va[e.va.length-1],new E(f,l)));e.va.push(new $c(e.va[e.va.length-1],b,h));e.va.push(new $c(e.va[e.va.length-1],new E(m,n),h));"solid"===e.aa.arrowStyle&&e.va.push(new Zc(e.va[e.va.length-1],new E(f,l),a,e.aa.smoothness,0))}if(this.Ln=0<this.aa.arrowSize&&!this.aa.closed&&0<this.va.length){var e=this,c=this.aa.arrowSize,g=this.aa.arrowXOffset,h=this.aa.smoothness,
k=this.aa.doubleLine;null===g&&(g=c);var l=this.va[this.va.length-1];b(l.fa,l.Dc());this.aa.doubleArrow&&b(this.va[0].fa,yc(this.va[1].ze()))}};a.prototype.close=function(){this.aa.commands.push(a.zc)};a.prototype.Xp=function(){var a=this.va[this.va.length-1];8>=G(a.fa.x,a.fa.y,this.origin.x,this.origin.y)&&this.close()};a.prototype.uq=function(a,d){this.log("ConvertToRects: width=%s",d);for(var b=0,c=a.ba,g=0,h=0,k,l,m=new P;b<c.length;){this.log("cmd %s %s %s",c[b],c[b+1],c[b+2]);switch(c[b]){case P.qc:g=
c[b+1];h=c[b+2];break;case P.pc:k=c[b+1];l=c[b+2];this.log("(%s,%s-%s,%s)",g,h,k,l);if(0<G(g,h,k,l)){var n=I(g,h,k,l),q=n.y*d/2;n=-n.x*d/2;m.moveTo(g+q,h+n);m.lineTo(k+q,l+n);m.lineTo(k-q,l-n);m.lineTo(g-q,h-n);m.closePath()}g=k;h=l}b+=P.gc[c[b]]}return m};a.prototype.clip=function(a){if(this.aa.closed){this.log("Clipping to a path");for(var b=0;b<this.va.length;b++)this.va[b].ja(a);a.closePath()}};a.prototype.Ee=function(a){if(this.aa.spotHighlight)this.log("Not drawing node %s due to spothighlight",
this.id);else{var b=this.inverse;a.save();a.lineJoin="round";a.transform(b.m11,b.m21,b.m12,b.m22,b.Ca,b.Da);a.beginPath();a.lineCap="round";b=!0;var e;for(e=0;e<this.Uc.length;e++)this.Uc[e].gl&&(b=!1);if(b)for(e=0;e<this.va.length;e++)this.va[e].ja(a);for(e=0;e<this.Uc.length;e++)this.Uc[e].ja(a);if(!b&&0<this.aa.arrowSize)for(e=this.Jf;e<this.va.length;e++)this.va[e].ja(a);this.aa.closed&&(a.closePath(),a.fill(),a.shadowColor="rgba(0,0,0,0.0)");b&&(this.lc.length&&0<this.aa.lineWidth?(a.beginPath(),
this.Kc.ii(a,this.lc),a.lineCap="butt"):0<0+this.la("shapeWidth")&&(a.beginPath(),this.Kc.ja(a)));0<this.aa.lineWidth&&a.stroke();if(this.aa.arrowSize&&"solid"===this.aa.arrowStyle){a.beginPath();for(e=this.Jf;e<this.va.length;e++)this.va[e].ja(a);a.fillStyle=this.aa.strokeStyle;a.fill()}""!==this.aa.text&&this.dc.ja(a);a.restore()}};a.prototype.gb=function(a,d){if(this.hidden()||this.la("locked"))return null;var b=12+this.aa.shapeWidth/2+this.aa.lineWidth/2;if(a>=this.rect.x-b&&a<this.rect.x+b+this.rect.width&&
d>=this.rect.y-b&&d<this.rect.y+b+this.rect.height)if(this.aa.closed&&!this.fp){if(this.Kc.Ao(a,d))return this}else if(this.Kc.al(a,d,b)||""!==this.aa.text&&this.dc.gb(a,d))return this;return null};a.prototype.Lj=function(a){var b=new P;if(0<this.aa.arrowSize&&!a)for(a=0;a<this.Jf;a++)this.va[a].ja(b);else for(a=0;a<this.va.length;a++)this.va[a].ja(b);this.aa.closed&&b.closePath();return b};a.prototype.lineTo=function(b,d){var e=this.aa.commands;e.push(a.Qd);e.push(b);e.push(d)};a.prototype.Ng=function(b,
d){var e=this.aa.commands;e.push(a.Kh);e.push(b);e.push(d)};a.prototype.Yf=function(){return!1!==this.aa.editable&&!0!==this.aa.lockEditMode};a.prototype.md=function(a,d,e){e*=8;if(a>=this.origin.x-e&&a<this.origin.x+e&&d>=this.origin.y-e&&d<this.origin.y+e)return 0;for(var b=0;b<this.Jf;b++){var c=this.va[b];if(a>=this.va[b].fa.x-e&&a<this.va[b].fa.x+e&&d>=this.va[b].fa.y-e&&d<this.va[b].fa.y+e)return 3*b;if(c.control){if(a>=c.control.x-e&&a<c.control.x+e&&d>=c.control.y-e&&d<c.control.y+e)return 3*
b+1}else if(c.Aa){if(a>=c.Aa.x-e&&a<c.Aa.x+e&&d>=c.Aa.y-e&&d<c.Aa.y+e)return 3*b+1;if(c.Ja&&a>=c.Ja.x-e&&a<c.Ja.x+e&&d>=c.Ja.y-e&&d<c.Ja.y+e)return 3*b+2}}return null};a.prototype.fe=function(b){var d=this.aa.commands;b/=3;var e=0,c=!1,g=0,h;for(h=0;h<d.length;){var k=d[h];if(k===a.zc){c=!0;break}g+=1;h+=a.$a[d[h]]+1}0===b&&c&&(b=g-1);for(h=0;h<d.length;e++){c=null;switch(d[h]){case a.zf:c="move_to";break;case a.Qd:c="line_to";break;case a.Bf:c="quadratic_to"}if(b===e)return c;h+=a.$a[d[h]]+1}return null};
a.xp=function(b,d,e){d/=3;var c=0,g=[],h=new E(0,0),k=!1,l=0,m;for(m=0;m<b.length;){var n=b[m];if(n===a.zc){k=!0;break}l+=1;m+=a.$a[b[m]]+1}0===d&&k&&(d=l-1);for(m=0;m<b.length;c++){n=b[m];k=!1;d===c&&(n===a.Bf&&"line_to"===e?(g.push(a.Qd,b[m+1],b[m+2]),k=!0):n===a.Qd&&"quadratic_to"===e&&(g.push(a.Bf,b[m+1],b[m+2],(h.x+b[m+1])/2,(h.y+b[m+2])/2),k=!0));h=new E(b[m+1],b[m+2]);if(!k)for(n=0;n<1+a.$a[b[m]];n++)g.push(b[m+n]);m+=a.$a[b[m]]+1}return g};a.prototype.Wn=function(){return!0};a.prototype.ji=
function(a,d,e){a.save();a.lineWidth=1*d;a.strokeStyle="#0050B7";a.fillStyle="#0050B7";d*=8;0===e?a.fillRect(this.origin.x-d,this.origin.y-d,2*d,2*d):a.strokeRect(this.origin.x-d,this.origin.y-d,2*d,2*d);for(var b=1;b<this.Jf;b++){var c=this.va[b];a.beginPath();if(c.control)a.arc(c.control.x,c.control.y,d,0,2*Math.PI),a.arc(c.control.x,c.control.y,2*d,0,2*Math.PI),e===3*b+1?a.fill():a.stroke();else if(c instanceof cd||c instanceof dd){var h=c.Aa;var k=c.Ja;var l=c.pa.fa;h&&(a.moveTo(l.x,l.y),a.lineTo(h.x,
h.y),a.moveTo(h.x+d,h.y),a.arc(h.x,h.y,d,0,2*Math.PI),e===3*b+1?a.fill():a.stroke());a.beginPath();a.moveTo(c.fa.x,c.fa.y);a.lineTo(k.x,k.y);a.moveTo(k.x+d,k.y);a.arc(k.x,k.y,d,0,2*Math.PI);e===3*b+2?a.fill():a.stroke()}e===3*b?a.fillRect(this.va[b].fa.x-d,this.va[b].fa.y-d,2*d,2*d):a.strokeRect(this.va[b].fa.x-d,this.va[b].fa.y-d,2*d,2*d)}a.restore()};a.rp=function(a){var b=new U,e=0;for(a=a.ba;e<a.length;){switch(a[e]){case P.qc:b.moveTo(a[e+1],a[e+2]);break;case P.pc:b.lineTo(a[e+1],a[e+2]);break;
case P.yf:b.bezierCurveTo(a[e+1],a[e+2],a[e+3],a[e+4],a[e+5],a[e+6]);break;case P.Af:b.quadraticCurveTo(a[e+1],a[e+2],a[e+3],a[e+4]);break;case P.zc:b.close()}e+=P.gc[a[e]]}return b.ec()};a.ya={strokeStyle:"#000000",fillStyle:"#ffffff",textFillStyle:"#000000",fontName:"Arial",fontSize:20,lineWidth:2,dashes:"",shapeWidth:0,smoothness:.3,sloppiness:0,shadow:!1,closed:!1,arrowSize:0,arrowXOffset:null,arrowStyle:"simple",doubleArrow:!1,text:"",roundRadius:0,wrap:!1,angleArcs:0};a.np=8;a.oj=2;a.zf=0;a.Qd=
1;a.Bf=2;a.nj=3;a.zg=4;a.Kh=5;a.pj=6;a.zc=7;a.nm=8;a.Pu=.5522847498;a.$a=[];return a}(R);S.$a[S.zf]=2;S.$a[S.Qd]=2;S.$a[S.Bf]=4;S.$a[S.nj]=5;S.$a[S.zg]=6;S.$a[S.Kh]=2;S.$a[S.pj]=4;S.$a[S.zc]=0;S.$a[S.nm]=6;
var U=function(){function c(a){void 0===a&&(a=[]);this.ba=a}c.prototype.beginPath=function(){};c.prototype.gd=function(a,b,d){for(var e=0,c=0;c<a;c++)e+=S.$a[this.ba[e]]+1;this.ba[e+1]=b;this.ba[e+2]=d};c.prototype.moveTo=function(a,b){this.ba.push(S.zf);this.ba.push(a);this.ba.push(b)};c.prototype.lineTo=function(a,b){this.ba.push(S.Qd);this.ba.push(a);this.ba.push(b)};c.prototype.Ng=function(a,b){this.ba.push(S.Kh);this.ba.push(a);this.ba.push(b)};c.prototype.quadraticCurveTo=function(a,b,d,e){this.ba.push(S.Bf);
this.ba.push(d);this.ba.push(e);this.ba.push(a);this.ba.push(b)};c.prototype.Ne=function(a,b,d,e){this.ba.push(S.pj);this.ba.push(d);this.ba.push(e);this.ba.push(a);this.ba.push(b)};c.prototype.bezierCurveTo=function(a,b,d,e,c,g){this.ba.push(S.zg);this.ba.push(c);this.ba.push(g);this.ba.push(a);this.ba.push(b);this.ba.push(d);this.ba.push(e)};c.prototype.arcTo=function(a,b,d,e,c){this.ba.push(S.nj);this.ba.push(d);this.ba.push(e);this.ba.push(a);this.ba.push(b);this.ba.push(c)};c.prototype.xn=function(){for(var a=
[],b=0;b<this.ba.length;){for(var d=this.ba[b],e=0;e<S.$a[d];e+=2)a.push(new E(this.ba[b+1+e],this.ba[b+1+e+1]));b+=S.$a[d]+1}a=K.Be(a);return{x:a.x,y:a.y,width:a.width,height:a.height}};c.prototype.translate=function(a,b){for(var d=0;d<this.ba.length;){for(var e=this.ba[d],c=0;c<S.$a[e];c+=2)this.ba[d+1+c]+=a,this.ba[d+2+c]+=b;d+=S.$a[e]+1}};c.prototype.closePath=function(){this.ba.push(S.zc)};c.prototype.close=function(){this.closePath()};c.prototype.ec=function(){return this.ba};return c}();
U.prototype.change=U.prototype.gd;U.prototype.moveTo=U.prototype.moveTo;U.prototype.lineTo=U.prototype.lineTo;U.prototype.curveTo=U.prototype.Ng;U.prototype.quadraticCurveTo=U.prototype.quadraticCurveTo;U.prototype.cornerTo=U.prototype.Ne;U.prototype.bezierCurveTo=U.prototype.bezierCurveTo;U.prototype.arcTo=U.prototype.arcTo;U.prototype.getBoundingBox=U.prototype.xn;U.prototype.translate=U.prototype.translate;U.prototype.closePath=U.prototype.closePath;U.prototype.close=U.prototype.close;
U.prototype.toArray=U.prototype.ec;function jd(){var c=new E(0,0),a=new U;a.moveTo(c.x,c.y-50);a.Ne(c.x+50,c.y-50,c.x+50,c.y);a.Ne(c.x+50,c.y+50,c.x,c.y+50);a.Ne(c.x-50,c.y+50,c.x-50,c.y);a.Ne(c.x-50,c.y-50,c.x,c.y-50);a.closePath();return a.ec()}R.Tc("PathNode",S);U.prototype.beginPath=U.prototype.beginPath;U.prototype.change=U.prototype.gd;U.prototype.moveTo=U.prototype.moveTo;U.prototype.lineTo=U.prototype.lineTo;U.prototype.curveTo=U.prototype.Ng;U.prototype.quadraticTo=U.prototype.lv;
U.prototype.cornerTo=U.prototype.Ne;U.prototype.bezierTo=U.prototype.aq;U.prototype.arcTo=U.prototype.arcTo;U.prototype.getBoundingBox=U.prototype.xn;U.prototype.translate=U.prototype.translate;U.prototype.closePath=U.prototype.closePath;U.prototype.close=U.prototype.close;U.prototype.toArray=U.prototype.ec;var id=function(){function c(a){this.bc=a;this.xc=0;this.gl=!0;this.wi=!1;this.path=new P;this.Ki=new P;this.log=B.create("DoubleLineAddon")}c.prototype.format=function(){this.log("Formatting doubleline; thickness=%s",this.bc.la("doubleLine"));var a=this.bc.Lj(!1).Jl(S.oj),b=this.bc.ir();if(0<b){var d=a.cq();d>b&&(a=a.eq(d-b))}a=a.Nd();b=this.bc.la("doubleLine");this.path=new P;this.Ki=new P;d=this.bc.la("doubleLineDashSide");this.wi=!1;"outer"===d?(Nc(this.path,a,b,"middle",!0,!1),Nc(this.Ki,a,b,
"middle",!1,!0),this.wi=!0):"inner"===d?(Nc(this.path,a,b,"middle",!1,!0),Nc(this.Ki,a,b,"middle",!0,!1),this.wi=!0):Nc(this.path,a,b,"middle",!0,!0)};c.prototype.ja=function(a){a.beginPath();this.bc.lc.length&&this.wi?(this.Ki.ii(a,this.bc.lc),this.path.ja(a)):this.bc.lc.length?this.path.ii(a,this.bc.lc):this.path.ja(a)};return c}();var kd=function(c){function a(){var a=c.call(this)||this;a.lg=[];a.Ie=!1;a.canvas=null;a.log=B.create("FORMAT",!0);return a}p(a,c);a.prototype.add=function(a,d,e,c,g){var b;var f=this.lg;var l=0;for(b=f.length;l<b;l++){var m=f[l];m.type===d&&m.Qk===a&&(m.Wi=!0)}this.log("Request URL %s",e.substr(0,64));this.lg.push({Qk:a,type:d,url:e,jv:c||{},Vm:g,Wi:!1});this.check()};a.prototype.check=function(){for(var a=0;!this.Ie&&a<this.lg.length;)this.lg[a].Wi?this.lg.shift():(this.Hp(this.lg[0]),a+=1);this.Ie||
this.ua("done")};a.prototype.Hp=function(a){var b=this;b.Ie=!0;b.log("Processing request for item %s url=%s",a.Qk,a.url.substr(0,64));if(0===a.type.indexOf("image")){var e=0<=a.url.indexOf("svg+xml");Nb.load(a.url,function(d,c){if(null!==d){b.log("Image request completed for item %s url %s",a.Qk,c.substr(0,64));if(e){b.log("Doing double-copy to eliminate SVG");var f=document.createElement("canvas");f.width=d.naturalWidth;f.height=d.naturalHeight;f.getContext("2d").drawImage(d,0,0);Nb.load(f.toDataURL(),
function(d,e){null!==d?(b.log("SVG elimination succeeded; url=%s",e.substr(0,20)),a.Vm(d,e)):b.log("Image conversion from SVG failed.");b.Ie=!1;a.Wi=!0;b.check()});return}a.Vm(d,c)}else b.log("Image request failed for url %s",c);b.Ie=!1;a.Wi=!0;b.check()})}};a.prototype.sq=function(a,d){this.ua("convert-dom-request",a,d)};a.prototype.Pi=function(a){this.ua("reformat",a)};a.prototype.pk=function(){return C(this.canvas)};return a}(Hb);var ld=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.children=[];return b}p(a,c);a.prototype.type=function(){return"GroupNode"};a.prototype.clone=function(b){for(var d=new a(b(),this.ha),e=0;e<this.children.length;e++){var c=this.children[e].clone(b);c.parent=d;d.children.push(c)}return d};a.prototype.format=function(a,d){for(var b=0;b<this.children.length;b++)this.children[b].format(a,d),0===b?this.rect=this.children[b].rect.clone():this.rect.Hh(this.children[b].rect)};a.prototype.ja=
function(a){for(var b=0;b<this.children.length;b++)this.children[b].ja(a)};a.prototype.gb=function(a,d){for(var b=this.children.length-1;0<=b;b--){var c=this.children[b].gb(a,d);if(c)return c}return null};a.prototype.jk=function(a){for(var b=0;b<this.children.length;b++)if(a===this.children[b])return b;return-1};return a}(R);R.Tc("GroupNode",ld);var md=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.ma=[];b.lc=[];b.log=B.create("BRUSH",!0);b.log("New BrushNode created.");b.aa.points=[];b.aa.strokeStyle="#ff00ff";b.aa.lineWidth=10;return b}p(a,c);a.prototype.type=function(){return"BrushNode"};a.prototype.setProperty=function(a,d){"fillStyle"===a&&(a="strokeStyle");a in this.aa||"dashes"===a||"lineCap"===a?this.aa[a]=d:c.prototype.setProperty.call(this,a,d)};a.prototype.la=function(a){"fillStyle"===a&&(a="strokeStyle");return c.prototype.la.call(this,
a)};a.prototype.format=function(){var a,d;this.ma.length=0;var e=this.aa.points;var c=a=0;for(d=e.length-1;a<=d;c=a+=2)this.ma.push(new E(e[c],e[c+1]));c=K.Be(this.ma);e=this.Ga().Zg();a=this.aa.lineWidth;c.Hc(a/e.x,a/e.y);this.fb=c.clone();c=new Q(c);c.transform(this.aa.matrix);this.rect=K.Be(c.ma);this.lc=[];if("dashes"in this.aa)for(e=this.aa.dashes.split(","),c=0;c<e.length;c++)a=parseFloat(e[c]),isNaN(a)||this.lc.push(a);this.log("Format brushnode")};a.prototype.gb=function(a,d){if(this.rect.Vc(a,
d)){var b=this.Ue().apply(a,d);if(Gc(this.ma,b.x,b.y,12+this.aa.lineWidth/2))return this}return null};a.prototype.Ee=function(b){var d=this.aa.points;if(0!==d.length){b.save();b.beginPath();var e=this.la("lineCap")||"round";b.lineCap=e;b.lineJoin="round"===e?"round":"bevel";if(1<this.lc.length){e=this.ma;var c=this.lc;if(0!==e.length){b.moveTo(e[0].x,e[0].y);var g=0;for(var h=1,k=c[0],l=e[0].clone(),m;h<e.length;)m=l.Oa(e[h]),0===m?h+=1:m<=k?(l=e[h].clone(),g&1?b.moveTo(l.x,l.y):b.lineTo(l.x,l.y),
k-=m,h+=1):(l.x+=(e[h].x-l.x)*k/m,l.y+=(e[h].y-l.y)*k/m,g&1?b.moveTo(l.x,l.y):b.lineTo(l.x,l.y),g=(g+1)%c.length,k=c[g])}}else for(b.moveTo(d[0],d[1]),e=c=2,g=d.length-1;c<=g;e=c+=2)b.lineTo(d[e],d[e+1]);this.Ue().fj(b);nc(b,this.aa.strokeStyle);if(a.wp){this.Ga().fj(b);b.beginPath();e=c=0;for(g=d.length-1;c<=g;e=c+=2)b.rect(d[e]-2,d[e+1]-2,4,4);b.fillStyle="#ff0000";b.fill()}b.restore()}};a.wp=!1;return a}(R);R.Tc("BrushNode",md);function nd(c){c=c.replace(/\+/g," ");return decodeURIComponent(c)}function od(){if(void 0===c)var c=window.location.hash;0===c.indexOf("#/")&&(c="#"+c.substr(2));var a=c,b;c={};var d=a.indexOf("#");0<=d&&(a=a.substr(d+1));d=a.indexOf("#");0<=d&&(a=a.substr(0,d));a=a.split("&");d=0;for(b=a.length;d<b;d++){var e=a[d];var f=e.split("=");e=nd(f[0]);f=1<f.length?nd(f[1]):"";e.length&&(c[e]=f)}return c};var pd=function(){if(!document.getElementsByTagName)return"";var c=document.getElementsByTagName("script");if(0===c.length)return"";c=c[c.length-1];return void 0!==c.getAttribute.length?c.src:c.getAttribute("src")||""}(),qd=function(c){function a(a){var b=c.call(this)||this;b.options={angleArcs:0,allowSelectBox:"auto",allowResize:!0,allowTextInShape:!0,allowPointerEvents:!0,allowSystemClipboard:!1,allowZoom:!0,autoPickTool:!0,autoPickToolText:!0,autoSnap:0,background:"clear",backgroundImage:null,
clickToDrawShapes:!1,colourPicker:"wheel",colourPalette:"auto",debug:!1,defaultArrowStyle:"simple",defaultArrowSize:15,defaultArrowXOffset:null,defaultItalic:!1,defaultBold:!1,defaultBrushColour:"#000000",defaultBrushWidth:10,defaultFillStyle:"#e0e0e0",defaultFont:"Arial",defaultFontSize:20,defaultLineWidth:2,defaultPaperSize:"none",defaultRoundRectRadius:10,defaultSmoothness:"smooth",defaultStrokeStyle:"#000000",defaultText:"Lorum ipsum dolor",defaultTextBackground:"rgba(0,0,0,0.0)",defaultTextFillStyle:"#000000",
defaultTextStrokeStyle:"#000000",defaultTextLineWidth:0,defaultZoom:1,drawCircleStyle:"box",drawShapeStyle:"box",fonts:["Arial","Times New Roman"],gridBlocks:10,gridSpacing:20,gridColour:"#cccccc",imageFolder:"$SCRIPT",iPadNoScrollText:!1,keyBringToFront:"Home",keyCancel:"ESC",keyCopy:"Ctrl+C,\u2318+C",keyCurveTool:"C",keyCut:"Ctrl+X,\u2318+X,Shift+Delete",keyDelete:"Delete,Backspace",keyDown:"Down,Ctrl+Down",keyDuplicate:"Ctrl+D",keyEnter:"Enter",keyGroup:"Ctrl+G",keyLeft:"Left,Ctrl+Left",keyLineTool:"L",
keyMoveDown:"PageDown",keyMoveUp:"PageUp",keyNext:"Down,Right",keyNextPage:"Shift+PageDown",keyPaste:"Ctrl+V,\u2318+V,Shift+Insert",keyPrevious:"Left,Up",keyPreviousPage:"Shift+Pageup",keyRedo:"Ctrl+Shift+Z",keyRight:"Right,Ctrl+Right",keySelectNone:"ESC",keySelectAll:"Ctrl+A",keySendToBack:"End",keyUndo:"Ctrl+Z",keyUngroup:"Ctrl+Shift+G",keyUp:"Up,Ctrl+Up",keyZoomIn:"+,Shift+=",keyZoomNormal:"=",keyZoomOut:"-",keyZoomToPage:"F4",keyZoomToWidth:"Shift+F4",language:"en",leaveTextToolOnBlur:!1,maximumZoom:0,
minimumZoom:0,multilineText:!1,nudge:10,outsidePageColour:"#808080",pagePlacement:"centre",pageSelectorDiv:"",pageBorderColour:"rbga(0,0,0,0.0)",pageInflation:20,pageShadow:!0,pageView:!1,pasteOffset:10,pasteOffsetX:0,pasteOffsetY:0,persistent:!1,preciseNudge:1,readOnly:!1,scrollbars:!0,setFocus:!0,showArrowTool:!0,showBackgroundSelector:!1,showBrushTool:!0,showCircleTool:!0,showColourPanel:!0,showCopyPaste:!0,showCurveTool:!0,showDebug:!1,showFontNameProperty:!0,showFontSizeProperty:!0,showHints:!0,
showImageSelector:!1,showImageTool:!1,showKeyboardHelp:!0,showLineTool:!0,showMathTool:!1,showMoveToFrontBack:!1,showPageSelector:!1,showPageSelectorControls:!0,showPickTool:!0,showPropertyPanel:!1,showRoundRectTool:!1,showShapeBrushTool:!1,showSloppinessProperty:!0,showSmoothnessProperty:!0,showSquareTool:!0,showTextTool:!0,showToolbar:!0,showUndoRedo:!0,simulateGestures:!1,singleStrokeBrush:!1,sloppy:!1,snap:0,spotHighlightColour:"rgba(0,0,0,0.2)",spotHighlightZIndex:0,symmetry:0,textMode:"interactive",
toolbarButtonSize:50,useTouch:"auto",enableArrowKeysNudge:!1,showMenu:!1};b.log=B.create("CONFIG");for(var e in a)e in b.options||alert("Zwibbler: Unknown option '"+e+"'"),b.set(e,a[e],!0);C(window).xa("hashchange",function(){b.log("Reload parameters from url hash");b.co()});b.co();""===b.Fn()?(b.Ed=b.options.imageFolder.replace("$SCRIPT/",""),b.Ed=b.Ed.replace("$SCRIPT","")):b.Ed=b.options.imageFolder.replace("$SCRIPT",b.Fn());""!==b.Ed&&"/"!==b.Ed[b.Ed.length-1]&&(b.Ed+="/");"auto"===b.options.useTouch&&
b.log("Detected touch support: %s","ontouchstart"in window||"onmsgesturechange"in window);b.log("Detect clipboard support: %s",b.Bk());for(var f in b.options)b.log("%s=%s",f,b.options[f]);return b}p(a,c);a.prototype.co=function(){var a=od(),d;for(d in a)this.set(d,a[d])};a.prototype.set=function(a,d,e){void 0===e&&(e=!1);if(!(a in this.options))return this.log("Error: %s is not a configuration option.",a),!1;if("defaultZoom"===a){if("page"!==d&&"width"!==d&&!r(d)&&(d=parseFloat(d),isNaN(d)))return this.log("Error: Config option %s must be a number or 'page' or 'width'",
a),!1}else if("allowSelectBox"!==a)if("colourPalette"===a)"auto"!==d&&"string"===typeof d&&(d=A.Us(d));else if("string"===typeof d)if("number"===typeof this.options[a]){if(d=parseFloat(d),isNaN(d))return this.log("Error: Config option %s expects a number",a),!1}else"boolean"===typeof this.options[a]&&(d="1"===d||"true"===d||""===d);this.log("Set config %s=%s",a,d);this.options[a]=d;e||(this.Pe("update",a,d),this.Pe(a,d,!1));return!0};a.prototype.xa=function(a,d){d(a,this.options[a],!0);return c.prototype.xa.call(this,
a,d)};a.prototype.Fn=function(){var a=pd;var d=a.lastIndexOf("/");return a=0<=d?a.substr(0,d+1):""};a.prototype.Ot=function(){return this.options.showBrushTool};a.prototype.Zo=function(){return this.options.showPropertyPanel};a.prototype.Pt=function(){return this.options.showColourPanel};a.prototype.sg=function(){return this.options.showDebug};a.prototype.St=function(){return this.options.showToolbar};a.prototype.Ha=function(a){return this.options[a]};a.prototype.get=function(a){return this.Ha(a)};
a.prototype.wd=function(){return"auto"===this.options.useTouch?"ontouchstart"in window||"onmsgesturechange"in window:this.options.useTouch};a.prototype.gr=function(){if("auto"===this.options.allowSelectBox){var a=this.wd(),d=document.documentElement.offsetHeight,e=window.innerHeight,c=!a||a&&0<e-d+50;this.log("Allowing select box: %s (useTouch=%s, documentHeight=%s, windowHeight=%s)",c,a,d,e);return c}return this.options.allowSelectBox};a.prototype.rr=function(){var a=(""+this.options.defaultSmoothness).toLowerCase();
return"sharpest"===a?0:"sharper"===a?.1:"sharp"===a?.2:"smoothest"===a?.5:.3};a.prototype.ub=function(a){return 0===a.indexOf("http:")||0===a.indexOf("https:")||0===a.indexOf("/")?a:this.Ed+a};a.prototype.rk=function(a){a=this.get(a);return void 0!==a.className?a:""!==a&&C(a).length?C(a)[0]:null};a.prototype.Up=function(a){var b={};this.Bk()&&(this.log("Using system clipboard. Ignore keyCut/keyCopy/keyPaste."),b.keyCut=1,b.keyCopy=1,b.keyPaste=1);for(var e in this.options)if(this.options.hasOwnProperty(e)&&
0===e.indexOf("key")&&!b[e]){for(var c="",g=0;g<e.length;g++){var h=e.charAt(g);c=h===h.toUpperCase()?c+("-"+h.toLowerCase()):c+h}a.map(this.options[e],c.substr(4))}};a.prototype.Bn=function(){return"radial"===this.get("drawCircleStyle")||"radial"===this.get("drawShapeStyle")?"circle":"rectangle"};a.prototype.hl=function(a){var b=a;0<this.options.maximumZoom&&(a=Math.min(a,this.options.maximumZoom));0<this.options.minimumZoom&&(a=Math.max(a,this.options.minimumZoom));a!==b&&this.log("Zoom restricted to %s",
a);return a};a.prototype.Bk=function(){var a=document;return this.get("allowSystemClipboard")&&void 0!==a.oncopy&&void 0!==a.oncut&&void 0!==a.onpaste};return a}(Hb);var rd=function(c){function a(a,d,e){var b=c.call(this,C("<div>"))||this;b.da=a;b.language=d;b.rb=e;b.Ni=[];b.Oi={};b.view=null;b.ra=[];b.onclick=null;b.log=B.create("PROP");lb(b.ia,"PropertyPanel");b.Xm=vb.isSupported()&&"wheel"===a.get("colourPicker");b.Xm||b.log("ColourWheel not supported in this canvas.");b.ia.ea("background","#ffffff");b.ia.ea("border","none");b.ia.ea("font-family","tahoma,arial,helvetica,sans");b.ia.ea("color","#4fa0d3");b.ia.ea("font-weight","bold");b.ia.ea("font-size","10pt");
b.ia.ea("overflow-y","scroll");b.ia.click(function(){b.log("PropertyPanel clicked.");b.ua("click")});return b}p(a,c);a.prototype.xa=function(a,d){if("click"===a)this.onclick=d;else throw Error("This object only handles the click event");};a.prototype.ua=function(){if(this.onclick)this.onclick()};a.prototype.qs=function(a){this.Ni.length=0;this.Oi={};this.ra=a.concat();for(var b=!1,e=0;e<a.length;e++){var c=a[e];c.Ck()&&(b=!0);var g=c.uc(),h;for(h in g)g.hasOwnProperty(h)&&this.ps(h,c)}this.wq();this.da.get("showKeyboardHelp")&&
this.Rt(a,b)};a.prototype.Rt=function(a,d){var b=lb(C("<div>"),"keydiv");b.ea("font-size","8pt");b.ea("color","#909090");b.ea("font-weight","normal");C(this.ia).append(b);var c=this.language.fn();b.append("<h1>"+c("keyboard")+"</h1>");var g=[{key:this.da.get("keyCurveTool"),description:c("draw-curves")},{key:this.da.get("keyLineTool"),description:c("draw-lines")}];0<a.length&&g.push({key:this.da.get("keyDelete"),description:c("delete-selection")},{key:this.da.get("keyDuplicate"),description:c("duplicate-selection")},
{key:this.da.get("keyMoveUp"),description:c("move-selection-closer")},{key:this.da.get("keyMoveDown"),description:c("move-selection-away")});1<a.length&&g.push({key:this.da.get("keyGroup"),description:c("group-selection")});d&&g.push({key:this.da.get("keyUngroup"),description:c("break-apart-group")});g.push({key:this.da.get("keyZoomIn"),description:c("zoom-in")});g.push({key:this.da.get("keyZoomOut"),description:c("zoom-out")});g.push({key:c("arrow-keys"),description:c("move-while-zoomed")});for(c=
0;c<g.length;c++){var h=lb(C("<a>").text(g[c].key),"key");h.ea("background","#d0d0d0");h.ea("border-left","1px solid #808080");h.ea("border-right","1px solid #e0e0e0");h.ea("border-top","1px solid #808080");h.ea("border-bottom","1px solid #e0e0e0");h.ea("padding-left","0.5em");h.ea("padding-right","0.5em");h.ea("margin-right","1em");h.ea("color","#4fa0d3");h.ea("font-weight","bold");h=C("<p>").append(h);h[0].appendChild(document.createTextNode(g[c].description));b.append(h)}};a.prototype.zq=function(a,
d){var b=this.language.fn();if("strokeStyle"===d)return{name:d,type:"colour",display:b("outline-colour")};if("fillStyle"===d)return{name:d,type:"colour",display:b("fill-colour")};if("lineWidth"===d){var c=[{name:b("thickness-pencil"),value:1},{name:b("thickness-pen"),value:2},{name:b("thickness-marker"),value:4},{name:b("thickness-brush"),value:10}];!0!==a.la("closed")&&"TextNode"!==a.type()||c.unshift({name:b("none"),value:0});return{name:d,display:b("outline-thickness"),type:"select",values:c}}if("sloppiness"===
d)return{name:"sloppiness",display:b("sloppiness"),type:"select",values:[{name:b("sloppiness-draftsman"),value:0},{name:b("sloppiness-artist"),value:.25},{name:b("sloppiness-cartoonist"),value:.5},{name:b("sloppiness-child"),value:1},{name:b("sloppiness-drunk"),value:2}]};if("smoothness"===d)return{name:"smoothness",display:b("smoothness"),type:"select",values:[{name:b("smoothness-sharpest"),value:0},{name:b("smoothness-sharper"),value:.1},{name:b("smoothness-sharp"),value:.2},{name:b("smoothness-smooth"),
value:.3},{name:b("smoothness-smoothest"),value:.5}]};if("shadow"===d)return{name:"shadow",display:b("shadow"),type:"select",values:[{name:b("yes"),value:!0},{name:b("no"),value:!1}]};if("dashes"===d)return{name:"dashes",display:b("line-style"),type:"select",values:[{name:b("line-style-solid"),value:""},{name:b("line-style-short-dashes"),value:"5,5"},{name:b("line-style-long-dashes"),value:"10,5"}]};if("matrix"===d||"inverse"===d||"closed"===d||"commands"===d||"seed"===d)return{name:d,type:"none"};
if("text"===d)return{name:"text",display:b("text"),type:"textarea"};if("textFillStyle"===d)return{name:"textFillStyle",display:b("text-colour"),type:"colour"};if("fontSize"===d)return{name:"fontSize",display:b("font-size"),type:"select",values:[{name:"10",value:10},{name:"12",value:12},{name:"15",value:15},{name:"20",value:20},{name:"30",value:30},{name:"40",value:40},{name:"50",value:50},{name:"60",value:60},{name:"100",value:100}]};if("fontName"===d){var g=[],h=this.da.Ha("fonts");for(c=0;c<h.length;c++)g.push({name:h[c],
value:h[c]});return{name:"fontName",display:b("font"),type:"select",values:g}}return"arrowSize"===d?{name:"arrowSize",display:b("arrowhead-size"),type:"select",values:[{name:b("arrowhead-size-none"),value:0},{name:b("arrowhead-size-tiny"),value:10},{name:b("arrowhead-size-small"),value:15},{name:b("arrowhead-size-medium"),value:20},{name:b("arrowhead-size-large"),value:30}]}:"arrowStyle"===d?{name:"arrowStyle",display:b("arrowhead-style"),type:"select",values:[{name:b("arrowhead-style-simple"),value:"simple"},
{name:b("arrowhead-style-solid"),value:"solid"}]}:"doubleArrow"===d?{name:"doubleArrow",display:b("double-arrows"),type:"select",values:[{name:b("no"),value:!1},{name:b("yes"),value:!0}]}:"url"===d?{name:"url",display:b("image-url"),type:"text"}:"rows"===d?{name:d,display:"Rows",type:"text"}:"columns"===d?{name:d,display:"Columns",type:"text"}:{name:d,display:"Display-"+d,type:"text"}};a.prototype.ps=function(a,d){var b=this.da;a in this.Oi?(b=this.Oi[a],b.value!==d.la(a)&&(b.value=null)):"locked"===
a||"points"===a||!0===d.la("closed")&&("arrowSize"===a||"arrowStyle"===a||"doubleArrow"===a)||!1===d.la("closed")&&("fontName"===a||"fontSize"===a||"textFillStyle"===a||"text"===a||"fillStyle"===a)||"ImageNode"===d.type()&&("fillStyle"===a||"strokeStyle"===a||"lineWidth"===a||"shadow"===a)||"BrushNode"===d.type()&&"fillStyle"===a||"TextNode"===d.type()&&"fillStyle"===a||"lockSize"===a||"lockRotate"===a||"rotateAround"===a||"layer"===a||0===a.indexOf("cell-")||"fontName"===a&&!b.get("showFontNameProperty")||
"fontSize"===a&&!b.get("showFontSizeProperty")||"smoothness"===a&&!b.get("showSmoothnessProperty")||"sloppiness"===a&&!b.get("showSloppinessProperty")||(b={dl:this.zq(d,a),value:d.la(a)},b.dl.display&&0===b.dl.display.indexOf("Display-")||(this.Ni.push(b),this.Oi[a]=b))};a.prototype.wq=function(){function a(){h.Fu(this)}function d(){var a=this;"timer"in a&&clearTimeout(a.timer);a.timer=setTimeout(function(){h.apply(a.wc.name,a.value)},250)}function c(a){13===a.keyCode&&h.apply(this.wc.name,this.value)}
function f(){var a=parseInt(this.value,10);this.wc&&this.wc.values&&h.apply(this.wc.name,this.wc.values[a].value)}C(this.ia).empty();var g,h=this;for(g=0;g<this.Ni.length;g++){var k=this.Ni[g],l=k.dl;if("none"!==l.type){var m=document.createElement("div");var n=document.createElement("span");n.appendChild(document.createTextNode(l.display||l.name));m.appendChild(n);m.appendChild(document.createElement("br"));if("select"===l.type){var q=document.createElement("select");for(n=0;n<l.values.length;n++){var u=
l.values[n],v=document.createElement("option");v.appendChild(document.createTextNode(u.name));v.setAttribute("value",n.toString());u.value===k.value&&v.setAttribute("selected","");q.appendChild(v)}q.wc=l;q.onchange=f;m.appendChild(q)}else if("colour"===l.type)n=document.createElement("input"),n.setAttribute("type","text"),n.value=k.value,n.wc=l,jb(C(n),c),m.appendChild(n),k=document.createElement("img"),k.src=this.da.ub("wd-wheel.png"),k.style.verticalAlign="middle",k.input=n,m.appendChild(k),C(k).click(a);
else if("text"===l.type)n=document.createElement("input"),n.setAttribute("type","text"),n.value=k.value,n.wc=l,jb(C(n),c),m.appendChild(n);else if("textarea"===l.type)n=document.createElement("textarea"),n.setAttribute("rows","3"),n.setAttribute("cols","20"),n.value=k.value,n.wc=l,jb(C(n),d),m.appendChild(n);else if("button"===l.type)n=document.createElement("input"),n.setAttribute("type","button"),n.value="Edit",n.wc=l,m.appendChild(n);else throw"Error: No such property";this.ia.append(C(m))}}};
a.prototype.apply=function(a,d){this.view.setProperty(a,d)};a.prototype.Fu=function(a){if(!a.Nn){var b="#000000 #ffffff #000088 #008800 #008888 #880000 #880088 #884400 #888888 #444444 #0000ff #00ff00 #00ffff #ff0000 #ff00ff #ffff00".split(" "),c=this;if(this.Xm){b=document.createElement("div");var f=new vb(b,120);f.Ro(a.input.value);f.Yk=function(b){c.Pj(b,a.input,a.input.wc)};a.Eu=f;a.Nn=!0;a.parentNode.appendChild(b)}else{f=this.da.get("colourPalette");"auto"===f&&(f=b);b=new oc(C(a.parentNode),
20,!1,!0,f);b.ia.ea("position","static");a.Eu=b;a.Nn=!0;a.parentNode.appendChild(b.ia[0]);var g=Lb(c.rb);b.xa("colour",function(b){c.Pj(b,a.input,a.input.wc);b=A.Xb(b).values[3];g.vl(Math.round(100*b))});g.min="0";g.max="100";var h=A.Xb(a.input.value);g.vl(Math.round(100*h.values[3]));g.onchange=function(){h=A.Xb(a.input.value);h.values[3]=g.Hn()/100;c.Pj(h.toString(),a.input,a.input.wc)};a.parentNode.appendChild(document.createElement("br"));a.parentNode.appendChild(g)}}};a.prototype.Pj=function(a,
d,c){this.view.setProperty(c.name,a);d.value=a};return a}(rb);var sd=function(){function c(a,b){void 0===b&&(b="repeat");this.qa=a;this.repeat=b}c.prototype.loaded=function(){return this.qa instanceof HTMLImageElement?this.qa.complete:!0};c.prototype.setTransform=function(){};return c}(),td=function(){function c(a,b,d,c){this.bu=[];this.from=new E(a,b);this.fa=new E(d,c)}c.prototype.addColorStop=function(a,b){this.bu.push({offset:a,Me:b})};return c}(),ud=function(){function c(){this.stack=[];this.sa=new M;this.lineCap="butt";this.lineJoin="miter";this.lineWidth=
1;this.strokeStyle=this.fillStyle="#000000";this.textBaseline="top";this.font="10px arial";this.globalCompositeOperation="source-over";this.globalAlpha=1;this.shadowBlur=this.shadowOffsetY=this.shadowOffsetX=0;this.shadowColor="rgba(0,0,0,0)"}c.prototype.save=function(){this.stack.push({sa:this.sa.clone(),fillStyle:this.fillStyle,font:this.font,lineJoin:this.lineJoin,lineCap:this.lineCap,lineWidth:this.lineWidth,strokeStyle:this.strokeStyle,textBaseline:this.textBaseline,globalCompositeOperation:this.globalCompositeOperation,
globalAlpha:this.globalAlpha,shadowOffsetX:this.shadowOffsetX,shadowOffsetY:this.shadowOffsetY,shadowBlur:this.shadowBlur,shadowColor:this.shadowColor})};c.prototype.restore=function(){var a=this.stack.pop();a&&(this.sa=a.sa,this.fillStyle=a.fillStyle,this.font=a.font,this.lineJoin=a.lineJoin,this.lineCap=a.lineCap,this.lineWidth=a.lineWidth,this.sa=a.sa,this.strokeStyle=a.strokeStyle,this.textBaseline=a.textBaseline,this.globalCompositeOperation=a.globalCompositeOperation,this.globalAlpha=a.globalAlpha,
this.shadowOffsetX=a.shadowOffsetX,this.shadowOffsetY=a.shadowOffsetY,this.shadowBlur=a.shadowBlur,this.shadowColor=a.shadowColor)};c.prototype.drawImage=function(a,b,d,c,f,g,h,k,l){var e=a.width,n=a.height,q=0,u=e,v=n;void 0!==c&&void 0!==f&&void 0!==g&&void 0!==h&&void 0!==k&&void 0!==l?(q=b,0-d,u=c,v=f,b=g,d=h,e=k,n=l):void 0!==c&&void 0!==f&&(e=c,n=f);this.tm(a,q,0,u,v,b,d,e,n)};c.prototype.beginPath=function(){};c.prototype.closePath=function(){};c.prototype.arc=function(a,b,d,c,f,g){g&&(g=c,
c=f,f=g);for(;0>c;)c+=2*Math.PI;for(;0>f;)f+=2*Math.PI;c>f&&(c-=2*Math.PI);var e=2*Math.PI;var k=c%e;var l=f%e;l===k&&(l+=2*Math.PI);f=[];c=Math.PI/2;g=k<l?1:-1;var m=k;for(e=Math.min(e,Math.abs(l-k));1E-5<e;){k=m+g*Math.min(e,c);var n=(k-m)/2,q=d*Math.cos(n),u=d*Math.sin(n),v=.5522847498*Math.tan(n);l=q+v*u;q=-u+v*q;u=-q;v=n+m;n=Math.cos(v);v=Math.sin(v);f.push({Qc:d*Math.cos(m),Rc:d*Math.sin(m),Od:l*n-q*v,Pd:l*v+q*n,Hu:l*n-u*v,Ju:l*v+u*n,Iu:d*Math.cos(k),Ku:d*Math.sin(k)});e-=Math.abs(k-m);m=k}for(d=
0;d<f.length;d++)c=f[d],0===d&&this.moveTo(c.Qc+a,c.Rc+b),this.bezierCurveTo(c.Od+a,c.Pd+b,c.Hu+a,c.Ju+b,c.Iu+a,c.Ku+b)};c.prototype.arcTo=function(){};c.prototype.strokeRect=function(a,b,d,c){this.beginPath();this.rect(a,b,d,c);this.stroke()};c.prototype.setTransform=function(a,b,d,c,f,g){this.sa=new M(a,d,b,c,f,g)};c.prototype.transform=function(a,b,d,c,f,g){a=new M(a,d,b,c,f,g);this.sa=this.sa.multiply(a)};c.prototype.translate=function(a,b){this.transform(1,0,0,1,a,b)};c.prototype.scale=function(a,
b){this.transform(a,0,0,b,0,0)};c.prototype.rotate=function(a){var b=Math.cos(a);a=Math.sin(a);this.transform(b,a,-a,b,0,0)};c.prototype.rect=function(a,b,d,c){this.beginPath();this.moveTo(a,b);this.lineTo(a+d,b);this.lineTo(a+d,b+c);this.lineTo(a,b+c);this.lineTo(a,b);this.closePath()};c.prototype.fillRect=function(a,b,d,c){this.rect(a,b,d,c);this.fill()};c.prototype.Ff=function(a){var b=null,d="10",c="normal",f="normal",g="normal",h="normal",k=!1;a=a.split(/\s+/);a:for(;;){var l=a.shift();if(!l)break;
switch(l){case "normal":break;case "italic":case "oblique":c=l;break;case "small-caps":g=l;break;case "bold":case "bolder":case "lighter":case "100":case "200":case "300":case "400":case "500":case "600":case "700":case "800":case "900":f=l;break;default:if(k){b=l;a.length&&(b+=" "+a.join(" "));2<b.length&&('"'===b.charAt(0)||"'"===b.charAt(0))&&(b=b.substr(1,b.length-2));break a}else l=l.split("/"),d=l[0],k=!0,1<l.length&&(h=l[1])}}return{fontStyle:c,fontVariant:g,fontWeight:f,fontSize:d,lineHeight:h,
fontFamily:b}};c.prototype.createPattern=function(a,b){return new sd(a,b)};c.prototype.createLinearGradient=function(a,b,d,c){return new td(a,b,d,c)};c.prototype.clip=function(){};return c}();var vd=function(){function c(a,b,d,c){this.x=a;this.y=b;this.width=d;this.height=c;this.Yb=[];this.fonts={};this.images=[];this.hj={};this.lb=1;this.qq=!0;this.page={};this.log=B.create("PdfWriter");this.ab=this.object("Pages",{Kids:[],Count:0});this.fq=this.object("Catalog",{Pages:this.ab._id+" 0 R"});this.tg()}c.prototype.$r=function(){if(null!==c.Aj)return c.Aj;var a=document.createElement("canvas"),b=!1;a.width=10;a.height=10;"toDataURL"in a&&(b=0<a.toDataURL("image/jpeg").indexOf("jpeg"));c.Aj=
b;this.log("JPEG supported: %s",b);return b};c.prototype.tg=function(a,b,d,c){void 0===a&&(a=this.x);void 0===b&&(b=this.x);void 0===d&&(d=this.width);void 0===c&&(c=this.height);this.log("StartPage MediaBox=[%s %s %s %s]",a,b,d,c);this.page=this.object("Page",{MediaBox:[a,b,a+d,b+c],Parent:this.ab._id+" 0 R"});this.ab.Kids.push(this.page._id+" 0 R");this.ab.Count+=1;this.hj={}};c.prototype.object=function(a,b){var d=this.Yb.length+1;a&&(b.Type=a);b._id=d;this.Yb.push(b);return b};c.prototype.Rp=
function(a){this.page.Contents=a._id+" 0 R"};c.prototype.stream=function(a){if(this.qq){var b=Sb.Ag("LZWEncoder");b.Vl(a);b.flush();a=b.Tf().toString();a=this.object(null,{_stream:a,Filter:"[/LZWDecode]",DecodeParms:"[ << /EarlyChange 0 >> ]"})}else a=this.object(null,{_stream:a});return a};c.prototype.pu=function(a){if(!(a in this.fonts)){var b="F"+this.lb;this.lb+=1;var d="/"+a.replace(/ /g,"");b=this.object("Font",{_name:b,BaseFont:d,Encoding:"/StandardEncoding",Subtype:"/Type1"});this.fonts[a]=
b}this.Nh("Font",this.fonts[a]);return"/"+this.fonts[a]._name};c.prototype.jp=function(a,b){var d=""+a+"-"+b;if(!(d in this.hj)){var c="gs"+this.lb;this.lb+=1;var f=this.object("ExtGState",{_name:c});b?f.ca=this.Mc(a):f.CA=this.Mc(a);this.hj[d]=c;this.Nh("ExtGState",f)}return this.hj[d]};c.prototype.Nh=function(a,b){"Resources"in this.page||(this.page.Resources={});a in this.page.Resources||(this.page.Resources[a]={});this.page.Resources[a][b._name]=b._id+" 0 R"};c.prototype.yj=function(a,b){void 0===
b&&(b="");for(var d=0;d<this.images.length;d++)if(this.images[d].dh===a&&b===this.images[d].Rn)return this.images[d].oh;return null};c.prototype.ij=function(a,b){var d,c=this.yj(a);if(!c){var f="I"+this.lb;this.lb+=1;b instanceof HTMLCanvasElement?c=b:(c=document.createElement("canvas"),c.width=b.width,c.height=b.height,c.getContext("2d").drawImage(b,0,0));var g=c.getContext("2d").getImageData(0,0,c.width,c.height),h=!1;if(this.$r()){this.log("Using JPEG encoding");var k="[/DCTDecode]";var l=Sb.Ag("");
for(d=0;d<g.data.length;d+=4)h=h||255>g.data[d+3];d=c.toDataURL("image/jpeg");var m=atob(d.split(",")[1]);for(d=0;d<m.length;d++)l.Qa(m.charCodeAt(d))}else{this.log("Using LZW encoding");k="[/LZWDecode]";l=Sb.Ag("LZWEncoder");for(d=0;d<g.data.length;d+=4)l.Qa(g.data[d]),l.Qa(g.data[d+1]),l.Qa(g.data[d+2]),h=h||255>g.data[d+3];var n="[ <</EarlyChange 0 >> ]"}l.flush();l=l.Tf().toString();f=this.object("XObject",{Subtype:"/Image",Width:c.width,Height:c.height,ColorSpace:"/DeviceRGB",BitsPerComponent:8,
Length:l.length,Interpolate:"true",Filter:k,_name:f,_stream:l});n&&(f.DecodeParms=n);if(h){l=Sb.Ag("LZWEncoder");for(d=0;d<g.data.length;d+=4)l.Qa(g.data[d+3]);l.flush();l=l.Tf().toString();n=this.object("XObject",{Subtype:"/Image",Width:c.width,Height:c.height,ColorSpace:"/DeviceGray",BitsPerComponent:8,Length:l.length,Filter:"[/LZWDecode]",DecodeParms:"[ << /EarlyChange 0 >> ]",_stream:l});f.SMask=n._id+" 0 R"}this.images.push({dh:a,Rn:"",oh:f});c=f}this.Nh("XObject",c);return"/"+c._name};c.prototype.jj=
function(a,b){var d=this.yj(a.qa,b.toString());if(!d){d="P"+this.lb;this.lb+=1;this.ij(a.qa,a.qa);var c=this.yj(a.qa),f=new M(a.qa.width,0,0,-a.qa.height,0,a.qa.height);f=b.multiply(f);var g="1",h="1",k=b.Zg();k=Math.max(k.x,k.y);if("no-repeat"===a.repeat||"repeat-y"===a.repeat)g=""+Math.ceil(this.width/a.qa.width/k);if("no-repeat"===a.repeat||"repeat-x"===a.repeat)h=""+Math.ceil(this.height/a.qa.height/k);d=this.object("Pattern",{_name:d,PatternType:"1",PaintType:"1",TilingType:"2",BBox:"[0 0 1 1]",
XStep:g,YStep:h,Matrix:"[ "+this.Mc(f.m11,f.m21,f.m12,f.m22,f.Ca,f.Da)+"]",Resources:"<< /XObject << /"+c._name+" "+c._id+" 0 R >> >>"});d._stream="/"+c._name+" Do";this.images.push({dh:a.qa,Rn:b.toString(),oh:d})}this.Nh("Pattern",d);return"/"+d._name};c.prototype.lf=function(){var a=[],b=[],d;a.push("%PDF-1.4\n%\u0080\u0081\u0082\u0083\n");for(d=0;d<this.Yb.length;d++)this.Hm(a,b,this.Yb[d],!1);var c=a.join("").length;a.push("xref\n0 "+(this.Yb.length+1)+"\n");a.push("0000000000 65535 f\n");for(d=
0;d<this.Yb.length;d++){for(var f=""+b[d];10>f.length;)f="0"+f;a.push(f+" 00000 n \n")}a.push("trailer\n");a.push("<< /Size "+(this.Yb.length+1)+"\n");a.push("   /Root "+this.fq._id+" 0 R\n");a.push(">>\n");a.push("startxref\n");a.push(c+"\n");a.push("%%EOF\n");return a.join("")};c.prototype.toBlob=function(){for(var a=this.lf(),b=new Uint8Array(a.length),d=0;d<a.length;d++)b[d]=a.charCodeAt(d);return new Blob([b],{type:"application/pdf"})};c.prototype.Hm=function(a,b,d,c){c?a.push("<<\n"):(b.push(a.join("").length),
a.push(d._id+" 0 obj\n"),"Type"in d?a.push("<< /Type /"+d.Type+"\n"):a.push("<<\n"));"_stream"in d&&(d.Length=d._stream.toString().length);for(var e in d)if(d.hasOwnProperty(e)&&"Type"!==e&&"_"!==e.charAt(0)){c&&a.push("    ");a.push("   /"+e+" ");var g=d[e];"object"===typeof g&&"[object Array]"===Object.prototype.toString.apply(g)?a.push("[ "+g.join(" ")+" ]"):"object"===typeof g?this.Hm(a,b,g,!0):a.push(g);a.push("\n")}c&&a.push("    ");a.push(">>\n");"_stream"in d&&(a.push("stream\n"),a.push(d._stream+
"\n"),a.push("endstream\n"));c||a.push("endobj\n")};c.prototype.Qq=function(a){return"("+a.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")+")"};c.prototype.Mc=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];b=[];for(var d=0;d<a.length;d++){var c=""+a[d];0<c.indexOf("e")&&(c=a[d].toFixed(20));b.push(c)}return b.join(" ")};c.Aj=null;return c}(),wd=function(c){function a(a,d){var b=c.call(this)||this;b.Zq=d;b.path=[];b.x=0;b.y=0;b.xo=[];b.af="";b.gf="";b.ff=-1;b.ef=
"";b.df="";b.cf="";b.bf="";b.$e=-1;b.log=B.create("PDFContext");b.Jd=a.clone();b.Jd.transform(new O(.75,.75,0,0));b.mb=new vd(72*a.x/96,72*a.y/96,72*a.width/96,72*a.height/96);b.stream=[];b.x=0;b.y=0;b.fillStyle="#000000";b.strokeStyle="#000000";b.Em=b.Ip;b.Dm();return b}p(a,c);a.prototype.save=function(){c.prototype.save.call(this);this.stream.push("q");this.xo.push({af:this.af,gf:this.gf,ff:this.ff,ef:this.ef,df:this.df,cf:this.cf,bf:this.bf,$e:this.$e})};a.prototype.restore=function(){c.prototype.restore.call(this);
var a=this.xo.pop();a&&(this.stream.push("Q"),this.af=a.af,this.gf=a.gf,this.ff=a.ff,this.ef=a.ef,this.df=a.df,this.cf=a.cf,this.bf=a.bf,this.$e=a.$e)};a.prototype.tg=function(a){var b=new O(.75,.75,0,0);a&&(this.Jd=a.clone(),this.Jd.transform(b));this.gk();this.mb.tg(this.Jd.x,this.Jd.y,this.Jd.width,this.Jd.height);this.Dm();this.beginPath()};a.prototype.beginPath=function(){this.path.length=0};a.prototype.Dm=function(){this.log("Start page: %s",this.Jd);this.setTransform(1,0,0,1,0,0);this.gf=this.af=
"";this.ff=-1;this.bf=this.cf=this.df=this.ef="";this.$e=-1};a.prototype.gk=function(){this.stream.length&&this.mb.Rp(this.mb.stream(this.stream.join("\n")));this.stream.length=0};a.prototype.toString=function(){this.gk();return this.mb.lf()};a.prototype.toBlob=function(){this.gk();return this.mb.toBlob()};a.prototype.setTransform=function(a,d,c,f,g,h){var b=this.Jd.Lf();this.sa=(new M(a,c,d,f,g,h)).multiply(new Ac(0,b.x,b.y)).multiply(new O(.75,.75,0,0))};a.prototype.closePath=function(){this.path.push("h")};
a.prototype.fill=function(){this.Bj();for(var a=0;a<this.path.length;a++)this.stream.push(this.path[a]);this.stream.push("f")};a.prototype.stroke=function(){this.Cj();for(var a=0;a<this.path.length;a++)this.stream.push(this.path[a]);this.stream.push("S")};a.prototype.moveTo=function(a,d){var b=this.sa.apply(a,d);this.path.push(this.mb.Mc(b.x,b.y)+" m");this.x=a;this.y=d};a.prototype.lineTo=function(a,d){var b=this.sa.apply(a,d);this.path.push(this.mb.Mc(b.x,b.y)+" l");this.x=a;this.y=d};a.prototype.bezierCurveTo=
function(a,d,c,f,g,h){a=this.sa.apply(a,d);c=this.sa.apply(c,f);f=this.sa.apply(g,h);this.path.push(this.mb.Mc(a.x,a.y,c.x,c.y,f.x,f.y)+" c");this.x=g;this.y=h};a.prototype.quadraticCurveTo=function(a,d,c,f){this.bezierCurveTo(2/3*a+1/3*this.x,2/3*d+1/3*this.y,2/3*a+1/3*c,2/3*d+1/3*f,c,f)};a.prototype.fillText=function(a,d,c){this.Em(a,d,c,0)};a.prototype.strokeText=function(a,d,c){this.Em(a,d,c,1)};a.prototype.Bj=function(){if(this.af!==this.fillStyle){if(this.fillStyle instanceof sd){var a=this.mb.jj(this.fillStyle,
this.sa);this.stream.push("/Pattern cs");this.stream.push(a+" scn")}else"string"===typeof this.fillStyle&&(a=A.Xb(this.fillStyle).Ad(A.RGBA),this.stream.push(this.mb.Mc(a.values[0],a.values[1],a.values[2])+" rg"),a=this.mb.jp(a.values[3],!0),this.stream.push("/"+a+" gs"));this.af=this.fillStyle}};a.prototype.Cj=function(){function a(a){return"bevel"===a?2:"round"===a?1:0}function d(a){return"butt"===a?0:"round"===a?1:2}if(this.gf!==this.strokeStyle){if(this.strokeStyle instanceof sd){var c=this.mb.jj(this.strokeStyle,
this.sa);this.stream.push("/Pattern CS");this.stream.push(c+" SCN")}else"string"===typeof this.strokeStyle&&(c=A.Xb(this.strokeStyle).Ad(A.RGBA),this.stream.push(this.mb.Mc(c.values[0],c.values[1],c.values[2])+" RG"),c=this.mb.jp(c.values[3],!1),this.stream.push("/"+c+" gs"));this.gf=this.strokeStyle}this.ff!==this.lineWidth&&(this.ff=this.lineWidth,this.stream.push(this.mb.Mc(72*this.lineWidth/96)+" w"));this.ef!==this.lineJoin&&(this.ef=this.lineJoin,this.stream.push(a(this.lineJoin)+" j"));this.df!==
this.lineCap&&(this.df=this.lineCap,this.stream.push(d(this.lineCap)+" J"))};a.prototype.Jp=function(a,d,c,f){var b=this.Ff(this.font);if(this.cf!==b.fontSize||this.bf!==b.fontFamily){var e=this.mb.pu(b.fontFamily);this.stream.push(e+" "+this.mb.Mc(parseFloat(b.fontSize))+" Tf");this.cf=b.fontSize;this.bf=b.fontFamily}this.$e!==f&&(this.stream.push(f+" Tr"),this.$e=f);0===f?this.Bj():this.Cj();this.stream.push("BT");d=this.sa.multiply(new M(1,0,0,-1,d,c));this.stream.push(this.mb.Mc(d.m11,d.m21,d.m12,
d.m22,d.Ca,d.Da)+" Tm");this.stream.push(this.mb.Qq(a)+" Tj");this.stream.push("ET")};a.prototype.Ip=function(a,d,c,f){var b=this.Ff(this.font),e=this.Zq.get(b.fontFamily);e?(0===f?this.Bj():this.Cj(),this.beginPath(),e.Kq(this,a,d,c,parseFloat(b.fontSize)),0===f?this.fill():this.stroke()):this.Jp(a,d,c,f)};a.prototype.measureText=function(){return{width:1}};a.prototype.Ff=function(a){var b="",c="",f="normal",g="normal",h="normal",k="normal";a=a.split(/\s+/);a:for(;;){var l=a.shift();if(!l)break;
switch(l){case "normal":break;case "italic":case "oblique":f=l;break;case "small-caps":h=l;break;case "bold":case "bolder":case "lighter":case "100":case "200":case "300":case "400":case "500":case "600":case "700":case "800":case "900":g=l;break;default:if(""===c)l=l.split("/"),c=l[0],1<l.length&&(k=l[1]);else{b=l;a.length&&(b+=" "+a.join(" "));break a}}}b&&(b=b.replace(/"/g,""));return{fontStyle:f,fontVariant:h,fontWeight:g,fontSize:c,lineHeight:k,fontFamily:b}};a.prototype.tm=function(a,d,c,f,
g,h,k,l,m){this.log("DrawImage(%s, %s, %s, %s, %s, %s, %s %s)",d,c,f,g,h,k,l,m);k+=m;var b=document.createElement("canvas"),e=b.getContext("2d");b.width=f;b.height=g;e.drawImage(a,-d,-c);a=this.mb.ij(a instanceof HTMLImageElement?[a.src,d,c,f,g].join():a,b);this.stream.push("q");h=this.sa.multiply(new M(l,0,0,-m,h,k));this.stream.push(this.mb.Mc(h.m11,h.m21,h.m12,h.m22,h.Ca,h.Da)+" cm");this.stream.push(a+" Do");this.stream.push("Q")};a.prototype.lf=function(){return this.mb.lf()};return a}(ud);var xd=function(){function c(){this.ba=[]}c.prototype.lineTo=function(a,b,d){a.apply(b,d);this.ba.push({Ig:"L",Id:a.apply(b,d)})};c.prototype.moveTo=function(a,b,d){a.apply(b,d);this.ba.push({Ig:"M",Id:a.apply(b,d)})};c.prototype.quadraticCurveTo=function(a,b,d,c,f){this.ba.push({Ig:"Q",Id:a.apply(b,d),Ye:a.apply(c,f)})};c.prototype.bezierCurveTo=function(a,b,d,c,f,g,h){this.ba.push({Ig:"C",Id:a.apply(b,d),Ye:a.apply(c,f),gg:a.apply(g,h)})};c.prototype.closePath=function(){this.ba.push({Ig:"Z"})};
c.prototype.ep=function(a){a=a.inverse();for(var b="",d=0;d<this.ba.length;d++){var c=this.ba[d];0<d&&(b+=" ");b+=c.Ig;if(c.Id){var f=a.apply(c.Id.x,c.Id.y);b+=f.x+","+f.y;c.Ye&&(f=a.apply(c.Ye.x,c.Ye.y),b+=","+f.x+","+f.y,c.gg&&(c=a.apply(c.gg.x,c.gg.y),b+=","+c.x+","+c.y))}}return b};return c}(),yd=function(c){function a(a){var b=c.call(this)||this;b.sa=new M;b.ba=[];b.path=new xd;b.Yb=[];b.log=B.create("SvgContext");b.Bg=1;b.Cf=2;b.qj=4;b.log("SVG context rect: %s",a);b.root=new sa("svg",{xmlns:"http://www.w3.org/2000/svg",
"xmlns:xlink":"http://www.w3.org/1999/xlink",version:1.2,baseProfile:"tiny",width:a.width,height:a.height,viewBox:a.x+" "+a.y+" "+a.width+" "+a.height});b.Yj=new sa("defs",{});b.root.Le(b.Yj);b.Cd=[b.root];return b}p(a,c);a.prototype.kg=function(a){a=new sa("g",a||{});this.Sj().Le(a);this.Cd.push(a)};a.prototype.ig=function(){var a=this.Cd.pop();if(a&&1===a.children.length){var d=a.children[0];d.Mo(a.attributes);a.name=d.name;a.attributes=d.attributes;a.children=d.children;a.text=d.text}};a.prototype.Sj=
function(){return this.Cd[this.Cd.length-1]};a.prototype.node=function(a,d,c,f){function b(a,b){if(b instanceof sd)c[a]="url(#"+e.jj(b)+")";else if("string"===typeof b){var d=A.Xb(b),f=d.values[3];1>f&&(d.values[3]=1,c[a+"-opacity"]=""+f);c[a]=d.toString()}}void 0===c&&(c={});var e=this;this.sa.Dk()||(c.transform="matrix("+this.sa.m11+" "+this.sa.m21+" "+this.sa.m12+" "+this.sa.m22+" "+this.sa.Ca+" "+this.sa.Da+")");d&this.Bg?b("fill",this.fillStyle):c.fill="none";d&this.Cf&&(b("stroke",this.strokeStyle),
c["stroke-width"]=this.lineWidth,"miter"!==this.lineJoin&&(c["stroke-linejoin"]=this.lineJoin),"butt"!==this.lineCap&&(c["stroke-linecap"]=this.lineCap));d&this.qj&&(d=this.Ff(this.font),c["font-weight"]=d.fontWeight,c["font-size"]=parseFloat(d.fontSize),c["font-style"]=d.fontStyle,c["font-family"]=d.fontFamily);this.Pp(new sa(a,c,f))};a.prototype.Pp=function(a){var b=!0,c=null,f={},g,h=this.Sj();0===h.children.length?b=!1:c=h.children[h.children.length-1];!c||a.name===c.name&&a.text===c.text||(b=
!1);if(b&&c)for(g in c.attributes)if(c.attributes.hasOwnProperty(g))if(g in a.attributes){var k=c.attributes[g],l=a.attributes[g];if(k!==l)if(0===g.indexOf("fill")||0===g.indexOf("stroke"))if("none"===k)f[g]=l;else if("none"===l)f[g]=k;else{b=!1;break}else{b=!1;break}}else f[g]=c.attributes[g];if(b&&c)for(g in a.attributes)a.attributes.hasOwnProperty(g)&&(g in c.attributes||(f[g]=a.attributes[g]));b&&c?c.Mo(f):h.Le(a)};a.prototype.Ai=function(a){if(a===this.Cf){if(0===this.lineWidth)return!1;a=this.strokeStyle}else a=
this.fillStyle;return a instanceof sd?!0:"string"===typeof a?0<A.Xb(a).values[3]:!1};a.prototype.wm=function(a){for(var b=0;b<this.Yb.length;b++)if(this.Yb[b].dh===a)return this.Yb[b].oh;return null};a.prototype.ij=function(a){var b=this.wm(a);if(b)return b;b="image"+this.Yb.length;this.Yb.push({dh:a,oh:b});var c=document.createElement("canvas"),f=c.getContext("2d");c.width=a.width;c.height=a.height;f.drawImage(a,0,0);c=c.toDataURL();a=new sa("image",{id:b,x:0,y:0,width:a.width,height:a.height,"xlink:href":c});
this.Yj.Le(a);return b};a.prototype.jj=function(a){var b=this.wm(a);if(b)return b;var c=this.ij(a.qa);b="pattern"+this.Yb.length;this.Yb.push({dh:a,oh:b});var f=new sa("pattern",{id:b});"no-repeat"===a.repeat?(f.attributes.width="1",f.attributes.height="1"):"repeat-x"===a.repeat?(f.attributes.patternUnits="userSpaceOnUse",f.attributes.width=a.qa.width,f.attributes.height=1E4):("repeat-y"===a.repeat?(f.attributes.patternUnits="userSpaceOnUse",f.attributes.width=1E4):(f.attributes.patternUnits="userSpaceOnUse",
f.attributes.width=a.qa.width),f.attributes.height=a.qa.height);f.Le(new sa("use",{"xlink:href":"#"+c}));this.Yj.Le(f);return b};a.prototype.toString=function(){return'<?xml version="1.0" encoding="UTF-8"?>\n'+this.root.toString()};a.prototype.toBlob=function(){for(var a=this.toString(),d=new Uint8Array(a.length),c=0;c<a.length;c++)d[c]=a.charCodeAt(c);return new Blob([d],{type:"image/svg+xml"})};a.prototype.beginPath=function(){this.path=new xd};a.prototype.transform=function(a,d,c,f,g,h){a=new M(a,
c,d,f,g,h);this.sa=this.sa.multiply(a)};a.prototype.closePath=function(){this.path.closePath()};a.prototype.fill=function(){this.Ai(this.Bg)&&this.node("path",this.Bg,{d:this.path.ep(this.sa)})};a.prototype.stroke=function(){this.Ai(this.Cf)&&this.node("path",this.Cf,{d:this.path.ep(this.sa)})};a.prototype.moveTo=function(a,d){this.path.moveTo(this.sa,a,d)};a.prototype.lineTo=function(a,d){this.path.lineTo(this.sa,a,d)};a.prototype.quadraticCurveTo=function(a,d,c,f){this.path.quadraticCurveTo(this.sa,
a,d,c,f)};a.prototype.bezierCurveTo=function(a,d,c,f,g,h){this.path.bezierCurveTo(this.sa,a,d,c,f,g,h)};a.prototype.fillText=function(a,d,c){this.Ai(this.Bg)&&(this.Ff(this.font),this.node("text",this.Bg|this.qj,{x:d,y:c},a))};a.prototype.strokeText=function(a,d,c){this.Ai(this.Cf)&&(this.Ff(this.font),this.node("text",this.Cf|this.qj,{x:d,y:c},a))};a.prototype.tm=function(a,d,c,f,g,h,k,l,m){var b=document.createElement("canvas"),e=b.getContext("2d");b.width=f;b.height=g;e.drawImage(a,-d,-c);a=b.toDataURL();
this.Sj().Le(new sa("image",{transform:"matrix("+this.sa.m11+" "+this.sa.m21+" "+this.sa.m12+" "+this.sa.m22+" "+this.sa.Ca+" "+this.sa.Da+")",x:h,y:k,width:l,height:m,"xlink:href":a}))};a.prototype.measureText=function(){return{width:1}};a.prototype.tg=function(){};return a}(ud);var Dd=new (function(){function c(){this.log=B.create("serializer")}c.prototype.sj=function(a){if(a instanceof Array)var b=this.Tn(a);else{if("string"!==typeof a)return this.log("Can only open an array or string as a document."),null;if("{"===a.charAt(0))b=this.rs(a);else if(0===a.indexOf("zwibbler3."))b=JSON.parse(a.substr(10)),b=this.Tn(b);else if(0===a.indexOf("zwibblerclip."))b=new zd(!1),a=b.eo(a,new M),b.ta(a),b.rh();else throw Error("Format detection failed.");}for(a=1;a<b.Ec();a++)b.Kl(a,
!1);return b};c.prototype.rs=function(a){function b(a){var b=new M;b.m11=a.m11;b.m12=a.m12;b.m21=a.m21;b.m22=a.m22;b.Ca=a.dx;b.Da=a.dy;return b}function d(a,c){switch(a.type){case "Node":for(var e=[],h=a.children,k=h.length-1;0<=k;k--){var l=f.lb;try{d(h[k],c+1)}catch(F){continue}e.push(l)}0<c&&g.push(new Ad(f.Va(),e));break;case "PathNode":case "ArrowNode":var v=a;h=0;"arrowSize"in v&&(h=v.arrowSize,v=v.path);e=b(v.matrix);h={strokeStyle:v.strokeStyle,fillStyle:v.fillStyle,lineWidth:v.lineWidth,
smoothness:v.smoothness,sloppiness:v.sloppiness,shadow:v.shadow,arrowSize:h,seed:Math.round(65535*Math.random())};"textNode"in v&&(k=v.textNode,h.fontSize=k.fontSize,h.fontName=k.fontName,h.text=k.text,h.textFillStyle="textFillStyle"in k?k.textFillStyle:k.fillStyle);"path"in v&&(v=v.path);var z=v.startX,w=v.startY;k=v.closed;l=new U;v=v.segments;z=e.apply(z,w);l.moveTo(z.x,z.y);for(z=0;z<v.length;z++){var y=v[z];switch(y.type){case 1:w=e.apply(y.x,y.y);l.lineTo(w.x,w.y);break;case 2:w=e.apply(y.x,
y.y);l.Ng(w.x,w.y);break;case 3:w=e.apply(y.x1,y.y1);y=e.apply(y.x,y.y);l.Ne(w.x,w.y,y.x,y.y);break;default:throw"Unknown path segment type: "+y.type;}}k&&l.close();h.commands=l.ec();g.push(new V(f.Va(),"PathNode",h));break;case "TextNode":e=b(a.matrix);e=e.multiply(new L(0,1.3*a.fontSize));e={fillStyle:a.fillStyle,lineWidth:0,text:a.text,fontName:a.fontName,fontSize:a.fontSize,matrix:e};g.push(new V(f.Va(),"TextNode",e));break;default:throw Error("Unknown node type: "+a.type);}}var c=B.create("IMPORT"),
f=new zd,g=[];try{var h=JSON.parse(a)}catch(k){a=a.replace(/\\\\/g,"\\").replace(/\\"/g,'"');try{h=JSON.parse(a)}catch(l){throw c("Couldn't parse file."),"Couldn't parse file.";}}c("Successfully parsed!");d(h,0);f.ta(g);return f};c.prototype.Tn=function(a){function b(a,d){if(void 0!==a){var e={};for(var g in a)a.hasOwnProperty(g)&&"children"!==g&&"parent"!==g&&"id"!==g&&"type"!==g&&(e[g]="matrix"===g?new M(a[g]):a[g]);g=f;0!==a.id&&c.push(new V(g,a.type,e,d,-1));f+=1;if(void 0!==a.children)for(e=
0;e<a.children.length;e++)b(a.children[e],g)}}var d;a=JSON.parse(JSON.stringify(a));var c=[],f=0,g={},h=!1;for(d=0;d<a.length;d++){var k=a[d];if("document"===k.type)delete k.type,c.push(new Bd(k));else{"PageNode"===k.type&&(h=!0);if("parent"in k){if(!(k.parent in g))throw"Error: child "+k.id+" references parent "+k.parent+" before it was defined.";var l=g[k.parent];void 0!==l.children?l.children.push(k):l.children=[k]}"GroupNode"!==k.type&&"PageNode"!==k.type||void 0!==k.children||(k.children=[]);
g[k.id]=k}}h||(f+=1);b(g[0],f);for(d=0;d<c.length;d++)this.log(c[d].toString());a=new zd(h);a.ta(c);a.rh();return a};c.prototype.nn=function(a){function b(a,c){var e={id:c.id,type:c.type()};d.push(e);a&&(e.parent=a.id);var f=c.uc(),g;for(g in f)f.hasOwnProperty(g)&&("matrix"===g?e[g]=f[g].ec():"inverse"!==g&&(e[g]=f[g]));if(c.Yn()&&c.children)for(e=0;e<c.children.length;e++)b(c,c.children[e])}var d=[],c={type:"document"},f=!1,g;for(g in a.aa)a.aa.hasOwnProperty(g)&&(c[g]=a.aa[g],f=!0);f&&d.push(c);
b(null,a.getRootNode());return d};c.prototype.vj=function(a,b,d){if("list"===b)a=this.nn(a),b="application/json";else if("zwibbler3"===b)a=this.nn(a),a="zwibbler3."+JSON.stringify(a),b="application/octet-stream";else if("svg"===b){b=a.Ve();var c=new yd(b);a.ja(c);a=c;b="image/svg+xml"}else if("pdf"===b){b=a.Ve();c=new wd(b,Cd.fonts);var f=a.Ua;for(b=0;b<a.Ec();b++)0<b&&c.tg(),a.Bb(b),a.ja(c);a.Bb(f);a=c;b="application/pdf"}else throw"Unknown save format: "+b;if("string"===typeof a)if("string"===d)var g=
a;else if("data-uri"===d)g="data:"+b+";base64,"+x.encode("base64",a);else{if("blob"===d)for(d=new Uint8Array(a.length),b=0;b<a.length;b++)d[b]=a.charCodeAt(b)}else if(a.toBlob&&a.toString)"string"===d?g=a.toString():"data-uri"===d?g="data:"+b+";base64,"+x.encode("base64",a.toString()):"blob"===d&&(g=a.toBlob());else if("object"===d)g=a;else throw"Error in ZwibblerDocument.save()";return g};return c}());var Ed=new (function(){function c(){this.hk={}}c.prototype.Wh=function(){if("localStorage"in window)try{var a=window.localStorage}catch(b){}return void 0!==a};c.prototype.setItem=function(a,b){this.Wh()?window.localStorage.setItem(a,b):this.hk[a]=""+b};c.prototype.getItem=function(a){return this.Wh()?window.localStorage.getItem(a):this.hk[a]};c.prototype.removeItem=function(a){this.Wh()?window.localStorage.removeItem(a):delete this.hk[a]};return c}());function Fd(c){function a(a){b&&clearTimeout(b);b=setTimeout(function(){b=null;c()},arguments.length?a:1E3)}var b=null;a.cancel=function(){b&&(clearTimeout(b),b=null)};return a};var Id=function(){function c(a,b,d,c,f,g,h){this.view=a;this.node=b;this.handle=d;this.jf=g;this.Ch=this.Bh=0;this.log=B.create("MoveEditNode");this.vo=b.Yg(d);this.Fa=b.la("snap")||0;this.Sa(c,f,h)}c.prototype.tc=function(){this.log("Entering MoveEditNode")};c.prototype.Ic=function(){this.log("Leaving MoveEditNode")};c.prototype.wb=function(a){if("touchmove"===a.type){var b=a.touches[0];b=this.view.eb(b.pageX,b.pageY);return this.Ta(b.x,b.y,a)}return"touchend"===a.type?(b=a.changedTouches[0],b=this.view.eb(b.pageX,
b.pageY),this.Za(b.x,b.y,a)):!1};c.prototype.Sa=function(a,b){var d=this.view.Fa(new E(a,b),this.Fa);a=d.x;b=d.y;this.log("onMouseDown(%s,%s)",a,b);this.Bh=a;this.Ch=b;return!0};c.prototype.Ta=function(a,b){var d=this.view.Fa(new E(a,b),this.Fa);a=d.x;b=d.y;this.node.ke(this.handle,a,b);this.node.format(this.view.ka,this.view.request);this.view.ja();return!0};c.prototype.Za=function(a,b){var d=this.view.Fa(new E(a,b),this.Fa);a=d.x;b=d.y;this.log("onMouseUp(%s,%s)",a,b,this.Bh,this.Ch);a!==this.Bh||
b!==this.Ch?this.view.ta([new Gd(this.node.id,this.handle,this.vo.x,this.vo.y,a,b)]):this.view.rt(this.node.id,this.handle);this.view.ja();this.view.Pa(this.jf||new Hd(this.view));return!0};return c}();function Jd(){this.y=this.x=0}
var Kd=function(c){function a(a,d,e){var b=c.call(this)||this;b.sa=a;b.$k=d;b.origin=e;a=b.sa.apply(d.x,d.y);b.x=a.x;b.y=a.y;return b}p(a,c);a.prototype.$g=function(a){var b=1,c=1,f=this.sa.inverse(),g=f.apply(this.x+a.x,this.y+a.y);a=new E(this.$k.x-this.origin.x,this.$k.y-this.origin.y);g=new E(g.x-this.origin.x,g.y-this.origin.y);g=(g.x*a.x+g.y*a.y)/(a.x*a.x+a.y*a.y);0!==a.x&&0!==a.y?c=b=g:0!==a.x?b=g:c=g;return this.sa.multiply(new O(b,c,this.origin.x,this.origin.y)).multiply(f)};return a}(Jd),
Ld=function(c){function a(a,d,e,f){var b=c.call(this)||this;b.sa=a;b.$k=d;b.$h=f;b.log=B.create("RotationSelHandle");b.origin=b.sa.apply(e.x,e.y);a=b.sa.apply(d.x,d.y);b.x=a.x;b.y=a.y;b.au=Math.atan2(b.y-b.origin.y,b.x-b.origin.x);b.$h=f;return b}p(a,c);a.prototype.$g=function(a){a=Math.atan2(this.y+a.y-this.origin.y,this.x+a.x-this.origin.x)-this.au;if(this.$h){var b=Math.PI/16;a=Math.floor(a/b)*b}return new zc(-a,this.origin.x,this.origin.y)};return a}(Jd),Md=function(c){function a(a){var b=c.call(this)||
this;b.sa=a;return b}p(a,c);a.prototype.$g=function(a){return new L(a.x,a.y)};return a}(Jd),Nd=function(c){function a(){return null!==c&&c.apply(this,arguments)||this}p(a,c);a.prototype.$g=function(){return new M};return a}(Jd);function Od(c){for(var a=[],b=0;b<c.length;b++)a.push(c[b].id);return a}
var Qd=function(){function c(a,b,d,c,f,g){this.view=a;this.handle=b;this.gu=d;this.sh=new K(0,0,0,0);this.ra=[];this.je=[];this.td=new E(0,0);this.log=B.create("TransformSelectionBehaviour");this.view.$o(this.handle instanceof Ld);this.On=!1;this.Fa=0;this.Sa(c,f,g)}c.prototype.wb=function(a){var b;if(this.On||"touchmove"!==a.type&&"touchstart"!==a.type&&"touchend"!==a.type)return!1;for(b=0;b<a.touches.length;){b=a.touches[b];b=this.view.eb(b.pageX,b.pageY);"touchmove"===a.type&&this.Ta(b.x,b.y,a);
break}for(b=0;b<a.changedTouches.length;){b=a.changedTouches[b];b=this.view.eb(b.pageX,b.pageY);"touchend"===a.type&&this.Za(b.x,b.y,a);break}return!0};c.prototype.Ya=function(a){if("gesturestart"!==a.type&&"gesturechange"!==a.type&&"gestureend"!==a.type)return!1;this.log("%s scale=%s rotation=%s",a.type,a.scale,a.rotation);this.On=!0;var b=this.sh.x+this.sh.width/2,d=this.sh.y+this.sh.height/2,c=a.scale;this.view.th||(c=1);var f=-a.rotation/180*Math.PI;if(0<this.view.da.get("snap")){var g=Math.PI/
16;f=Math.floor(f/g)*g}c=new O(c,c,b,d);b=new zc(f,b,d);b=c.multiply(b);for(d=0;d<this.ra.length;d++)this.ra[d].qg(b.multiply(this.je[d])),this.ra[d].format(this.view.ka,this.view.request);this.view.Ll(b);this.view.ja();if("gestureend"===a.type){for(d=0;d<this.ra.length;d++)this.ra[d].qg(this.je[d]);this.view.ta([new Pd(Od(this.ra),b)]);this.mn()}return!0};c.prototype.Sa=function(a,b){this.ra=this.view.Vf();this.Tq(this.ra);this.td=this.view.Fa(new E(a,b),this.Fa);this.log("onMouseDown(%s,%s)",this.td.x,
this.td.y);this.sh=new K(this.view.bd.x,this.view.bd.y,this.view.bd.width,this.view.bd.height);return!0};c.prototype.Tq=function(a){this.je=[];for(var b=0;b<a.length;b++)this.je.push(a[b].Ga()),this.Fa=this.Fa||a[b].la("snap")};c.prototype.Ta=function(a,b){var d=this;var c=this.view.Fa(new E(a,b),this.Fa);var f=c.x;var g=c.y;var h=this.handle.$g(new E(c.x-this.td.x,c.y-this.td.y));h=this.yo(h,a,b);for(var k=0;k<this.ra.length;k++)c=h.multiply(this.je[k]),this.ra[k].qg(c),this.ra[k].format(this.view.ka,
this.view.request);this.view.Ll(h);this.view.ja(function(){if(d.handle instanceof Ld){var a=d.view.ka;a.save();a.beginPath();a.strokeStyle="#0050B7";a.lineWidth=1/d.view.scale;a.moveTo(d.handle.origin.x,d.handle.origin.y);a.lineTo(f,g);a.stroke();a.restore()}});return!0};c.prototype.Za=function(a,b){var d=a,c=b,f=this.view.Fa(new E(a,b),this.Fa);a=f.x;b=f.y;this.log("onMouseUp(%s,%s)",a,b);if(f.be(this.td))this.gu?(d=this.view.ha.gb(d,c,this.view.La))&&d.Yf()?(this.log("Didn't move, and has edit mode. Selecting node %s",
d.id),this.view.nb(),this.view.rf(d)):this.log("Didn't move, but node has no edit mode or failed hittest"):this.log("Didn't move, but toggleEditNode=false");else{this.log("Moved by %s,%s",a-this.td.x,b-this.td.y);f=this.handle.$g(new E(f.x-this.td.x,f.y-this.td.y));f=this.yo(f,d,c);for(d=0;d<this.ra.length;d++)this.ra[d].qg(this.je[d]);this.view.ta([new Pd(Od(this.ra),f)])}this.mn();return!0};c.prototype.mn=function(){this.view.Ll(new M);this.view.$o(!0);this.view.Kf();this.view.update(!0);this.view.Wa()};
c.prototype.Ts=function(a){a=a.split(/\s+/);for(var b,d={Vi:"bottom",qh:"inside",Qf:0},c=0;c<a.length;c++)switch(b=a[c],b){case "left":case "top":case "right":case "bottom":case "hcentre":case "vcentre":d.Vi=b;break;case "hcenter":d.Vi="hcentre";break;case "vcenter":d.Vi="vcentre";break;case "inside":case "outside":case "middle":d.qh=b;break;default:if(b=parseFloat(b))d.Qf=b}return d};c.prototype.yo=function(a,b,d){if(1<this.ra.length||!a.Zn())return a;var c=this.ra[0].la("wallAffinity");if(!c)return a;
var f=this.view.ha.gb(b,d,this.view.La,"WallNode");if(null===f)return a;var g=f.md(b,d,this.view.scale);if("middle"!==f.fe(g))return a;var h=this.Ts(c);a=f.vr(g);var k=this.je[0].Zg();this.log("Scale=%s",k);var l=this.ra[0].fb.clone();c=new M;c=(new O(k.x,k.y,0,0)).multiply(c);l.width*=k.x;l.height*=k.y;switch(h.Vi){case "left":c=(new zc(-Math.PI/2,0,0)).multiply(c);c=(new L(l.width/2,0)).multiply(c);break;default:case "top":c=(new L(-l.width/2,0)).multiply(c);break;case "right":c=(new zc(Math.PI/
2,0,0)).multiply(c);c=(new L(-l.height/2,l.width)).multiply(c);break;case "bottom":c=(new zc(Math.PI,0,0)).multiply(c);c=(new L(l.width/2,l.height)).multiply(c);break;case "hcentre":c=(new L(-l.width/2,-l.height/2)).multiply(c);break;case "vcentre":c=(new L(-l.width/2,-l.height/2)).multiply(c),c=(new zc(-Math.PI/2,0,0)).multiply(c)}k="outside"===h.qh;"inside"===h.qh||k?(k=f.xk(g,"inside",h.Qf,b,d),f=f.xk(g,"outside",h.Qf,b,d),f.Oa(new E(b,d))<k.Oa(new E(b,d))||"outside"===h.qh?(c=(new zc(Math.PI,
0,0)).multiply(c),b=f):b=k):b=f.xk(g,h.qh,h.Qf,b,d);c=(new zc(-a,0,0)).multiply(c);c=(new L(b.x,b.y)).multiply(c);return c.multiply(this.je[0].inverse())};return c}();var Sd=function(){function c(a,b){this.view=a;this.aa=b;this.mi=!1;this.Ba=this.ae=this.na=null;this.fillStyle="#000000";this.ik=!1;this.Gl="normal";this.log=B.create("Text");this.multiline=a.da.get("multilineText");this.tb=document.createElement("div");a.da.get("iPadNoScrollText")&&null!==navigator.userAgent.match(/iPad|iPhone|Android/i)&&(this.Gl="top")}c.prototype.tc=function(){this.log("Entering text mode");this.view.canvas.style.cursor="text"};c.prototype.Ic=function(){this.mi&&this.ci();this.view.canvas.style.cursor=
"default";this.log("Leaving text mode");this.na&&this.na.parentNode&&(this.na.parentNode.removeChild(this.na),this.na=null);this.tb.parentNode&&this.tb.parentNode.removeChild(this.tb)};c.prototype.wb=function(a){if("touchstart"!==a.type&&"touchend"!==a.type&&"touchmove"!==a.type)return!1;for(var b=0;b<a.touches.length;b++){var d=a.touches[b];d=this.view.eb(d.pageX,d.pageY);"touchstart"===a.type&&this.Sa(d.x,d.y,a)}return!1};c.prototype.Sa=function(a,b,d){this.log("onMouseDown(%s)",d.type);this.mi?
(this.log("Editing somewhere else on mousedown; submit that first."),this.ci(),this.view.da.get("autoPickToolText")&&this.view.Wa()):(d=this.view.ha.gb(a,b,this.view.La),this.Dl(d,a,b));this.log("Eating click");this.view.li=!0;return!1};c.prototype.Sq=function(){if(this.tb&&this.na){this.tb.style.fontSize=this.na.style.fontSize;this.tb.style.fontFamily=this.na.style.fontFamily;this.tb.style.fontWeight=this.na.style.fontWeight;this.tb.style.fontStyle=this.na.style.fontStyle;this.tb.style.whiteSpace=
"pre-line";this.tb.style.position="absolute";this.tb.style.visibility="hidden";this.tb.style.backgroundColor="rgba(0,0,0,0.2)";document.body.appendChild(this.tb);this.tb.style.left="0";for(this.tb.style.top="0";this.tb.firstChild;)this.tb.removeChild(this.tb.firstChild);this.tb.appendChild(document.createTextNode(this.na.value));var a=C(this.tb).width(),b=C(this.na).width();b<a&&(b=a,this.view.da.get("multilineText")&&b>500*this.view.scale&&(b=500*this.view.scale),C(this.na).width(b+2))}};c.prototype.Dl=
function(a,b,d){function c(){n.na&&(n.log("Set editBox height to %s",""+n.na.scrollHeight+"px"),n.na.style.height=""+n.na.scrollHeight+"px",n.na.style.width=""+n.na.scrollWidth+"px");q=null}var f=0;this.ik=!1;if(a&&"TextNode"===a.type()||a&&"PathNode"===a.type()&&this.view.da.get("allowTextInShape")){this.Ba=a;"top"!==this.Gl&&"TextNode"===a.type()&&this.Ba.se(!0);this.view.ja();this.ae=new E(a.rect.x,a.rect.y);var g=a.la("fontName");var h=a.la("fontSize");var k=a.la("bold");var l=a.la("italic");
var m=a.la("textDecoration");f=a.rect.width*this.view.scale;f=Math.max(f,200);this.fillStyle=a.la("fillStyle")}else this.Ba=null,this.ae=new E(b,d),g=this.Pb("fontName"),h=this.Pb("fontSize"),k=this.Pb("bold"),l=this.Pb("italic"),m=this.Pb("textDecoration"),this.fillStyle=this.aa.fillStyle||this.Pb("textFillStyle")||this.Pb("fillStyle");var n=this;this.na=document.createElement("textarea");a=C(this.na).height();this.na.style.width=f?""+f+"px":"auto";f=this.view.$j(this.ae.x,this.ae.y);this.na.style.position=
"absolute";this.na.style.fontFamily=g;this.na.style.fontSize=""+h*this.view.scale+"px";this.na.style.overflow="auto";this.na.style.fontWeight=k?"bold":"normal";this.na.style.fontStyle=l?"italic":"normal";this.na.style.padding="0";this.na.style.border="1px solid #888";this.na.style.color=this.fillStyle;this.na.style.backgroundColor=this.Pb("background");this.na.style.textDecoration=m||"none";this.na.style.zIndex=""+(this.view.Xf()+1);this.log("Using z-index %s",this.na.style.zIndex);this.log("FillStyle=%s",
A.Xb(this.fillStyle).toString());"#ffffff"===A.Xb(this.fillStyle).toString()&&(this.na.style.backgroundColor="#808080");g=C(this.view.canvas.parentNode);h=g.offset();l=k=0;"top"===this.Gl?(l=C(this.view.canvas).offset(),k=C(this.view.canvas).width(),f=C(this.na).width(),k=l.left+k/2-f/2,l=l.top):(k=Math.round(f.x)-1,l=Math.round(f.y)-1);this.na.style.WebkitTransitionDuration="0";this.na.style.MozTransitionDuration="0";this.na.style.msTransitionDuration="0";this.na.style.OTransitionDuration="0";this.na.style.transitionDuration=
"0";this.na.style.left=k-h.left+"px";this.na.style.top=l-h.top+"px";g[0].appendChild(this.na);lc(C(this.na));this.mi=!0;this.ae=new E(b,d+a);this.Ba&&(this.na.value=this.Ba.la("text"));var q=null;q=setTimeout(c,0);C(this.na).bind("keydown",function(a){"keydown"===a.type&&(27===a.keyCode&&n.multiline||13===a.keyCode&&(a.shiftKey||!n.multiline)?(n.log("Enter pressed. create text."),n.ci(),n.view.Ea.xb&&n.view.Yo(a),n.view.Wb.Pe("goto-canvas"),n.view.da.get("autoPickToolText")&&n.view.Wa()):27===a.keyCode?
(n.log("ESC pressed; cancel."),n.cancel(),n.view.Wa(),n.view.Wb.ua("goto-toolbar")):13===a.keyCode&&(q||(q=setTimeout(c,0))))});C(this.na).bind("input propertychange",function(){null===n.Ba&&n.Sq()});this.view.da.get("leaveTextToolOnBlur")&&(C(this.na).bind("focus",function(){n.log("Text focus received.")}),C(this.na).bind("blur",function(){n.na&&!n.na.fl&&(n.log("Text blur received -- removing=%s",!0===n.na.fl),n.na.fl=!0,n.ci())}));setTimeout(function(){n.na&&n.na.focus()},200);this.na.focus();
this.view.wa.ua("edit-text-shown",n.na)};c.prototype.cancel=function(){this.na&&(this.na.fl=!0,this.na.parentNode&&this.na.parentNode.removeChild(this.na),this.view.wa.ua("edit-text-hidden"));this.na=null;this.mi=!1;this.Ba&&(this.Ba.se(!1),this.view.ja())};c.prototype.Pb=function(a){return a in this.aa?this.aa[a]:"background"===a?this.view.da.get("defaultTextBackground"):this.view.ya[a]};c.prototype.ci=function(){if(this.na){var a=this.na.value;this.cancel();if(this.Ba&&this.Ba.la("text")===a&&!this.ik)this.log("Text was not changed.");
else if(null===this.Ba&&""===a)this.log("No text entered.");else if(this.Ba)this.log("Update text in node %s",this.Ba.id),a=[new Rd([this.Ba.id],"text",a),new Rd([this.Ba.id],"textFillStyle",this.fillStyle)],"bold"in this.aa&&a.push(new Rd([this.Ba.id],"bold",this.aa.bold)),"italic"in this.aa&&a.push(new Rd([this.Ba.id],"italic",this.aa.bold)),this.view.ta(a);else if(this.ae){this.log("Create new text node.");var b=this.view.ha.lb,d=0,c=this.Pb("fontSize");this.view.da.get("multilineText")||(d=c);
d=new L(this.ae.x,this.ae.y+d);this.view.ta([new V(this.view.ha.Va(),"TextNode",C.extend({text:a,background:this.Pb("background"),fontSize:c,fontName:this.Pb("fontName"),bold:this.Pb("bold"),italic:this.Pb("italic"),textFillStyle:this.Pb("textFillStyle"),strokeStyle:this.Pb("textStrokeStyle"),lineWidth:this.Pb("textLineWidth"),layer:this.aa.layer||this.view.La,wrap:this.view.da.get("multilineText")},this.aa)),new Pd([b],d)])}}};c.prototype.Ta=function(){return!1};c.prototype.Zb=function(a){this.log("keyboard: %s",
a);"cancel"===a&&null===this.na&&(this.view.Wa(),this.view.Wb.ua("goto-toolbar"))};c.prototype.nd=function(a){this.log("Set text colour to %s",a);this.ik=!0;this.fillStyle=a;this.aa.textFillStyle=a;this.na&&(this.na.style.color=a,"#ffffff"===A.Xb(a).toString()?this.na.style.backgroundColor="#808080":this.na.style.backgroundColor="#ffffff")};c.prototype.od=function(a,b){this.view.ul(a,b)};c.prototype.ne=function(a,b){if("defaultBold"===a)a="bold",this.na&&(this.na.style.fontWeight=b?"bold":"normal");
else if("defaultItalic"===a)a="italic",this.na&&(this.na.style.fontStyle=b?"italic":"normal");else if("defaultTextBackground"===a)a="background",this.na&&(this.na.style.backgroundColor=b);else return;this.log("Update %s=%s",a,b);this.aa[a]=b};c.prototype.Xc=function(){return"text"};c.prototype.we=function(a,b){this.aa[a]=b};return c}();var Hd=function(){function c(a){this.view=a;this.Io=1;this.log=B.create("DefaultBehaviour");this.view.te("");if(this.wd=this.view.da.wd())this.Io=2;this.ac=new Rc(a)}c.prototype.tc=function(){this.log("Entering pick tool.");this.view.canvas.style.cursor="default"};c.prototype.Ic=function(){this.log("Leaving pick tool.")};c.prototype.wb=function(a){if("touchmove"!==a.type&&"touchstart"!==a.type&&"touchend"!==a.type)return!1;for(var b=0;b<a.touches.length;b++){var d=a.touches[b];d=this.view.eb(d.pageX,
d.pageY);if("touchstart"===a.type)return this.Yr(d.x,d.y,a);if("touchend"===a.type)return this.Za(d.x,d.y,a)}return!1};c.prototype.Ya=function(a){return this.ac.Ya(a)};c.prototype.Yr=function(a,b,d){return this.Sa(a,b,d)};c.prototype.Sa=function(a,b,d){var c,f;this.log("onMouseDown");if(this.view.da.get("readOnly"))return(c=this.view.ha.gb(a,b,this.view.La))?(this.log("layer=%s active=%s",c.Bd(),this.view.La),this.view.wa.ua("node-clicked",c.id,a,b)):this.log("readOnly mode: Ignoring click."),!1;
if(f=this.view.yr(a,b))return this.view.Pa(new Qd(this.view,f,!1,a,b,d)),!0;this.view.selection.length&&this.view.es(d)&&this.view.Og();if(this.view.Ba&&(c=this.view.Ba,f=c.md(a,b,1/this.view.scale*this.Io),null!==f))return this.view.Pa(new Id(this.view,c,f,a,b,this,d)),!0;if(c=this.view.ha.gb(a,b,this.view.La))this.log("layer=%s active=%s",c.Bd(),this.view.La),this.view.wa.ua("node-clicked",c.id,a,b);if(c&&c.Bd()===this.view.La){var g=c===this.view.Ba,h=this.view.cs(c);this.log("wasEditNode: %s, wasSelected: %s",
g,h);if("WallNode"===c.type()&&1<c.Hb.length&&(f=c.md(a,b,1/this.view.scale),null!==f))return this.view.Pa(new Id(this.view,c,f,a,b,this,d)),!0;h||(d.shiftKey||this.view.nb(),this.view.Ge(c),this.view.Nb());this.view.Pa(new Qd(this.view,this.view.og?new Md(c.Ga()):new Nd,!g&&h,a,b,d))}else if(this.view.Ys(a,b))this.view.Pa(new Qd(this.view,this.view.og?new Md(this.view.selection[0].Ga()):new Nd,!0,a,b,d));else if(this.view.da.gr())this.view.rf(null),this.view.Pa(new Oc(this.view,this,a,b));else return this.log("Disabled select box -- mobile touch active."),
this.view.rf(null),this.view.nb(),this.view.Nb(),this.view.ja(),!1;return!0};c.prototype.Za=function(){this.log("onMouseUp");return!1};c.prototype.Zb=function(a,b){this.log("keyboard: %s",a);var d=!0,c=this.view.da.get("nudge");b&&b.ctrlKey&&(c=this.view.da.get("preciseNudge"));switch(a){case "bring-to-front":this.view.Fg();break;case "send-to-back":this.view.uh();break;case "left":this.view.Gi(-1,0,c)||(this.view.yb=Math.min(this.view.yb+16,0),this.view.ic(),this.view.ja());break;case "right":this.view.Gi(1,
0,c)||(c=this.view.jc.width,this.view.yb=Math.max(-(c*this.view.scale-c),this.view.yb-16),this.view.ic(),this.view.ja());break;case "up":this.view.Gi(0,-1,c)||(this.view.ib=Math.min(this.view.ib+16,0),this.view.ic(),this.view.ja());break;case "down":this.view.Gi(0,1,c)||(c=this.view.jc.height,this.view.ib=Math.max(-(c*this.view.scale-c),this.view.ib-16),this.view.ic(),this.view.ja());break;case "select-none":this.view.nb();this.view.Nb();this.view.ja();this.view.Ea.xb&&this.view.Wb.ua("goto-toolbar");
break;case "select-all":var f=[];this.view.ha.Rf(function(a){f.push(a)});this.view.selectNodes(f);this.view.ja();this.view.Ea.xb&&this.view.Wb.ua("goto-toolbar");break;case "duplicate":this.view.duplicate();break;case "move-up":this.view.Di();break;case "move-down":this.view.Ci();break;case "delete":this.view.Og();break;case "curve-tool":this.view.Uj({});break;case "line-tool":this.view.Ik({},!1,!1);break;case "group":this.view.group();break;case "ungroup":this.view.Gh();break;case "undo":this.view.jb();
break;case "redo":this.view.Kd();break;case "cut":this.view.Xj();break;case "copy":this.view.Vd();break;case "paste":this.view.hg();break;case "zoom-normal":this.view.da.get("allowZoom")?(c=this.view.ee(),this.view.scale=1,this.view.yb=-c.x,this.view.ib=-c.y,this.view.ic(),this.view.ja()):this.log("Zooming is disabled.");break;case "zoom-in":this.view.da.get("allowZoom")?this.view.lj():this.log("Zooming is disabled.");break;case "zoom-out":this.view.da.get("allowZoom")?this.view.mj():this.log("Zooming is disabled.");
break;default:d=!1}d&&(b.preventDefault(),b.stopPropagation())};c.prototype.nd=function(a,b){if(b){this.view.Db=a;this.view.Vb=a;var d="fillStyle"}else this.view.Mb=a,d="strokeStyle";this.view.setProperty(d,a)};c.prototype.od=function(a,b){b?(this.view.Db=hc(this.view.Db,a),this.view.Vb=hc(this.view.Vb,a)):this.view.Mb=hc(this.view.Mb,a);this.view.ul(a,b)};c.prototype.Hd=function(a,b){this.log("onDoubleClick");var d=this.view.ha.gb(a,b,this.view.La);this.log("hittest: %s, hasText: %s",null!==d,null!==
d&&d.xi());this.view.wa.ua("double-click",a,b,d?d.id:null);if(d&&"PathNode"===d.type()&&!this.view.da.get("allowTextInShape"))this.log("Editing text in shape is disabled.");else if(d&&d.xi())this.log("Text double-clicked."),this.view.bj({}),this.view.oa instanceof Sd&&this.view.oa.Dl(d,a,b);else return!1;return!0};c.prototype.Xc=function(){return"pick"};return c}();var Td=function(){function c(a,b,d,c){this.view=a;this.jf=b;this.options=d;this.mode=c;this.Ma=!1;this.Rb=[];this.Fh={};this.from=this.Re=null;this.log=B.create("Brush");this.ac=new Rc(this.view);this.view.nb(!0)}c.prototype.oe=function(){this.Kk(this.options.lineWidth/2)};c.prototype.tc=function(){this.view.canvas.style.cursor="crosshair";this.Kk(this.options.lineWidth/2);C(window).xa("resize",this.oe)};c.prototype.Ic=function(){this.view.canvas.style.cursor="default";this.view.ja();C(window).yg("resize",
this.oe)};c.prototype.reset=function(){this.Ma=!1;this.Rb=[];this.Fh={}};c.prototype.Ya=function(a){a=this.ac.Ya(a);this.Ma&&this.ac.active&&this.reset();return a};c.prototype.Kk=function(a){var b=document.createElement("canvas");a*=window.devicePixelRatio||1;a*=this.view.scale;a=Math.ceil(a+1);b.width=2*a+2;b.height=2*a+2;var d=b.getContext("2d");d.beginPath();"round"===(this.options.lineCap||"round")?d.arc(a+1,a+1,a,0,2*Math.PI):d.rect(1,1,2*a-2,2*a-2);d.lineWidth=2;d.strokeStyle="#ffffff";d.stroke();
d.lineWidth=1;d.strokeStyle="#000000";d.stroke();b=b.toDataURL();this.view.canvas.style.cursor="url("+b+") "+(a+1)+" "+(a+1)+", auto"};c.prototype.vh=function(a){this.options.strokeStyle=a};c.prototype.pl=function(a){this.options.lineWidth=a;this.Kk(a/2)};c.prototype.wb=function(a){var b;if(this.ac.active)return!0;if("touchstart"===a.type){var d=a.changedTouches;var c=0;for(b=d.length;c<b;c++){var f=d[c];a=this.view.eb(f.pageX,f.pageY,!0);this.Rb.push([a]);f.identifier&&(this.Fh[f.identifier]=this.Rb[this.Rb.length-
1])}this.Ma=!0;1===this.Rb.length&&(this.Re=this.view.Mk())}else if("touchmove"===a.type){var g=a.changedTouches;b=0;for(d=g.length;b<d;b++)f=g[b],a=this.view.eb(f.pageX,f.pageY,!0),f.identifier?f.identifier in this.Fh?c=this.Fh[f.identifier]:(c=[a],this.Rb.push(c),this.Fh[f.identifier]=c):c=this.Vq(a),c?a.x===c[c.length-1].x&&a.y===c[c.length-1].y||c.push(a):this.log("WARNING: Can't find path for touch!");!1===this.Ma&&(this.Re=this.view.Mk(),this.Ma=!0);this.Re?this.Re.ja(this.ph,this):this.view.ja()}else"touchend"===
a.type&&this.Ma&&0===a.touches.length&&(this.ta(),this.Ma=!1);return!0};c.prototype.Vq=function(a){var b=0,d;var c=null;for(d=0;d<this.Rb.length;d++){var f=this.Rb[d],g=f[f.length-1].Oa(a);if(null===c||g<b)c=f,b=g}c||(c=[a],this.Rb.push(c));return c};c.prototype.Sa=function(a,b){var d=new E(a,b);this.Ma=!0;this.Rb.push([d]);1===this.Rb.length&&(this.Re=this.view.Mk());return!0};c.prototype.ph=function(a){var b,d,c,f=this.view.Wm();a.lineCap=this.options.lineCap||"round";a.lineJoin="round"===a.lineCap?
"round":"bevel";a.lineWidth=this.options.lineWidth;var g=a.globalAlpha;"opacity"in this.options&&(a.globalAlpha=this.options.opacity);a.beginPath();var h=this.Rb;var k=0;for(d=h.length;k<d;k++){var l=h[k];a.moveTo(l[0].x,l[0].y);var m=b=1;for(c=l.length-1;b<=c;m=b+=1)m=l[m],a.lineTo(m.x,m.y)}nc(a,this.options.strokeStyle);f&&a.restore();a.globalAlpha=g};c.prototype.Ta=function(a,b){var d=new E(a,b);this.Ma&&(this.from=this.Rb[0][this.Rb[0].length-1],d.x!==this.from.x||d.y!==this.from.y)&&(this.Rb[0].push(d),
this.Re?this.Re.ja(this.ph,this):this.view.ja());return!0};c.prototype.Za=function(a,b,d){this.Ta(a,b,d);this.Ma=!1;this.ta();return!0};c.prototype.ta=function(){var a,b,d,c;var f=[];var g=this.Rb;var h=this.view.ha.lb;var k=0;for(d=g.length;k<d;k++){var l=g[k];if("brush"===this.mode){var m=[];1===l.length&&l.push(new E(l[0].x+.1,l[0].y+.1));if(1<l.length){var n=a=0;for(b=l.length-1;a<=b;n=a+=1)m.push(l[n].x),m.push(l[n].y);f.push(new V(this.view.ha.Va(),"BrushNode",C.extend({points:m,layer:this.view.La},
this.options)))}}else{if("shapebrush"===this.mode){l=Ic(l,20);b=l;if(!(2>b.length)){l=b[0];n=b[b.length-1];m=40>l.Oa(n);for(a=0;a<b.length;a++){var q=b[a];for(c=a+1;c<b.length;c++){var u=b[c];20>Math.abs(q.x-u.x)&&(u.x=q.x);20>Math.abs(q.y-u.y)&&(u.y=q.y)}}q=K.Be(b).Lf();for(a=0;a<b.length;a++)c=b[a],20>Math.abs(c.x-q.x)&&(c.x=q.x),20>Math.abs(c.y-q.y)&&(c.y=q.y);m&&(l.x=n.x,l.y=n.y)}l=b}else if("freehand"===this.mode)m=l,m=Ic(m,2),m=Kc(m,4),l=m=Ic(m,.5);else if("quadratic"===this.mode){l=Ic(l,10);
a=Qc(l);m=a.ba[1];n=a.ba[2];c=a.ba[4];b=a.ba[5];l=a.ba[8];a=a.ba[9];c=((3*c-m)/2+(3*c-l)/2)/2;b=((3*b-n)/2+(3*b-a)/2)/2;q=new P;q.moveTo(m,n);q.quadraticCurveTo(c,b,l,a);m=q;m=S.rp(m);f.push(new V(this.view.ha.Va(),"PathNode",C.extend({commands:m,fillStyle:this.view.Db,sloppiness:0,layer:this.view.La},this.options)));continue}1===l.length&&"freehand"===this.mode&&l.push(new E(l[0].x+.1,l[0].y+.1));if(1<l.length){m=new U;m.moveTo(l[0].x,l[0].y);a=l[0].be(l[l.length-1]);n=b=1;for(c=l.length-1;b<=c;n=
b+=1)m.lineTo(l[n].x,l[n].y);a&&m.close();f.push(new V(this.view.ha.Va(),"PathNode",C.extend({commands:m.ec(),fillStyle:this.view.Db,sloppiness:0,layer:this.view.La},this.options)))}}}this.view.ta(f);this.view.nb();k=this.view.ha.za(h,!1);f.length&&"quadratic"===this.mode?(k&&this.view.rf(k),this.view.Wa()):this.view.da.get("singleStrokeBrush")?(k&&this.view.Ge(k),this.view.Wa()):this.reset();this.view.Nb()};c.prototype.nd=function(a,b){this.options.strokeStyle=a;if(b){this.view.Db=a;this.view.Vb=
a;var d="fillStyle"}else this.view.Mb=a,d="strokeStyle";this.view.setProperty(d,a)};c.prototype.od=function(a){this.view.Vb=hc(this.view.Vb,a);this.options.strokeStyle=hc(this.options.strokeStyle,a);this.view.Db=this.view.Vb};c.prototype.Zb=function(a){this.log("keyboard: %s",a);"cancel"===a&&(this.log("ESC pressed. Abort brush and go back to toolbar."),this.view.Wa(),this.view.Wb.ua("goto-toolbar"))};c.prototype.ne=function(a,b){"defaultBrushWidth"===a?this.pl(b):"defaultBrushColour"===a&&this.vh(b)};
c.prototype.Xc=function(){return"circle"===this.mode?"ellipse":this.mode};return c}();var Ud=function(){function c(a,b,d,c,f,g){void 0===d&&(d="");void 0===c&&(c={});void 0===f&&(f=!1);void 0===g&&(g=!1);this.view=a;this.type=b;this.url=d;this.aa=c;this.Tt=f;this.$h=g;this.node=null;this.kk=new E(0,0);this.Hk=new E(0,0);this.index=0;this.state="start";this.log=B.create("DRAWLINES");"wrap"in this.aa||(this.aa.wrap=this.view.da.get("multilineText"));"fontSize"in this.aa||(this.aa.fontSize=this.view.da.get("defaultFontSize"));this.ac=new Rc(this.view);this.view.nb(!0)}c.prototype.tc=
function(){this.log("Entering DrawLinesBehaviour");this.view.canvas.style.cursor="crosshair";this.view.da.wd()||this.view.te("click-to-place-first-point-of-line");this.view.ja()};c.prototype.reset=function(){this.tc()};c.prototype.wb=function(a){if("touchstart"===a.type){var b=a.changedTouches[0];b=this.view.eb(b.pageX,b.pageY);return this.Sa(b.x,b.y,a)}return"touchmove"===a.type?(b=a.changedTouches[0],b=this.view.eb(b.pageX,b.pageY),this.Ta(b.x,b.y,a)):"touchend"===a.type?(b=a.changedTouches[0],
b=this.view.eb(b.pageX,b.pageY),this.Za(b.x,b.y,a)):!1};c.prototype.Ya=function(a){a=this.ac.Ya(a);this.ac.active&&this.node&&this.reset();return a};c.prototype.Zb=function(a){"cancel"===a&&(null!==this.node&&this.view.bs&&"curve"===this.type&&this.ta(),null!==this.node&&this.view.ha.removeNode(this.node),this.view.Ea.xb?this.view.Wb.ua("goto-toolbar"):this.view.Wa())};c.prototype.done=function(){this.view.da.get("autoPickTool")?(this.view.Wa(),this.view.Co()):this.state="start"};c.prototype.Km=function(a,
b){this.node instanceof S&&("curve"===this.type||"arrow"===this.type||"linear-bezier"===this.type?this.node.Ng(a,b):this.node.lineTo(a,b))};c.prototype.Sa=function(a,b){var d=this.view.Fa(new E(a,b));if("start"===this.state)if(this.kk=new E(a,b),"stampline"===this.type)this.node=R.create("StampLineNode",this.view.ha.Va(),this.view.ha),this.node.setProperty("x1",d.x),this.node.setProperty("y1",d.y),this.node.setProperty("x2",d.x),this.node.setProperty("y2",d.y),this.node.setProperty("url",this.url),
this.view.ha.Hf(this.node),this.view.te("click-to-set-the-end-of-the-line"),this.view.update(),this.index=3;else{this.node=new S(this.view.ha.Va(),this.view.ha);this.node.setProperty("seed",Math.round(65535*Math.random()));this.node.setProperty("strokeStyle",this.view.Mb);this.node.setProperty("lineWidth",this.view.ya.lineWidth);this.node.setProperty("sloppiness",this.view.ya.sloppiness);this.node.setProperty("smoothness",this.view.ya.smoothness);for(var c in this.aa)this.aa.hasOwnProperty(c)&&this.node.setProperty(c,
this.aa[c]);this.view.ha.Hf(this.node);"arrow"===this.type&&(this.node.setProperty("arrowSize",this.view.da.Ha("defaultArrowSize")),this.node.setProperty("arrowStyle",this.view.da.Ha("defaultArrowStyle")),this.node.setProperty("arrowXOffset",this.view.da.Ha("defaultArrowXOffset")));this.node.moveTo(d.x,d.y);this.Km(d.x,d.y);this.index=3;this.view.update();this.state="predrag"}else if("placing"===this.state)if("arrow"!==this.type&&8>this.kk.Oa(new E(a,b))&&3<this.index)this.log("Clicked close to start; automatically closing path"),
this.node instanceof S&&this.node.close(),this.ta(),this.done();else if(8>this.Hk.Oa(new E(a,b)))3<this.index?(this.node instanceof S&&this.node.mt(this.index),this.ta()):this.cancel(),this.done();else{if(this.Tt)return this.ta(),this.done(),!0;this.node&&(this.Km(d.x,d.y),this.index+=3,this.view.ha.ag(this.node.id),this.view.update())}else return this.log("Invalid state %s",this.state),!0;this.Hk=new E(d.x,d.y);return!0};c.prototype.Za=function(a,b){var d=new E(a,b);d=this.kk.Oa(d);this.log("onMouseUp (%s,%s) %s",
a,b,this.state);"predrag"===this.state&&(this.log("MovedBy: %s",d),10<d?(this.ta(),this.done()):(this.state="placing",this.view.te("click-to-place-another-point-or-double-click-to-end-the-line")));return!0};c.prototype.Ta=function(a,b,d){b=this.view.Fa(new E(a,b));a=b.x;b=b.y;if(d.ctrlKey||this.$h){d=this.Hk;var c=Math.atan2(b-d.y,a-d.x),f=Math.PI/8;c>=-f&&c<f?b=d.y:c>=f&&c<3*f?(a=Math.max(b-d.y,a-d.x),b=d.y+a,a=d.x+a):c>=3*f&&c<5*f?a=d.x:c>=5*f&&c<7*f?(a=Math.max(b-d.y,d.x-a),b=d.y+a,a=d.x-a):c>=
7*f||c<=7*-f?b=d.y:c<5*-f?(a=Math.max(d.y-b,d.x-a),b=d.y-a,a=d.x-a):c<3*-f?a=d.x:(a=Math.max(d.y-b,a-d.x),b=d.y-a,a=d.x+a)}this.node&&(this.node.ke(this.index,a,b),this.node.format(this.view.ka,this.view.request),this.view.ja());return!0};c.prototype.nc=function(){this.log("onMouseClick()");return!0};c.prototype.tq=function(a){for(var b=0,d=[],c,f,g,h,k,l;b<a.length;){var m=a[b];switch(m){case S.zf:g=a[b+1];h=a[b+2];d.push(m,g,h);break;case S.Qd:c=a[b+1],f=a[b+2],void 0!==g&&void 0!==h&&void 0!==
k&&void 0!==l&&d.push(S.zg,c,f,(k+g)/2,(l+h)/2,(g+c)/2,(h+f)/2),k=g,l=h,g=c,h=f}b+=S.$a[m]+1}return d};c.prototype.ta=function(){if(this.node){this.node instanceof S&&this.node.Xp();this.view.ha.removeNode(this.node);var a=this.view.da.Ha("defaultArrowSize"),b=this.node.la("commands");"linear-bezier"===this.type&&(b=this.tq(b));a={arrowSize:"arrow"===this.type?a:0,arrowStyle:this.view.da.Ha("defaultArrowStyle"),arrowXOffset:this.view.da.Ha("defaultArrowXOffset"),commands:b,seed:this.node.la("seed"),
fillStyle:this.view.Db,strokeStyle:this.view.Mb,lineWidth:this.view.ya.lineWidth,sloppiness:this.view.ya.sloppiness,smoothness:this.view.ya.smoothness,layer:this.view.La};for(var d in this.aa)this.aa.hasOwnProperty(d)&&(a[d]=this.aa[d]);this.view.ta([new V(this.view.ha.Va(),"PathNode",a)]);this.node=null}};c.prototype.cancel=function(){this.node&&(this.view.ha.removeNode(this.node),this.node=null)};c.prototype.Ic=function(){this.cancel();this.view.canvas.style.cursor="default";this.view.te("");this.view.ja()};
c.prototype.nd=function(a,b){if(b){this.view.Db=a;this.view.Vb=a;var d="fillStyle";this.log("We are drawing lines. Set strokeStyle instead of fillStyle")}else d="strokeStyle";this.view.Mb=a;this.view.setProperty(d,a)};c.prototype.od=function(a,b){b?(this.view.Db=hc(this.view.Db,a),this.view.Vb=hc(this.view.Vb,a)):this.view.Mb=hc(this.view.Mb,a);this.view.ul(a,b)};c.prototype.Xc=function(){return this.type};c.prototype.we=function(a,b){this.aa[a]=b};return c}();var Vd=function(){function c(a,b,d,c,f,g,h){var e=this;this.view=a;this.nodeType=b;this.aa=d;this.width=c;this.height=f;this.Jo=g;this.iu=h;this.state="initial";this.start=new E(0,0);this.end=new E(0,0);this.node=null;this.log=B.create("DrawShape");"rectangle-tl"===g&&(this.dn=function(a){a.lineWidth=1/e.view.scale;a.strokeStyle="#ccc";a.beginPath();a.rect(e.start.x,e.start.y,e.end.x-e.start.x,e.end.y-e.start.y);a.stroke()});this.ac=new Rc(this.view);this.view.nb(!0)}c.prototype.dn=function(){};c.prototype.tc=
function(){this.log("Entering DrawShapeBehaviour");this.view.canvas.style.cursor="crosshair"};c.prototype.Ic=function(){this.log("Leaving DrawShapeBehaviour");this.cancel()};c.prototype.cancel=function(){this.node&&(this.view.ha.removeNode(this.node),this.view.update(),this.node=null);this.state="initial"};c.prototype.Ya=function(a){a=this.ac.Ya(a);this.node&&this.ac.active&&(this.view.ha.removeNode(this.node),this.node=null,this.state="initial");return a};c.prototype.Zb=function(a){"cancel"===a&&
this.view.Wa()};c.prototype.wb=function(a){if("touchstart"===a.type){var b=a.changedTouches[0];b=this.view.eb(b.pageX,b.pageY);return this.Sa(b.x,b.y)}return"touchmove"===a.type?(b=a.changedTouches[0],b=this.view.eb(b.pageX,b.pageY),this.Ta(b.x,b.y,a)):"touchend"===a.type?(b=a.changedTouches[0],b=this.view.eb(b.pageX,b.pageY),this.Za(b.x,b.y,a)):!1};c.prototype.Sa=function(a,b){"initial"===this.state&&(this.start=this.view.Fa(new E(a,b)),this.state="predraw",this.log("initial -> predraw"));return!0};
c.prototype.Ta=function(a,b,d){a=this.view.Fa(new E(a,b));d=d.ctrlKey;"predraw"===this.state&&10<this.start.Oa(a)&&(this.create(),this.state="drawing",this.log("predraw -> drawing"));"drawing"===this.state&&(this.transform(this.start,a,d),this.end=a,this.view.update(!1,this.dn));return!0};c.prototype.Za=function(a,b,d){"predraw"===this.state?this.view.da.get("clickToDrawShapes")?(this.create(),this.transform(this.start,null,d.ctrlKey),this.ta(),this.view.da.get("autoPickTool")&&this.view.Wa(),this.state=
"initial"):this.cancel():"drawing"===this.state&&(this.transform(this.start,this.view.Fa(new E(a,b)),d.ctrlKey),this.ta(),this.view.da.get("autoPickTool")&&this.view.Wa(),this.state="initial");return!0};c.prototype.create=function(){if(this.node=R.create(this.nodeType,this.view.ha.Va(),this.view.ha))this.node.Cb(this.aa),this.view.ha.Hf(this.node)};c.prototype.transform=function(a,b,d){if(b)if("circle"===this.Jo){var c=a;a=a.Oa(b);var f=2*a/this.width;a=2*a/this.height}else{if("rectangle-tl"===this.Jo)a=
a.clone(),b=b.clone(),a.x>b.x&&(f=a.x,a.x=b.x,b.x=f),a.y>b.y&&(f=a.y,a.y=b.y,b.y=f),c=a;else if(f=[a,b],0===f.length)c=new E(0,0);else{c=f[0].x;for(var g=f[0].y,h=1;h<f.length;h++)c+=f[h].x,g+=f[h].y;c=new E(c/f.length,g/f.length)}f=(b.x-a.x)/this.width;a=(b.y-a.y)/this.height}else c=a,a=f=1;d&&(a=f=Math.min(f,a));d=new L(c.x,c.y);d=d.multiply(new O(f,a));this.node&&(this.node.qg(d),this.view.ha.ag(this.node.id))};c.prototype.ta=function(){this.node&&(this.aa.matrix=this.node.Ga(),this.view.ha.removeNode(this.node),
this.node=null,this.view.ta([new V(this.view.ha.Va(),this.nodeType,this.aa)]))};c.prototype.pl=function(a){this.aa.lineWidth=a};c.prototype.nd=function(a,b){Hd.prototype.nd.call(this,a,b);this.aa[b?"fillStyle":"strokeStyle"]=a};c.prototype.od=function(a,b){Hd.prototype.od.call(this,a,b);var d=b?"fillStyle":"strokeStyle",c=hc(this.aa[d],a);this.log("oldColour=%s+opacity %s = %s",this.aa[d],a,c);this.aa[d]=c};c.prototype.Xc=function(){return this.iu};c.prototype.we=function(a,b){this.aa[a]=b};c.prototype.ne=
function(a,b){"defaultLineWidth"===a&&this.pl(b)};return c}();var Wd=function(){function c(a,b){this.view=a;this.aa=b;this.ba=[];this.node=null;this.log=B.create("Wall");this.Fa=b.snap||0}c.prototype.Xc=function(){return"wall"};c.prototype.Zb=function(a){this.log("keyboard: %s",a);"cancel"===a&&(this.log("ESC pressed. Abort wall and go back to toolbar."),this.view.Wa(),this.view.Wb.ua("goto-toolbar"))};c.prototype.tc=function(){this.log("Enter DrawWallBehaviour");this.view.canvas.style.cursor="crosshair"};c.prototype.Ic=function(){this.log("Leaving DrawWallBehaviour");
this.reset()};c.prototype.Sa=function(a,b,d){var c=this.view.Fa(new E(a,b),this.Fa);if(this.node){if(this.view.ds(d))return this.ta(!1),!0;d=new E(this.ba[this.ba.length-4],this.ba[this.ba.length-3]);this.log("Last point=%s new point=%s distance=%s",d,new E(a,b),d.Oa(new E(a,b)));if(10<d.Oa(new E(a,b))){if(10>c.Oa(new E(this.ba[1],this.ba[2])))return this.ba.push("Z"),this.log("Closed path!"),this.ta(!0),!0;this.ba.push(a,b);this.node.setProperty("svgpath",this.ba.join(" "));this.view.ha.ag(this.node.id)}}else this.ba=
["M",c.x,c.y,c.x,c.y],this.node=R.create("WallNode",this.view.ha.lb,this.view.ha),this.node.Cb(this.aa),this.node.setProperty("svgpath",this.ba.join(" ")),this.view.ha.Hf(this.node),this.view.yl(!0),this.view.te("click-to-place-another-point-or-double-click-to-end-the-line");this.view.update();return!0};c.prototype.Ta=function(a,b){var d=this.view.Fa(new E(a,b),this.Fa);return this.node?(this.ba[this.ba.length-2]=d.x,this.ba[this.ba.length-1]=d.y,this.node.setProperty("svgpath",this.ba.join(" ")),
this.view.ha.ag(this.node.id),this.view.update(),!0):!1};c.prototype.Za=function(a,b){var d=this.view.Fa(new E(a,b),this.Fa);if(this.node){var c=new E(this.ba[this.ba.length-4],this.ba[this.ba.length-3]);this.log("Last point=%s new point=%s distance=%s",c,new E(a,b),c.Oa(new E(a,b)));10<c.Oa(d)&&(this.ba.push(d.x,d.y),this.ta(!1));return!0}return!1};c.prototype.Hd=function(){this.ta(!1);return!0};c.prototype.ta=function(a){this.node&&(this.log("Commit()"),this.view.ha.removeNode(this.node),this.node=
null,this.ba.length-=2,3<this.ba.length&&(a&&this.ba.push("Z"),this.aa.svgpath=this.ba.join(" "),this.view.ta([new V(this.view.ha.Va(),"WallNode",this.aa)]),this.view.nb()),this.view.yl(!1),this.view.te(""))};c.prototype.reset=function(){this.node&&(this.view.yl(!1),this.view.ha.removeNode(this.node),this.view.update(),this.view.te(""))};return c}();var $d=function(){function c(a,b,d){this.view=a;this.aa=b;this.ys=d;this.state="none";this.scale=1;this.log=B.create("ImageStamp");this.qa=document.createElement("img");this.url=this.qa.src=b.url;"scale"in this.aa&&(this.scale=this.aa.scale,delete this.aa.scale)}c.prototype.tc=function(){this.log("Entering ImageStampBehaviour");this.view.canvas.style.cursor="move"};c.prototype.Ic=function(){this.log("Leaving ImageStampBehaviour");this.view.ja()};c.prototype.wb=function(a){if("touchstart"===a.type){var b=
a.changedTouches[0];b=this.view.eb(b.pageX,b.pageY);return this.Sa(b.x,b.y,a)}return"touchmove"===a.type?(b=a.changedTouches[0],b=this.view.eb(b.pageX,b.pageY),this.Ta(b.x,b.y,a)):"touchend"===a.type?(b=a.changedTouches[0],b=this.view.eb(b.pageX,b.pageY),this.Za(b.x,b.y,a)):!1};c.prototype.Fa=function(a,b){this.qa.complete&&(a-=this.qa.width/2,b-=this.qa.height/2);return this.view.Fa(new E(a,b))};c.prototype.Sa=function(a,b,d){this.log("onMouseDown type %s",d.type);a=this.Fa(a,b);this.view.ta([new V(this.view.ha.Va(),
"ImageNode",C.extend({},this.aa,{url:this.url,layer:this.view.La,matrix:(new L(a.x,a.y)).multiply(new O(this.scale,this.scale))}))]);this.ys||(this.log("MultiStamp not set; return to pick mode."),this.view.Wa());return!0};c.prototype.Ta=function(a,b){this.qa.complete||this.log("Don't draw; image not loaded.");var d=this.Fa(a,b),c=this;this.view.ja(function(a){var b=a.globalAlpha;a.globalAlpha=.5;a.drawImage(c.qa,d.x,d.y,c.qa.naturalWidth*c.scale,c.qa.naturalHeight*c.scale);a.globalAlpha=b});return!0};
c.prototype.Za=function(){return!0};c.prototype.Zb=function(a){"cancel"===a&&(this.view.Wa(),this.view.Wb.ua("goto-toolbar"))};return c}();var ae=function(){function c(){this.Jh=[];this.kj=[];this.log=B.create("SnapRules",!0)}c.prototype.Gj=function(a,b){jc(this.Jh,function(b){return b.id===a});jc(this.kj,function(b){return b.id===a});var d;for(d=0;d<b.length;d++)this.Jh.push({id:a,value:b[d].x}),this.kj.push({id:a,value:b[d].y})};c.prototype.Cq=function(){this.Jh.sort(function(a,b){return a.value-b.value});this.kj.sort(function(a,b){return a.value-b.value})};c.prototype.Fa=function(a,b,d){return 0===this.Jh.length?new E(a,b):new E(this.Cm(this.Jh,
a,d),this.Cm(this.kj,b,d))};c.prototype.Cm=function(a,b,d){for(var c=a.length,f=-1,g;1<c-f;)g=(c+f)/2|0,a[g].value<=b?f=g:c=g;-1===f&&(f=0);return Math.abs(a[f].value-b)<d?a[f].value:f+1<a.length&&Math.abs(a[f+1].value-b)<d?a[f+1].value:b};return c}();var be=function(){function c(a){this.view=a;this.log=B.create("Wall")}c.prototype.Xc=function(){return"split-wall"};c.prototype.Zb=function(a){this.log("keyboard: %s",a);"cancel"===a&&(this.log("ESC pressed. Abort wall and go back to toolbar."),this.view.Wa(),this.view.Wb.ua("goto-toolbar"))};c.prototype.tc=function(){this.log("Enter SplitWallBehaviour");this.view.canvas.style.cursor="default"};c.prototype.Ic=function(){this.log("Leaving DrawWallBehaviour")};c.prototype.Sa=function(a,b,d){this.Ta(a,
b,d);var c=this.view.ha.gb(a,b,this.view.La),f,g;return c&&"WallNode"===c.type()?((f=c.md(a,b,this.view.scale))&&"middle"===c.fe(f)&&(g=this.Zt(c.Rr(),a,b))&&(g.transform(c.Ga().inverse()),f=new Mc,g.ja(f),this.view.ta([new Rd([c.id],"svgpath",f.toString())]),f=c.md(a,b,this.view.scale)),f&&this.view.Pa(new Id(this.view,c,f,a,b,this,d)),!0):!1};c.prototype.Ta=function(a,b){this.view.Fa(new E(a,b));var d=this.view.ha.gb(a,b,this.view.La),c;if(d&&"WallNode"===d.type()&&(c=d.md(a,b,this.view.scale))){var f=
!0;d=d.fe(c);this.view.canvas.style.cursor="middle"===d?"copy":"move"}f||(this.view.canvas.style.cursor="default");return!0};c.prototype.Zt=function(a,b,d){var c,f;new E(0,0);var g=0,h=0,k=0,l=0,m=null,n=null,q=new E(b,d);a.ja({moveTo:function(a,b){var d=new E(a,b);d=q.Oa(d);if(null===m||m>d)m=d;c=a;f=b},lineTo:function(a,b){var d=new E(a,b),e=q.Oa(d);if(null===m||m>e)m=e;d=q.gi(new E(c,f),d);if(null===n||n>d)g=c,h=f,k=a,l=b,n=d;c=a;f=b},beginPath:function(){},closePath:function(){}});if(null!==m&&
(null===n||n>m))return null;var u=new P;a.ja({moveTo:function(a,b){u.moveTo(a,b);c=a;f=b},lineTo:function(a,b){c===g&&f===h&&a===k&&b===l&&u.lineTo(q.x,q.y);u.lineTo(a,b);c=a;f=b},beginPath:function(){},closePath:function(){u.closePath()}});return u};c.prototype.ta=function(){};return c}();for(var ce,de=[],ee=0;4>ee;ee++)de.push(String.fromCharCode(">2$-".charCodeAt(ee)^"zwibbler3".charCodeAt(ee%9)));ce=de.join("");for(var fe,ge=[115,116,114,111,107,101,84,101,120,116],he=[],ie=0;ie<ge.length;ie++)he.push(String.fromCharCode(ge[ie]));fe=he.join("");
var ne=function(){function c(a,b,d,e,f,g,h,k){this.ha=b;this.Ub=d;this.Wb=e;this.da=f;this.language=g;this.wa=h;this.rb=k;this.xd="none";this.Eh=this.Dh=0;this.scale=1;this.ib=this.yb=0;this.bd=new K(0,0,0,0);this.kl=new Q;this.og=this.Qi=this.th=!0;this.jl=new M;this.selection=[];this.qe=[];this.fk=!0;this.La="default";this.ye=this.li=!1;this.ed=this.background=this.He=null;this.backgroundRepeat="no-repeat";this.jd=this.Ba=null;this.De=4;this.rj=2*this.De;this.vd=this.Cc=null;this.ek=!1;this.hd=
null;this.Ef=!1;this.Vb=this.Db=this.Mb="#000000";this.Nf=5;this.Zf="";this.cc=0;this.Rk=new K(0,0,0,0);this.Sk=new K(0,0,0,0);this.Ea={xb:!1,Ma:!1,Mj:!1,x:100,y:100};this.Co=function(){};this.log=B.create("VIEW");this.canvas=a[0];this.ka=this.canvas.getContext("2d");this.ye=!0===f.get("pageView");this.zh=new ae;this.kt();this.oa=new Hd(this);this.Sb=null;this.kd=new Tc("horizontal",!0,this.rb);this.kd.Ij(this.canvas.parentNode);this.fc=new Tc("vertical",!1,this.rb);this.fc.Ij(this.canvas.parentNode);
this.Hi=this.Wg();this.jc=new xc(this.canvas.width/this.Hi,this.canvas.height/this.Hi);var l=this;this.request=new kd;this.request.canvas=this.canvas;this.request.xa("reformat",function(a){l.log("Node %s requests reformat",a);l.ha.Qe(a)&&(l.log("   Reformatting... zoom=%s",l.xd),l.ha.ag(a));l.update();a===l.ed&&l.ai();l.mg();l.wa.ua("resource-loaded")});this.request.xa("convert-dom-request",function(a,b){l.wa.ua("convert-dom-request",b,a)});f.xa("useTouch",function(){f.wd()?(l.vd=document.createElement("img"),
l.vd.setAttribute("src",f.ub("trashcan.png")),l.rj=4*l.De):(l.vd=null,l.rj=2*l.De)});this.fc.xa("scroll",function(a){l.ib=-a*l.scale;l.ja()});this.kd.xa("scroll",function(a){l.yb=-a*l.scale;l.ja()});this.ai();this.ha=this.qf(b);(a=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame)?(this.log("Using requestAnimationFrame"),this.requestAnimationFrame=a):this.log("Emulating requestAnimationFrame");this.da.xa("update",function(a,b){l.ne(a,b)});this.rb.bind(C(document),
"webkitfullscreenchange",function(){0<=navigator.userAgent.search("Safari")&&0>navigator.userAgent.search("Chrome")&&(l.log("SAFARI WORKAROUND: Disabling requestAnimationFrame."),l.requestAnimationFrame=c.prototype.requestAnimationFrame)});this.oa=this.Wa()}c.prototype.Kn=function(a){var b,d=-1,c=!1;for(b=0;b<a.kf.length;b++){var f=a.kf[b];this.zh.Gj(f,[]);f===this.ed&&(this.log("Background node has been removed"),d=-1)}for(b=0;b<a.cd.length;b++){f=a.cd[b];var g=this.ha.za(f,!1);this.zh.Gj(f,g.yk());
"background"===g.la("layer")&&(this.log("Background node has been added"),d=f)}for(b=0;b<a.vf.length;b++)f=a.vf[b],g=this.ha.za(f,!1),this.zh.Gj(f,g.yk()),"background"===g.la("layer")?(this.log("Background node has been changed"),d=f,c=!0):f===this.ed&&(this.log("Node removed from background layer"),d=-1);-1===d||!c&&d===this.ed||(this.ed=d,this.ai(),this.ed&&this.ha.za(this.ed,!1).se(!0));(a.cd.length||a.vf.length)&&this.zh.Cq();a.cd.length&&this.wa.ua("nodes-added",a.cd);a.vf.length&&this.wa.ua("nodes-changed",
a.vf);a.kf.length&&this.wa.ua("nodes-removed",a.kf)};c.prototype.requestAnimationFrame=function(a){a()};c.prototype.Vg=function(){return parseInt(C(this.canvas).ea("border-left-width"),10)||0};c.prototype.Ug=function(){this.log("getActiveLayer() -> %s",this.La);return this.La};c.prototype.Ri=function(a){this.log("setActiveLayer(%s)",a);this.La=a;this.nb();this.Nb();this.ja()};c.prototype.yh=function(a,b){this.ha.yh(a,b);b||a!==this.La||(this.nb(),this.Nb());this.ja()};c.prototype.qf=function(a){this.log("setDocument()");
this.Wa();this.ha=a;this.scale=1;this.ib=this.yb=0;this.selection=[];this.jd=this.Ba=null;this.cc=1;this.bd=new K(0,0,0,0);this.kl=new Q(this.bd);this.jl=new M;this.fk=!0;this.Zf="";this.La="default";this.Db="#ffffff";this.Vb=this.da.Ha("defaultBrushColour");this.Mb=this.da.Ha("defaultStrokeStyle");this.ya={};this.ya.lineWidth=this.da.Ha("defaultLineWidth");this.ya.sloppiness=.5;this.ya.fontName=this.da.Ha("defaultFont");this.ya.fontSize=this.da.Ha("defaultFontsize");this.ya.bold=this.da.Ha("defaultBold");
this.ya.italic=this.da.Ha("defaultItalic");this.ya.smoothness=.3;this.ya.textFillStyle=this.da.Ha("defaultTextFillStyle");this.ya.textStrokeStyle=this.da.Ha("defaultTextStrokeStyle");this.ya.textLineWidth=this.da.Ha("defaultTextLineWidth");this.Nf=this.da.get("defaultBrushWidth");var b=this.ee();this.yb=-b.x;this.ib=-b.y;this.ic();this.ha.Bl=this.da.get("spotHighlightColour");this.ha.Yi=this.da.get("spotHighlightZIndex");this.ha.format(this.ka,this.request);this.Sk=new K(0,0,0,0);this.Rk=new K(0,
0,0,0);"none"!==this.xd?this.Nc(this.xd):(this.Nc(this.da.get("defaultZoom")),this.ja());return a};c.prototype.ne=function(a,b){var d=!1;switch(a){case "allowResize":this.Kf();this.ja();break;case "defaultBrushColour":this.Vb=b;break;case "defaultFillStyle":this.Db=this.ya.fillStyle=b;break;case "defaultStrokeStyle":this.Mb=b;this.ya.strokeStyle=b;break;case "defaultLineWidth":this.ya.lineWidth=b;break;case "defaultFont":this.ya.fontName=b;break;case "defaultBold":this.ya.bold=b;break;case "defaultItalic":this.ya.italic=
b;break;case "defaultFontSize":this.ya.fontSize=b;break;case "defaultTextFillStyle":this.ya.textFillStyle=b;break;case "defaultTextStokeStyle":this.ya.textStrokeStyle=b;break;case "defaultTextLineWidth":this.ya.textLineWidth=b;break;case "defaultBrushWidth":this.Nf=b;break;case "defaultZoom":this.Nc(b);break;case "pageView":this.ye=b;d=!0;break;case "pagePlacement":this.Nc(this.xd);break;case "snap":case "background":case "gridSpacing":case "gridBlocks":case "gridColour":case "backgroundImage":this.ai();
d=!0;break;case "pageShadow":case "symmetry":case "outsidePageColour":d=!0;break;case "readOnly":!0===b&&(this.Wa(),this.nb(),this.Nb(),d=!0);this.ha.rg(b);break;case "spotHighlightColour":this.ha.Bl=b;d=!0;break;case "spotHighlightZIndex":this.ha.Yi=b,d=!0}this.oa.ne&&this.oa.ne(a,b);d&&this.ja()};c.prototype.re=function(a,b){this.ya[a]=b;"fillStyle"===a?this.Db=b:"strokeStyle"===a&&(this.Mb=b)};c.prototype.Nc=function(a){a!==this.xd&&this.log("Zooming to: %s",a);var b=this.jc.width-20;var d=this.ha.Zr();
var c=!0;this.xd=a;d||"number"===typeof a||(this.log("WARNING: Cannot zoom to page/width because the document size has not been set."),c="page"===a||"width"===a);if("number"===typeof a)this.scale=a;else if("none"===a||this.ha.empty()||!d)this.scale=1;else{if("page"===a)return d=this.ee(),this.xh(d,"centre"===this.da.get("pagePlacement"),!0),this.xd=a,this.oa.oe&&this.oa.oe(),c;"width"===a&&(d=this.ee(),this.scale=b/d.width,this.yb=-d.x*this.scale,this.ib=-d.y*this.scale,this.log("RECT=%s scale=%s tx=%s ty=%s",
d,this.scale,this.yb,this.ib),this.xd=a)}this.ic();this.ja();this.oa.oe&&this.oa.oe();return c};c.prototype.eb=function(a,b,d){void 0===d&&(d=!1);a=this.In().apply(a,b);d||(a=this.Fa(a));return a};c.prototype.$j=function(a,b){return this.In().inverse().apply(a,b)};c.prototype.yc=function(a){return this.eb(a.pageX,a.pageY,!0)};c.prototype.Zb=function(a,b){this.oa.Zb&&this.oa.Zb(a,b);if("TEXTAREA"!==b.target.tagName&&"INPUT"!==b.target.tagName&&!this.Wr(a,b)){switch(a){case "next-page":this.Bb(this.ha.Ua+
1);break;case "previous-page":this.Bb(this.ha.Ua-1);break;case "zoom-to-page":this.da.get("allowZoom")&&this.Nc("page");break;case "zoom-to-width":this.da.get("allowZoom")&&this.Nc("width")}b.preventDefault();b.stopPropagation()}};c.prototype.kt=function(){var a=this;this.Vg();C(this.canvas).bind("gesturestart",function(b){a.log("GestureStart");a.oa.Ya&&!1!==a.oa.Ya(b)?(b.stopPropagation(),b.preventDefault()):a.log("Pass to browser")});C(this.canvas).bind("gesturechange",function(b){a.oa.Ya&&!1!==
a.oa.Ya(b)?(b.stopPropagation(),b.preventDefault()):a.log("Pass to browser")});C(this.canvas).bind("gestureend",function(b){a.log("GestureEnd");a.oa.Ya&&!1!==a.oa.Ya(b)?(b.stopPropagation(),b.preventDefault()):a.log("Pass to browser")});"ongesturestart"in this.canvas?this.log("Using native gestures"):(this.log("Using emulated gestures"),ub(this.canvas,function(b){a.oa.Ya&&!1!==a.oa.Ya(b)?(b.stopPropagation(),b.preventDefault()):a.log("Allow %s event to pass through",b.type)}));this.da.get("simulateGestures")&&
mc(this.canvas,function(b){a.log("Simulating %s",b.type);a.oa.Ya&&!1!==a.oa.Ya(b)&&(b.stopPropagation(),b.preventDefault())});var b="ontouchstart"in window,d="onpointerdown"in window,c="ongesturestart"in window,f="onmousedown"in window;this.log("Have TouchEvents: %s",b);this.log("Have PointerEvents: %s",d);this.log("Have GestureEvents: %s",c);this.log("Have MouseEvents: %s",f);d&&!this.da.get("allowPointerEvents")&&(this.log("Configuration does not allow PointerEvents"),d=!1);var g=new E(0,0),h=0,
k=0,l=!1,m=!1,n;this.Co=function(){a.log("Preventing next double click.");l=!0};if(b){this.log("Using touch events for screen movement.");var q=new Date,u=new E(0,0);C(this.canvas).bind("touchstart",function(b){if(a.oa.wb&&"touchstart"===b.type){var d=!0;300<(new Date).getTime()-q.getTime()?d=!1!==a.oa.wb(b):a.oa.Hd&&(n=new E(b.changedTouches[0].pageX,b.changedTouches[0].pageY),a.log("Double-click distance: %s",n.Oa(u)),10>n.Oa(u)?(n=a.yc(b.changedTouches[0]),d=!1!==a.oa.Hd(n.x,n.y,b)):d=!1);d&&(b.stopPropagation(),
b.preventDefault());q=new Date;u=new E(b.changedTouches[0].pageX,b.changedTouches[0].pageY)}});C(this.canvas).bind("touchmove",function(b){a.oa.wb&&!1!==a.oa.wb(b)&&(b.stopPropagation(),b.preventDefault())});C(this.canvas).bind("touchend",function(b){a.oa.wb&&!1!==a.oa.wb(b)&&(b.stopPropagation(),b.preventDefault())})}else if(d){this.log("Using pointer events for movement");C(this.canvas).bind("pointerdown",function(b){"pointerdown"===b.type&&(a.log("PointerDown"),g=new E(b.pageX,b.pageY),h=$b(),
m=!0,a.oa.Sa&&(n=a.yc(b),!1!==a.oa.Sa(n.x,n.y,b)&&(b.stopPropagation(),b.preventDefault())))});C(this.canvas).bind("pointermove",function(b){"pointermove"===b.type&&(m&&0===b.buttons&&(a.log("MISSED POINTERUP! Fixing."),v(b)),a.oa.Ta&&(n=a.yc(b),!1!==a.oa.Ta(n.x,n.y,b)&&(b.stopPropagation(),b.preventDefault())))});var v=function(b){if("pointerup"===b.type||"pointermove"===b.type){a.log("PointerUp");n=a.yc(b);a.oa.Za&&m&&!1!==a.oa.Za(n.x,n.y,b)&&(b.stopPropagation(),b.preventDefault());m=!1;a.log("TimeDist=%s PixelDist=%s",
$b()-h,g.Oa(new E(b.pageX,b.pageY)));var d=k,c=200>$b()-h&&2>g.Oa(new E(b.pageX,b.pageY));a.log("Didclick: %s dbltime=%s",c,$b()-d);a.oa.nc&&c&&(a.log("Simulate mouseclick from pointerup"),n=a.yc(b),!1!==a.oa.nc(n.x,n.y,b)&&(b.stopPropagation(),b.preventDefault()));a.oa.Hd&&c&&300>$b()-d&&!l&&(a.log("Simulate double-click"),!1!==a.oa.Hd(n.x,n.y,b)&&(b.stopPropagation(),b.preventDefault()));c&&(k=$b(),l=!1)}};this.rb.bind(C(document),"pointerup",v)}!d||b?(this.log("Using mouse events for screen movement."),
hb(C(this.canvas),function(b){"mousemove"===b.type&&(a.oa.Ta&&(n=a.yc(b),a.oa.Ta(n.x,n.y,b)),b.preventDefault())}),ib(C(this.canvas),function(b){"mousedown"===b.type&&(m=!0,a.oa.Sa&&(n=a.yc(b),a.oa.Sa(n.x,n.y,b)),b.preventDefault())}),this.rb.bind(C(document),"mouseup",function(b){"mouseup"===b.type&&(a.oa.Za&&m&&(n=a.yc(b),a.oa.Za(n.x,n.y,b)),m=!1)}),C(this.canvas).click(function(b){"click"===b.type&&(C(a.canvas).offset(),a.oa.nc&&(n=a.yc(b),a.oa.nc(n.x,n.y,b)),b.stopPropagation(),b.preventDefault())}),
gb(C(this.canvas),function(b){if("dblclick"===b.type){C(a.canvas).offset();if(a.oa.Hd||a.oa.nc)n=a.yc(b),dc()&&a.oa.nc&&(a.log("Insert false mouse click for IE"),a.oa.nc(n.x,n.y,b)),a.oa.Hd&&a.oa.Hd(n.x,n.y,b);b.stopPropagation();b.preventDefault()}})):this.log("Not using mouse events.");C(this.canvas).bind("mouseenter",function(a){a.stopPropagation();a.preventDefault()});C(this.canvas).bind("mouseleave",function(a){a.stopPropagation();a.preventDefault()});C(this.canvas).bind("mouseover",function(a){a.stopPropagation();
a.preventDefault()});C(this.canvas).bind("mouseout",function(a){a.stopPropagation();a.preventDefault()});!window.parent&&this.da.get("setFocus")&&C(this.canvas).focus();this.Ub.bind("colour",function(b,d){a.oa.nd&&a.oa.nd(b,d)});this.Ub.bind("opacity",function(b,d){a.oa.od&&a.oa.od(b,d)});this.da.get("simulateGestures")||(b="mousewheel","onwheel"in document.createElement("div")&&(b="wheel"),a.log("Binding to '%s' for mouse wheel",b),C(this.canvas).bind(b,function(b){if("wheel"===b.type||"mousewheel"===
b.type){var d=b.wheelDelta||-40*b.deltaY,c=d/120*32;n=a.yc(b);a.log("mousewheel: delta %s",d);if((!a.oa.Wk||!1===a.oa.Wk(n.x,n.y,c,b))&&a.fc.fs()){var e=a.ee();a.ib=-120>=d?Math.max(a.ib+c,-(e.bottom()*a.scale-a.canvas.clientHeight)):Math.min(a.ib+c,-e.y*a.scale);a.ic();a.ja();b.stopPropagation();b.preventDefault()}}}));C(this.canvas).bind("dragover",function(b){a.log("Dragover");b.preventDefault()});C(this.canvas).bind("drop",function(){a.log("Drop")});C(this.canvas).bind("dragenter",function(){a.log("DragEnter")});
C(this.canvas).bind("dragleave",function(){a.log("DragLeave")})};c.prototype.Gs=function(a){function b(a){var b=new FileReader;b.readAsDataURL(a.getAsFile());b.onloadend=function(){d.Nk(b.result)}}this.log("Received clipboard event: %s",a.type);var d=this;switch(a.type){case "copy":case "cut":if(!this.Mn())break;this.log("Cut to system clipboard.");var c=this.Vd(!0,this.vc(!1));a.clipboardData.setData("application/zwibbler",c);a.preventDefault();"cut"===a.type&&this.Og();break;case "paste":for(this.log("There are %s items on the clipboard",
a.clipboardData.items.length),c=0;c<a.clipboardData.items.length;c++){var f=a.clipboardData.items[c];this.log("Item [%s] type is %s",c,f.type);if(0===f.type.indexOf("image/")){b(f);a.preventDefault();break}else if("application/zwibbler"===f.type){this.log("Pasting from system clipboard");f.getAsString(function(a){d.hg(a)});a.preventDefault();break}}}};c.prototype.Wr=function(a,b){if(!this.Ea.xb)return!1;var d=0,c=0,f=this.da.get("nudge");switch(a){case "right":d=f;break;case "left":d=-f;break;case "down":c=
f;break;case "up":c=-f;break;case "enter":if(this.oa.nc){this.Ea.Ma=!1;var g="click"}else this.Ea.Ma=!this.Ea.Ma,g=this.Ea.Ma?"mousedown":"mouseup"}if(d||c)g=this.jc,this.Ea.x+=d,this.Ea.x=Math.max(this.Ea.x,0),this.Ea.x=Math.min(g.width,this.Ea.x),this.Ea.y+=c,this.Ea.y=Math.max(this.Ea.y,0),this.Ea.y=Math.min(g.height,this.Ea.y),this.ja(),g="mousemove";return g?(b.preventDefault(),b.stopPropagation(),this.ja(),c=C(this.canvas).offset(),d=this.Ea.x+c.left-window.pageXOffset,c=this.Ea.y+c.top-window.pageYOffset,
this.log("Simulate a %s at (%s,%s)",g,d,c),f=document.createEvent("MouseEvents"),f.initMouseEvent(g,!0,!0,window,0,d,c,d,c,!1,!1,!1,!1,this.Ea.Ma?1:0,null),this.canvas.dispatchEvent(f),!0):!1};c.prototype.qd=function(a){void 0===a&&(a=!1);this.Ea.xb=!0;this.Ea.Ma=!1;this.Ea.Mj=a;this.log("Showing keyboard cursor, caret=%s",a);this.ja()};c.prototype.Yo=function(a){this.Ea.xb=!0;this.Ea.Mj=!1;if(0<this.selection.length){this.log("showKeyboardCursorAndStartMoving()");this.Ea.Ma=!0;var b=this.bd.Lf();
this.Ea.x=b.x;this.Ea.y=b.y;this.Wa();this.Pa(new Qd(this,new Md(this.selection[0].Ga()),!1,b.x-4,b.y-4,a))}this.ja()};c.prototype.Qn=function(){this.Ea.xb&&(this.Ea.xb=!1,this.ja())};c.prototype.bs=function(){return this.Ea.xb};c.prototype.es=function(a){var b=this.Vg(),d=C(this.canvas).offset(),c=this.fc.ti();if("changedTouches"in a){var f=a.changedTouches[0].pageX-d.left-b;a=a.changedTouches[0].pageY-d.top-b}else if("pageX"in a)f=a.pageX-d.left-b,a=a.pageY-d.top-b;else return!1;b=this.jc;return this.vd&&
f>b.width-this.vd.width-c&&a<this.vd.height};c.prototype.ds=function(a){var b=this.Vg(),d=C(this.canvas).offset(),c=this.fc.ti();if("changedTouches"in a){var f=a.changedTouches[0].pageX-d.left-b;a=a.changedTouches[0].pageY-d.top-b}else if("pageX"in a)f=a.pageX-d.left-b,a=a.pageY-d.top-b;else return!1;b=this.jc;return this.Cc&&f>b.width-this.Cc.width-c&&a<this.Cc.height};c.prototype.Fa=function(a,b){void 0===b&&(b=0);b=b||this.da.get("snap")||0;var d=this.da.get("autoSnap");if(0<b){d=Math.round(a.x/
b)*b;var c=Math.round(a.y/b)*b}else{if(0<d)return this.zh.Fa(a.x,a.y,d/this.scale);d=a.x;c=a.y}return new E(d,c)};c.prototype.Di=function(){var a=this.vc(!1);a.length&&this.ta([new je(a,je.jm)])};c.prototype.Ci=function(){var a=this.vc(!1);a.length&&this.ta([new je(a,je.im)])};c.prototype.Fg=function(){var a=this.vc(!1);a.length&&this.ta([new je(a,je.am)])};c.prototype.uh=function(){var a=this.vc(!1);a.length&&this.ta([new je(a,je.uj)])};c.prototype.setProperty=function(a,b){var d=this.vc(!0);this.ya[a]=
b;if(d.length){var c=[new Rd(d,a,b)];if("fillStyle"===a)for(var f=0;f<d.length;f++){var g=this.ha.za(d[f],!1);g&&(this.log("nodeType=%s closed=%s",g.type(),g.la("closed")),"PathNode"===g.type()&&!1===g.la("closed")&&c.push(new Rd([d[f]],"strokeStyle",b)))}this.ta(c)}0<this.selection.length&&"lineWidth"===a&&"BrushNode"===this.selection[0].type()?this.Nf=b:"textFillStyle"===a&&(this.ya.textFillStyle=b)};c.prototype.we=function(a,b){this.oa.we&&this.oa.we(a,b)};c.prototype.pi=function(){return this.ya.fillStyle};
c.prototype.ui=function(){return this.ya.strokeStyle};c.prototype.ul=function(a,b){this.log("setSelectionOpacity(%s, fill=%s)",a,b);for(var d=this.vc(!0),c=[],f=b?"fillStyle":"strokeStyle",g=0;g<d.length;g++){var h=d[g],k=this.ha.za(h);k&&(k=k.la(f))&&(k=hc(k,a),c.push(new Rd([h],f,k)),this.log("   set %s of %s to %s",f,h,k))}c.length&&this.ta(c);this.log("   Affected %s of %s nodes",c.length,d.length)};c.prototype.group=function(){var a=this.vc(!1);a.length&&this.ta([new Ad(this.ha.Va(),a)])};c.prototype.Gh=
function(){var a=this.vc(!1);a.length&&this.ta([new ke(a)])};c.prototype.Og=function(){var a=this.vc(!1);a.length&&this.ta([new le(a)])};c.prototype.nb=function(a){void 0===a&&(a=!1);var b=!1;0<this.selection.length&&(this.cc+=1,this.selection.length=0,this.log("Clear selection. selectGeneration=%s",this.cc),b=!0);null!==this.jd&&(this.wa.ua("selected-edit-handle",null,null),b=!0);this.Ba&&(this.log("Clear selection."),this.jd=this.Ba=null,b=!0);b&&a&&(this.Nb(),this.ja())};c.prototype.Ge=function(a){this.rf(null);
if(a.cc!==this.cc&&a.Bd()===this.La){this.selection.push(a);a.cc=this.cc;if(a.Ck()){for(var b=a.parent,d=0;d<b.children.length;d++)this.Ge(b.children[d]);this.Ge(b)}a.children&&0<a.children.length&&this.Ge(a.children[0])}};c.prototype.selectNodes=function(a){this.nb();for(var b=0;b<a.length;b++)a[b].la("locked")||"PageNode"===a[b].type()||this.Ge(a[b]);this.Nb()};c.prototype.rt=function(a,b){var d=this.ha.za(a,!1);d?d.Wn()?(d!==this.Ba&&this.rf(d),this.log("Select edit handle %s",b),this.jd=b,this.wa.ua("selected-edit-handle",
a,b)):this.log("selectEditHandle: That handle is not selectable."):this.log("selectEditHandle: nodeid %s does not exist.",a)};c.prototype.ta=function(a,b){void 0===b&&(b=!1);if(this.da.get("readOnly"))this.log("readOnly mode: Ignoring change.");else if(0!==a.length){var d=this.ha.ta(a,b),c;this.ha.format(this.ka,this.request);if(d.cd.length&&!b){var f=[];for(c=0;c<d.cd.length;c++)f.push(this.ha.za(d.cd[c],!1));this.da.get("autoPickTool")&&this.selectNodes(f)}else if((this.selection.length||this.Ba)&&
0<d.kf.length){f=0;this.cc+=1;for(c=0;c<this.selection.length;c++)c!==f&&(this.selection[f]=this.selection[c]),this.ha.Qe(this.selection[f].id)&&(this.selection[f].cc=this.cc,f++);this.selection.length!==f&&(this.selection.length=f);this.Ba&&!this.ha.Qe(this.Ba.id)&&(this.log("EditNode %s no longer exists",this.Ba.id),this.Ba=null,null!==this.jd&&this.wa.ua("selected-edit-handle",null,null),this.jd=null);0!==this.selection.length||this.Ba||this.nb();this.Nb();this.log("Done selecting called.")}this.Kn(d);
this.mg();this.ja();this.wa.ua("document-changed")}};c.prototype.qt=function(a){a=this.ha.Lr(a);for(var b=0;b<a.length;b++)this.Ge(a[b])};c.prototype.Nb=function(){this.Kf();this.Sb&&this.Sb.qs(this.selection);this.wa.ua("selected-nodes")};c.prototype.Kf=function(){function a(a,b,d,e){!1!==c.th&&c.qe.push(new Kd(b,new E(a.x+d*a.width,a.y+e*a.height),new E(a.x+(1-d)*a.width,a.y+(1-e)*a.height)))}var b;this.og=this.Qi=this.th=!0;var d=!1;this.qe.length=0;if(0!==this.selection.length){this.bd=this.selection[0].rect.clone();
this.selection[0].la("lockSize")&&(this.th=!1);this.selection[0].la("lockRotation")&&(this.Qi=!1);this.selection[0].la("lockPosition")&&(this.og=!1);this.selection[0].la("lockAspectRatio")&&(d=!0);for(b=1;b<this.selection.length;b++)this.bd.Hh(this.selection[b].rect),this.selection[b].la("lockSize")&&(this.th=!1),this.selection[b].la("lockRotation")&&(this.Qi=!1),this.selection[b].la("lockAspectRatio")&&(d=!0),this.selection[b].la("lockPosition")&&(this.og=!1);this.kl=1===this.selection.length?this.selection[0].mk():
new Q(this.bd);var c=this,f=0<this.da.get("snap");if(1<this.selection.length){var g=new M;b=null;var h=this.bd}else b=this.selection[0],h=b.fb,g=b.Ga();this.da.get("allowResize")&&(d||(a(h,g,.5,0),a(h,g,1,.5),a(h,g,.5,1),a(h,g,0,.5)),a(h,g,0,0),a(h,g,1,0),a(h,g,1,1),a(h,g,0,1));if(this.Qi)if(b&&b.la("rotationHandles"))for(d=b.la("rotationHandles"),b=0;b<d.length;b+=4){h=new E(d[b],d[b+1]);var k=new E(d[b+2],d[b+3]);c.qe.push(new Ld(g,h,k,f))}else c.qe.push(new Ld(g,new E(h.x+.5*h.width,h.y-10/this.scale),
new E(h.x+.5*h.width,h.y+.5*h.height),f))}};c.prototype.gq=function(){for(var a=0,b=0;b<this.selection.length;b++)b!==a&&(this.selection[a]=this.selection[b]),this.ha.Qe(this.selection[a].id)&&(a+=1);this.selection.length!==a&&(this.selection.length=a);this.Ba&&!this.ha.Qe(this.Ba.id)&&(this.Ba=null,null!==this.jd&&this.wa.ua("selected-edit-handle",null,null),this.jd=null)};c.prototype.Ys=function(a,b){return this.selection.length&&this.kl.Vc(a,b)};c.prototype.Mn=function(){return 0!==this.selection.length||
null!==this.Ba};c.prototype.Vf=function(){var a=this.selection.concat();this.Ba&&a.push(this.Ba);return a};c.prototype.Kr=function(a){if(0===a.length)return new E(0,0);for(var b=a[0].rect.clone(),d=1;d<a.length;d++)b.Hh(a[d].rect);return b.Lf()};c.prototype.Cn=function(a){for(var b=[],d=0;d<a.length;d++)this.log("Selected id=%s",a[d].id),b.push(a[d].id);return b};c.prototype.In=function(){var a=C(this.canvas).offset();return(new M).multiply(new O(1/this.scale,1/this.scale)).multiply(new L(-this.yb,
-this.ib)).multiply(new L(-a.left,-a.top))};c.prototype.vc=function(a){var b=this.Vf();a||(b=this.ha.Zh(b));return this.Cn(b)};c.prototype.nk=function(a){for(var b=null,d=0;d<a.length;d++){var c=this.ha.za(a[d]);c&&(null===b?b=c.rect.clone():b.Hh(c.rect))}null===b&&(b=new K(0,0,0,0));return b};c.prototype.update=function(a,b){void 0===a&&(a=!1);if(this.ha.format(this.ka,this.request)||a)this.Kf(),this.ja(b)};c.prototype.ai=function(){var a=this.da.get("snap"),b=null,d;var c=this.da.get("background");
var f=A.lk(c),g=this.da.get("backgroundImage");this.background=this.He=null;this.backgroundRepeat="no-repeat";var h=this;this.log("createBackground() background=%s",c);this.log("backgroundNodeId==%s",this.ed);if("grid"===c){this.backgroundRepeat="repeat";a=this.da.get("gridBlocks");g=this.da.get("gridSpacing");var k=(a||1)*g;b=Zb(document.body);b.width=k;b.height=k;c=b.getContext("2d");c.fillStyle="#ffffff";c.fillRect(0,0,k,k);c.beginPath();for(d=0;d<k;d+=g)if(d%k||1>a)c.moveTo(d+.5,0),c.lineTo(d+
.5,k);for(d=0;d<k;d+=g)if(d%k||1>a)c.moveTo(0,d+.5),c.lineTo(k,d+.5);c.strokeStyle=this.da.get("gridColour");c.lineWidth=.5;c.stroke();if(0<a){c.beginPath();for(d=0;d<=k;d+=k)c.moveTo(d,0),c.lineTo(d,k);for(d=0;d<=k;d+=k)c.moveTo(0,d+.5),c.lineTo(k,d+.5);c.lineWidth=2;c.stroke()}}else if(g)this.request.add(0,"image",g,null,function(a){h.log("Background image finished loading");h.background=a});else if(this.ed){if(this.log("Regenerate background image"),a=this.ha.za(this.ed,!1))c=a.rect.clone(),b=
Zb(document.body),b.width=c.x+c.width,b.height=c.y+c.height,c=b.getContext("2d"),a.ja(c)}else f?(this.log("Using background colour %s",f.toString()),this.He=function(a,b,d,c,e){a.fillStyle=f.toString();a.fillRect(b,d,c,e)}):0<a&&"clear"!==c&&(this.backgroundRepeat="repeat",b=Zb(document.body),b.width=a,b.height=a,c=b.getContext("2d"),c.beginPath(),c.moveTo(0,0),c.arc(0,0,3,0,2*Math.PI,!1),c.moveTo(a,0),c.arc(a,0,3,0,2*Math.PI,!1),c.moveTo(a,a),c.arc(a,a,3,0,2*Math.PI,!1),c.moveTo(0,a),c.arc(0,a,3,
0,2*Math.PI,!1),c.fillStyle="#c0c0c0",c.fill());b&&document.body.removeChild(b);this.background=b};c.prototype.Rg=function(a,b,d,c,f){a.Df=null;this.background?(a.Df=a.createPattern(this.background,this.backgroundRepeat),a.fillStyle=a.Df,a.fillRect(b,d,c,f)):this.He?this.He(a,b,d,c,f):"G_vmlCanvasManager"in window&&(a.fillStyle="rgba(0, 0, 0, 0.0)",a.fillRect(b,d,c,f))};c.prototype.Hq=function(a){var b=this.ha.wk();a.beginPath();a.fillStyle="#FFFFFF";this.da.get("pageShadow")&&(a.shadowOffsetX=3/
this.scale,a.shadowOffsetY=3/this.scale,a.shadowBlur=5/this.scale,a.shadowColor="rgba(0,0,0,1.0)");a.rect(0,0,b.width,b.height);a.fill();a.shadowColor="rgba(0,0,0,0.0)";a.shadowBlur=0;a.shadowOffsetX=0;a.shadowOffsetY=0;a.strokeStyle=this.da.get("pageBorderColour");a.stroke();this.Rg(a,0,0,b.width,b.height);this.He&&this.He(a,0,0,b.width,b.height)};c.prototype.nl=function(a){a?(this.log("Setting a custom background function."),this.He=a):this.log("Clearing custom background function.")};c.prototype.Fq=
function(a){if(this.Ea.xb){var b=this.Ea.x,d=this.Ea.y,c=this.Wg();a.save();a.setTransform(c,0,0,c,0,0);a.beginPath();this.Ea.Mj?(a.moveTo(b-3,d-10),a.lineTo(b+3,d-10),a.moveTo(b-3,d+10),a.lineTo(b+3,d+10),a.moveTo(b,d-10),a.lineTo(b,d+10)):(a.moveTo(b,d-3),a.lineTo(b,d-15),a.moveTo(b,d+3),a.lineTo(b,d+15),a.moveTo(b-3,d),a.lineTo(b-15,d),a.moveTo(b+3,d),a.lineTo(b+15,d));this.Ea.Ma&&this.ka.arc(b,d,8,0,2*Math.PI,!1);a.lineWidth=2;a.strokeStyle="#000000";a.stroke();a.restore()}};c.prototype.oe=function(){var a=
C(this.canvas),b=a.offset(),d=C(this.canvas.parentNode).offset(),c=a.width();a=a.height();var f=b.left-d.left;b=b.top-d.top;d=this.Vg();this.fc.moveTo(f+c-20+d,b+d);this.fc.ve(20,a-20);this.kd.moveTo(f+d,b+a-20+d);this.kd.ve(c-20,20);this.mg();this.ja()};c.prototype.mg=function(){if(!this.Fk()){var a=this.ee(),b=this.jc;b=new K(0,0,b.width,b.height);a.be(this.Sk)&&b.be(this.Rk)||!this.Nc(this.xd)||(this.Sk=a,this.Rk=b)}};c.prototype.Wm=function(){if(this.ye){var a=this.ha.wk();this.ka.save();this.ka.beginPath();
this.ka.rect(0,0,a.width,a.height);this.ka.clip()}return this.ye};c.prototype.ja=function(a){if(!this.Fk()&&(this.hd=a||null,!this.ek)){this.ek=!0;var b=this;this.requestAnimationFrame.call(window,function(){b.ek=!1;var a=b.Wg();a!==b.Hi&&(b.log("Detected DPR change; resize canvas now"),b.Oo(b.jc.width,b.jc.height),b.Hi=a);var c=b.Wf(),f=c.x,g=c.y,h=c.width,k=c.height;b.ka.setTransform(1,0,0,1,0,0);b.ka.clearRect(0,0,b.canvas.width,b.canvas.height);b.ye&&(b.ka.fillStyle=b.da.get("outsidePageColour"),
b.ka.fillRect(0,0,b.canvas.width,b.canvas.height));b.ka.scale(a,a);b.ka.translate(b.yb,b.ib);b.ka.scale(b.scale,b.scale);var l=new L(b.yb,b.ib);l=l.multiply(new O(b.scale,b.scale));b.ka.Lu=l;b.ye?b.Hq(b.ka):b.Rg(b.ka,f,g,Math.max(h,h-f),Math.max(k,k-f));b.ha.Qt();f=b.Wm();g=b.da.Ha("symmetry");if(1<g){h=2*Math.PI/g;k=b.Fa(new E(b.canvas.width/a/2,b.canvas.height/a/2));g&1&&(l=new zc(h,k.x,k.y));for(b.ka.save();h<2*Math.PI-1E-8;)0===(g&1)&&(l=new Ac(h,k.x,k.y)),b.ka.transform(l.m11,l.m21,l.m12,l.m22,
l.Ca,l.Da),b.ha.ja(b.ka),h+=2*Math.PI/g;b.ka.setTransform(1,0,0,1,0,0);b.ka.fillStyle="rgba(255,255,255,0.3)";b.ka.fillRect(0,0,b.canvas.width,b.canvas.height);b.ka.restore()}b.ha.ja(b.ka,c);b.wa.hd&&(b.ka.save(),b.wa.hd(b.ka),b.ka.restore());0<b.selection.length&&(b.ka.save(),b.Iq(b.ka),b.ka.restore());f&&b.ka.restore();b.Ba&&b.Ba.ji(b.ka,1/b.scale,b.jd);""!==b.Zf&&b.da.get("showHints")&&(b.ka.save(),b.ka.font=10/b.scale+"px Arial",b.ka.fillStyle="#000000",b.ka.textBaseline="top",b.ka.fillText(b.Zf,
0,0),b.ka.restore());b.Fq(b.ka);b.oa.ph&&b.oa.ph(b.ka);b.hd&&b.hd(b.ka);b.wa.Pe("draw",b.ka);b.ka.setTransform(1,0,0,1,0,0);0<b.selection.length&&b.vd&&b.vd.naturalWidth&&(c=b.vd.width,b.ka.drawImage(b.vd,b.canvas.width-c-b.fc.ti(),0));b.Cc&&b.Cc.complete&&b.Cc.naturalWidth&&(c=b.Cc.naturalWidth,b.ka.drawImage(b.Cc,b.canvas.width-c-b.fc.ti(),0));b.ka.setTransform(a,0,0,a,0,0);b.ka.beginPath();b.ka.font="20px Arial";h=b.ka.measureText(ce).width;a=b.canvas.width/a/h;b.ka.scale(a,a);b.ka.textBaseline=
"top";b.ka.lineWidth=4/a;b.ka.strokeStyle="rgba(128, 128, 128, 0.1)";b.ka[fe](ce,0,0)})}};c.prototype.Iq=function(a){a.lineWidth=1/this.scale;a.strokeStyle="#888888";a.beginPath();for(var b=0;b<this.selection.length;b++){var d=this.selection[b];var c=d.Ga();d=new P(d.fb);d.transform(c);d.ii(a,[3/this.scale,3/this.scale])}a.stroke();c=this.scale;for(b=0;b<this.qe.length;b++){d=this.qe[b];var f=this.jl.apply(d.x,d.y);d instanceof Ld?this.fk&&(a.beginPath(),a.strokeStyle="#008000",a.lineWidth=3/c,a.moveTo(f.x,
f.y),a.arc(f.x,f.y,6/c,0,1.5*Math.PI,!1),a.stroke()):(a.beginPath(),a.strokeStyle="#000",a.lineWidth=1/c,a.rect(f.x-this.De/c,f.y-this.De/c,this.De/c*2,this.De/c*2),a.stroke())}};c.prototype.rf=function(a){this.Ba=a};c.prototype.Ll=function(a){this.jl=a};c.prototype.$o=function(a){this.fk=a};c.prototype.cs=function(a){return a.cc===this.cc};c.prototype.yr=function(a,b){if(this.Ba)return null;for(var d=this.rj/this.scale,c=null,f=Number.MAX_VALUE,g=0;g<this.qe.length;g++){var h=this.qe[g],k=G(h.x,
h.y,a,b);k<d&&k<f&&(f=k,c=h)}return c};c.prototype.jb=function(){this.hp(!1)};c.prototype.Kd=function(){this.hp(!0)};c.prototype.hp=function(a){if(this.da.get("readOnly"))this.log("readOnly mode: Ignoring undo.");else if(a?this.ha.Je():this.ha.Ke())a=a?this.ha.Kd():this.ha.jb(),this.ha.format(this.ka,this.request),this.gq(),this.Kf(),this.mg(),this.ic(),this.Kn(a),a=this.ha.bg,this.log("Most recent change page=%s",a),a!==this.ha.Ua?(this.log("Undo/redo switched page %s->%s",this.ha.Ua,a),this.Bb(a)):
this.ja(),this.wa.ua("document-changed")};c.prototype.Xj=function(){this.Vd();this.Og()};c.prototype.Vd=function(a,b){void 0===a&&(a=!1);var d=b?this.ha.tk(b,!1,!1):this.Vf();var c=this.ha.pt(d);0<d.length&&(!0!==a&&Ed.setItem("clipboard",c),this.log("Reset paste offset to 0"),this.Eh=this.Dh=0);return c};c.prototype.duplicate=function(){var a=this.vc(!1),b=this.da.get("pasteOffset"),d=b||this.da.get("pasteOffsetX");b=b||this.da.get("pasteOffsetY");0<a.length&&this.ta([new me(a,d,b)])};c.prototype.hg=
function(a){if(!a&&(a=Ed.getItem("clipboard"),!a))return;var b=this.da.get("pasteOffset"),d=b||this.da.get("pasteOffsetX");b=b||this.da.get("pasteOffsetY");this.Dh+=d;this.Eh+=b;this.log("Using paste offset %s,%s",this.Dh,this.Eh);d=new L(this.Dh,this.Eh);a=this.ha.eo(a,d);this.ta(a);this.update()};c.prototype.te=function(a){""!==a?(this.Zf=this.language.get(a),this.wa.ua("hint",this.Zf)):(this.Zf="",this.wa.ua("hint",""))};c.prototype.Wa=function(){return this.Pa(new Hd(this))};c.prototype.Pa=function(a){this.oa&&
this.oa.Ic&&this.oa.Ic();this.oa=a;a.tc&&a.tc();a.Xc&&this.wa.ua("tool-changed",a.Xc());return a};c.prototype.qk=function(){var a=null;this.oa.Xc&&(a=this.oa.Xc());return a};c.prototype.bj=function(a){if(this.da.get("readOnly"))this.log("readOnly mode: Ignoring tool click.");else return a=new Sd(this,a),this.Pa(a),a};c.prototype.Ik=function(a,b,d){this.da.get("readOnly")?this.log("readOnly mode: Ignoring tool click."):this.Pa(new Ud(this,"line",void 0,a,b,d))};c.prototype.dk=function(a){this.da.get("readOnly")?
this.log("readOnly mode: Ignoring tool click."):(a.lineWidth=a.lineWidth||this.Nf,a.strokeStyle=a.strokeStyle||this.Vb,this.Pa(new Td(this,this.oa,a,"brush")))};c.prototype.en=function(a){this.da.get("readOnly")?this.log("readOnly mode: Ignoring tool click."):(a.lineWidth=a.lineWidth||this.Nf,a.strokeStyle=a.strokeStyle||this.Vb,this.Pa(new Td(this,this.oa,a,"shapebrush")))};c.prototype.cn=function(a,b){this.da.get("readOnly")?this.log("readOnly mode: Ignoring tool click."):(a.lineWidth=a.lineWidth||
this.Nf,a.strokeStyle=a.strokeStyle||this.Vb,this.Pa(new Td(this,this.oa,a,b)))};c.prototype.Uj=function(a){this.da.get("readOnly")?this.log("readOnly mode: Ignoring tool click."):this.Pa(new Ud(this,"curve",void 0,a))};c.prototype.$t=function(a){this.da.get("readOnly")?this.log("readOnly mode: Ignoring tool click."):this.Pa(new Ud(this,"stampline",a))};c.prototype.Om=function(a,b){this.da.get("readOnly")?this.log("readOnly mode: Ignoring tool click."):this.Pa(new Ud(this,"arrow",void 0,a,b))};c.prototype.ee=
function(){if(this.ye){var a=this.ha.wk();a=new K(0,0,a.width,a.height);var b=this.da.get("pageInflation");a.Hc(b,b)}else a=this.ha.Ve();return a};c.prototype.ic=function(){if(!this.Fk())if(this.da.get("scrollbars")){var a=this.jc,b=this.ee(),d=this.Wf(),c=!1,f=!1;d.y<=b.y&&d.bottom()>=b.bottom()?this.fc.Xa():(this.fc.show(),this.fc.Wo(Math.min(d.y,b.y),Math.max(d.bottom(),b.bottom()),d.height,-this.ib/this.scale),c=!0);d.x<=b.x&&d.right()>=b.right()?this.kd.Xa():(this.kd.show(),this.kd.Wo(Math.min(d.x,
b.x),Math.max(d.right(),b.right()),d.width,-this.yb/this.scale),f=!0);f&&c?(this.fc.ve(20,a.height-20),this.kd.ve(a.width-20,20)):c?this.fc.ve(20,a.height):f&&this.kd.ve(a.width,20)}else this.fc.Xa(),this.kd.Xa()};c.prototype.pg=function(a,b,d){this.log("Set document size %s,%s",a,b);d?d.push(new Bd({width:a,height:b})):(this.ha.setProperty("width",a),this.ha.setProperty("height",b),this.ic(),this.mg(),this.wa.ua("document-changed"));return!0};c.prototype.Gi=function(a,b,d){if(this.og)return a*=d/
this.scale,b*=d/this.scale,this.log("Nudge selection by %s, %s",a,b),d=this.vc(!0),d.length&&(a=new L(a,b),this.ta([new Pd(d,a)])),0<d.length;this.log("Can't nudge; selection motion is locked.")};c.prototype.wf=function(a){var b=new U;var d=new E(-50,-50);var c=new E(50,-50);var f=new E(50,50);var g=new E(-50,50);b.moveTo(d.x,d.y);b.lineTo(c.x,c.y);b.lineTo(f.x,f.y);b.lineTo(g.x,g.y);b.lineTo(d.x,d.y);b.close();a=C.extend({},{commands:b.ec(),fillStyle:this.Db,strokeStyle:this.Mb,seed:Math.round(65535*
Math.random()),lineWidth:this.ya.lineWidth,sloppiness:this.ya.sloppiness,layer:this.La,wrap:this.da.get("multilineText"),fontSize:this.da.get("defaultFontSize")},a);this.log("Create an item on layer %s",this.La);this.Pa(new Vd(this,"PathNode",a,100,100,"rectangle","rectangle"))};c.prototype.Pl=function(a,b,d,c){var e=new U;for(var g=0;g<=a;g++){var h=50*Math.sin(b),k=50*-Math.cos(b);g&1&&(h*=d,k*=d);0===g?e.moveTo(h,k):e.lineTo(h,k);b+=2*Math.PI/a}e.close();c=C.extend({},{commands:e.ec(),fillStyle:this.Db,
strokeStyle:this.Mb,seed:Math.round(65535*Math.random()),lineWidth:this.ya.lineWidth,sloppiness:this.ya.sloppiness,layer:this.La,wrap:this.da.get("multilineText"),fontSize:this.da.get("defaultFontSize")},c);this.log("Create an item on layer %s",this.La);this.Pa(new Vd(this,"PathNode",c,100,100,this.da.Bn(),"polygon"))};c.prototype.Rs=function(){this.Pa(new Sc(this))};c.prototype.Ih=function(a){a=C.extend({},{commands:jd(),fillStyle:this.Db,strokeStyle:this.Mb,seed:Math.round(65535*Math.random()),
lineWidth:this.ya.lineWidth,sloppiness:this.ya.sloppiness,layer:this.La,wrap:this.da.get("multilineText"),fontSize:this.da.get("defaultFontSize")},a||{});this.Pa(new Vd(this,"PathNode",a,100,100,this.da.Bn(),"circle"))};c.prototype.Ql=function(a,b,d,c,f){this.Pa(new Vd(this,a,b,d,c,f,"shape"))};c.prototype.ru=function(a,b){this.Pa(new $d(this,a,b))};c.prototype.Ol=function(a){var b=this.ha.za(a,!1);if(!b)return this.log("useEditHandleTool: node %s doesn't exist.",a),!1;if(!b.Yf())return this.log("useEditHandleTool: nodetype %s has no edit mode",
b.type()),!1;this.Wa();this.nb();this.Nb();this.rf(b);this.ja()};c.prototype.Sl=function(a){this.Pa(new Wd(this,a))};c.prototype.Rl=function(){this.Pa(new be(this))};c.prototype.As=function(){if("interactive"===this.da.get("textMode"))this.bj({});else{var a=this.ha.Va();var b=this.Fa(new E(100,100));b=new L(b.x,b.y);this.ta([new V(a,"TextNode",{text:this.da.Ha("defaultText"),fontSize:this.ya.fontSize,fontName:this.ya.fontName,bold:this.ya.bold,italic:this.ya.italic,textFillStyle:this.ya.textFillStyle,
strokeStyle:this.ya.textStrokeStyle,lineWidth:this.ya.textLineWidth,layer:this.La}),new Pd([a],b)])}};c.prototype.Nk=function(a){var b=this.ha.Va();var d=this.Fa(new E(100,100));d=new L(d.x,d.y);this.ta([new V(b,"ImageNode",{url:a,layer:this.La}),new Pd([b],d)]);this.Wa()};c.prototype.Xf=function(){return ec()};c.prototype.Is=function(a,b){this.oa.nd?(this.log("Simulating click of colour %s",a),this.oa.nd(a,b)):this.log("A colour is not needed for this tool.")};c.prototype.Ns=function(a,b){this.oa.od?
(this.log("Simulating opacity change %s",a),this.oa.od(a,b)):this.log("An opacity is not needed for this tool.")};c.prototype.Bb=function(a){this.ha.Bb(a)&&(this.nb(),this.Nb(),this.ja(),this.wa.ua("set-page",a))};c.prototype.sl=function(a){this.ye=a;a=this.ee();this.yb=-a.x;this.ib=-a.y;this.ic();this.ja()};c.prototype.lj=function(){this.Nc(this.da.hl(1.1*this.scale))};c.prototype.mj=function(){this.Nc(this.da.hl(this.scale/1.1))};c.prototype.Tg=function(a,b,d){d=d||this.Kr(a);b=new Ac(b,d.x,d.y);
this.ta([new Pd(this.Cn(a),b)])};c.prototype.sn=function(a,b){this.Mn()||this.log("flipSelection: selection is empty");this.Tg(this.Vf(),a,b)};c.prototype.Wg=function(){var a=this.ka;return(window.devicePixelRatio||1)/(a.ov||a.dv||a.ev||a.gv||a.Wu||1)};c.prototype.Oo=function(a,b){var d=this.Wg();this.canvas.width=a*d;this.canvas.height=b*d;this.canvas.style.width=a+"px";this.canvas.style.height=b+"px";this.jc.width=a;this.jc.height=b};c.prototype.Wf=function(){var a=this.jc;return new K((0-this.yb)/
this.scale,(0-this.ib)/this.scale,a.width/this.scale,a.height/this.scale)};c.prototype.xh=function(a,b,d){void 0===b&&(b=!1);void 0===d&&(d=!1);this.log("setViewRect(%s)",a);var c=this.jc,f=Math.min(c.width/a.width,c.height/a.height),g=a.x*f,h=a.y*f;this.yb=b?(c.width-a.width*f)/2-g:-g;this.ib=d?(c.height-a.height*f)/2-h:-h;this.xd=this.scale=f;this.ic();this.ja()};c.prototype.ar=function(a){this.request.Ie?(this.log("Formatting in progress; will call function soon"),this.request.once("done",a)):
(this.log("Format already done; call function in 1 tick"),setTimeout(a,0))};c.prototype.Bi=function(a){!this.Ef&&a?(this.log("Locking updates."),this.Ef=!0):this.Ef&&!a&&(this.log("Resuming updates"),this.Ef=!1,this.mg(),this.ic(),this.ja())};c.prototype.Fk=function(){this.Ef&&this.log("Updates are locked. Ignoring draw/format request");return this.Ef};c.prototype.yl=function(a){var b=this;a?(b.Cc=document.createElement("img"),b.Cc.setAttribute("src",b.da.ub("wd-done.png")),b.Cc.onload=function(){b.ja()}):
b.Cc=null};c.prototype.Mk=function(){var a=this,b=document.createElement("canvas");b.width=this.canvas.width;b.height=this.canvas.height;var d=b.getContext("2d"),c=this,f=!1;c.ja(function(){d.drawImage(a.canvas,0,0);f=!0});return{ja:function(a,d){c.requestAnimationFrame.call(window,function(){if(f&&(c.ka.setTransform(1,0,0,1,0,0),c.ka.clearRect(0,0,c.canvas.width,c.canvas.height),c.ka.drawImage(b,0,0),a)){var e=c.Wg();c.ka.scale(e,e);c.ka.translate(c.yb,c.ib);c.ka.scale(c.scale,c.scale);a.call(d,
c.ka)}})}}};return c}();var oe=function(){function c(a,b,d){var c=this;this.wa=a;this.ia=b;this.rb=new sb;this.sg=!1;this.no=this.qo=-1;this.ym=!1;this.ao=this.bo=0;this.xf="";this.xg=null;this.log=B.create("APP");this.ia.empty();"absolute"!==this.ia.ea("position")&&"fixed"!==this.ia.ea("position")&&this.ia.ea("position","relative");this.ia.ea("overlow","none");this.ia.ea("text-align","left");this.Mf=new tb(C("<div>").ea("width","300px"),this.rb);this.log("Zwibbler built on %s",new Date(1527177474860));this.ia.append(this.Mf.ia);
this.da=new qd(d);this.language=new wb("\nen:arrowhead-size:Arrowhead size\nes:arrowhead-size:Flecha tama\u00f1o\n\nen:arrowhead-size-large:Large\nes:arrowhead-size-large:Grande\n\nen:arrowhead-size-medium:Medium\nes:arrowhead-size-medium:Medio\n\nen:arrowhead-size-none:None\nes:arrowhead-size-none:Nada\n\nen:arrowhead-size-small:Small\nes:arrowhead-size-small:Peque\u00f1o\n\nen:arrowhead-size-tiny:Tiny\nes:arrowhead-size-tiny:Diminuto\n\nen:arrowhead-style:Arrowhead style\nes:arrowhead-style:Flecha estilo\n\nen:arrowhead-style-simple:Simple\nes:arrowhead-style-simple:Llanura\n\nen:arrowhead-style-solid:Solid\nes:arrowhead-style-solid:Denso\n\nen:arrow-keys:Arrow Keys\nes:arrow-keys:Teclas de flecha\n\nen:arrow-tool:Arrow tool\nes:arrow-tool:Flecha\nfr:arrow-tool:Fl\u00e8che\nnl:arrow-tool:Pijl\n\nen:break-apart-group:Break apart group\nes:break-apart-group:Dividir el grupo\n\nen:bring-to-front:Bring to front\nes:bring-to-front:Traer al frente\n\nen:brush-tool:Brush tool\nes:brush-tool:Brocha\nfr:brush-tool:Brosse\nnl:brush-tool:Penseel\n\nen:circle-tool:Circle tool\nes:circle-tool:C\u00edrculo\nfr:circle-tool:Cercle\nnl:circle-tool:Cirkel\n\nen:click-to-place-another-point-or-double-click-to-end-the-line:Click to place another point, or double-click to end the line.\nes:click-to-place-another-point-or-double-click-to-end-the-line:Haga clic para colocar otro punto, o doble clic para finalizar la l\u00ednea\nfr:click-to-place-another-point-or-double-click-to-end-the-line:Cliquez pour placer un autre point, ou double-cliquez pour terminer la ligne.\nnl:click-to-place-another-point-or-double-click-to-end-the-line:Klik op een ander punt te plaatsen, of dubbelklik om de lijn te be\u00ebindigen.\n\nen:click-to-place-first-point-of-line:Click to place first point of line\nes:click-to-place-first-point-of-line:Haga clic para colocar el primer punto de la l\u00ednea\nfr:click-to-place-the-first-point-of-line:Cliquez pour placer le premier point de la ligne\nnl:click-to-place-the-first-point-of-line:Klik om het eerste punt van de lijn te plaatsen.\n\nen:click-to-set-the-end-of-the-line:Click to set the end of the line\nes:click-to-set-the-end-of-the-line:Haga clic para colocar el extremo de la l\u00ednea\nfr:click-to-set-the-end-of-the-line:Cliquez pour d\u00e9finir la fin de la ligne\nnl:click-to-set-the-end-of-the-line:Klik hier voor het einde van de lijn in te stellen.\n\nen:copy:Copy\nes:copy:Copiar\nfr:copy:Copie\nnl:copy:Kopi\u00ebren\n\nen:curve-tool:Curve tool\nes:curve-tool:Curva\nfr:curve-tool:Courbes\nnl:curve-tool:Kromme\n\nen:delete-selection:Delete selection\nes:delete-selection:Eliminar la selecci\u00f3n\n\nen:del-key:Del\nes:del-key:Del\n\nen:double-arrows:Double arrows\nes:double-arrows:flechas dobles\n\nen:draw-curves:Draw curves\nes:draw-curves:Dibuje las curvas\n\nen:draw-lines:Draw lines\nes:draw-lines:Dibujar l\u00edneas\n\nen:duplicate-selection:Duplicate selection\nes:duplicate-selection:Duplica la selecci\u00f3n\n\nen:fill-colour:Fill colour\nes:fill-colour:Color de relleno\n\nen:font:Font\nes:font:Font\n\nen:font-size:Font size\nes:font-size:Tama\u00f1o de letra\n\nen:group-selection:Group selection\nes:group-selection:Grupo la selecci\u00f3n\n\nen:image-tool:Image tool\nes:image-tool:Imagen\nfr:image-tool:Image\nnl:image-tool:Afbeelding\n\nen:image-url:Image URL\nes:image-url:URL de la imagen\n\nen:keyboard:Keyboard\nes:keyboard:Teclado\n\nen:line-style:Line style\nes:line-style:Estilo de l\u00ednea\n\nen:line-style-long-dashes:Long dashes\nes:line-style-long-dashes:Gui\u00f3n largo\n\nen:line-style-short-dashes:Short dashes\nes:line-style-short-dashes:Gui\u00f3n corto\n\nen:line-style-solid:Solid\nes:line-style-solid:Denso\n\nen:line-tool:Line tool\nes:line-tool:Raya\nfr:line-tool:Lignes\nnl:line-tool:Lijn\n\nen:move-selection-away:Move selection away\nes:move-selection-away:Mover la selecci\u00f3n de distancia\n\nen:move-selection-closer:Move selection closer\nes:move-selection-closer:Mover la selecci\u00f3n de distancia\n\nen:move-while-zoomed:Move while zoomed\nes:move-while-zoomed:Desplazarse por la pantalla\n\nen:none:None\nes:none:Nada\n\nen:no:No\nes:no:No\n\nen:outline-colour:Outline colour\nes:outline-colour:Color del contorno\n\nen:outline-thickness:Outline thickness\nes:outline-thickness:Grosor del contorno\n\nen:page-down-key:Page Down\nes:page-down-key:Page Down\n\nen:page-up-key:Page Up\nes:page-up-key:Page Up\n\nen:paste:Paste\nes:paste:Pegar\nfr:paste:Coller\nnl:paste:Plak\n\nen:pick-tool:Pick tool\nes:pick-tool:Seleccionar\nfr:pick-tool:S\u00e9lectionner\nnl:pick-tool:Uitkiezen\n\nen:rectangle-tool:Rectangle tool\nes:rectangle-tool:rect\u00e1ngulo\nfr:rectangle-tool:Rectangle\nnl:rectangle-tool:Rechthoek\n\nen:redo:Redo\nes:redo:Rehacer\nfr:redo:Refaire\nnl:redo:Opnieuw maken\n\nen:rounded-rectangle-tool:Rounded rectangle tool\nes:rounded-rectangle-tool:Rect\u00e1ngulo redondeado\n\nen:save:Save\nes:save:Guardar\n\nen:send-to-back:Send to back\nes:send-to-back:Enviar a la parte posterior\n\nen:shadow:Shadow\nes:shadow:Sombra\n\nen:shape-brush-tool:Shape brush tool\nes:shape-brush-tool:Brush que dibuja formas\n\nen:sloppiness-artist:Artist\nes:sloppiness-artist:Artista\n\nen:sloppiness-cartoonist:Cartoonist\nes:sloppiness-cartoonist:Caricaturista\n\nen:sloppiness-child:Child\nes:sloppiness-child:Ni\u00f1o\n\nen:sloppiness-draftsman:Draftsman\nes:sloppiness-draftsman:Dibujante\n\nen:sloppiness-drunk:Drunk\nes:sloppiness-drunk:Borracho\n\nen:sloppiness:Sloppiness\nes:sloppiness:La dejadez\n\nen:smoothness-sharper:Sharper\nes:smoothness-sharper:Muy afilado\n\nen:smoothness-sharpest:Sharpest\nes:smoothness-sharpest:M\u00e1s afilado\n\nen:smoothness-sharp:Sharp\nes:smoothness-sharp:Afilado\n\nen:smoothness-smoothest:Smoothest\nes:smoothness-smoothest:Muy liso\n\nen:smoothness:Smoothness\nes:smoothness:Lisura\n\nen:smoothness-smooth:Smooth\nes:smoothness-smooth:Liso\n\nen:text-colour:Text colour\nes:text-colour:Color del texto\n\nen:text:Text\nes:text:Texto\n\nen:text-tool:Text tool\nes:text-tool:Texto\nfr:text-tool:Texte\nnl:text-tool:Tekst\n\nen:thickness-brush:Brush\nes:thickness-brush:Brocha\n\nen:thickness-marker:Marker\nes:thickness-marker:Rotulador\n\nen:thickness-pencil:Pencil\nes:thickness-pencil:L\u00e1piz\n\nen:thickness-pen:Pen\nes:thickness-pen:Pluma\n\nen:undo:Undo\nes:undo:Deshacer\nfr:undo:D\u00e9faire\nnl:undo:Ongedaan maken\n\nen:yes:Yes\nes:yes:S\u00ed\n\nen:zoom-in:Zoom in\nes:zoom-in:Zoom\n\nen:zoom-out:Zoom out\nes:zoom-out:Disminuir el zoom\n");
this.language.Uo(this.da.get("language"));this.dd=null;this.Td=C("<div>");this.Td.ea("position","absolute");this.Td.ea("overflow","hidden");this.ia.append(this.Td);this.canvas=C(Zb(this.Td[0]));this.canvas.ea("outline","0");this.canvas.ea("position","absolute");this.canvas.ea("left","0");this.canvas.ea("top","0");this.canvas.Jb("tabindex","0");this.ka=this.canvas[0].getContext("2d");a=this.da.wd();this.Ub=new oc(this.ia,a?40:20,a,!1,this.da.get("colourPalette"));this.da.xa("useTouch",function(a,b,
d){d||(c.da.wd()?(a=40,b=!0):(a=20,b=!1),c.Ub.ve(a,b),c.Dg(!0))});this.Wb=new Hb;this.view=new ne(this.canvas,new zd,this.Ub,this.Wb,this.da,this.language,this.wa,this.rb);this.Po();this.toolbar=this.di();this.wa.xa("tool-changed",function(a){c.toolbar.No(a)});this.hs=this.Mt();this.Sb=new rd(this.da,this.language,this.rb);this.ia.append(this.Sb.ia);this.da.Zo()&&(this.view.Sb=this.Sb);this.Sb.view=this.view;this.Sb.xa("click",function(){c.focus("none")});this.rb.bind(C(window),"resize",function(){setTimeout(function(){c.Dg()},
1)});window.$&&(this.log("jQuery detected; register for bootstrap events"),window.$(document).bind("shown.bs.modal",function(){c.log("Bootstrap modal shown; resize now");c.wa.resize()}));this.query=od();this.sg="debug"in this.query||this.da.sg();this.Bc=new Ob(this.ia);this.Bc.ia.ea("border-right","1px solid black");this.Fc=new Ob(this.ia);this.Fc.ia.ea("border-top","1px solid black");this.Fc.xa("click",function(a){c.view.Nk(a)});this.Bc.xa("click",function(a){c.Si(a)});null!==this.da.Ha("backgroundImage")&&
(this.Si(this.da.Ha("backgroundImage")),this.view.ha.rh());this.Pq();this.da.xa("update",function(a,b){c.ne(a,b)});this.$b=new pc(this.wa,C("<div>"),!1,!this.da.get("showPageSelectorControls"));this.$b.ia.ea("position","absolute");this.$b.ia.ea("top","0");this.$b.ia.ea("bottom","0");this.$b.ia.ea("width","160px");this.$b.ia.ea("left","50px");this.$b.ia.ea("background",this.da.get("outsidePageColour"));this.$b.Ti(this.da.get("showPageSelector"));this.ia.append(this.$b.ia);this.cl=C("<div>").ea("position",
"absolute").ea("top","0").ea("right","0").ea("box-shadow","3px 3px 3px #444").ea("background","#ccc").ea("color","black").ea("border-bottom-left-radius","4px").ea("font-family","arial,sans");this.ia.append(this.cl);this.Dg();this.Wj=(a=this.da.rk("pageSelectorDiv"))?new pc(this.wa,C(a),!0,!0):null;this.da.get("setFocus")&&this.focus("toolbar");this.hi=[];this.$b.ml(this.wa);this.Wj&&(this.Wj.ml(this.wa),this.Wj.Ti(!0));this.wa.ua("document-changed");this.wa.ua("set-page",this.view.ha.Ua);if(Ed.Wh()){if(this.da.get("persistent")&&
(a=Ed.getItem("zwibbler-document")))try{var f=Dd.sj(a);if(f)this.qf(f);else throw Error("Failed to open document.");}catch(g){this.log("Failed to load persistent document: %s",g.message)}this.xg=Fd(function(){c.da.get("persistent")&&(c.log("Saving document"),Ed.setItem("zwibbler-document",c.wa.save()))});this.wa.xa("document-changed",function(){c.xg()});this.rb.add(function(){c.xg.cancel()})}this.rb.add(function(){c.ia.empty();delete c.ia[0].zwibbler})}c.prototype.Of=function(){this.rb.Of()};c.prototype.ne=
function(a,b){var c=!1;this.log("onConfigChange %s=%s",a,b);switch(a){case "debug":case "showDebug":this.sg=b;c=!0;break;case "showPageSelector":c=!0;this.$b.Ti(b);break;case "backgroundImage":this.Si(b);break;case "colourPalette":this.Ub.vt(b);break;case "showToolbar":case "showColourPanel":c=!0;break;case "showArrowTool":case "showBrushTool":case "showCircleTool":case "showCopyPaste":case "showCurveTool":case "showLineTool":case "showMoveToFrontBack":case "showPickTool":case "showRoundRectTool":case "showShapeBrushTool":case "showSquareTool":case "showTextTool":case "showUndoRedo":case "toolbarButtonSize":this.di();
c=!0;break;case "language":this.language.Uo(b)}c&&this.Dg(!0)};c.prototype.Pq=function(){var a;var b=this.da.Ha("fonts");var c=[];var e=0;for(a=b.length;e<a;e++){var f=b[e];this.log("Preloading: %s",f);f=C("<div>").ea("font-family",f).text("abcd");f.ea("color","transparent");c.push(this.ia.append(f))}};c.prototype.Po=function(){this.da.Ha("sloppy")||this.view.re("sloppiness",0);this.view.re("smoothness",this.da.rr());this.view.re("fillStyle",this.da.Ha("defaultFillStyle"));this.view.re("strokeStyle",
this.da.Ha("defaultStrokeStyle"));this.view.re("fontName",this.da.Ha("defaultFont"));this.view.re("fontSize",this.da.Ha("defaultFontSize"));this.view.re("lineWidth",this.da.Ha("defaultLineWidth"));this.view.re("textFillStyle",this.da.Ha("defaultTextFillStyle"))};c.prototype.tt=function(a,b){var c;this.Bc.clear();b&&this.Bc.Ui(b,b);var e=[];var f=0;for(c=a.length;f<c;f++){var g=a[f];"string"===typeof g?e.push(this.Bc.Uh(g,g)):e.push(this.Bc.Uh(g.small,g.large,g.tooltip))}};c.prototype.Et=function(a,
b){var c;this.Fc.clear();var e=[];b&&this.Fc.Ui(b,b);var f=0;for(c=a.length;f<c;f++){var g=a[f];"string"===typeof g?e.push(this.Fc.Uh(g,g)):e.push(this.Fc.Uh(g.small,g.large,g.tooltip))}};c.prototype.qf=function(a){this.dd=null;this.view.qf(a);this.Po();this.Uq();this.wa&&(this.wa.ua("document-changed"),this.wa.ua("set-page",a.Ua));for(a=0;a<this.hi.length;a++){var b=this.hi[a];this.log("Removing old DomElement of type %s",b.tagName);C(b).remove()}this.hi=[]};c.prototype.kq=function(){this.view.ha.rh()};
c.prototype.di=function(){function a(a){return 0===a.type.indexOf("key")}var b,c=this;this.toolbar&&this.toolbar.ia.remove();var e=this.language.fn(),f=new Ib(this.da.get("toolbarButtonSize"));this.toolbar=f;if(this.da.get("showToolbar")){this.da.get("showPickTool")&&f.Fe("pick",e("pick-tool"),this.da.ub("wd-pick.png"),function(b){c.view.Wa();a(b)&&c.qd()});this.da.get("showSquareTool")&&f.hc(this.da.ub("wd-box.png"),e("rectangle-tool"),function(b){c.view.wf({});a(b)&&c.El(b)});this.da.get("showRoundRectTool")&&
f.hc(this.da.ub("wd-roundrect.png"),e("rounded-rectangle-tool"),function(b){c.view.wf({roundRadius:c.da.get("defaultRoundRectRadius")});a(b)&&c.El(b)});this.da.get("showCircleTool")&&f.hc(this.da.ub("wd-circle.png"),e("circle-tool"),function(b){c.view.Ih({});a(b)&&c.El(b)});this.da.get("showShapeBrushTool")&&f.Fe("shapebrush",e("shape-brush-tool"),this.da.ub("wd-shapebrush.png"),function(b){c.view.en({});a(b)&&c.qd()});this.da.Ot()&&f.Fe("brush",e("brush-tool"),this.da.ub("wd-brush.png"),function(b){c.view.dk({});
a(b)&&c.qd()});this.da.get("showLineTool")&&f.Fe("line",e("line-tool"),this.da.ub("wd-line.png"),function(b){c.view.Ik({angleArcs:c.da.get("angleArcs")},!1,!1);a(b)&&c.qd()});this.da.get("showCurveTool")&&f.Fe("curve",e("curve-tool"),this.da.ub("wd-curve.png"),function(b){c.view.Uj({});a(b)&&c.qd()});this.da.get("showArrowTool")&&f.Fe("arrow",e("arrow-tool"),this.da.ub("wd-arrow.png"),function(b){c.view.Om({},!1);a(b)&&c.qd()});this.da.get("showTextTool")&&f.Fe("text",e("text-tool"),this.da.ub("wd-text.png"),
function(b){c.view.As();a(b)&&c.qd(!0)});var g=function(a){c.toolbar.hc(a.image,a.name,function(b){c.Ls(b,a)})};var h=0;for(b=Cd.buttons.length;h<b;h++){var k=Cd.buttons[h];this.log("add custom button %s",name);g(k)}f.No("pick");this.da.Ha("showImageTool")&&f.hc(this.da.ub("wd-image.png"),e("image-tool"),function(){c.view.Nk("logo.png")});this.da.Ha("showMoveToFrontBack")&&(f.hc(this.da.ub("wd-moveup.png"),e("bring-to-front"),function(){c.view.Fg()}),f.hc(this.da.ub("wd-movedown.png"),e("send-to-back"),
function(){c.view.uh()}));this.da.get("showUndoRedo")&&(f.hc(this.da.ub("wd-undo.png"),e("undo"),function(){c.view.jb()}),f.hc(this.da.ub("wd-redo.png"),e("redo"),function(){c.view.Kd()}));this.da.get("showCopyPaste")&&(f.hc(this.da.ub("wd-copy.png"),e("copy"),function(){c.view.Vd()}),f.hc(this.da.ub("wd-paste.png"),e("paste"),function(){c.view.hg()}))}f.xa("click",function(){c.focus("toolbar")});f.ia.style.position="absolute";f.ia.style.left="0";f.ia.style.right="0";this.ia.append(C(f.ia));return f};
c.prototype.Ls=function(a,b){this.log("Custom button %s clicked.",b.name);b.onclick.call(a.target,this.wa)};c.prototype.Mt=function(){var a=this,b=this;this.xf="none";var c=new Kb;this.da.Up(c);c.xa("*",function(a,c){"toolbar"===b.xf?b.toolbar.Zb(a,c):"canvas"===b.xf?b.view.Zb(a,c):b.log("Ignore key action -- don't have focus.")});this.ia.Jb("tabindex","0");c.Vp(this.ia[0]);this.rb.add(function(){b.hs.detach(b.ia[0])});this.view.li=!1;this.canvas.click(function(){dc()||b.view.li?b.xf="canvas":b.focus("canvas");
b.view.li=!1});C(this.toolbar.ia).click(function(){b.focus("toolbar")});this.Ub.xa("colour",function(){b.focus("canvas")});this.Wb.xa("goto-toolbar",function(){b.da.get("showToolbar")?b.focus("toolbar"):b.wa.ua("blur")});this.Wb.xa("goto-canvas",function(){b.focus("canvas")});this.rb.bind(this.ia,"blur",function(){b.log("Blur event received -- hide keyboard cursor");b.view.Qn()});this.da.Bk()&&this.rb.bind(C(document),"cut copy paste",function(b){a.view.Gs(b)});return c};c.prototype.focus=function(a){this.log("Set focus to %s",
a);if("toolbar"!==a&&"canvas"!==a&&"none"!==a)throw"Focus must be toolbar or canvas or none, not "+a;this.xf=a;"toolbar"===this.xf?(this.toolbar.focus(),this.view.Qn(),this.ia.focus()):"canvas"===this.xf&&(this.toolbar.blur(),this.ia.focus())};c.prototype.El=function(a){this.focus("canvas");this.view.Yo(a)};c.prototype.qd=function(a){void 0===a&&(a=!1);this.focus("canvas");this.view.qd(a)};c.prototype.createNode=function(a,b,c){var d=this.view.ha.Va();"layer"in c||(c.layer=this.view.La);a.push(new V(d,
b,c));return d};c.prototype.transformNode=function(a,b,c){a.push(new Pd(b,c));return!0};c.prototype.rl=function(a,b,c,e,f,g,h,k){c=new M(c,f,e,g,h,k);a.push(new Rd(b,"matrix",c));return!0};c.prototype.gj=function(a,b,c,e){c=new L(c,e);a.push(new Pd(b,c));return!0};c.prototype.il=function(a,b,c,e,f,g){c=new O(c,e,f,g);a.push(new Pd(b,c));return!0};c.prototype.sc=function(a,b){a.push(new le(b));return!0};c.prototype.Uq=function(){var a=this;this.dd=null;this.view.ha.sb(!1,function(b){"ImageNode"!==
b.type()||"background"!==b.la("layer")&&"background"!==b.la("tag")||(a.log("Found background image at nodeid %s",b.id),a.dd=b.id,b.se(!0))})};c.prototype.Si=function(a){var b=[];null!==this.dd&&this.view.ha.Qe(this.dd)&&b.push(new le([this.dd]));if(a){var c=this.view.ha.Va();b.push(new V(c,"ImageNode",{url:a,locked:!0,tag:"background",layer:this.view.La}));b.push(new je([c],je.uj))}this.dd=c||null;this.view.ta(b);c&&this.view.ha.za(c,!1).se(!0);this.view.nb();this.view.Nb()};c.prototype.kr=function(){return null!==
this.dd&&this.view.ha.Qe(this.dd)?this.view.ha.za(this.dd).la("url"):null};c.prototype.Lk=function(){this.qf(new zd);null!==this.da.Ha("backgroundImage")&&(this.Si(this.da.Ha("backgroundImage")),this.view.ha.rh())};c.prototype.Dg=function(a){void 0===a&&(a=!1);var b,c,e;var f=C(window).width();var g=C(window).height();if(a||f!==this.bo||g!==this.ao)if(this.bo=f,this.ao=g,f=this.ia.width()-0,g=this.ia.height()-0,!(0>=f||!a&&f===this.qo&&g===this.no)){this.qo=f;this.no=g;if(this.da.Ha("showBackgroundSelector")){var h=
100;this.Bc.show();this.Bc.Ui(h-24,0)}else h=0,this.Bc.Xa();if(this.da.Ha("showImageSelector")){var k=100;this.Fc.Ui(0,k-24);this.Fc.show()}else k=0,this.Fc.Xa();if(this.da.Ha("showPageSelector")){this.$b.ia.show();var l=this.$b.ia.outerWidth()}else this.$b.ia.Xa(),l=0;if(this.da.Pt()){this.Ub.show();this.Ub.wl(f);var m=this.Ub.height()}else this.Ub.Xa(),m=0;this.log("Colour panel height is %s",m);if(this.da.St()){this.toolbar.show(!0);this.toolbar.cr(g-m);var n=this.toolbar.width()}else this.toolbar.show(!1),
n=0;a=this.view.Vg();this.toolbar&&this.toolbar.moveTo(h+l,0);var q=g-m;var u=b=e=0;this.sg&&(this.Mf.show(),u=this.Mf.width());(c=this.da.Zo()&&700<=f)&&(b=300);e+=b+u;var v=f-2*a-h-e;var z=g-2*a-m-k;this.Bc.width(h);this.Bc.height(g-2*a-m);this.Bc.moveTo(0,0);this.$b.ia.ea("top","0");this.$b.ia.ea("left","0");this.Fc.width(v);this.Fc.height(k);this.Fc.moveTo(h,g-2*a-m-k);k=l+h+n;h=f-2*a-n-e-h-l;this.Td.ea("left",""+k+"px");this.Td.ea("top","0");this.Td.ea("width",""+h+"px");this.Td.ea("height",
""+z+"px");this.view.Oo(h,z);this.Ub&&(this.Ub.moveTo(k,q),this.Ub.wl(f-k),this.Ub.ja());this.cl.ea("top","0").ea("right",""+(b+u)+"px");this.sg?(this.Mf.moveTo(f-u,0),this.Mf.height(g-2*a-m)):this.Mf.Xa();c?(this.Sb.show(),this.Sb.moveTo(f-u-b,0),this.Sb.width(b),this.Sb.height(g-2*a-m)):this.ym||this.Sb.Xa();this.view.oe()}};c.prototype.wj=function(a,b,c){void 0===c&&(c=this.view.ha.Ua);var d=this.view.ha.Ua;this.view.ha.Bb(c);a.translate(-b.x,-b.y);this.view.Rg(a,b.x,b.y,b.width,b.height);this.view.ha.ja(a);
this.wa.hd&&this.wa.hd(a);this.view.ha.Bb(d)};c.prototype.Go=function(a,b){if("image/svg+xml"===a||"application/pdf"===a){var c=!1;if("image/svg+xml"===a)var e=new yd(new K(0,0,b.width,b.height));else e=new wd(new K(0,0,b.width,b.height),Cd.fonts),c=!0;if(c)for(c=0;c<this.view.ha.Ec();c++)0<c&&e.tg(),this.wj(e,b,c);else this.wj(e,b);return"data:"+a+";base64,"+x.encode("base64",e.toString())}c=C("<canvas>");c.Jb("width",""+b.width);c.Jb("height",""+b.height);e=c[0].getContext("2d");if("image/jpeg"===
a||"image/bmp"===a)e.fillStyle="#ffffff",e.fillRect(0,0,b.width,b.height);this.wj(e,b);if("image/bmp"===a)if(e=c[0],c=e.getContext("2d"),null===c)e="error";else{var f=c.getImageData(0,0,e.width,e.height);e=f.width;var g=f.height;c=e*g*3;var h=c+54,k=[66,77,h&255,h>>8&255,h>>16&255,h>>24&255,0,0,0,0,54,0,0,0],l=[40,0,0,0,e&255,e>>8&255,e>>16&255,e>>24&255,g&255,g>>8&255,g>>16&255,g>>24&255,1,0,24,0,0,0,0,0,c&255,c>>8&255,c>>16&255,c>>24&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];c=(4-3*e%4)%4;f=f.data;h=
e<<2;for(var m=Sb.Ag("Base64Encoder"),n=0;n<k.length;n++)m.Qa(k[n]);for(n=0;n<l.length;n++)m.Qa(l[n]);do{k=h*(g-1);for(l=0;l<e;l++)n=l<<2,m.Qa(f[k+n+2]),m.Qa(f[k+n+1]),m.Qa(f[k+n]);for(k=0;k<c;k++)m.Qa(0)}while(--g);m.flush();e="data:image/bmp;base64,"+m.Tf().toString()}else e=c[0].toDataURL(a);return e};c.prototype.ue=function(a,b,c,e){this.log("External app setItemProperty %s: %s=%s",b,c,e);a.push(new Rd(b,c,e));return!0};c.prototype.ql=function(a,b,c){var d;this.log("External app setNodeProperty %s: %s",
b,c);for(d in c)c.hasOwnProperty(d)&&a.push(new Rd(b,d,c[d]));return!0};c.prototype.ri=function(a,b){var c,e;(c=this.view.ha.za(a))&&(e=c.la(b));this.log("GetItemProperty %s: %s=%s",a,b,e);return e};c.prototype.Rj=function(a,b){var c,e;if(6>b.length)this.log("newShape: Cannot create shape with fewer than three points.");else{var f=new U;var g=c=0;for(e=b.length-1;c<=e;g=c+=2){var h=this.view.Fa(new E(b[g],b[g+1]));if(0===g){f.moveTo(h.x,h.y);var k=h}else f.lineTo(h.x,h.y)}k&&(f.lineTo(k.x,k.y),f.close());
return this.bi(a,f.ec())}};c.prototype.bi=function(a,b){return this.createNode(a,"PathNode",{commands:b,fillStyle:this.view.Db,strokeStyle:this.view.Mb,seed:Math.round(65535*Math.random()),lineWidth:this.view.ya.lineWidth,sloppiness:this.view.ya.sloppiness,angleArcs:this.da.get("angleArcs")})};c.prototype.Mg=function(a,b){var c=this.view.ha.Va();a.push(new Ad(c,b));return c};c.prototype.Gh=function(a,b){a.push(new ke(b));return!0};c.prototype.yq=function(a){return new pb(this.cl,a)};return c}();var pe=function(){function c(a,b){this.view=a;this.methods=b;this.log=B.create("CustomToolBehaviour");this.ac=new Rc(a)}c.prototype.tc=function(){this.log("Entering CustomToolBehaviour");this.methods.enter&&this.methods.enter()};c.prototype.Ic=function(){this.log("Leaving CustomToolBehaviour");this.methods.leave&&this.methods.leave()};c.prototype.nc=function(a,b,c){return this.methods.onMouseClick?this.methods.onMouseClick(a,b,c):!1};c.prototype.Sa=function(a,b,c){return this.methods.onMouseDown?
this.methods.onMouseDown(a,b,c):!1};c.prototype.Ta=function(a,b,c){return this.methods.onMouseMove?this.methods.onMouseMove(a,b,c):!1};c.prototype.Za=function(a,b,c){return this.methods.onMouseUp?this.methods.onMouseUp(a,b,c):!1};c.prototype.Hd=function(a,b,c){return this.methods.onDoubleClick?this.methods.onDoubleClick(a,b,c):!1};c.prototype.nd=function(a,b){return this.methods.onColour?this.methods.onColour(a,b):!1};c.prototype.od=function(a,b){return this.methods.onOpacity?this.methods.onOpacity(a,
b):!1};c.prototype.Zb=function(a){this.log("keyboard: %s",a);"cancel"===a&&(this.log("ESC pressed. Abort brush and go back to toolbar."),this.view.Wa(),this.view.Wb.ua("goto-toolbar"))};c.prototype.ph=function(a){if(this.methods.onRedraw)this.methods.onRedraw(a)};c.prototype.wb=function(a){if(this.methods.onTouch)return this.methods.onTouch(a);if("touchstart"===a.type||"touchmove"===a.type||"touchend"===a.type){if(a.touches&&a.touches.length)var b=a.touches[0];else a.changedTouches&&a.changedTouches.length?
b=a.changedTouches[0]:(this.log("No touches!"),b={pageX:0,pageY:0});b=this.view.eb(b.pageX,b.pageY);return"touchstart"===a.type?this.Sa(b.x,b.y,a):"touchend"===a.type?this.Za(b.x,b.y,a):"touchmove"===a.type?this.Ta(b.x,b.y,a):!1}};c.prototype.Ya=function(a){return this.methods.onGesture?this.methods.onGesture(a):this.ac.Ya(a)};c.prototype.Wk=function(a,b,c,e){return this.methods.onMouseWheel?this.methods.onMouseWheel(a,b,c,e):!1};c.prototype.Xc=function(){return this.methods.getToolName?this.methods.getToolName():
"custom"};return c}();var qe=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.element=null;b.fi=void 0;b.ob=new Q;b.zk=new Q;b.$d=new M;b.readOnly=!1;b.xb=!1;b.Wc=null;b.width=0;b.height=0;b.oc=null;b.log=B.create("DomNode",!0);b.aa.data="";b.aa.locked=!1;return b}p(a,c);a.prototype.type=function(){return"DomNode"};a.prototype.setProperty=function(a,d){if("data"===a)this.element&&(C(this.element).remove(),this.fi=this.element=null);else if("border"===a||"lockSize"===a||"lockRotate"===a||"preview"===a){this.aa[a]=
d;return}c.prototype.setProperty.call(this,a,d)};a.prototype.Bt=function(a){null!==this.Wc&&(this.log("Node %s receives DOM element and requests reformat",this.id),this.element&&(this.log("   Remove existing DOM element"),C(this.element).remove()),this.element=a,this.element.style.position="absolute","IFRAME"!==a.tagName&&(this.element.style.pointerEvents="none"),ob(C(this.element),this.Wc.pk()),this.width=this.element.offsetWidth||parseFloat(this.element.getAttribute("width")||"0"),this.height=this.element.offsetHeight||
parseFloat(this.element.getAttribute("height")||"0"),C(this.element).remove(),this.rg(this.readOnly,!0),this.element.style.top="0px",this.element.style.left="0px",this.Dj("transformOrigin","top left"),this.log("element height: %s, %s",this.element.offsetWidth,this.element.offsetHeight),this.Wc.Pi(this.id))};a.prototype.rk=function(){return this.element};a.prototype.Dj=function(a,c){if(null!==this.element){for(var b=a.charAt(0).toUpperCase()+a.substr(1),d=["ms","Webkit","O","Moz"],g=0;g<d.length;g++)this.element.style[d[g]+
b]=c;this.element.style[a]=c}};a.prototype.se=function(a){R.prototype.se.call(this,a);this.element&&(this.element.style.visibility=this.Oh?"hidden":"visible")};a.prototype.rg=function(a,c){void 0===c&&(c=!1);if(c||this.readOnly!==a)this.readOnly=a,this.element&&this.Wc&&this.xb&&(ob(C(this.element),this.Wc.pk()),a?C(this.element).ea("pointer-events","auto"):C(this.element).ea("pointer-events","none"))};a.prototype.format=function(a,c){var b=this;null===this.element&&this.fi!==this.la("data")&&c&&
(this.fi=this.la("data"),this.Wc=c,this.log("DomNode %s requests conversion to DOM element",this.id),this.Wc.sq(this.fi,this.id));if(this.element){var d=this.$d;d=d.multiply(this.Ga());d.Zn()?(this.Dj("transform",""),this.element.style.left=""+d.Ca+"px",this.element.style.top=""+d.Da+"px"):(this.element.style.left="0px",this.element.style.top="0px",this.Dj("transform","matrix("+d.m11+","+d.m21+","+d.m12+","+d.m22+","+d.Ca+","+d.Da+")"));this.rect.x=0;this.rect.y=0;this.rect.width=this.width;this.rect.height=
this.height;this.element.style.visibility=this.Oh?"hidden":"visible"}else this.rect.x=0,this.rect.y=0,this.rect.width=100,this.rect.height=22;this.ob=new Q(this.rect);this.fb=this.rect.clone();this.rect.transform(this.Ga());this.ob.transform(this.Ga());if(d=this.aa.border)this.rect.Hc(d),this.zk=this.ob.clone(),this.zk.Hc(d/2),this.ob.Hc(d);!this.aa.preview||null!==this.oc&&this.oc.src===this.aa.preview?this.aa.preview||(this.oc=null):(this.log("Requesting new preview image for %s",this.aa.preview),
this.oc=document.createElement("img"),this.oc.src=this.aa.preview,this.oc.onload=function(){b.log("Preview image loaded.");c.Pi(b.id)},this.oc.onerror=function(){b.log("FAiled to load preview image")})};a.prototype.Ee=function(a){var b=a.Lu;b&&this.Wc&&(b.m11!==this.$d.m11||b.m21!==this.$d.m21||b.m12!==this.$d.m12||b.m22!==this.$d.m22||b.Ca!==this.$d.Ca||b.Da!==this.$d.Da)&&(this.log("Moving DOM element as result of draw zooming"),this.$d=b,this.format(a,this.Wc));if(this.element){if(b=this.aa.border){var c=
this.zk;a.setTransform(1,0,0,1,0,0);a.beginPath();a.lineWidth=b;a.strokeStyle="#cccccc";a.moveTo(c.ma[0].x,c.ma[0].y);a.lineTo(c.ma[1].x,c.ma[1].y);a.lineTo(c.ma[2].x,c.ma[2].y);a.lineTo(c.ma[3].x,c.ma[3].y);a.lineTo(c.ma[0].x,c.ma[0].y);a.closePath();a.stroke()}}else a.beginPath(),a.lineWidth=1,a.fillStyle="#888888",a.strokeStyle="#CCCCCC",a.rect(0,0,100,22),a.stroke(),a.font="20px Arial",a.textBaseline="top",a.fillText("DomNode",0,0);if(this.oc&&this.oc.naturalHeight){this.log("Drawing preview image %s,%s ->%s,s",
this.oc.naturalWidth,this.oc.naturalHeight,this.width,this.height);try{a.drawImage(this.oc,0,0,this.oc.naturalWidth,this.oc.naturalHeight,0,0,this.width,this.height)}catch(f){this.log("Tried to draw image, got error: %s",f.toString())}}};a.prototype.gb=function(a,c){return!this.aa.locked&&this.rect.Vc(a,c)&&this.ob.Vc(a,c,3)?this:null};a.prototype.Vk=function(){this.element&&this.Wc&&(this.log("Added DOM NODE %s",this.id),ob(C(this.element),this.Wc.pk()),this.readOnly?C(this.element).ea("pointer-events",
"auto"):C(this.element).ea("pointer-events","none"));this.xb=!0};a.prototype.Xk=function(){this.log("Removed DOM NODE %s",this.id);this.element&&C(this.element).remove();this.xb=!1};return a}(R);R.Tc("DomNode",qe);var X,re=X||(X={});re[re.IDLE=0]="IDLE";re[re.CONNECTING=1]="CONNECTING";re[re.CONNECTED=2]="CONNECTED";re[re.WAIT_FOR_ACK=3]="WAIT_FOR_ACK";re[re.ERROR_WAIT=4]="ERROR_WAIT";re[re.STOPPING=5]="STOPPING";
var ve=function(c){function a(a,d,e){var b=c.call(this)||this;b.name=a;b.log=B.create("Sharing");b.state=X.IDLE;b.paused=!1;b.k=0;b.timeout=null;b.Zk="";b.Ds=1;a=new se;var g=new te(d,a);b.xl=new Gb(g);a=new ue(b.xl,a);d.ha.It(a,e);b.k=0;b.connect();return b}p(a,c);a.prototype.sf=function(a){this.log(X[this.state]+" -> "+X[a]);this.state=a};a.prototype.connect=function(){var a=this;this.log("connect(): "+X[this.state]);this.state!==X.IDLE?this.log("Bad state"):(this.sf(X.CONNECTING),this.Ah=new WebSocket("ws://zwibbler.com:3000/socket/"+
this.name),this.Ah.addEventListener("open",function(){a.Ks()}),this.Ah.addEventListener("close",function(){a.Hs()}),this.Ah.addEventListener("message",function(b){a.Ms(b)}))};a.prototype.Ks=function(){this.log("onConnected(): "+X[this.state]);this.state!==X.CONNECTING?this.log("Bad state"):(this.sf(X.pp),this.ll())};a.prototype.Hs=function(){this.log("onClose(): "+X[this.state]);this.state!==X.Lh&&(this.state===X.CONNECTING?(this.sf(X.Lh),this.it()):(this.sf(X.IDLE),this.paused||(this.k=0,this.connect())))};
a.prototype.it=function(){var a=this;this.state===X.Lh&&(this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.timeout=setTimeout(function(){a.state===X.Lh&&(a.log("onTimeout(): "+X[a.state]),a.timeout=null,a.sf(X.IDLE),a.connect())},1E3*Math.pow(2,this.k)),5>this.k&&(this.k+=1))};a.prototype.ll=function(){if(this.state===X.pp){if(this.paused)this.log("Currently paused; ignoring changes.");else if(""!==this.Zk){this.log("Have outstanding changes... not sending more.");return}var a=this.xl.lr();
a.length&&(this.Zk=a,this.Ah.send(JSON.stringify({type:"Data",MID:""+this.Ds++,oldCID:"0",newCID:"0",data:a})))}};a.prototype.Ms=function(a){a=JSON.parse(a.data);"Data"===a.type?this.xl.Mp(a.data):"Ack"===a.type&&(this.Zk="",this.ll())};a.prototype.pause=function(a){this.log("SharedSession.pause(): "+X[this.state]);(this.paused=a)?stop():this.state===X.IDLE&&(this.sf(X.CONNECTING),this.connect())};a.prototype.stop=function(){this.log("SharedSession.stop(): "+X[this.state]);this.paused=!0;this.state<
X.Lh?this.Ah.close():this.sf(X.IDLE)};return a}(Hb),se=function(){function c(){this.local={};this.remote={};this.add("0",0)}c.prototype.add=function(a,b){this.local[a]=b;this.remote[b]=a};c.prototype.remove=function(a,b){delete this.local[a];delete this.remote[b]};c.prototype.vg=function(a){return this.local[a]};c.prototype.uf=function(a){a in this.remote||console.log("LocalId "+a+" has no remote");return this.remote[a]};return c}();
function we(c){var a={},b;for(b in c)a[b]="matrix"===b?c[b].ec():c[b];return a}function xe(c){var a={},b;for(b in c)a[b]="matrix"===b&&c[b]instanceof Array?new M(c[b]):c[b];return a}
var te=function(){function c(a,b){this.view=a;this.map=b;this.Wd={};this.actions=[];this.log=B.create("Remote")}c.prototype.createNode=function(a,b,c,e){if(!e.type)throw console.log(e),Error("Tried to create node with bad type");var d=xe(e),g=d.type;delete d.type;var h=this.view.ha.Va();this.log("Create node "+g+" "+a+"/"+h+" at "+b+":"+c);this.map.add(a,h);b=new V(h,g,d,this.map.vg(b),c);this.actions.push(b);this.Wd[a]=e};c.prototype.sc=function(a,b,c){var d=this.map.vg(a);this.log("Delete node "+
a+"/"+d+" from "+b+":"+c);b=new le([d]);this.actions.push(b);this.map.remove(a,d)};c.prototype.le=function(a,b,c){this.log("Move node "+a+" to "+b+":"+c);this.actions.push(new ye(this.map.vg(a),this.map.vg(b),c))};c.prototype.Cb=function(a,b){b=xe(b);var c=this.map.vg(a);this.log("Set properties for node "+a+"/"+c+" to "+JSON.stringify(b));for(var e in b)this.actions.push(new Rd([c],e,b[e]));if(a in this.Wd)for(var f in b)this.Wd[a][f]=b[f]};c.prototype.uc=function(a){var b={};if(a in this.Wd)b=this.Wd[a];
else if(a=this.view.ha.za(this.map.vg(a)))b=we(a.uc()),b.type=a.type();return b};c.prototype.ta=function(){this.Wd={};this.view.ta(this.actions,!0);this.view.Kf();this.view.ja();this.actions=[]};return c}(),ue=function(){function c(a,b){this.Md=a;this.map=b;this.log=B.create("LOCAL")}c.prototype.createNode=function(a,b,c,e){if(!this.Md.mc){console.log("Create node "+e.type+" "+a+" at "+b+":"+c);if(!e.type)throw Error("Error: Local tried to create node with bad type.");e=we(e);var d=this.Md.vs(a);
this.map.add(d,a);a=this.map.uf(b);this.Md.createNode(d,a,c,e)}};c.prototype.sc=function(a,b,c){this.Md.mc||(console.log("Delete node "+a+" from "+b+":"+c),b=this.map.uf(b),a=this.map.uf(a),this.Md.sc(a,b,c))};c.prototype.le=function(a,b,c,e,f){this.Md.mc||(console.log("Move node "+a+" from "+e+":"+f+" to "+b+":"+c),this.Md.le(this.map.uf(a),this.map.uf(b),c,this.map.uf(e),f))};c.prototype.Cb=function(a,b){this.Md.mc||(console.log("Set properties for node "+a+" to "+JSON.stringify(b)),b=we(b),this.Md.Cb(this.map.uf(a),
b))};return c}();function ze(c){return c instanceof Array?c:[c]}
var Y=function(){function c(a,b){var c=this;this.Ra={};this.zb=0;this.actions=[];this.ei=new t;this.Zj=new t;this.Ii=0;this.Tj=-1;this.Jk=null;this.Gf={};this.xe=this.hd=null;this.log=B.create("CONTEXT");this.ga=new oe(this,a,b);this.so();var e=this;Cd.Ak.push(this);this.ga.rb.add(function(){c.aj();delete a[0].zwibbler;delete e.Ra;delete e.actions;delete e.ga;delete e.hd;for(var b=Cd.Ak,d=0;d<b.length;d++)if(b[d]===e){b.splice(d,1);break}});this.xa("document-changed",function(){c.xe&&c.xe.ll()})}
c.prototype.Lp=function(){1<this.zb&&this.Ia("abortTransaction is not implemented for nested calls. Please contact support.");this.zb=0;this.actions=[]};c.prototype.Hj=function(a){this.ga.language.Hj(a)};c.prototype.Qp=function(){return this.fh(this.Ec())};c.prototype.Qm=function(){this.zb+=1;1===this.zb?(this.actions=[],this.Zj.clear(),this.ei.clear(),this.Ii=0,this.Tj=this.ga.view.ha.Ua,this.log("beginTransaction() -- beginning new")):this.log("beginTransaction() -- already in one, bump counter")};
c.prototype.Fg=function(){this.ga.view.Fg()};c.prototype.Je=function(){return this.ga.view.ha.Je()};c.prototype.Ke=function(){return this.ga.view.ha.Ke()};c.prototype.nb=function(){this.ga.view.nb();this.ga.view.Nb();this.ga.view.ja()};c.prototype.jq=function(){this.ga.kq()};c.prototype.lq=function(a,b){this.vh(a,!b)};c.prototype.pq=function(){this.zb=Math.max(0,this.zb-1);0===this.zb?(this.ga.view.ta(this.actions,!0),this.actions=[],this.log("committing irreversible transaction.")):this.log("delaying transaction commit -- nested call (count=%s)",
this.zb)};c.prototype.Qj=function(){this.zb=Math.max(0,this.zb-1);0===this.zb?(this.ga.view.ta(this.actions),this.actions=[],this.log("committing transaction.")):this.log("delaying transaction commit -- nested call (count=%s)",this.zb)};c.prototype.Vd=function(a,b){void 0===a&&(a=!1);"boolean"!==typeof a&&this.Ia("First parameter of copy() must be true/false");return this.ga.view.Vd(a,b)};c.prototype.Mg=function(a){if(0<a.length)return this.Ib(this.ga.Mg(this.actions,a))};c.prototype.Kb=function(a){void 0===
a&&(a={});var b={},c;for(c in a)if(a.hasOwnProperty(c)){var e=a[c];"matrix"===c&&("[object Array]"===Object.prototype.toString.apply(e)&&"Matrix"===e[0]&&e.splice(0,1),e=new M(e));b[c]=e}return b};c.prototype.createNode=function(a,b){this.log("createNode(%s)",a);var c=this.Kb(b);return this.Ib(this.ga.createNode(this.actions,a,c))};c.prototype.bi=function(a){return this.Ib(this.ga.bi(this.actions,a))};c.prototype.di=function(a,b){function c(a,b){b.click(function(b){a.onclick.call(this,f,b)})}var e=
Yb(a);pa(b)||this.Ia("createToolbar: second parameter must be array");for(var f=this,g=0;g<b.length;g++){var h=b[g],k=C("<a>").Jb("href","javascript:void(0)");k.ea("background-repeat","no-repeat");k.ea("background-position","center");k.ea("display","inline-block");lb(k,"zwibbler-button");h.toolName&&lb(k,h.toolName);h.onclick&&c(h,k);h.title&&k.Jb("title",h.title);h.background?k.ea("background",h.background):h.image&&k.ea("background-image","url("+h.image+")");h.html&&(k[0].innerHTML=h.html,k.ea("overflow",
"hidden"));e.append(k)}var l;this.xa("tool-changed",function(a){f.log("Tool-changed: %s",a);if(l)for(var b=l,c="zwibbler-selected".split(Pa),d=0,g=b.length;d<g;d++){var h=b[d];if(1===h.nodeType&&h.className){for(var k=(" "+h.className+" ").replace(Sa," "),m=0,F=c.length;m<F;m++)k=k.replace(" "+c[m]+" "," ");h.className=Oa.trim(k)}}l=e.find("."+a);lb(l,"zwibbler-selected")})};c.prototype.Bq=function(a,b){var c="string"===typeof b?C("#"+b):C(b);if("PageSelector"===a)this.log("Creating page selector"),
c=new pc(this,c,!1,!1),c.Ti(!0),c.ml(this),c.el();else return this.Ia("Cannot create UI Elemment %s",a),!1;return!0};c.prototype.Rj=function(a){if(a=this.ga.Rj(this.actions,a))return this.Ib(a);this.Ia("createShape needs an array of at least 6 numbers");return null};c.prototype.Xj=function(){var a=this.ga.view.Vd(!1);this.bn();return a};c.prototype.Of=function(){this.ga.Of();for(var a in this)this.hasOwnProperty(a)&&delete this[a]};c.prototype.Ib=function(a){this.zb?"number"===typeof a&&this.ei.add(a):
(this.log("Not in a transaction. committing immediately. id=%s",a),this.Qj());return a};c.prototype.sc=function(a){this.$m(a)};c.prototype.Cp=function(a){for(var b=0;b<a.length;b++){var c=a[b],e=this.ga.view.ha.za(c,!1);e&&!this.Zj.contains(c)||!e&&this.ei.contains(c)||(a.splice(b,1),--b)}return 0<a.length};c.prototype.$m=function(a){this.log("deleteNodes()");a=ze(a);this.Cp(a)&&(this.Ib(this.ga.sc(this.actions,a)),this.Zj.add(a))};c.prototype.an=function(){1<this.zb&&this.Ia("deletePage is not implemented inside transactions. Please contact support.");
1===this.Ec()?this.log("Cannot remove all the pages."):(this.actions.push(new le([this.ga.view.ha.vk().id])),this.Ib())};c.prototype.bn=function(){this.ga.view.Og()};c.prototype.Xd=function(){1===arguments.length&&!1===arguments[0]&&this.ga.view.ha.ho();return this.ga.view.ha.Xd()};c.prototype.download=function(a,b,c){"jpeg"===a&&(a="jpg");var d;if("pdf"===a||"svg"===a||"png"===a||"jpg"===a||"bmp"===a||"zwibbler3"===a){var f="zwibbler3"===a?Dd.vj(this.ga.view.ha,a,"data-uri"):this.save(a,c);"Blob"in
window&&(d=ic(f));if(d){if(window.navigator.msSaveOrOpenBlob){this.log("Using msSaveOrOpenBlob()");window.navigator.msSaveOrOpenBlob(d,b);return}f=window.URL.createObjectURL(d);this.log("Using blob object url %s",f);this.ga.rb.add(function(){window.URL.revokeObjectURL(f)})}var g=document.createElement("a");g.innerHTML="download";g.setAttribute("href",f);g.setAttribute("download",b);g.style.display="none";document.body.appendChild(g);g.click();setTimeout(function(){document.body.removeChild(g)},1E3)}else this.log("unsupported format for download: %s",
a)};c.prototype.ja=function(a,b){void 0===b&&(b={});var c=b.page||0,e=this.ga.view.ha.Ua,f=this.ga.view.ha.Ve();this.ga.view.ha.Bb(c);this.ga.view.Rg(a,0,0,f.width,f.height);this.ga.view.ha.ja(a);this.ga.view.ha.Bb(e)};c.prototype.Lq=function(a){var b=this.ga.view.ha.za(a,!1);b?b.xi()?(a=this.ga.view.bj({}))&&a.Dl(b,b.rect.x,b.rect.y):this.log("editNodeText: node %s (%s) cannot contain text.",a,b.type()):this.log("editNodeText: nodeid %s does not exist.",a)};c.prototype.duplicate=function(){this.ga.view.duplicate()};
c.prototype.ua=function(a){for(var b=1;b<arguments.length;b++);var c=this;this.Ra||(this.Ra={});if(!this.zm(a)){var e=Array.prototype.slice.call(arguments,1);setTimeout(function(){var b;if(a in c.Ra){var d=c.Ra[a];var h=0;for(b=d.length;h<b;h++){var k=d[h];k.apply(null,e)}}},0);return this}};c.prototype.Pe=function(a){for(var b=1;b<arguments.length;b++);this.Ra||(this.Ra={});if(!this.zm(a)){b=Array.prototype.slice.call(arguments,1);var c;if(a in this.Ra){var e=this.Ra[a];var f=0;for(c=e.length;f<
c;f++){var g=e[f];g.apply(null,b)}}}};c.prototype.Ut=function(a){this.Gf[a]=a in this.Gf?this.Gf[a]+1:1};c.prototype.zm=function(a){return a in this.Gf&&0<this.Gf[a]?(this.log("Skipped %s event",a),--this.Gf[a],!0):!1};c.prototype.focus=function(a){void 0===a&&(a=!1);a?this.ga.qd():this.ga.focus("canvas")};c.prototype.Wq=function(a){a=this.qn(a);return a.length?a[0]:null};c.prototype.qn=function(a){a=this.ga.view.ha.Xq(a);for(var b=[],c=0;c<a.length;c++)b.push(a[c].id);return b};c.prototype.Yq=function(a,
b,c){if(3===arguments.length)if("number"!==typeof b||"number"!==typeof c)this.Ia("flip: 2nd and 3rd args must be numbers.");else{var d=new E(b,c);this.ga.view.sn(a/180*Math.PI,d)}else this.ga.view.sn(a/180*Math.PI)};c.prototype.Tg=function(a,b,c,e){a=this.Fm(a);"number"===typeof c&&"number"===typeof e?(c=new E(c,e),this.ga.view.Tg(a,b/180*Math.PI,c)):this.ga.view.Tg(a,b/180*Math.PI)};c.prototype.dr=function(a,b,c){function d(a){a.xa("click contextmenu",function(b){if("click"===b.type||"contextmenu"===
b.type)m.call(h,a.ea("background-color"),0===b.button),b.preventDefault()})}function f(){var a=C("<div>").ea("width",b+"px").ea("height",b+"px").ea("display","inline-block");k.append(a);return a}function g(a,b){var c=document.createElement("canvas");c.width=a;c.height=a;b(c.getContext("2d"),0,0,a);return f().append(c)}void 0===c&&(c={});var h=this,k=Yb(a),l,m=c.onColour||c.onColor||h.vh;a=g(b,oc.gm);a.xa("click contextmenu",function(a){m.call(h,"transparent",0===a.button);a.preventDefault()});a=g(b,
oc.fm);a.xa("click contextmenu",function(a){if(c.onOpacity)c.onOpacity(.5,0===a.button);else h.Vo(.5,0===a.button);a.preventDefault()});for(l=0;1>=l;l+=1/13){var n=(new A(A.Ac,[0,0,l,1])).toString();d(f().ea("background-color",n))}for(l=.3;1>=l;l+=.7/14)for(a=0;360>a;a+=22.5)n=(new A(A.Ac,[a,.7,l,1])).toString(),d(f().ea("background-color",n));for(a=0;360>a;a+=22.5)n=(new A(A.Ac,[a,1,1,1])).toString(),d(f().ea("background-color",n))};c.prototype.Ug=function(){return this.ga.view.Ug()};c.prototype.fr=
function(){var a=[];this.ga.view.ha.Rf(function(b){a.push(b.id)},this.de());return a};c.prototype.Ep=function(){var a=[];this.ga.view.ha.sb(!1,function(b){a.push(b.id)});return a};c.prototype.jr=function(){return this.ga.kr()};c.prototype.nk=function(a){return this.Cg(this.ga.view.nk(a))};c.prototype.nr=function(a){qa(a)||this.Ia("getConfig: Expected string");return this.ga.da.get(a)};c.prototype.de=function(){return this.zb?this.Tj:this.ga.view.ha.Ua};c.prototype.pr=function(){return this.ga.view.pi()};
c.prototype.qr=function(){return this.ga.view.ui()};c.prototype.qk=function(){return this.ga.view.qk()};c.prototype.sr=function(a,b){var c=this.ga.view.eb(a,b);return{x:c.x,y:c.y}};c.prototype.Xg=function(){var a=this.ga.view.ha.Ve();return{x:a.x,y:a.y,width:a.width,height:a.height}};c.prototype.pi=function(){return this.ga.view.pi()};c.prototype.Dr=function(a){return this.ga.language.get(a)};c.prototype.Cg=function(a){return{x:a.x,y:a.y,width:a.width,height:a.height}};c.prototype.Ph=function(a){"object"!==
typeof a&&this.Ia("Error: Rectangle object expected.");a=new K(a.x||0,a.y||0,a.width||0,a.height||0);a.Eo();return a};c.prototype.ur=function(){return this.Cg(this.ga.view.ha.yn())};c.prototype.Br=function(a,b){return this.ri(a,b)};c.prototype.Fr=function(){var a=[],b={};this.ga.view.ha.sb(!1,function(d){!(c=d.Bd())||c in b||(b[c]=1,a.push(c))});var c=this.Ug();c in b||a.push(c);return a};c.prototype.Er=function(a){var b=[];this.ga.view.ha.sb(!1,function(c){c.Bd()===a&&b.push(c.id)});return b};c.prototype.ge=
function(a){return this.ga.view.ha.ge(a)};c.prototype.ri=function(a,b){return this.ga.ri(a,b)};c.prototype.Gr=function(a){a=ze(a);for(var b=null,c=0;c<a.length;c++){var e=a[c],f=this.ga.view.ha.za(e);null===f?this.Ia("Error: node %s does not exist",e):b?b.Hh(f.rect):b=f.rect.clone()}b||(b=new K(0,0,0,0));return this.Cg(b)};c.prototype.Hr=function(a){var b=this.ga.view.ha.za(a);if(null===b)return this.Ia("Error: node %s does not exist",a),null;a=b.Ga().Zg();return{x:a.x,y:a.y}};c.prototype.Ir=function(a){return(a=
this.ga.view.ha.za(a))?a.type():""};c.prototype.Jr=function(a,b){var c=this.ga.view.ha.gb(a,b,this.ga.view.La);return c?c.id:null};c.prototype.Ec=function(){var a=this.ga.view.ha.Ec();this.zb&&(a+=this.Ii);return a};c.prototype.Dn=function(a){return(a=this.ga.view.ha.vk(a))?a.id:null};c.prototype.si=function(a){var b=this.ga.view.ha.za(a,!1);if(!b||"PathNode"!==b.type())return null;a=b.si().clone().Nd();var c=[];b.Ga();for(b=0;b<a.length;b++){var e=a[b];c.push(e.x);c.push(e.y)}return c};c.prototype.Mr=
function(a){a=this.ga.view.ha.za(a,!1);if(!a||"PathNode"!==a.type())return null;a=a.si();for(var b=[],c=[],e=0;e<a.ba.length;){switch(a.ba[e]){case P.qc:c=[{x:a.ba[e+1],y:a.ba[e+2]}];b.push(c);break;case P.pc:c.push({x:a.ba[e+1],y:a.ba[e+2]})}e+=P.gc[a.ba[e]]}return b};c.prototype.Fp=function(){this.ga.view.Sb=this.ga.Sb;this.ga.ym=!0;return this.ga.Sb.ia[0]};c.prototype.zn=function(){return this.ga.view.scale};c.prototype.Pr=function(a,b,c,e){var d=this.ga.view.$j(a,b);if(void 0===c||void 0===e)return{x:d.x,
y:d.y};a=this.ga.view.$j(a+c,b+e);return this.Cg(new K(d.x,d.y,a.x-d.x,a.y-d.y))};c.prototype.Qr=function(){return this.ga.view.jd};c.prototype.ui=function(){return this.ga.view.ui()};c.prototype.fe=function(a,b){var c=this.ga.view.ha.za(a,!1);return c?c.fe(b):null};c.prototype.At=function(a,b,c){var d=this.ga.view.ha.za(a,!1);if(!d)return this.log("setEditHandle: node %s doesn't exist.",a),!1;if("PathNode"!==d.type())return this.log("setEditHandle: node %s is not a PathNode.",a),!1;d=d.la("commands");
d=S.xp(d,b,c);if(!d)return this.log("setEditHandle: failed"),!1;this.ue(a,"commands",d);return!0};c.prototype.Vf=function(a){void 0===a&&(a=!1);return this.ga.view.vc(a)};c.prototype.Or=function(a){for(var b={properties:{},types:{},nodes:a},c=this.ga.da.get("allowTextInShape"),e=0;e<a.length;e++){var f=this.ga.view.ha.za(a[e],!1);if(f){var g=f.type();b.types[g]=!0;b.types.AnyNode=!0;"PathNode"===g&&(g=f.la("closed")?"PathNode-closed":"PathNode-open",b.types[g]=!0);f=f.uc();for(var h in f)if(f.hasOwnProperty(h)&&
"matrix"!==h&&("BrushNode"!==g||"fillStyle"!==h)){var k=b.properties[h],l=f[h];("PathNode-open"!==g||"fontSize"!==h&&"fontName"!==h&&"fillStyle"!==h)&&("PathNode-closed"!==g||c||"fontSize"!==h&&"fontName"!==h)&&void 0!==l&&(b.properties[h]=k!==l&&void 0!==k?null:l)}}}return b};c.prototype.Ur=function(){return this.Cg(this.ga.view.Wf())};c.prototype.Ia=function(a){for(var b=1;b<arguments.length;b++);b=arguments[0].split("%s");for(var c=[],e=0;e<b.length;e++)c.push(b[e]),e<b.length-1&&c.push(JSON.stringify(arguments[e+
1]));var f=c.join("");this.log(f);throw{message:f,toString:function(){return f}};};c.prototype.fh=function(a){var b=this.ga.view.ha.Va();this.actions.push(new V(b,"PageNode",{},this.ga.view.ha.root.id,a));this.Ib(b);this.zb&&(this.Ii+=1);return a};c.prototype.Ek=function(a){return this.ga.view.ha.Ek(a)};c.prototype.load=function(a,b){void 0===b&&(b=a);var c=Dd.sj(b);return c?(this.aj(),this.ga.qf(c),!0):!1};c.prototype.Bi=function(a){var b=this;r(a)?(this.Jk&&clearTimeout(this.Jk),this.Jk=setTimeout(function(){b.ga.view.Bi(!1)},
a),b.ga.view.Bi(!0)):this.Ia("lockUpdates: Expected a number")};c.prototype.Ci=function(){this.ga.view.Ci()};c.prototype.xs=function(a,b){if(r(a)&&r(b)){var c=this.Ec();0>a||a>=c?this.Ia("From page must be > 0 and less than getPageCount()"):0>b||b>=c?this.Ia("From page must be > 0 and less than getPageCount()"):(c=this.Dn(a),null!==c&&(this.actions.push(new je([c],je.mm,b)),this.Ib()))}else this.Ia("movePage: needs two valid page numbers.")};c.prototype.Di=function(){this.ga.view.Di()};c.prototype.Lk=
function(){this.aj();this.ga.Lk();this.so()};c.prototype.nextPage=function(){this.pf(Math.min(this.de()+1,this.Ec()-1))};c.prototype.xa=function(a,b){"draw"===a?this.hd=b:a in this.Ra?this.Ra[a].push(b):this.Ra[a]=[b];return this};c.prototype.Js=function(a){"function"===typeof a||this.Ia("Error: onComplete needs a function argument.");this.ga.view.ar(a)};c.prototype.so=function(){var a=this.ga.da.get("defaultPaperSize");this.log("onNewDocument()");"none"!==a&&this.tl(a)};c.prototype.hg=function(a){this.ga.view.hg(a)};
c.prototype.Zs=function(){this.pf(Math.max(this.de()-1,0))};c.prototype.print=function(a,b){var c=[],e;if("number"===typeof a)c.push(a);else if(a instanceof Array)for(e=0;e<a.length;e++)if(r(a[e]))c.push(a[e]);else{this.Ia("print(): pageSpec must be array of numbers");return}else if(!a)for(e=0;e<this.Ec();e++)c.push(e);var f=b?this.Ph(b):this.Ph(this.Xg());var g=this.de(),h=document.createElement("canvas");h.width=f.width;h.height=f.height;var k=h.getContext("2d");k.translate(-f.x,-f.y);e=window.location.hostname;
var l=window.open("about:blank","_blank");l.document.write("<!DOCTYPE html><html><head><title>"+e+"</title></head><body>");for(e=0;e<c.length;e++)this.pf(c[e]),this.ga.view.Rg(k,f.x,f.y,f.width,f.height),this.ga.view.ha.ja(k),0<e?l.document.write("<div style='page-break-before:always'>"):l.document.write("<div>"),l.document.write("<img style='width:100%' src='"),l.document.write(h.toDataURL()),l.document.write("'></div>"),k.clearRect(f.x,f.y,f.width,f.height);l.document.write("</body></html>");l.document.close();
setTimeout(function(){l.focus();l.print();setTimeout(function(){l.close()},1E3)},1E3);this.pf(g)};c.prototype.Kd=function(){this.ga.view.Kd()};c.prototype.pe=function(a){this.ga.view.ja(a)};c.prototype.resize=function(){var a=this;setTimeout(function(){a.ga.Dg(!0)},1)};c.prototype.save=function(a,b){void 0===a&&(a="zwibbler3");var c={jpeg:"image/jpeg",jpg:"image/jpeg",png:"image/png",bmp:"image/bmp",svg:"image/svg+xml",pdf:"application/pdf"},e=this.Ph(b||this.Xg());switch(a){case "list":return Dd.vj(this.ga.view.ha,
"list","object");case "png":case "jpeg":case "jpg":case "bmp":case "svg":case "pdf":return this.ga.Go(c[a],e);case "zwibbler3":return Dd.vj(this.ga.view.ha,"zwibbler3","string");case "image/png":case "image/jpeg":case "image/bmp":return c=this.ga.Go(a,e),c=c.substr(c.indexOf(",")+1),x.decode("base64",c);default:return"Unsupported format: "+a}};c.prototype.yt=function(a){C(this.ga.view.canvas).ea("cursor",a)};c.prototype.we=function(a,b){this.ga.view.we(a,b)};c.prototype.Fm=function(a){for(var b=[],
c=0;c<a.length;c++){var e=this.ga.view.ha.za(a[c],!1);e&&b.push(e)}return b};c.prototype.selectNodes=function(a){a=this.Fm(ze(a));this.ga.view.selectNodes(a);this.ga.view.Nb();this.ga.view.ja()};c.prototype.uh=function(){this.ga.view.uh()};c.prototype.Ri=function(a){this.ga.view.Ri(a)};c.prototype.st=function(a,b){this.ga.tt(a,b)};c.prototype.wt=function(a,b){"defaultPaperSize"===a&&this.tl(b);return this.ga.da.set(a,b)};c.prototype.vh=function(a,b){this.ga.view.Is(a,b)};c.prototype.pf=function(a){this.zb?
(this.log("Set page to %s inside transaction",a),this.actions.push(new Ae(a)),this.Tj=a):this.ga.view.Bb(a)};c.prototype.nl=function(a){this.ga.view.nl(a)};c.prototype.pg=function(a,b){!r(a)&&null!==a||!r(b)&&null!==b?alert("setDocumentSize: width/height must be numbers"):this.ga.view.pg(a,b)};c.prototype.Qo=function(a,b){!r(a)&&null!==a||!r(b)&&null!==b?alert("setDocumentSize: width/height must be numbers"):this.Ib(this.ga.view.pg(a,b,this.actions))};c.prototype.zt=function(a,b){var c=this.ga.view.ha.za(a);
c?("DomNode"!==c.type()&&this.Ia("setDomElement: Node %s is not a DomNode. It is %s",a,c.type()),c.Bt(b),this.ga.hi.push(b)):this.Ia("setDomElement: Node %s does not exist",a)};c.prototype.tr=function(a){var b=this.ga.view.ha.za(a);if(!b)return this.Ia("getDomElement: Node %s does not exist",a),null;b instanceof qe||this.Ia("getDomElement: Node %s is not a DomNode. It is %s",a,b.type());return b.rk()};c.prototype.Gt=function(a,b){qa(a)&&qa(b)?(this.Ug()===a&&this.Ri(b),this.ga.view.ha.sb(!1,function(c){c.Bd()===
a&&c.setProperty("layer",b)})):this.Ia("setLayerName() needs string arguments.")};c.prototype.tl=function(a,b){var c=null,e=null,f=!0,g=!1;if(2===arguments.length)if(r(arguments[0])&&r(arguments[1])){var h=arguments[0];c=arguments[1]}else qa(arguments[0])&&"boolean"===typeof arguments[1]?(e=arguments[0],g=arguments[1]):f=!1;else if(1===arguments.length&&qa(arguments[0]))for(var k=arguments[0].split(" "),l=0;l<k.length;l++)"landscape"===k[l]?g=!0:"portrait"===k[l]?g=!1:e=k[l];if(!1===f)return this.log("Bad arguments to setPaperSize()."),
!1;if(null===e)return this.pg(h,c),!0;switch(e.toLowerCase()){case "letter":h=816;c=1056;break;case "legal":h=816;c=1344;break;case "11x17":h=1056;c=1632;break;case "tabloid":h=1056;c=1632;break;case "a0":h=841/25.4*96;c=1189/25.4*96;break;case "a1":h=594/25.4*96;c=841/25.4*96;break;case "a2":h=420/25.4*96;c=594/25.4*96;break;case "a3":h=297/25.4*96;c=420/25.4*96;break;case "a4":h=210/25.4*96;c=297/25.4*96;break;case "none":c=h=null;break;default:return this.log("Invalid paper size: %s",e),!1}g&&
(e=h,h=c,c=e);this.pg(h,c);return!0};c.prototype.Dt=function(a,b){this.ga.Et(a,b)};c.prototype.Ft=function(a,b,c){this.ue(a,b,c)};c.prototype.ql=function(a,b){if(2!==arguments.length)throw"Error: setNodeProperties takes 2 arguments.";return this.Ib(this.ga.ql(this.actions,ze(a),this.Kb(b)))};c.prototype.ue=function(a,b,c){3!==arguments.length&&this.Ia("Error: setNodeProperty takes 3 arguments.");return this.Ib(this.ga.ue(this.actions,ze(a),b,c))};c.prototype.Ht=function(a,b){for(var c=ze(a),e=0;e<
c.length;e++){var f=this.ga.view.ha.za(c[e],!0);f&&f.se(!b)}this.ga.view.ja()};c.prototype.Vo=function(a,b){this.ga.view.Ns(a,b)};c.prototype.sl=function(a){this.ga.view.sl(a)};c.prototype.Lt=function(a){ra(a)&&r(a.x)&&r(a.y)&&r(a.width)&&r(a.height)||this.Ia("setViewRect: arg must be an object with numeric x, y, width, height properties");0!==a.width&&0!==a.height||this.Ia("setViewRect: width and height must be non-zero.");this.ga.view.xh(this.Ph(a))};c.prototype.Nc=function(a,b,c){if(r(a)||"page"===
a||"width"===a)if(1===arguments.length)this.ga.view.Nc(a);else if(3===arguments.length&&"number"===typeof a&&r(b)&&r(c)){var d=this.zn()/a,f=this.ga.view.Wf();f.transform(new O(d,d,b,c));this.ga.view.xh(f)}else this.Ia("setZoom: invalid arguments.");else this.log("setZoom: invalid parameter.")};c.prototype.yh=function(a,b){void 0===b&&(b=!0);this.ga.view.yh(a,b)};c.prototype.gj=function(a,b,c){this.log("Translate node %s by %s,%s actions=%s",a,b,c,this.actions.length);return this.Ib(this.ga.gj(this.actions,
ze(a),b,c))};c.prototype.ot=function(a){var b=Math.round(a/(Math.PI/2));a=b*Math.PI/2;b=0===b%2;var c=this.Ep(),e=this.Xg(),f=e.width/2,g=e.height/2;this.Qm();for(var h=0;h<c.length;h++)this.Fo(c[h],a,f,g),b||this.gj(c[h],g-f,f-g);b||this.Qo(e.height,e.width);this.Qj()};c.prototype.Fo=function(a,b,c,e){this.log("Rotate nodes by %s around (%s,%s) actions=%s",b/Math.PI*180,c,e,this.actions.length);for(var d=4===arguments.length,g=ze(a),h=new E(0,0),k=0;k<g.length;k++){var l=g[k],m=this.ga.view.ha.za(l);
!m&&!this.ei.contains(l)||!m&&!d?this.log("rotateNode: Node %s does not exist",l):!d&&m&&(l=m.rect.Lf(),h.x+=l.x,h.y+=l.y)}d?(h.x=c,h.y=e):(h.x/=g.length,h.y/=g.length);d=new zc(b,h.x,h.y);return this.Ib(this.ga.transformNode(this.actions,g,d))};c.prototype.il=function(a,b,c,e,f){void 0===e&&(e=0);void 0===f&&(f=0);this.log("Scale node %s by %s,%s actions=%s",a,b,c,this.actions.length);return this.Ib(this.ga.il(this.actions,ze(a),b,c,e,f))};c.prototype.rl=function(a,b,c,e,f,g,h){7!==arguments.length&&
this.Ia("setNodeTransform: requires 7 arguments");this.log("setNodeTransform(id=%s %s %s %s %s %s %s %s)",a,b,c,e,f,g,h);return this.Ib(this.ga.rl(this.actions,ze(a),b,c,e,f,g,h))};c.prototype.Aq=function(){var a=[];for(var b=0;32>b;b++)a.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz01234567890"[Math.floor(63*Math.random())]);a=a.join("");this.log("Creating shared session "+a);return this.Am(a,!0)};c.prototype.Am=function(a,b){this.log("Attach to shared session "+a);this.xe&&this.xe.stop();
this.xe=new ve(a,this.ga.view,b);return a};c.prototype.gs=function(a){var b=new zd(!0);this.ga.qf(b);this.Am(a,!1)};c.prototype.aj=function(){this.xe&&(this.xe.stop(),this.xe=null)};c.prototype.jb=function(){this.ga.view.jb()};c.prototype.Gh=function(a){this.Ib(this.ga.Gh(this.actions,ze(a)))};c.prototype.upload=function(a,b){function c(){}function e(){}var f=this.ga.yq(b||"Working"),g=new XMLHttpRequest,h=new FormData(a);g.upload.addEventListener("progress",function(a){f.update(a.loaded/a.total)},
!1);g.addEventListener("load",function(){200===g.status?(f.done(),e(g.response,g)):(f.error("Error"),c(g))},!1);g.addEventListener("error",function(){f.error("Error");c(g)},!1);g.addEventListener("abort",function(){f.error("Aborted");c(g)},!1);g.open(a.method,a.action);g.send(h);var k={success:function(a){e=a;return k},error:function(a){c=a;return k}};return k};c.prototype.ku=function(a,b){void 0===b&&(b=!1);this.ga.view.Om(this.Kb(a),b)};c.prototype.lu=function(a,b){2===arguments.length?this.ga.view.dk({lineWidth:b,
strokeStyle:a}):this.ga.view.dk(this.Kb(arguments[0]))};c.prototype.mu=function(a){this.ga.view.Ih(this.Kb(a))};c.prototype.nu=function(a){this.ga.view.Uj(this.Kb(a))};c.prototype.ou=function(a){ra(a)?(a=new pe(this.ga.view,a),this.ga.view.Pa(a)):this.Ia("useCustomTool(): requires an object as argument.")};c.prototype.Ol=function(a){this.ga.view.Ol(a)};c.prototype.Ih=function(a){void 0===a&&(a={});this.ga.view.Ih(this.Kb(a))};c.prototype.qu=function(a,b,c){void 0===c&&(c="freehand");ra(a)?(a=this.Kb(a),
c=b):a={strokeStyle:a,lineWidth:b};this.ga.view.cn(a,c)};c.prototype.Au=function(a,b){void 0===b&&(b=!0);var c=a;qa(a)?c={url:a}:"url"in c||this.Ia("useStampTool: missing url in properties");this.ga.view.ru(c,1===arguments.length||!0===b)};c.prototype.su=function(a,b){if(ra(b)){var c=b.singleLine;var e=b.orthogonal}else c=b;this.ga.view.Ik(this.Kb(a),c,e)};c.prototype.tu=function(){this.ga.view.Rs()};c.prototype.uu=function(){this.ga.view.Wa()};c.prototype.Pl=function(a,b,c,e){r(a)||this.Ia("usePolygonTool: parameter 1 must be a number.");
r(b)||this.Ia("usePolygonTool: parameter 2 must be a number.");c&&!r(c)&&this.Ia("usePolygonTool: parameter 3 must be a number.");e&&!ra(e)&&this.Ia("usePolygonTool: parameter 4 must be a object properties.");this.ga.view.Pl(a,b,c||1,e||{})};c.prototype.vu=function(a){void 0===a&&(a={});this.ga.view.cn(this.Kb(a),"quadratic")};c.prototype.wf=function(a){void 0===a&&(a={});this.ga.view.wf(this.Kb(a))};c.prototype.wu=function(a){void 0===a&&(a={});this.ga.view.wf(C.extend({},{roundRadius:this.ga.da.get("defaultRoundRectRadius")},
a))};c.prototype.xu=function(a,b){var c={};ra(a)?c=this.Kb(a):qa(a)&&(c.stokeStyle=a);r(b)&&(c.lineWidth=b);this.ga.view.en(c)};c.prototype.Ql=function(a,b,c,e,f){this.ga.view.Ql(a,this.Kb(b),c,e,f)};c.prototype.Rl=function(){this.ga.view.Rl()};c.prototype.zu=function(a){this.ga.view.$t(a)};c.prototype.yu=function(a){this.ga.view.wf(this.Kb(a))};c.prototype.Bu=function(a){this.ga.view.bj(this.Kb(a))};c.prototype.Sl=function(a){this.ga.view.Sl(this.Kb(a))};c.prototype.lj=function(){this.ga.view.lj()};
c.prototype.mj=function(){this.ga.view.mj()};return c}();Y.prototype.log=Y.prototype.log;Y.prototype.abortTransaction=Y.prototype.Lp;Y.prototype.addToLanguage=Y.prototype.Hj;Y.prototype.addPage=Y.prototype.Qp;Y.prototype.beginTransaction=Y.prototype.Qm;Y.prototype.bringToFront=Y.prototype.Fg;Y.prototype.canRedo=Y.prototype.Je;Y.prototype.canUndo=Y.prototype.Ke;Y.prototype.clearSelection=Y.prototype.nb;Y.prototype.clearUndo=Y.prototype.jq;Y.prototype.clickColour=Y.prototype.lq;
Y.prototype.commitIrreversibleTransaction=Y.prototype.pq;Y.prototype.commitTransaction=Y.prototype.Qj;Y.prototype.copy=Y.prototype.Vd;Y.prototype.createGroup=Y.prototype.Mg;Y.prototype.createNode=Y.prototype.createNode;Y.prototype.createPath=Y.prototype.bi;Y.prototype.createToolbar=Y.prototype.di;Y.prototype.createUiElement=Y.prototype.Bq;Y.prototype.createShape=Y.prototype.Rj;Y.prototype.cut=Y.prototype.Xj;Y.prototype.destroy=Y.prototype.Of;Y.prototype.deleteNode=Y.prototype.sc;
Y.prototype.deleteNodes=Y.prototype.$m;Y.prototype.deletePage=Y.prototype.an;Y.prototype.deleteSelection=Y.prototype.bn;Y.prototype.dirty=Y.prototype.Xd;Y.prototype.download=Y.prototype.download;Y.prototype.draw=Y.prototype.ja;Y.prototype.editNodeText=Y.prototype.Lq;Y.prototype.duplicate=Y.prototype.duplicate;Y.prototype.emit=Y.prototype.ua;Y.prototype.skipEvent=Y.prototype.Ut;Y.prototype.focus=Y.prototype.focus;Y.prototype.findNode=Y.prototype.Wq;Y.prototype.findNodes=Y.prototype.qn;
Y.prototype.flip=Y.prototype.Yq;Y.prototype.flipNodes=Y.prototype.Tg;Y.prototype.generatePalette=Y.prototype.dr;Y.prototype.getActiveLayer=Y.prototype.Ug;Y.prototype.getAllNodes=Y.prototype.fr;Y.prototype.getBackgroundImage=Y.prototype.jr;Y.prototype.getBoundingRectangle=Y.prototype.nk;Y.prototype.getConfig=Y.prototype.nr;Y.prototype.getCurrentPage=Y.prototype.de;Y.prototype.getCurrentFillColour=Y.prototype.pr;Y.prototype.getCurrentOutlineColour=Y.prototype.qr;Y.prototype.getCurrentTool=Y.prototype.qk;
Y.prototype.getDocumentCoordinates=Y.prototype.sr;Y.prototype.getDocumentSize=Y.prototype.Xg;Y.prototype.getFillColour=Y.prototype.pi;Y.prototype.getLanguageString=Y.prototype.Dr;Y.prototype.getDrawingRectangle=Y.prototype.ur;Y.prototype.getItemProperty=Y.prototype.Br;Y.prototype.getLayers=Y.prototype.Fr;Y.prototype.getLayerNodes=Y.prototype.Er;Y.prototype.getNodePageNumber=Y.prototype.ge;Y.prototype.getNodeProperty=Y.prototype.ri;Y.prototype.getNodeRectangle=Y.prototype.Gr;
Y.prototype.getNodeScale=Y.prototype.Hr;Y.prototype.getNodeType=Y.prototype.Ir;Y.prototype.getNodeUnderPoint=Y.prototype.Jr;Y.prototype.getPageCount=Y.prototype.Ec;Y.prototype.getPageNode=Y.prototype.Dn;Y.prototype.getPathData=Y.prototype.si;Y.prototype.getPathAsPoints=Y.prototype.Mr;Y.prototype._getPropertyPanelElement=Y.prototype.Fp;Y.prototype.getCanvasScale=Y.prototype.zn;Y.prototype.getScreenCoordinates=Y.prototype.Pr;Y.prototype.getSelectedEditHandle=Y.prototype.Qr;
Y.prototype.getStrokeColour=Y.prototype.ui;Y.prototype.getEditHandleType=Y.prototype.fe;Y.prototype.setEditHandle=Y.prototype.At;Y.prototype.getSelectedNodes=Y.prototype.Vf;Y.prototype.getPropertySummary=Y.prototype.Or;Y.prototype.getViewRectangle=Y.prototype.Ur;Y.prototype.insertPage=Y.prototype.fh;Y.prototype.isLayerVisible=Y.prototype.Ek;Y.prototype.load=Y.prototype.load;Y.prototype.lockUpdates=Y.prototype.Bi;Y.prototype.moveDown=Y.prototype.Ci;Y.prototype.movePage=Y.prototype.xs;
Y.prototype.moveUp=Y.prototype.Di;Y.prototype.newDocument=Y.prototype.Lk;Y.prototype.nextPage=Y.prototype.nextPage;Y.prototype.on=Y.prototype.xa;Y.prototype.onComplete=Y.prototype.Js;Y.prototype.paste=Y.prototype.hg;Y.prototype.previousPage=Y.prototype.Zs;Y.prototype.print=Y.prototype.print;Y.prototype.redo=Y.prototype.Kd;Y.prototype.redraw=Y.prototype.pe;Y.prototype.resize=Y.prototype.resize;Y.prototype.save=Y.prototype.save;Y.prototype.setCursor=Y.prototype.yt;Y.prototype.setToolProperty=Y.prototype.we;
Y.prototype.selectNodes=Y.prototype.selectNodes;Y.prototype.sendToBack=Y.prototype.uh;Y.prototype.setActiveLayer=Y.prototype.Ri;Y.prototype.setBackgroundBrowserImages=Y.prototype.st;Y.prototype.setConfig=Y.prototype.wt;Y.prototype.setColour=Y.prototype.vh;Y.prototype.setCurrentPage=Y.prototype.pf;Y.prototype.setCustomBackgroundFn=Y.prototype.nl;Y.prototype.setDocumentSize=Y.prototype.pg;Y.prototype.setDocumentSizeInTransaction=Y.prototype.Qo;Y.prototype.setDomElement=Y.prototype.zt;
Y.prototype.getDomElement=Y.prototype.tr;Y.prototype.setLayerName=Y.prototype.Gt;Y.prototype.setPaperSize=Y.prototype.tl;Y.prototype.setIconBrowserImages=Y.prototype.Dt;Y.prototype.setItemProperty=Y.prototype.Ft;Y.prototype.setNodeProperties=Y.prototype.ql;Y.prototype.setNodeProperty=Y.prototype.ue;Y.prototype.setNodeVisibility=Y.prototype.Ht;Y.prototype.setOpacity=Y.prototype.Vo;Y.prototype.setPageView=Y.prototype.sl;Y.prototype.setViewRectangle=Y.prototype.Lt;Y.prototype.setZoom=Y.prototype.Nc;
Y.prototype.showLayer=Y.prototype.yh;Y.prototype.translateNode=Y.prototype.gj;Y.prototype.rotateDocument=Y.prototype.ot;Y.prototype.rotateNode=Y.prototype.Fo;Y.prototype.scaleNode=Y.prototype.il;Y.prototype.setNodeTransform=Y.prototype.rl;Y.prototype.createSharedSession=Y.prototype.Aq;Y.prototype.joinSharedSession=Y.prototype.gs;Y.prototype.stopSharing=Y.prototype.aj;Y.prototype.undo=Y.prototype.jb;Y.prototype.ungroup=Y.prototype.Gh;Y.prototype.upload=Y.prototype.upload;Y.prototype.useArrowTool=Y.prototype.ku;
Y.prototype.useBrushTool=Y.prototype.lu;Y.prototype.useCircleTool=Y.prototype.mu;Y.prototype.useCurveTool=Y.prototype.nu;Y.prototype.useCustomTool=Y.prototype.ou;Y.prototype.useEditHandleTool=Y.prototype.Ol;Y.prototype.useEllipseTool=Y.prototype.Ih;Y.prototype.useFreehandTool=Y.prototype.qu;Y.prototype.useStampTool=Y.prototype.Au;Y.prototype.useLineTool=Y.prototype.su;Y.prototype.usePanTool=Y.prototype.tu;Y.prototype.usePickTool=Y.prototype.uu;Y.prototype.usePolygonTool=Y.prototype.Pl;
Y.prototype.useQuadraticBezierTool=Y.prototype.vu;Y.prototype.useRectangleTool=Y.prototype.wf;Y.prototype.useRoundRectTool=Y.prototype.wu;Y.prototype.useShapeBrushTool=Y.prototype.xu;Y.prototype.useShapeTool=Y.prototype.Ql;Y.prototype.useSplitWallTool=Y.prototype.Rl;Y.prototype.useStampLineTool=Y.prototype.zu;Y.prototype.useSquareTool=Y.prototype.yu;Y.prototype.useTextTool=Y.prototype.Bu;Y.prototype.useWallTool=Y.prototype.Sl;Y.prototype.zoomIn=Y.prototype.lj;Y.prototype.zoomOut=Y.prototype.mj;"undefined"!==typeof jQuery&&(jQuery.fn.zwibbler=function(c){void 0===c&&(c={});var a=null;this.each(function(b,d){d.zwibbler&&jQuery(d).empty();a=new Y(C(d),c);d.zwibbler=a});return a},jQuery.fn.zwibblerContext=function(){return this[0].zwibbler});
var Z=function(){function c(){this.Ak=[];this.buttons=[];this.Vj={};this.fonts=new wc;this.log=B.create("ZWIBBLER")}c.prototype.create=function(a,b){"string"===typeof a&&0<a.length&&"."!==a.charAt(0)&&"#"!==a.charAt(0)&&(a="#"+a);var c=Yb(a);return 0===c.length?(alert("Zwibbler.create: Cannot find an element with id "+a),null):new Y(c,b)};c.prototype.hc=function(a){for(var b=["name","image","onclick"],c=0;c<b.length;c++)if(!(b[c]in a))return alert("Zwibbler.addButton: missing "+b[c]),!1;this.buttons.push(a);
return!0};c.prototype.Np=function(a,b){this.Vj[a]=b};c.prototype.vp=function(a,b){void 0===b&&(b={});return this.em(a,b)};c.prototype.em=function(a,b){function c(){var a=e.outerWidth(),b=e.outerHeight(),c=kc();e.offset({left:c.x+c.width/2-a/2,top:c.y+c.height/2-b/2})}void 0===b&&(b={});var e=Yb(a);null===e[0].parentNode&&C(document.body).append(e);"static"===e.ea("position")&&e.ea("position","absolute");e.ea("display","none");var f=new qb("transparent");f.insertBefore=e;var g=b.showNear,h=b.showHow,
k=!1,l={hide:function(){f.Xa();e.Xa();if(l.onhide)l.onhide();C(window).yg("resize",c)},show:function(a,b,d){void 0===d&&(d=!1);var m=0,n=0,q="",w="";if("number"===typeof a&&"number"===typeof b){m=a;n=b;var y=!0}else q=a||g,w=b||h,y=!1;a=ec()+1;e.ea("z-index",a);f.zIndex=a;e.show();a=e.outerWidth();b=e.outerHeight();y?(w=kc(),m={left:m,top:n},m.left=Math.min(m.left,w.x+w.width-a-2),m.top=Math.min(m.top,w.y+w.height-b-3),e.offset(m)):q&&w?(n=Yb(q),m=e,q=w,w=n.offset(),q=q.toLowerCase().split(" "),2!==
q.length&&(q=["tl","tl"]),0<=q[0].indexOf("b")&&(w.top+=n.outerHeight()),0<=q[0].indexOf("r")&&(w.left+=n.outerWidth()),0<=q[1].indexOf("b")&&(w.top-=m.outerHeight()),0<=q[1].indexOf("r")&&(w.left-=m.outerWidth()),m.ea("position","absolute"),n=kc(),q=m.width(),a=m.height(),w.left=Math.min(w.left,n.x+n.width-q),w.top=Math.min(w.top,n.y+n.height-a),m.offset(w)):(C(window).xa("resize",c),c());f.show(l.hide);if(l.onshow)l.onshow();k=d},onshow:b.onshow,onhide:b.onhide};e.xa("click",function(){k&&l.hide()});
return l};c.prototype.qp=function(a,b){var c=Yb(a),e=new vb(c,b),f=new Hb;e.Yk=function(a){f.ua("change",a)};return{on:function(a,b){f.xa(a,b)},colour:function(){if(arguments.length)e.Ro(arguments[0]);else return e.kb.toString()}}};c.prototype.yp=function(a,b){void 0===b&&(b={});var c=b.autohide,e=new Jb(Yb(a));b.onshow&&e.xa("show",b.onshow);b.onhide&&e.xa("hide",b.onhide);return{show:function(a){e.show("left"===a?"left":"right",c)},hide:function(){e.Xa()}}};c.prototype.xq=function(a,b){return this.lf(a,
b)};c.prototype.lf=function(a,b){function c(){var a=u.Ve(),b=1,c=0,d=0;h&&(a.y=h);m&&(a.height=m-a.y);k&&(a.x=k);l&&(a.width=l-a.x);f&&g?b=Math.min(f/a.width,g/a.height):f?(b=f/a.width,g=a.height*b):g?(b=g/a.height,f=a.width*b):(f=a.width,g=a.height);a.width*b<f&&(c=f/2-a.width*b/2);a.height*b<g&&(d=g/2-a.height*b/2);c-=a.x*b;d-=a.y*b;n.width=Math.ceil(f);n.height=Math.ceil(g);q.translate(c,d);q.scale(b,b);u.ja(q);e.log("Drawn.")}var e=this;void 0===b&&(b={});var f=b.width||0,g=b.height||0,h=b.top||
0,k=b.left||0,l=b.right||0,m=b.bottom||0,n=Zb(null),q=n.getContext("2d"),u=Dd.sj(a);if(!u)throw Error("Zwibbler.render: Could not open document");var v=new kd;u.format(q,v);v.xa("reformat",function(a){u.ag(a.id)});v.Ie?v.xa("done",function(){u.format(q,v);c()}):c();return n};c.prototype.Ws=function(a){a=A.Xb(a);return{r:a.values[0],g:a.values[1],b:a.values[2],a:a.values[3]}};c.prototype.us=function(a){return(new A(A.RGBA,[a.r,a.g,a.b,a.a])).toString()};c.prototype.er=function(a){var b=document.createElement("a");
b.href=a;return b.href};c.prototype.Zp=function(a){return x.encode("base64",a)};c.prototype.Op=function(a,b){this.fonts.add(a,b)};c.prototype.sp=function(a){var b=new U;Lc(b,a);return b.ec()};c.prototype.Ar=function(a,b){var c=document.createElement("img");c.src=a;c.onload=function(){b(c.naturalWidth,c.naturalHeight,c)}};c.prototype.ut=function(a,b){return hc(a,b)};c.prototype.hu=function(a){var b=Yb(a)[0];if(!b)throw Error("Zwibbler.toggleFullScreen: "+a+" not found");a=document;this.Xn()?document.exitFullscreen?
document.exitFullscreen():a.msExitFullscreen?a.msExitFullscreen():a.mozCancelFullScreen?a.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():b.requestFullscreen?b.requestFullscreen():b.msRequestFullscreen?b.msRequestFullscreen():b.mozRequestFullScreen?b.mozRequestFullScreen():b.webkitRequestFullscreen&&b.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)};c.prototype.Xn=function(){var a=document;return document.fullscreenElement||a.mozFullScreenElement||a.webkitFullscreenElement||
a.msFullscreenElement?!0:!1};c.prototype.Oq=function(){B.Nq()};return c}(),Cd=new Z;Cd.instances=Cd.Ak;Z.prototype.addButton=Z.prototype.hc;Z.prototype.addCustomNode=Z.prototype.Np;Z.prototype.Popup=Z.prototype.vp;Z.prototype.Dialog=Z.prototype.em;Z.prototype.ColourWheel=Z.prototype.qp;Z.prototype.SlidingPanel=Z.prototype.yp;Z.prototype.createPreview=Z.prototype.xq;Z.prototype.render=Z.prototype.lf;Z.prototype.parseColour=Z.prototype.Ws;Z.prototype.makeColour=Z.prototype.us;
Z.prototype.getAbsoluteUrl=Z.prototype.er;Z.prototype.base64Encode=Z.prototype.Zp;Z.prototype.addFont=Z.prototype.Op;Z.prototype.pathCommands=Z.prototype.kv;Z.prototype.CommandsFromSvgPath=Z.prototype.sp;Z.prototype.getImageSize=Z.prototype.Ar;Z.prototype.setColourOpacity=Z.prototype.ut;Z.prototype.toggleFullScreen=Z.prototype.hu;Z.prototype.isFullScreen=Z.prototype.Xn;Z.prototype.enableConsoleLogging=Z.prototype.Oq;window.Zwibbler=Cd;var Be=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.Gc=null;b.log=B.create("CUSTOM");return b}p(a,c);a.prototype.type=function(){return"CustomNode"};a.prototype.setProperty=function(a,d){if(null===this.Gc&&"type"===a){var b=Cd.Vj[d];this.Gc=new b}this.Gc&&this.Gc.setProperty?this.Gc.setProperty(a,d):c.prototype.setProperty.call(this,a,d)};a.prototype.la=function(a){return this.Gc&&this.Gc.setProperty?this.Gc.getProperty(a):c.prototype.la.call(this,a)};a.prototype.format=function(a){"format"in
this.Gc?this.Gc.format(a):alert("Error: custom item must have a format(ctx) function");a=this.Gc.rect;this.rect=new K(a.x,a.y,a.width,a.height)};a.prototype.ja=function(a){this.Gc.draw(a)};return a}(R);R.Tc("CustomNode",Be);var Ce=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.qa=null;b.width=100;b.height=20;b.ob=new Q;b.Oe=[];b.Fd=new K(0,0,b.width,b.height);b.kc=new K(0,0,b.width,b.height);b.log=B.create("IMAGE",!0);delete b.aa.fillStyle;delete b.aa.strokeStyle;delete b.aa.lineWidth;b.aa.url="";return b}p(a,c);a.prototype.type=function(){return"ImageNode"};a.prototype.setProperty=function(a,d){c.prototype.setProperty.call(this,a,d);if("url"===a)this.qa=null;else if("allowCrop"===a||"crop"===a||"blendMode"===
a||"opacity"===a||"width"===a||"height"===a)this.aa[a]=d};a.prototype.xt=function(a){a.x=Math.max(a.x,0);a.y=Math.max(a.y,0);a.width=Math.min(a.width,this.Fd.width);a.height=Math.min(a.height,this.Fd.height);a.width=Math.max(1,a.width);a.height=Math.max(1,a.height);this.aa.crop=[a.x,a.y,a.width,a.height].join()};a.prototype.An=function(){var a=this.aa.crop,c=new K(0,0,this.Fd.width,this.Fd.height);a&&(a=a.split(","),c.x=parseFloat(a[0])|0,c.y=parseFloat(a[1])|0,c.width=parseFloat(a[2])|0,c.height=
parseFloat(a[3])|0);return c};a.prototype.format=function(a,c){function b(a,b,c){l.Oe.push({x:l.kc.x+a*l.kc.width,y:l.kc.y+b*l.kc.height,Dd:c})}var d=this;null===this.qa&&"ImageSurface"in window?(this.qa=new window.ImageSurface(this.aa.url),this.Fd=new K(0,0,this.qa.width,this.qa.height)):null===this.qa?(this.Fd=new K(0,0,this.width,this.height),c.add(this.id,"image",this.aa.url,null,function(a){d.log("Got image response.");d.qa=a;a=d.la("width");var b=d.la("height");d.log("Override width/height as %s/%s",
a,b);a&&(d.qa.style.width=a+"px");b&&(d.qa.style.height=b+"px");return c.Pi(d.id)})):this.Fd=new K(0,0,this.qa.width,this.qa.height);this.kc=this.An();this.rect=this.kc.clone();var g=this.la("boundingPolygon");if(g){for(var h=[],k=0;k<g.length;k+=2)h.push(new E(g[k],g[k+1]));this.ob=new Q(h)}else this.ob=new Q(this.rect);this.fb=this.rect.clone();this.ob.transform(this.aa.matrix);this.rect.transform(this.aa.matrix);this.Oe.length=0;var l=this;b(.5,0,!0);b(1,.5,!1);b(.5,1,!0);b(0,.5,!1)};a.prototype.mk=
function(){return this.ob};a.prototype.gb=function(a,c){return!this.aa.locked&&this.ob.Vc(a,c,3)?this:null};a.prototype.Ee=function(b){var c,e,f=!1;if(this.qa)try{var g=b.globalCompositeOperation,h=b.globalAlpha,k=this.la("blendMode"),l=this.la("opacity");k&&(b.globalCompositeOperation=""+k,this.log("Using globalCompsiteOperation=%s (requested %s)",b.globalCompositeOperation,k));void 0!==l&&(b.globalAlpha=l);b.drawImage(this.qa,this.kc.x,this.kc.y,this.kc.width,this.kc.height,this.kc.x,this.kc.y,
this.kc.width,this.kc.height);b.globalAlpha=h;b.globalCompositeOperation=g;if(a.cm){var m=this.ob.ma;b.save();b.setTransform(1,0,0,1,0,0);b.beginPath();b.lineWidth=2;b.strokeStyle="#000000";b.moveTo(m[0].x,m[0].y);var n=c=1;for(e=m.length-1;c<=e;n=c+=1)b.lineTo(m[n].x,m[n].y);b.closePath();b.stroke();b.restore()}}catch(q){this.log("Error drawing image: %s",q.message),f=q}if(null===this.qa||f)b.save(),b.lineWidth=1,b.strokeStyle="#cccccc",b.strokeRect(0,0,this.width,this.height),b.restore()};a.prototype.Yf=
function(){return!0===this.la("allowCrop")&&!0!==this.la("lockEditMode")};a.prototype.ji=function(a,c){a.save();a.beginPath();a.lineWidth=1*c;a.strokeStyle="#0050B7";for(var b=this.Ga(),d=0;d<this.Oe.length;d++){var g=this.Oe[d],h=b.apply(g.x,g.y),k;if(g.Dd){var l=20;var m=k=0;var n=3;g=h.x-10;h=h.y-6}else l=0,k=20,m=3,n=0,g=h.x-6,h=h.y-10;for(var q=0;5>q;q++)a.moveTo(g,h),a.lineTo(g+l*c,h+k*c),g+=m*c,h+=n*c}a.stroke();a.restore()};a.prototype.md=function(a,c,e){var b=this.Ga();e*=10;for(var d=0;d<
this.Oe.length;d++){var h=this.Oe[d];h=b.apply(h.x,h.y);if(h.x-e<=a&&a<h.x+e&&h.y-e<=c&&c<h.y+e)return d}return null};a.prototype.Yg=function(a){a=this.Oe[a];return this.Ga().apply(a.x,a.y)};a.prototype.ke=function(a,c,e){var b=this.An();c=this.Ue().apply(c,e);0===a&&0<=c.y?(b.height-=c.y-b.y,b.y=c.y):1===a&&c.x<this.Fd.width?b.width=c.x-b.x:2===a&&c.y<this.Fd.height?b.height=c.y-b.y:3===a&&0<=c.x&&(b.width-=c.x-b.x,b.x=c.x);this.xt(b)};a.cm=!1;return a}(R);R.Tc("ImageNode",Ce);var De=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.qa=null;b.eh=20;b.Yc=20;b.ob=new Q;b.Qc=0;b.Rc=0;b.Od=0;b.Pd=0;b.log=B.create("STAMPLINE",!0);b.log("New StampLineNode created.");b.aa.x1=10;b.aa.y1=10;b.aa.x2=100;b.aa.y2=100;b.aa.url="http://zwibbler.com/wd-box.png";return b}p(a,c);a.prototype.type=function(){return"StampLineNode"};a.prototype.format=function(a,c){var b=this;null===this.qa?(c.add(this.id,"image",this.aa.url,null,function(a){b.log("Got image response.");b.qa=a;c.Pi(b.id)}),
this.Yc=this.eh=20):(this.eh=this.qa.width,this.Yc=this.qa.height);this.Qc=this.aa.x1;this.Rc=this.aa.y1;this.Od=this.aa.x2;this.Pd=this.aa.y2;var d=G(this.Qc,this.Rc,this.Od,this.Pd);var g=-Math.atan2(this.Pd-this.Rc,this.Od-this.Qc);this.ob=new Q;this.ob.add(0,-this.Yc/2);this.ob.add(d,-this.Yc/2);this.ob.add(d,this.Yc/2);this.ob.add(0,this.Yc/2);d=new M;d=d.multiply(this.Ga());d=d.multiply(new L(this.Qc,this.Rc));d=d.multiply(new zc(g,0,0));this.ob.transform(d);this.rect=this.ob.Sm()};a.prototype.gb=
function(a,c){return!this.aa.locked&&this.ob.Vc(a,c,3)?this:null};a.prototype.Yf=function(){return!0};a.prototype.md=function(a,c,e){var b=this.Ga();var d=b.apply(this.Qc,this.Rc);b=b.apply(this.Od,this.Pd);e*=8;return a>=d.x-e&&a<d.x+e&&c>=d.y-e&&c<d.y+e?0:a>=b.x-e&&a<b.x+e&&c>=b.y-e&&c<b.y+e?1:null};a.prototype.Yg=function(a){return 0===a?this.Ga().apply(this.aa.x1,this.aa.y1):this.Ga().apply(this.aa.x2,this.aa.y2)};a.prototype.ke=function(a,c,e){c=this.Ue().apply(c,e);0===a?(this.aa.x1=c.x,this.aa.y1=
c.y):1===a&&(this.aa.x2=c.x,this.aa.y2=c.y)};a.prototype.ji=function(a,c){a.save();a.lineWidth=1*c;a.strokeStyle="#0050B7";var b=this.Ga();var d=b.apply(this.Qc,this.Rc);b=b.apply(this.Od,this.Pd);var g=4*c;a.beginPath();a.moveTo(d.x,d.y);a.lineTo(b.x,b.y);a.rect(d.x-g,d.y-g,2*g,2*g);a.rect(b.x-g,b.y-g,2*g,2*g);a.stroke();a.restore()};a.prototype.Ee=function(a){var b,c;var f=new E(this.Qc,this.Rc);var g=new E(this.Od,this.Pd);g=f.Oa(g);f=new zc(-Math.atan2(this.Pd-this.Rc,this.Od-this.Qc),this.Qc,
this.Rc);f=f.multiply(new L(this.Qc,this.Rc));a.transform(f.m11,f.m21,f.m12,f.m22,f.Ca,f.Da);a.beginPath();f=b=0;for(c=this.eh;0<c?b<=g:b>=g;f=b+=c)this.qa?this.eh<g-f?a.drawImage(this.qa,f,-this.Yc/2|0):1<g-f&&a.drawImage(this.qa,0,0,g-f|0,this.Yc,f,-this.Yc/2|0,g-f|0,this.Yc):a.rect(f,0,this.eh,this.Yc);null===this.qa&&(a.lineWidth=2,a.strokeStyle="red",a.stroke())};return a}(R);R.Tc("StampLineNode",De);var Ee=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.Th="UnknownNode";b.width=100;b.height=20;b.pb=new Wc;b.log=B.create("UNKNOWN",!0);b.pb.Lo("centre","middle");return b}p(a,c);a.prototype.Kt=function(a){this.Th=a;this.pb.Xo(a);this.log("Creating placeholder for node type %s",a)};a.prototype.type=function(){return this.Th};a.prototype.setProperty=function(a,c){this.aa[a]=c};a.prototype.format=function(a){this.log("Formatting placeholder for %s",this.Th);this.rect=new K(0,0,this.width,
this.height);this.rect.transform(this.aa.matrix);this.pb.format(a,this.width,this.height)};a.prototype.Ee=function(a){this.log("Drawing placeholder for for %s",this.Th);a.save();a.lineWidth=1;a.fillStyle="#888888";a.fillRect(0,0,this.width,this.height);a.fillStyle="#000000";this.pb.ja(a,0,0);a.restore()};a.cm=!1;return a}(R);R.Tc("UnknownNode",Ee);var Fe=function(){function c(a,b){this.next=this.ad=null;this.Fl=this.cj=this.length=0;this.gp=!1;this.text="";this.Ei=!0;this.log=B.create("WallSegment",!0);a instanceof c?(this.ad=a,this.ad.next=this,this.from=this.ad.fa):this.from=a;this.fa=b}c.prototype.vn=function(a,b,c){this.text=a;this.cj=b;this.Fl=c;this.gp=!1};c.prototype.Gq=function(a){if(""!==this.text){var b=G(this.from.x,this.from.y,this.fa.x,this.fa.y);if(!(b<this.cj)){a.save();var c=2*this.Fl,e=I(this.from.x,this.from.y,this.fa.x,this.fa.y),
f=new E(e.y,-e.x),g=Math.atan2(this.fa.y-this.from.y,this.fa.x-this.from.x);0>g&&(g+=2*Math.PI);this.gp&&(c*=-1);var h=(b-this.cj)/2,k=new E(this.from.x+f.x*c,this.from.y+f.y*c),l=new E(this.fa.x+f.x*c,this.fa.y+f.y*c);a.beginPath();a.moveTo(k.x-f.x*c/4+e.x*c/4,k.y-f.y*c/4+e.y*c/4);a.lineTo(k.x,k.y);a.lineTo(k.x+f.x*c/4+e.x*c/4,k.y+f.y*c/4+e.y*c/4);a.moveTo(l.x-f.x*c/4-e.x*c/4,l.y-f.y*c/4-e.y*c/4);a.lineTo(l.x,l.y);a.lineTo(l.x+f.x*c/4-e.x*c/4,l.y+f.y*c/4-e.y*c/4);a.moveTo(k.x,k.y);a.lineTo(k.x+e.x*
h,k.y+e.y*h);a.moveTo(l.x,l.y);a.lineTo(l.x-e.x*h,l.y-e.y*h);a.stroke();g>Math.PI/2&&g<3*Math.PI/2&&(g+=Math.PI);a.translate(k.x+e.x*b/2,k.y+e.y*b/2);a.rotate(g);a.translate(-this.cj/2,this.Fl/2*.8);a.fillText(this.text,0,0);a.restore()}}};c.prototype.Dq=function(a,b){var c=I(this.from.x,this.from.y,this.fa.x,this.fa.y),e=new E(c.y,-c.x),f=e.x*(a-this.from.x)+e.y*(b-this.from.y);c=new E(this.from.x+f*e.x,this.from.y+f*e.y);e=new E(this.fa.x+f*e.x,this.fa.y+f*e.y);this.ad&&(f=Jc(this.ad.from.x,this.ad.from.y,
this.ad.fa.x,this.ad.fa.y,c.x,c.y,e.x,e.y))&&(c=f);this.next&&(f=Jc(this.next.from.x,this.next.from.y,this.next.fa.x,this.next.fa.y,c.x,c.y,e.x,e.y))&&(e=f);this.from.x=c.x;this.from.y=c.y;this.fa.x=e.x;this.fa.y=e.y};return c}(),Ge=function(){function c(a,b){this.Ka=a;this.type=b;this.log=B.create("WallEditHandle",!0);this.Ka=a;this.type=b}c.prototype.gb=function(a,b,c,e,f){switch(this.type){case "from":a=G(a,b,this.Ka.from.x,this.Ka.from.y);break;case "to":a=G(a,b,this.Ka.fa.x,this.Ka.fa.y);break;
default:var d=0,h=0;"middle"===e?(d=-f/2,h=f/2):"outside"===e?d=-f:h=f;e=I(this.Ka.from.x,this.Ka.from.y,this.Ka.fa.x,this.Ka.fa.y);e=new E(e.y,-e.x);d=(new E(a,b)).gi(new E(this.Ka.from.x+d*e.x,this.Ka.from.y+d*e.y),new E(this.Ka.fa.x+d*e.x,this.Ka.fa.y+d*e.y));a=(new E(a,b)).gi(new E(this.Ka.from.x+h*e.x,this.Ka.from.y+h*e.y),new E(this.Ka.fa.x+h*e.x,this.Ka.fa.y+h*e.y));a=Math.min(d,a)}return a<c};c.prototype.moveTo=function(a,b){switch(this.type){case "from":var c=this.Ka.ad;this.Ka.from.x=a;
this.Ka.from.y=b;break;case "to":var e=this.Ka.next;this.Ka.fa.x=a;this.Ka.fa.y=b;break;default:c=this.Ka.ad,e=this.Ka.next,this.Ka.Dq(a,b)}c&&(c.Ei=!0);e&&(e.Ei=!0)};c.prototype.Nr=function(){switch(this.type){case "from":return this.Ka.from;case "to":return this.Ka.fa;default:return this.Ka.from}};c.prototype.hr=function(){return Math.atan2(this.Ka.fa.y-this.Ka.from.y,this.Ka.fa.x-this.Ka.from.x)};return c}();var He=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.precision=1;b.font="";b.rect=new K(0,0,0,0);b.fb=new K(0,0,0,0);b.path=null;b.Hg=[];b.Hb=[];b.Gb=[];b.ka=null;b.lineWidth=0;b.ug=0;b.log=B.create("WallNode",!0);b.log("New WallNode created.");b.aa.svgpath="";b.aa.strokeStyle="#000000";b.aa.lineWidth=1;b.aa.pixelsPerUnit=1;b.aa.units="px";b.aa.fontSize=15;b.aa.fontName="Arial";b.aa.textFillStyle="#000000";b.aa.insideFillStyle="rgba(0,0,0,0.0)";b.aa.fillStyle="rgba(0,0,0,0.0)";b.aa.thickness=
10;b.aa.placement="middle";b.aa.lockCorners=!1;return b}p(a,c);a.prototype.type=function(){return"WallNode"};a.prototype.resolve=function(a){var b=a.mk().clone();this.log("Resolve with: %s %s",a.type(),b.ma);b.transform(this.Ue());this.Hg.push(b);return a.rect.Ps(this.rect)};a.prototype.format=function(a,c){this.ka=a;var b=new E(0,0),d=[],g=null,h=this.Ga(),k=[],l=[],m,n=this,q={beginPath:function(){},moveTo:function(a,c){b=h.apply(a,c);k.push(new E(a,c));l.push(b);g=null;q.moveTo=q.lineTo},lineTo:function(a,
c){var e=h.apply(a,c);g?g=new Fe(g,e):m=g=new Fe(b,e);k.push(new E(a,c));l.push(e);b=e;d.push(g)},bezierCurveTo:function(){},quadraticCurveTo:function(){},closePath:function(){n.log("close");m&&g!==m&&null!==g&&(n.log("close up!"),m.ad=g,g.next=m,g.fa=m.from)}};this.Hb=d;this.path=new P;this.log("Formatting svgpath=%s",this.la("svgpath"));Lc(this.path,this.la("svgpath"));var u;for(u=0;u<this.Hg.length;u++)this.log("path: %s",this.path.Nd()),this.log("poly: %s",this.Hg[u].Nd()),this.path=this.path.nq(this.Hg[u]);
this.path.ja(q);this.fb=K.Be(k);this.rect=K.Be(l);this.path.transform(this.Ga());this.lineWidth=u=this.la("lineWidth");this.rect.Hc(u/2,u/2);this.ug=this.la("thickness");this.rect.Hc(2*this.ug);this.rect.Hc(3*this.aa.fontSize);this.font=""+this.aa.fontSize+'px "'+this.aa.fontName+'"';for(u=0;u<this.Hb.length;u++)this.wn(a,this.Hb[u]);this.Gb.length=0;for(u=0;u<d.length;u++){var v=d[u];z!==v.from&&this.Gb.push(new Ge(v,"from"));this.Gb.push(new Ge(v,"to"));var z=v.fa}for(u=0;u<d.length;u++)v=d[u],
this.Gb.push(new Ge(v,"middle"));z=this.la("insideFillStyle");this.br(a,c,z);this.Hg.length=0};a.prototype.wn=function(a,c){c.Ei=!1;if(0>=this.aa.pixelsPerUnit)c.vn("",0,0);else{var b=G(c.from.x,c.from.y,c.fa.x,c.fa.y)/this.aa.pixelsPerUnit;if("ft-in"===this.aa.units){var d=Math.floor(b);b=Math.round(12*(b-d));12===b&&(b=0,d+=1);b=b?" "+d+"'"+b+'" ':" "+d+"' "}else d=Math.pow(10,this.precision),b=Math.round(b*d)/d,b=" "+b+this.aa.units+" ";a.font=this.font;c.vn(b,a.measureText(b).width,this.aa.fontSize)}};
a.prototype.jt=function(){this.log("Reconstruct path!");var a=new Mc,c=this.Ga().inverse();a.transform(c.m11,c.m21,c.m12,c.m22,c.Ca,c.Da);this.hn(a);this.setProperty("svgpath",a.toString())};a.prototype.Uf=function(){return"svgpath"};a.prototype.Rr=function(){return this.path||new P};a.prototype.hn=function(a){var b=null,c;for(c=0;c<this.Hb.length;c++){var f=this.Hb[c];if(b!==f.from){a.moveTo(f.from.x,f.from.y);var g=f.from}a.lineTo(f.fa.x,f.fa.y);f.fa===g&&a.closePath();b=f.fa}};a.prototype.ja=function(a){var b;
a.save();this.kg(a);a.lineJoin="square";a.lineCap="square";a.strokeStyle=this.la("strokeStyle");a.lineWidth=this.la("lineWidth");a.beginPath();this.hn(a);a.fillStyle=this.wr();a.fill();a.beginPath();var c=[];for(b=0;b<this.Hb.length;b++){var f=this.Hb[b];g!==f.from&&(Nc(a,c,this.la("thickness"),this.la("placement")),c.length=0,c.push(f.from));c.push(f.fa);var g=f.fa}Nc(a,c,this.la("thickness"),this.la("placement"));a.fillStyle=this.la("fillStyle");a.strokeStyle=this.la("strokeStyle");a.fill();a.stroke();
a.fillStyle=a.strokeStyle;if(0<this.la("pixelsPerUnit"))for(a.textBaseline="alphabetic",a.fillStyle=this.la("textFillStyle"),a.strokeStyle=this.la("textFillStyle"),a.font=this.font,b=0;b<this.Hb.length;b++)f=this.Hb[b],f.Gq(a);this.ig(a);a.restore()};a.prototype.gb=function(a,c){if(null===this.path)return null;var b=6+2*this.la("thickness");return"rgba(0,0,0,0.0)"===this.la("fillStyle")?!this.hidden()&&!this.la("locked")&&this.rect.Vc(a,c,b)&&this.path.al(a,c,b)?this:null:!this.hidden()&&!this.la("locked")&&
this.rect.Vc(a,c,b)&&this.path.Ao(a,c,b)?this:null};a.prototype.md=function(a,c,e){var b=this.la("thickness"),d=this.la("wallPlacement");e=6/e+b;for(var h=this.aa.lockCorners,k=0;k<this.Gb.length;k++)if(this.Gb[k].gb(a,c,e,d,b)&&(!h||"middle"===this.Gb[k].type))return k;return null};a.prototype.Yf=function(){return!1};a.prototype.Yg=function(a){return a>=this.Gb.length?(this.log("Bad edit handle %s",a),null):this.Gb[a].Nr()};a.prototype.fe=function(a){return null!==a&&a<this.Gb.length?this.Gb[a].type:
null};a.prototype.vr=function(a){return null!==a&&a<this.Gb.length?this.Gb[a].hr():0};a.prototype.xk=function(a,c,e,f,g){if(null===a||a>=this.Gb.length)return new E(0,0);a=this.Gb[a].Ka;var b=this.la("placement");"middle"===b?e-=this.ug/2:"outside"===b&&(e-=this.ug);"middle"===c?e+=this.ug/2:"outside"===c&&(e+=this.ug);c=I(a.from.x,a.from.y,a.fa.x,a.fa.y);var d=new E(c.y,-c.x);c=a.from.x+e*d.x;b=a.from.y+e*d.y;var l=a.fa.x+e*d.x-c;e=a.fa.y+e*d.y-b;f=((f-c)*l+(g-b)*e)/(l*l+e*e);1<f?f=1:0>f&&(f=0);
return new E(c+f*l,b+f*e)};a.prototype.ke=function(a,c,e){if(a>=this.Gb.length)this.log("Bad edit handle %s",a);else{this.Gb[a].moveTo(c,e);for(a=0;a<this.Hb.length;a++)c=this.Hb[a],c.Ei&&this.ka&&this.wn(this.ka,c);this.jt()}};return a}(R);R.Tc("WallNode",He);var Ie=function(c){function a(){var a=null!==c&&c.apply(this,arguments)||this;a.Tb="Action";a.log=B.create("ACTION");return a}p(a,c);a.prototype.Ob=function(){};a.prototype.toString=function(){return""+this.Tb+"()"};return a}(Pb),V=function(c){function a(a,d,e,f,g){void 0===f&&(f=null);void 0===g&&(g=-1);var b=c.call(this)||this;b.id=a;b.type=d;b.aa=e;b.Ji=f;b.index=g;b.node=null;b.Tb="CreateAction";return b}p(a,c);a.prototype.Ob=function(a){var b=R.create(this.type,this.id,a);b||(this.type in Cd.Vj?
(b=new Be(this.id,a),b.setProperty("type",this.type)):(this.log("Bad node type: %s",this.type),b=R.create("UnknownNode",this.id,a),b.Kt(this.type)));b.Cb(this.aa);null===this.Ji&&(this.Ji=a.vk().id,this.index=-1);var c=a.za(this.Ji,!1);c instanceof ld&&(a.qb(c,b,this.index),this.log("Add %s id %s to parent %s index %s",b.type(),this.id,c.type(),this.index),this.node=b)};a.prototype.toString=function(){return""+this.Tb+"("+this.type+NaN+this.id+", "+JSON.stringify(this.aa)+", parent="+this.Ji+", index="+
this.index+")"};a.prototype.jb=function(a){this.node&&a.removeNode(this.node)};return a}(Ie),le=function(c){function a(a){var b=c.call(this)||this;b.Na=a;b.me=[];b.Tb="DeleteAction";return b}p(a,c);a.prototype.Ob=function(a){var b;this.me.length=0;var c=this.Na;var f=0;for(b=c.length;f<b;f++){var g=c[f];(g=a.za(g,!1))&&this.me.push({node:g,parent:g.parent,index:a.removeNode(g)})}};a.prototype.jb=function(a){for(var b,c=this.me.length-1;0<=c;--c)b=this.me[c],b.node&&b.parent&&a.qb(b.parent,b.node,
b.index)};return a}(Ie),Rd=function(c){function a(a,d,e){var b=c.call(this)||this;b.Na=a;b.name=d;b.value=e;b.Gd=[];b.Tb="SetAction";return b}p(a,c);a.prototype.Ob=function(a){var b;this.Gd.length=0;var c=this.Na;var f=0;for(b=c.length;f<b;f++){var g=c[f];if(g=a.za(g,!0))this.Gd.push(g.la(this.name)),a.ue(g,this.name,this.value)}};a.prototype.jb=function(a){var b,c,f;if(0!==this.Na.length){var g=c=0;for(f=this.Na.length-1;0<=f?c<=f:c>=f;g=0<=f?++c:--c)(b=a.za(this.Na[g],!0))&&a.ue(b,this.name,this.Gd[g])}};
a.prototype.ko=function(b){if(!(b instanceof a)||this.name!==b.name)return!1;this.Na.sort();b.Na.sort();if(this.Na.length!==b.Na.length)return!1;for(var c=0;c<this.Na.length;c++)if(this.Na[c]!==b.Na[c])return!1;this.log("Merging property change %s",this.name);this.value=b.value;return!0};return a}(Ie),Pd=function(c){function a(a,d){var b=c.call(this)||this;b.Na=a;b.sa=d;b.Tb="TransformAction";b.inverse=d.inverse();return b}p(a,c);a.prototype.Ob=function(a){for(var b=a.tk(this.Na,!0,!0),c=0;c<b.length;c++){var f=
b[c];f.transform(this.sa);a.$c.Cb(f.id,{matrix:f.Ga()})}};a.prototype.jb=function(a){for(var b=a.tk(this.Na,!0,!0),c=0;c<b.length;c++){var f=b[c];f.transform(this.inverse);a.$c.Cb(f.id,{matrix:f.Ga()})}};return a}(Ie),Gd=function(c){function a(a,d,e,f,g,h){var b=c.call(this)||this;b.id=a;b.handle=d;b.Es=e;b.Fs=f;b.x=g;b.y=h;b.Tb="MoveEditHandleAction";return b}p(a,c);a.prototype.Ob=function(a){var b;if(b=a.za(this.id,!0)){b.ke(this.handle,this.x,this.y);var c={};c[b.Uf()]=b.la(b.Uf());a.$c.Cb(b.id,
c)}};a.prototype.jb=function(a){var b;if(b=a.za(this.id,!0)){b.ke(this.handle,this.Es,this.Fs);var c={};c[b.Uf()]=b.la(b.Uf());a.$c.Cb(b.id,c)}};return a}(Ie),Ad=function(c){function a(a,d){var b=c.call(this)||this;b.id=a;b.Na=d;b.me=[];b.node=null;b.Tb="GroupAction";return b}p(a,c);a.prototype.Ob=function(a){var b;this.me.length=0;var c=this.Na;var f=0;for(b=c.length;f<b;f++){var g=c[f];(g=a.za(g))&&this.me.push({node:g,parent:g.parent,index:g.parent.jk(g)})}this.node=a.Mg(this.id,this.Na)};a.prototype.jb=
function(a){var b,c;if(0!==this.Na.length&&this.node){for(b=c=this.Na.length-1;0<=c&&!(0>b);b=c+=-1)b=this.me[b],b.parent&&b.node&&a.qb(b.parent,b.node,b.index);a.removeNode(this.node)}};a.prototype.toString=function(){return"GroupAction("+JSON.stringify(this.Na)+")"};return a}(Ie),ke=function(c){function a(a){var b=c.call(this)||this;b.Na=a;b.Cd=[];b.Tb="UngroupAction";return b}p(a,c);a.prototype.Ob=function(a){var b,c,f={};var g=this.Na;var h=0;for(b=g.length;h<b;h++){var k=g[h];k=a.za(k);if(k instanceof
ld){var l=k;if(!(l.id in f)){f[l.id]=!0;var m={node:l,parent:l.parent,children:l.children.concat(),index:0};var n=m.children;var q=0;for(c=n.length;q<c;q++)k=n[q],a.qb(l.parent,k,-1);m.index=a.removeNode(l);this.Cd.push(m)}}}};a.prototype.jb=function(a){var b,c,f,g;if(0!==this.Cd.length){for(b=f=this.Cd.length-1;0<=f&&!(0>b);b=f+=-1)if(b=this.Cd[b],0!==b.children.length)for(a.qb(b.parent,b.node,b.index),c=g=b.children.length-1;0<=g&&!(0>c);c=g+=-1)a.qb(b.node,b.children[c],-1);a.ni=!0}};return a}(Ie);
function Je(c,a){var b;if(c.Yn()){var d=c.children;var e=0;for(b=d.length;e<b;e++){var f=d[e];Je(f,a)}}else c.transform(a)}
var me=function(c){function a(a,d,e){var b=c.call(this)||this;b.Na=a;b.offsetX=d;b.offsetY=e;b.ra=[];b.Tb="DuplicateAction";return b}p(a,c);a.prototype.Ob=function(a){var b;var c=new L(this.offsetX,this.offsetY);this.ra.length=0;var f=function(){return a.Va()};var g=this.Na;var h=0;for(b=g.length;h<b;h++){var k=g[h];if(k=a.za(k))k=k.clone(f),c.Dk()||Je(k,c),a.Hf(k),this.ra.push(k)}};a.prototype.jb=function(a){var b,c;if(0!==this.ra.length)for(b=c=this.ra.length-1;0<=c&&!(0>b);b=c+=-1)a.removeNode(this.ra[b])};
return a}(Ie),je=function(c){function a(a,d,e){var b=c.call(this)||this;b.Na=a;b.type=d;b.lo=e;b.ra=[];b.Tk=[];b.Tb="ChangeOrderAction";return b}p(a,c);a.prototype.Ob=function(b){var c,e;this.Tk.length=0;this.ra.length=0;var f=this.Na;var g=0;for(e=f.length;g<e;g++){var h=f[g];if(h=b.za(h))if(c=h.parent){var k=h.Te();this.Tk.push(k);this.ra.push(h);switch(this.type){case a.am:b.qb(c,h,-1);break;case a.uj:b.qb(c,h,0);break;case a.im:0<k?b.qb(c,h,k-1):b.qb(c,h,k);break;case a.jm:k<c.children.length?
b.qb(c,h,k+1):b.qb(c,h,k);break;case a.mm:void 0===this.lo?b.qb(c,h,-1):b.qb(c,h,this.lo)}}}};a.prototype.jb=function(a){var b,c,f;if(0!==this.Na.length)for(b=f=this.Na.length-1;0<=f&&!(0>b);b=f+=-1){var g=this.ra[b];(c=g.parent)&&g&&a.qb(c,g,this.Tk[b])}};a.am=0;a.uj=1;a.jm=2;a.im=3;a.mm=4;return a}(Ie),ye=function(c){function a(a,d,e){var b=c.call(this)||this;b.id=a;b.fu=d;b.eu=e;b.Tb="MoveNodeAction";b.po=0;b.Xe=0;return b}p(a,c);a.prototype.Ob=function(a){var b=a.za(this.id),c=a.za(this.fu);if(c&&
!(c instanceof ld)&&b)throw console.log("FATAL: Parent node: "+c.id+":"+c.type()+" child "+b.id+":"+b.type()),Error("Tried to move to a non-group node!");b&&b.parent&&c&&(this.po=b.parent.id,this.Xe=b.Te(),a.qb(c,b,this.eu))};a.prototype.jb=function(a){var b=a.za(this.id),c=a.za(this.po);b&&b.parent&&c&&a.qb(c,b,this.Xe)};return a}(Ie),Bd=function(c){function a(a){var b=c.call(this)||this;b.aa=a;b.Gd={};b.Tb="SetDocumentPropertiesAction";return b}p(a,c);a.prototype.Ob=function(a){var b;this.Gd={};
for(b in this.aa)this.aa.hasOwnProperty(b)&&(this.Gd[b]=a.la(b),a.setProperty(b,this.aa[b]))};a.prototype.jb=function(a){for(var b in this.Gd)this.Gd.hasOwnProperty(b)&&a.setProperty(b,this.Gd[b])};return a}(Ie),Ae=function(c){function a(a){var b=c.call(this)||this;b.Qs=a;b.oo=0;b.Tb="SetPageAction";return b}p(a,c);a.prototype.Ob=function(a){this.oo=a.Ua;a.Bb(this.Qs)};a.prototype.jb=function(a){a.Bb(this.oo)};return a}(Ie);var Ke=function(c){function a(b,d){var e=c.call(this,b,d,a)||this;e.log=B.create("PAGE",!0);e.children=[];return e}p(a,c);a.prototype.type=function(){return"PageNode"};a.prototype.format=function(){};a.prototype.gb=function(){return null};a.prototype.ja=function(){};return a}(ld);R.Tc("PageNode",Ke);var Le=function(){function c(){this.log=B.create("NullObserver")}c.prototype.createNode=function(a,b,c,e){this.log("Create node "+e.type+" "+a+" at "+b+":"+c)};c.prototype.sc=function(a,b,c){this.log("Delete node "+a+" from "+b+":"+c)};c.prototype.le=function(a,b,c,e,f){this.log("Move node "+a+" from "+e+":"+f+" to "+b+":"+c)};c.prototype.Cb=function(a,b){this.log("Set properties for node "+a+" to "+JSON.stringify(b))};return c}(),zd=function(c){function a(a){void 0===a&&(a=!1);var b=c.call(this)||
this;b.Xu=a;b.$c=new Le;b.Ae=new Qb;b.ra={};b.pe=new t;b.un=!0;b.ni=!0;b.lb=0;b.Zc=new t;b.removedNodes=new t;b.Ud=new t;b.root=new ld(b.Va(),b);b.Yi=0;b.Bl="magenta";b.readOnly=!1;b.Hb=new t;b.ck=new t;b.ak=new t;b.aa={};b.yi=new t;b.$l=new t;b.sd=[];b.ab=[];b.Ua=0;b.Qg=0;b.av=-1;b.bg=0;b.Ho=0;b.log=B.create("DOC");b.ra[b.root.id]=b.root;b.ho();a||(b.zj(b.root,0),b.Bb(b.fh(0)));return b}p(a,c);a.prototype.empty=function(){return 0===this.root.children.length};a.prototype.ho=function(){this.Ho=this.Ae.next};
a.prototype.Xd=function(){return this.Ho!==this.Ae.next};a.prototype.Va=function(){for(;;){var a=this.lb++;if(!(a in this.ra))return a}};a.prototype.Qe=function(a){return a in this.ra};a.prototype.zj=function(a,c,e,f,g){void 0===e&&(e=!0);void 0===f&&(f=null);void 0===g&&(g=0);var b,d=!1;if(a.id in this.ra)null!==f&&a.parent&&(this.$c.le(a.id,a.parent.id,a.Te(),f,g),this.log("Node %s inserted at %s:%s; was at %s",a.id,a.parent.id,a.Te(),g));else if(d=!0,this.ra[a.id]=a,a.parent&&(f=a.uc(),f.type=
a.type(),this.$c.createNode(a.id,a.parent.id,a.Te(),f)),a instanceof ld){var l=a.children;g=0;for(b=l.length;g<b;g++)f=l[g],this.zj(f,c,e)}"PageNode"!==a.type()&&d&&(this.Zc.add(a.id),this.removedNodes.remove(a.id));a.rg(this.readOnly);e&&this.pe.add(a.id);this.$l.add(a.Xf());a.la("spotHighlight")&&"PathNode"===a.type()&&this.sd.push(a);this.bg=void 0===c||null===c?this.ge(a.id)||0:c;a.la("wallAffinity")&&this.ck.add(a.id);"WallNode"===a.type()?this.Hb.add(a.id):"DomNode"===a.type()?this.ak.add(a.id):
"PageNode"===a.type()&&(this.Qg=-1);d&&a.Vk()};a.prototype.ag=function(a){this.Ud.add(a);this.bg=this.ge(a)||0;this.pe.add(a)};a.prototype.Hf=function(a){this.ab[this.Ua]||console.log("FATAL: Asked to add a node but bad page.",this.Ua,this.ab);this.qb(this.ab[this.Ua],a,-1)};a.prototype.za=function(a,c){void 0===c&&(c=!1);if(a in this.ra){var b=this.ra[a];c&&(this.pe.add(a),this.Ud.add(a),this.bg=this.ge(a)||0);return b}return null};a.prototype.ge=function(a){for(a=this.za(a,!1);;)if(a)if("PageNode"===
a.type())break;else{if(null===a.parent)return null;a=a.parent}else return null;for(var b=0;b<this.ab.length;b++)if(this.ab[b]===a)return b;return null};a.prototype.tk=function(a,c,e){for(var b=[],d=0;d<a.length;d++){var h=this.za(a[d],e);h&&b.push(h)}return b=c?this.Rq(b):this.Zh(b)};a.prototype.Xq=function(a){var b=[],c;for(c in this.ra)if(this.ra.hasOwnProperty(c)){var f=this.ra[c];f.la("tag")===a&&b.push(f)}return b};a.prototype.ta=function(a,c){void 0===c&&(c=!1);this.Zc=new t;this.removedNodes=
new t;this.Ud=new t;if(c){this.log("Performing actions without adding to undo stack");for(var b=0;b<a.length;b++)a[b].Ob(this)}else this.Ae.ta(a,!1,this);return{cd:this.Zc.ud(),kf:this.removedNodes.ud(),vf:this.Ud.Pf(this.Zc).Pf(this.removedNodes).ud()}};a.prototype.jb=function(){this.Zc=new t;this.removedNodes=new t;this.Ud=new t;this.Ae.jb(this);return{cd:this.Zc.ud(),kf:this.removedNodes.ud(),vf:this.Ud.Pf(this.Zc).Pf(this.removedNodes).ud()}};a.prototype.Kd=function(){this.Zc=new t;this.removedNodes=
new t;this.Ud=new t;this.Ae.Kd(this);return{cd:this.Zc.ud(),kf:this.removedNodes.ud(),vf:this.Ud.Pf(this.Zc).Pf(this.removedNodes).ud()}};a.prototype.Ke=function(){return this.Ae.Ke()};a.prototype.Je=function(){return this.Ae.Je()};a.prototype.rh=function(){this.Ae=new Qb};a.prototype.format=function(a,c){var b=this,d;var g=[];if(this.un)for(n in this.ra)g.push(this.ra[n]);else this.pe.sb(function(a){g.push(b.ra[parseInt(a,10)]);return!1});var h=this.Zh(g);var k=[],l=[];var m=0;for(d=h.length;m<d;m++){var n=
h[m];"WallNode"!==n.type()?(n.format(a,c),n.la("wallAffinity")&&k.push(n)):l.push(n)}if(!this.Hb.empty()){var q=new t,u,v,z=this,w;z.Hb.sb(function(a){a=parseInt(a,10);for(w=0;w<k.length;w++)u=k[w],z.ra[a].resolve(u)&&h.push(z.ra[a]),q.add(a+"_"+u.id);return!1});z.ck.sb(function(a){a=parseInt(a,10);for(w=0;w<l.length;w++)v=l[w],q.contains(v.id+"_"+a)||v.resolve(z.ra[a])&&h.push(v);return!1});m=0;for(d=h.length;m<d;m++)n=h[m],"WallNode"!==n.type()||q.contains(n.id)||(q.add(n.id),n.format(a,c))}this.pe.clear();
this.un=!1;return g.length};a.prototype.Jq=function(a,c,e){if(0!==this.sd.length&&c===this.Yi){a.save();a.beginPath();c=e||this.Ve();a.moveTo(c.x,c.y);a.lineTo(c.x,c.bottom());a.lineTo(c.right(),c.bottom());a.lineTo(c.right(),c.y);a.closePath();e=!1;for(var b=0;b<this.sd.length;b++)this.sd[b].page===this.ab[this.Ua]&&(this.sd[b].clip(a),e=!0);e&&(a.clip(),a.fillStyle=this.Bl,a.fillRect(c.x,c.y,c.width,c.height));a.restore()}};a.prototype.ja=function(a,c){function b(b){g.Rf(function(c){g.yi.contains(c.Bd())||
c.Xf()===b&&(c.hidden()||c.ja(a))});g.Jq(a,b,c)}var d,g=this;this.$l.add(this.Yi);var h=this.$l.ud();h.sort(function(a,b){return a-b});var k=0;for(d=h.length;k<d;k++)b(h[k])};a.prototype.gb=function(a,c,e,f){var b=null;this.Rf(function(d){d.Bd()===e&&d.gb(a,c)&&(!(null===b||b.Xf()<=d.Xf())||f&&f!==d.type()||(b=d))});return b};a.prototype.Lr=function(a){var b=[];this.Rf(function(c){a.contains(c.rect)&&b.push(c)});return b};a.prototype.Zh=function(a){var b,c;var f=[];var g={};var h=0;for(c=a.length;h<
c;h++){for(b=a[h];b.Ck()&&b.parent;)this.log("Node type %s:%s is a group member",b.id,b.type()),b=b.parent;b.id in g||(g[b.id]=b,f.push(b))}this.Wt(f);return f};a.prototype.Rq=function(a){function b(a){if(!(a.id in f)&&(f[a.id]=a,c.push(a),a.children))for(var d=0;d<a.children.length;d++)b(a.children[d])}for(var c=[],f={},g=0;g<a.length;g++)b(a[g]);return c};a.prototype.sb=function(a,c){function b(d){var e;if(d.children){a&&c(d);var f=d.children;var k=0;for(e=f.length;k<e;k++)d=f[k],b(d)}else c(d)}
b(this.root)};a.prototype.Rf=function(a,c){function b(c){if(c.children)for(var d=0;d<c.children.length;d++)b(c.children[d]);else"PageNode"!==c.type()&&a(c)}void 0===c&&(c=this.Ua);c<this.ab.length&&b(this.ab[c||0])};a.prototype.filter=function(a){var b=[];this.sb(!1,function(c){if(a(c))return b.push(c)});return b};a.prototype.Wt=function(a){var b=0;this.ni&&(this.ni=!1,this.sb(!0,function(a){a.order=b++}));a.sort(function(a,b){return a.order-b.order})};a.prototype.Mg=function(a,c){var b;var d=new ld(a,
this);this.Hf(d);var g=0;for(b=c.length;g<b;g++){var h=c[g];this.qb(d,this.ra[h],-1)}return d};a.prototype.pt=function(a){var b,c=[];var f=0;var g=this.Zh(a);var h=0;for(b=g.length;h<b;h++)a=g[h],f=this.Bm(a,c,f,null);return"zwibblerclip."+JSON.stringify(c)};a.prototype.Bm=function(a,c,e,f){var b=a.uc(),d={},k;for(k in b){var l=b[k];l instanceof M&&(l=["Matrix",l.m11,l.m12,l.m21,l.m22,l.Ca,l.Da]);d[k]=l}c.push({type:"CreateAction",node:a.type(),parent:f,properties:d});f=e+1;if(a.children)for(b=0,
a=a.children;b<a.length;b++)f=this.Bm(a[b],c,f,e);return f};a.prototype.eo=function(a,c){var b,d;0===a.indexOf("zwibblerclip.")&&(a=a.substr(13));var g=[];var h=JSON.parse(a);var k=[];var l={},m=0,n=0;var q=0;for(d=h.length;q<d;q++){var u=h[q];if("GroupAction"===u.type){var v=this.Va();l[m++]=v;var z=[];var w=0;for(u=u.members;w<u.length;w++)z.push(l[u[w]]);k.push(new Ad(v,z));g.push(v)}else if("CreateAction"===u.type){w=u.properties;z={};for(b in w)w.hasOwnProperty(b)&&(v=w[b],"[object Array]"===
Object.prototype.toString.apply(v)&&"Matrix"===v[0]&&(v.splice(0,1),v=new M(v)),z[b]=v);v=this.Va();l[m++]=v;w=null;var y=-1;"parent"in u&&u.parent in l?w=l[u.parent]:"PageNode"===u.node&&(w=this.root.id,y=this.Ua+1+n,n+=1);k.push(new V(v,u.node,z,w,y));g.push(v)}}0!==n||c.Dk()||k.push(new Pd(g,c));return k};a.prototype.qb=function(a,c,e){var b=null,d=0;c.parent&&(b=c.parent.id,d=c.Te(),this.removeNode(c,!1));-1===e?a.children.push(c):a.children.splice(e,0,c);c instanceof Ke&&(-1===e?this.ab.push(c):
this.ab.splice(e,0,c));c.parent=a;this.zj(c,this.ge(a.id),!0,b,d);this.ni=!0};a.prototype.lt=function(a,c){var b="function"!==typeof c?function(a){return a===c}:c;for(var d=0,g=0;g<a.length;g++)b(a[g])?d+=1:d&&(a[g-d]=a[g]);a.length-=d};a.prototype.removeNode=function(a,c){void 0===c&&(c=!0);var b=this,d=this.ge(a.id);if(!a.parent||null===d)return this.log("Error: removeNode -- should not happen!"),-1;var g=a.parent.jk(a);if(0<=g&&(c&&this.$c.sc(a.id,a.parent.id,g),a.parent.children.splice(g,1),a.parent=
null,c)){var h=function(a){var c;delete b.ra[a.id];b.Zc.remove(a.id);b.removedNodes.add(a.id);a.Xk();b.pe.remove(a.id);if(a.children){var d=a.children;var e=0;for(c=d.length;e<c;e++){var f=d[e];h(f)}}a.la("spotHighlight")&&b.lt(b.sd,a);b.Hb.remove(a.id);b.ck.remove(a.id);b.ak.remove(a.id)};h(a)}"PageNode"===a.type()?(this.ab.splice(g,1),g===this.Ua&&(this.log("Removed current page."),this.Bb(Math.min(g,this.ab.length-1)),this.bg=this.Ua),this.Qg=-1):this.bg=d;return g};a.prototype.yn=function(){var a=
0,c=0,e=0,f=0,g=!1;this.sb(!1,function(b){if(!g||b.rect.x<a)a=b.rect.x;if(!g||b.rect.right()>c)c=b.rect.right();if(!g||b.rect.y<e)e=b.rect.y;if(!g||b.rect.bottom()>f)f=b.rect.bottom();g=!0});return g?new K(a,e,c-a,f-e):new K(0,0,10,10)};a.prototype.Ve=function(){return this.aa.width?new K(0,0,this.aa.width,this.aa.height):this.yn()};a.prototype.la=function(a){return this.aa[a]};a.prototype.Zr=function(){return"width"in this.aa};a.prototype.setProperty=function(a,c){null===c?a in this.aa&&delete this.aa[a]:
this.aa[a]=c;var b={};b[a]=c;this.$c.Cb(this.root.id,b)};a.prototype.ue=function(a,c,e){a===this.root&&this.setProperty(c,e);a.setProperty(c,e);var b={};b[c]=e;this.$c.Cb(a.id,b);if("spotHighlight"===c&&"PathNode"===a.type()){for(c=0;c<this.sd.length;c++)if(this.sd[c]===a){this.sd.splice(c,1);break}e?(this.log("Added node %s to spotHighlightNodes",a.id),this.sd.push(a)):this.log("Removed node %s from spotHighlightNodes",a.id)}};a.prototype.yh=function(a,c){this.log("showLayer(%s, %s)",a,c);c?this.yi.remove(a):
this.yi.add(a)};a.prototype.Ek=function(a){return!this.yi.contains(a)};a.prototype.fh=function(a){this.log("Adding page to document with index %s",a);if(a>this.ab.length)return this.log("Error: Can insert page with index %s",a),-1;var b=R.create("PageNode",this.Va(),this);this.qb(this.root,b,a);return a};a.prototype.Ec=function(){return this.ab.length};a.prototype.Bb=function(a){if(a!==this.Ua){if(0<=a&&a<this.ab.length)return this.log("Set current page to %s/%s",a,this.ab.length),this.Ua=a,!0;this.log("Tried to set page to non-existing %s",
a);return!1}};a.prototype.Qt=function(){this.Qg!==this.Ua&&(this.Kl(this.Qg,!1),this.Kl(this.Ua,!0),this.Qg=this.Ua)};a.prototype.Kl=function(a,c){var b=this;c?this.Rf(function(a){"DomNode"===a.type()&&a.Vk()},a):this.ak.sb(function(a){(a=b.za(parseInt(a,10),!1))&&a.Xk()})};a.prototype.vk=function(a){return 0===this.ab.length?this.root:void 0===a?this.ab[this.Ua]:this.ab[a]};a.prototype.wk=function(){var a=816,c=1056;"width"in this.aa&&(a=this.aa.width);"height"in this.aa&&(c=this.aa.height);return new xc(a,
c)};a.prototype.rg=function(a){this.sb(!1,function(b){b.rg(a)})};a.prototype.getRootNode=function(){return this.root};a.prototype.It=function(a,c){void 0===c&&(c=!0);this.$c=a;c&&(this.$c.Cb(this.root.id,this.aa),this.sb(!0,function(b){if(b.parent){var c=b.uc();c.type=b.type();a.createNode(b.id,b.parent.id,b.Te(),c)}}))};return a}(Hb);}).call(window);
